function $w(i,e){for(var t=0;t<e.length;t++){const n=e[t];if(typeof n!="string"&&!Array.isArray(n)){for(const r in n)if(r!=="default"&&!(r in i)){const s=Object.getOwnPropertyDescriptor(n,r);s&&Object.defineProperty(i,r,s.get?s:{enumerable:!0,get:()=>n[r]})}}}return Object.freeze(Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function t(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=t(r);fetch(r.href,s)}})();function jw(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var nh={exports:{}},oo={},ih={exports:{}},He={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var j0;function Vw(){if(j0)return He;j0=1;var i=Symbol.for("react.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),a=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),d=Symbol.for("react.suspense"),c=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),m=Symbol.iterator;function p(P){return P===null||typeof P!="object"?null:(P=m&&P[m]||P["@@iterator"],typeof P=="function"?P:null)}var y={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},v=Object.assign,E={};function S(P,j,he){this.props=P,this.context=j,this.refs=E,this.updater=he||y}S.prototype.isReactComponent={},S.prototype.setState=function(P,j){if(typeof P!="object"&&typeof P!="function"&&P!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,P,j,"setState")},S.prototype.forceUpdate=function(P){this.updater.enqueueForceUpdate(this,P,"forceUpdate")};function A(){}A.prototype=S.prototype;function L(P,j,he){this.props=P,this.context=j,this.refs=E,this.updater=he||y}var R=L.prototype=new A;R.constructor=L,v(R,S.prototype),R.isPureReactComponent=!0;var D=Array.isArray,k=Object.prototype.hasOwnProperty,U={current:null},C={key:!0,ref:!0,__self:!0,__source:!0};function _(P,j,he){var ge,te={},fe=null,Pe=null;if(j!=null)for(ge in j.ref!==void 0&&(Pe=j.ref),j.key!==void 0&&(fe=""+j.key),j)k.call(j,ge)&&!C.hasOwnProperty(ge)&&(te[ge]=j[ge]);var be=arguments.length-2;if(be===1)te.children=he;else if(1<be){for(var Ve=Array(be),Ze=0;Ze<be;Ze++)Ve[Ze]=arguments[Ze+2];te.children=Ve}if(P&&P.defaultProps)for(ge in be=P.defaultProps,be)te[ge]===void 0&&(te[ge]=be[ge]);return{$$typeof:i,type:P,key:fe,ref:Pe,props:te,_owner:U.current}}function F(P,j){return{$$typeof:i,type:P.type,key:j,ref:P.ref,props:P.props,_owner:P._owner}}function O(P){return typeof P=="object"&&P!==null&&P.$$typeof===i}function W(P){var j={"=":"=0",":":"=2"};return"$"+P.replace(/[=:]/g,function(he){return j[he]})}var z=/\/+/g;function re(P,j){return typeof P=="object"&&P!==null&&P.key!=null?W(""+P.key):j.toString(36)}function ae(P,j,he,ge,te){var fe=typeof P;(fe==="undefined"||fe==="boolean")&&(P=null);var Pe=!1;if(P===null)Pe=!0;else switch(fe){case"string":case"number":Pe=!0;break;case"object":switch(P.$$typeof){case i:case e:Pe=!0}}if(Pe)return Pe=P,te=te(Pe),P=ge===""?"."+re(Pe,0):ge,D(te)?(he="",P!=null&&(he=P.replace(z,"$&/")+"/"),ae(te,j,he,"",function(Ze){return Ze})):te!=null&&(O(te)&&(te=F(te,he+(!te.key||Pe&&Pe.key===te.key?"":(""+te.key).replace(z,"$&/")+"/")+P)),j.push(te)),1;if(Pe=0,ge=ge===""?".":ge+":",D(P))for(var be=0;be<P.length;be++){fe=P[be];var Ve=ge+re(fe,be);Pe+=ae(fe,j,he,Ve,te)}else if(Ve=p(P),typeof Ve=="function")for(P=Ve.call(P),be=0;!(fe=P.next()).done;)fe=fe.value,Ve=ge+re(fe,be++),Pe+=ae(fe,j,he,Ve,te);else if(fe==="object")throw j=String(P),Error("Objects are not valid as a React child (found: "+(j==="[object Object]"?"object with keys {"+Object.keys(P).join(", ")+"}":j)+"). If you meant to render a collection of children, use an array instead.");return Pe}function ce(P,j,he){if(P==null)return P;var ge=[],te=0;return ae(P,ge,"","",function(fe){return j.call(he,fe,te++)}),ge}function ne(P){if(P._status===-1){var j=P._result;j=j(),j.then(function(he){(P._status===0||P._status===-1)&&(P._status=1,P._result=he)},function(he){(P._status===0||P._status===-1)&&(P._status=2,P._result=he)}),P._status===-1&&(P._status=0,P._result=j)}if(P._status===1)return P._result.default;throw P._result}var ie={current:null},G={transition:null},ee={ReactCurrentDispatcher:ie,ReactCurrentBatchConfig:G,ReactCurrentOwner:U};function J(){throw Error("act(...) is not supported in production builds of React.")}return He.Children={map:ce,forEach:function(P,j,he){ce(P,function(){j.apply(this,arguments)},he)},count:function(P){var j=0;return ce(P,function(){j++}),j},toArray:function(P){return ce(P,function(j){return j})||[]},only:function(P){if(!O(P))throw Error("React.Children.only expected to receive a single React element child.");return P}},He.Component=S,He.Fragment=t,He.Profiler=r,He.PureComponent=L,He.StrictMode=n,He.Suspense=d,He.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ee,He.act=J,He.cloneElement=function(P,j,he){if(P==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+P+".");var ge=v({},P.props),te=P.key,fe=P.ref,Pe=P._owner;if(j!=null){if(j.ref!==void 0&&(fe=j.ref,Pe=U.current),j.key!==void 0&&(te=""+j.key),P.type&&P.type.defaultProps)var be=P.type.defaultProps;for(Ve in j)k.call(j,Ve)&&!C.hasOwnProperty(Ve)&&(ge[Ve]=j[Ve]===void 0&&be!==void 0?be[Ve]:j[Ve])}var Ve=arguments.length-2;if(Ve===1)ge.children=he;else if(1<Ve){be=Array(Ve);for(var Ze=0;Ze<Ve;Ze++)be[Ze]=arguments[Ze+2];ge.children=be}return{$$typeof:i,type:P.type,key:te,ref:fe,props:ge,_owner:Pe}},He.createContext=function(P){return P={$$typeof:a,_currentValue:P,_currentValue2:P,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},P.Provider={$$typeof:s,_context:P},P.Consumer=P},He.createElement=_,He.createFactory=function(P){var j=_.bind(null,P);return j.type=P,j},He.createRef=function(){return{current:null}},He.forwardRef=function(P){return{$$typeof:u,render:P}},He.isValidElement=O,He.lazy=function(P){return{$$typeof:h,_payload:{_status:-1,_result:P},_init:ne}},He.memo=function(P,j){return{$$typeof:c,type:P,compare:j===void 0?null:j}},He.startTransition=function(P){var j=G.transition;G.transition={};try{P()}finally{G.transition=j}},He.unstable_act=J,He.useCallback=function(P,j){return ie.current.useCallback(P,j)},He.useContext=function(P){return ie.current.useContext(P)},He.useDebugValue=function(){},He.useDeferredValue=function(P){return ie.current.useDeferredValue(P)},He.useEffect=function(P,j){return ie.current.useEffect(P,j)},He.useId=function(){return ie.current.useId()},He.useImperativeHandle=function(P,j,he){return ie.current.useImperativeHandle(P,j,he)},He.useInsertionEffect=function(P,j){return ie.current.useInsertionEffect(P,j)},He.useLayoutEffect=function(P,j){return ie.current.useLayoutEffect(P,j)},He.useMemo=function(P,j){return ie.current.useMemo(P,j)},He.useReducer=function(P,j,he){return ie.current.useReducer(P,j,he)},He.useRef=function(P){return ie.current.useRef(P)},He.useState=function(P){return ie.current.useState(P)},He.useSyncExternalStore=function(P,j,he){return ie.current.useSyncExternalStore(P,j,he)},He.useTransition=function(){return ie.current.useTransition()},He.version="18.3.1",He}var V0;function tm(){return V0||(V0=1,ih.exports=Vw()),ih.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var G0;function Gw(){if(G0)return oo;G0=1;var i=tm(),e=Symbol.for("react.element"),t=Symbol.for("react.fragment"),n=Object.prototype.hasOwnProperty,r=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s={key:!0,ref:!0,__self:!0,__source:!0};function a(u,d,c){var h,m={},p=null,y=null;c!==void 0&&(p=""+c),d.key!==void 0&&(p=""+d.key),d.ref!==void 0&&(y=d.ref);for(h in d)n.call(d,h)&&!s.hasOwnProperty(h)&&(m[h]=d[h]);if(u&&u.defaultProps)for(h in d=u.defaultProps,d)m[h]===void 0&&(m[h]=d[h]);return{$$typeof:e,type:u,key:p,ref:y,props:m,_owner:r.current}}return oo.Fragment=t,oo.jsx=a,oo.jsxs=a,oo}var H0;function Hw(){return H0||(H0=1,nh.exports=Gw()),nh.exports}var b=Hw(),ru={},rh={exports:{}},An={},sh={exports:{}},ah={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var z0;function zw(){return z0||(z0=1,(function(i){function e(G,ee){var J=G.length;G.push(ee);e:for(;0<J;){var P=J-1>>>1,j=G[P];if(0<r(j,ee))G[P]=ee,G[J]=j,J=P;else break e}}function t(G){return G.length===0?null:G[0]}function n(G){if(G.length===0)return null;var ee=G[0],J=G.pop();if(J!==ee){G[0]=J;e:for(var P=0,j=G.length,he=j>>>1;P<he;){var ge=2*(P+1)-1,te=G[ge],fe=ge+1,Pe=G[fe];if(0>r(te,J))fe<j&&0>r(Pe,te)?(G[P]=Pe,G[fe]=J,P=fe):(G[P]=te,G[ge]=J,P=ge);else if(fe<j&&0>r(Pe,J))G[P]=Pe,G[fe]=J,P=fe;else break e}}return ee}function r(G,ee){var J=G.sortIndex-ee.sortIndex;return J!==0?J:G.id-ee.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;i.unstable_now=function(){return s.now()}}else{var a=Date,u=a.now();i.unstable_now=function(){return a.now()-u}}var d=[],c=[],h=1,m=null,p=3,y=!1,v=!1,E=!1,S=typeof setTimeout=="function"?setTimeout:null,A=typeof clearTimeout=="function"?clearTimeout:null,L=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function R(G){for(var ee=t(c);ee!==null;){if(ee.callback===null)n(c);else if(ee.startTime<=G)n(c),ee.sortIndex=ee.expirationTime,e(d,ee);else break;ee=t(c)}}function D(G){if(E=!1,R(G),!v)if(t(d)!==null)v=!0,ne(k);else{var ee=t(c);ee!==null&&ie(D,ee.startTime-G)}}function k(G,ee){v=!1,E&&(E=!1,A(_),_=-1),y=!0;var J=p;try{for(R(ee),m=t(d);m!==null&&(!(m.expirationTime>ee)||G&&!W());){var P=m.callback;if(typeof P=="function"){m.callback=null,p=m.priorityLevel;var j=P(m.expirationTime<=ee);ee=i.unstable_now(),typeof j=="function"?m.callback=j:m===t(d)&&n(d),R(ee)}else n(d);m=t(d)}if(m!==null)var he=!0;else{var ge=t(c);ge!==null&&ie(D,ge.startTime-ee),he=!1}return he}finally{m=null,p=J,y=!1}}var U=!1,C=null,_=-1,F=5,O=-1;function W(){return!(i.unstable_now()-O<F)}function z(){if(C!==null){var G=i.unstable_now();O=G;var ee=!0;try{ee=C(!0,G)}finally{ee?re():(U=!1,C=null)}}else U=!1}var re;if(typeof L=="function")re=function(){L(z)};else if(typeof MessageChannel<"u"){var ae=new MessageChannel,ce=ae.port2;ae.port1.onmessage=z,re=function(){ce.postMessage(null)}}else re=function(){S(z,0)};function ne(G){C=G,U||(U=!0,re())}function ie(G,ee){_=S(function(){G(i.unstable_now())},ee)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(G){G.callback=null},i.unstable_continueExecution=function(){v||y||(v=!0,ne(k))},i.unstable_forceFrameRate=function(G){0>G||125<G?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):F=0<G?Math.floor(1e3/G):5},i.unstable_getCurrentPriorityLevel=function(){return p},i.unstable_getFirstCallbackNode=function(){return t(d)},i.unstable_next=function(G){switch(p){case 1:case 2:case 3:var ee=3;break;default:ee=p}var J=p;p=ee;try{return G()}finally{p=J}},i.unstable_pauseExecution=function(){},i.unstable_requestPaint=function(){},i.unstable_runWithPriority=function(G,ee){switch(G){case 1:case 2:case 3:case 4:case 5:break;default:G=3}var J=p;p=G;try{return ee()}finally{p=J}},i.unstable_scheduleCallback=function(G,ee,J){var P=i.unstable_now();switch(typeof J=="object"&&J!==null?(J=J.delay,J=typeof J=="number"&&0<J?P+J:P):J=P,G){case 1:var j=-1;break;case 2:j=250;break;case 5:j=1073741823;break;case 4:j=1e4;break;default:j=5e3}return j=J+j,G={id:h++,callback:ee,priorityLevel:G,startTime:J,expirationTime:j,sortIndex:-1},J>P?(G.sortIndex=J,e(c,G),t(d)===null&&G===t(c)&&(E?(A(_),_=-1):E=!0,ie(D,J-P))):(G.sortIndex=j,e(d,G),v||y||(v=!0,ne(k))),G},i.unstable_shouldYield=W,i.unstable_wrapCallback=function(G){var ee=p;return function(){var J=p;p=ee;try{return G.apply(this,arguments)}finally{p=J}}}})(ah)),ah}var K0;function Kw(){return K0||(K0=1,sh.exports=zw()),sh.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var W0;function Ww(){if(W0)return An;W0=1;var i=tm(),e=Kw();function t(o){for(var l="https://reactjs.org/docs/error-decoder.html?invariant="+o,f=1;f<arguments.length;f++)l+="&args[]="+encodeURIComponent(arguments[f]);return"Minified React error #"+o+"; visit "+l+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var n=new Set,r={};function s(o,l){a(o,l),a(o+"Capture",l)}function a(o,l){for(r[o]=l,o=0;o<l.length;o++)n.add(l[o])}var u=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),d=Object.prototype.hasOwnProperty,c=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,h={},m={};function p(o){return d.call(m,o)?!0:d.call(h,o)?!1:c.test(o)?m[o]=!0:(h[o]=!0,!1)}function y(o,l,f,g){if(f!==null&&f.type===0)return!1;switch(typeof l){case"function":case"symbol":return!0;case"boolean":return g?!1:f!==null?!f.acceptsBooleans:(o=o.toLowerCase().slice(0,5),o!=="data-"&&o!=="aria-");default:return!1}}function v(o,l,f,g){if(l===null||typeof l>"u"||y(o,l,f,g))return!0;if(g)return!1;if(f!==null)switch(f.type){case 3:return!l;case 4:return l===!1;case 5:return isNaN(l);case 6:return isNaN(l)||1>l}return!1}function E(o,l,f,g,x,T,I){this.acceptsBooleans=l===2||l===3||l===4,this.attributeName=g,this.attributeNamespace=x,this.mustUseProperty=f,this.propertyName=o,this.type=l,this.sanitizeURL=T,this.removeEmptyString=I}var S={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(o){S[o]=new E(o,0,!1,o,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(o){var l=o[0];S[l]=new E(l,1,!1,o[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(o){S[o]=new E(o,2,!1,o.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(o){S[o]=new E(o,2,!1,o,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(o){S[o]=new E(o,3,!1,o.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(o){S[o]=new E(o,3,!0,o,null,!1,!1)}),["capture","download"].forEach(function(o){S[o]=new E(o,4,!1,o,null,!1,!1)}),["cols","rows","size","span"].forEach(function(o){S[o]=new E(o,6,!1,o,null,!1,!1)}),["rowSpan","start"].forEach(function(o){S[o]=new E(o,5,!1,o.toLowerCase(),null,!1,!1)});var A=/[\-:]([a-z])/g;function L(o){return o[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(o){var l=o.replace(A,L);S[l]=new E(l,1,!1,o,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(o){var l=o.replace(A,L);S[l]=new E(l,1,!1,o,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(o){var l=o.replace(A,L);S[l]=new E(l,1,!1,o,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(o){S[o]=new E(o,1,!1,o.toLowerCase(),null,!1,!1)}),S.xlinkHref=new E("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(o){S[o]=new E(o,1,!1,o.toLowerCase(),null,!0,!0)});function R(o,l,f,g){var x=S.hasOwnProperty(l)?S[l]:null;(x!==null?x.type!==0:g||!(2<l.length)||l[0]!=="o"&&l[0]!=="O"||l[1]!=="n"&&l[1]!=="N")&&(v(l,f,x,g)&&(f=null),g||x===null?p(l)&&(f===null?o.removeAttribute(l):o.setAttribute(l,""+f)):x.mustUseProperty?o[x.propertyName]=f===null?x.type===3?!1:"":f:(l=x.attributeName,g=x.attributeNamespace,f===null?o.removeAttribute(l):(x=x.type,f=x===3||x===4&&f===!0?"":""+f,g?o.setAttributeNS(g,l,f):o.setAttribute(l,f))))}var D=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,k=Symbol.for("react.element"),U=Symbol.for("react.portal"),C=Symbol.for("react.fragment"),_=Symbol.for("react.strict_mode"),F=Symbol.for("react.profiler"),O=Symbol.for("react.provider"),W=Symbol.for("react.context"),z=Symbol.for("react.forward_ref"),re=Symbol.for("react.suspense"),ae=Symbol.for("react.suspense_list"),ce=Symbol.for("react.memo"),ne=Symbol.for("react.lazy"),ie=Symbol.for("react.offscreen"),G=Symbol.iterator;function ee(o){return o===null||typeof o!="object"?null:(o=G&&o[G]||o["@@iterator"],typeof o=="function"?o:null)}var J=Object.assign,P;function j(o){if(P===void 0)try{throw Error()}catch(f){var l=f.stack.trim().match(/\n( *(at )?)/);P=l&&l[1]||""}return`
`+P+o}var he=!1;function ge(o,l){if(!o||he)return"";he=!0;var f=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(l)if(l=function(){throw Error()},Object.defineProperty(l.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(l,[])}catch(Z){var g=Z}Reflect.construct(o,[],l)}else{try{l.call()}catch(Z){g=Z}o.call(l.prototype)}else{try{throw Error()}catch(Z){g=Z}o()}}catch(Z){if(Z&&g&&typeof Z.stack=="string"){for(var x=Z.stack.split(`
`),T=g.stack.split(`
`),I=x.length-1,N=T.length-1;1<=I&&0<=N&&x[I]!==T[N];)N--;for(;1<=I&&0<=N;I--,N--)if(x[I]!==T[N]){if(I!==1||N!==1)do if(I--,N--,0>N||x[I]!==T[N]){var $=`
`+x[I].replace(" at new "," at ");return o.displayName&&$.includes("<anonymous>")&&($=$.replace("<anonymous>",o.displayName)),$}while(1<=I&&0<=N);break}}}finally{he=!1,Error.prepareStackTrace=f}return(o=o?o.displayName||o.name:"")?j(o):""}function te(o){switch(o.tag){case 5:return j(o.type);case 16:return j("Lazy");case 13:return j("Suspense");case 19:return j("SuspenseList");case 0:case 2:case 15:return o=ge(o.type,!1),o;case 11:return o=ge(o.type.render,!1),o;case 1:return o=ge(o.type,!0),o;default:return""}}function fe(o){if(o==null)return null;if(typeof o=="function")return o.displayName||o.name||null;if(typeof o=="string")return o;switch(o){case C:return"Fragment";case U:return"Portal";case F:return"Profiler";case _:return"StrictMode";case re:return"Suspense";case ae:return"SuspenseList"}if(typeof o=="object")switch(o.$$typeof){case W:return(o.displayName||"Context")+".Consumer";case O:return(o._context.displayName||"Context")+".Provider";case z:var l=o.render;return o=o.displayName,o||(o=l.displayName||l.name||"",o=o!==""?"ForwardRef("+o+")":"ForwardRef"),o;case ce:return l=o.displayName||null,l!==null?l:fe(o.type)||"Memo";case ne:l=o._payload,o=o._init;try{return fe(o(l))}catch{}}return null}function Pe(o){var l=o.type;switch(o.tag){case 24:return"Cache";case 9:return(l.displayName||"Context")+".Consumer";case 10:return(l._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return o=l.render,o=o.displayName||o.name||"",l.displayName||(o!==""?"ForwardRef("+o+")":"ForwardRef");case 7:return"Fragment";case 5:return l;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return fe(l);case 8:return l===_?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof l=="function")return l.displayName||l.name||null;if(typeof l=="string")return l}return null}function be(o){switch(typeof o){case"boolean":case"number":case"string":case"undefined":return o;case"object":return o;default:return""}}function Ve(o){var l=o.type;return(o=o.nodeName)&&o.toLowerCase()==="input"&&(l==="checkbox"||l==="radio")}function Ze(o){var l=Ve(o)?"checked":"value",f=Object.getOwnPropertyDescriptor(o.constructor.prototype,l),g=""+o[l];if(!o.hasOwnProperty(l)&&typeof f<"u"&&typeof f.get=="function"&&typeof f.set=="function"){var x=f.get,T=f.set;return Object.defineProperty(o,l,{configurable:!0,get:function(){return x.call(this)},set:function(I){g=""+I,T.call(this,I)}}),Object.defineProperty(o,l,{enumerable:f.enumerable}),{getValue:function(){return g},setValue:function(I){g=""+I},stopTracking:function(){o._valueTracker=null,delete o[l]}}}}function pn(o){o._valueTracker||(o._valueTracker=Ze(o))}function At(o){if(!o)return!1;var l=o._valueTracker;if(!l)return!0;var f=l.getValue(),g="";return o&&(g=Ve(o)?o.checked?"true":"false":o.value),o=g,o!==f?(l.setValue(o),!0):!1}function sn(o){if(o=o||(typeof document<"u"?document:void 0),typeof o>"u")return null;try{return o.activeElement||o.body}catch{return o.body}}function vi(o,l){var f=l.checked;return J({},l,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:f??o._wrapperState.initialChecked})}function Ta(o,l){var f=l.defaultValue==null?"":l.defaultValue,g=l.checked!=null?l.checked:l.defaultChecked;f=be(l.value!=null?l.value:f),o._wrapperState={initialChecked:g,initialValue:f,controlled:l.type==="checkbox"||l.type==="radio"?l.checked!=null:l.value!=null}}function $e(o,l){l=l.checked,l!=null&&R(o,"checked",l,!1)}function xt(o,l){$e(o,l);var f=be(l.value),g=l.type;if(f!=null)g==="number"?(f===0&&o.value===""||o.value!=f)&&(o.value=""+f):o.value!==""+f&&(o.value=""+f);else if(g==="submit"||g==="reset"){o.removeAttribute("value");return}l.hasOwnProperty("value")?gn(o,l.type,f):l.hasOwnProperty("defaultValue")&&gn(o,l.type,be(l.defaultValue)),l.checked==null&&l.defaultChecked!=null&&(o.defaultChecked=!!l.defaultChecked)}function Ht(o,l,f){if(l.hasOwnProperty("value")||l.hasOwnProperty("defaultValue")){var g=l.type;if(!(g!=="submit"&&g!=="reset"||l.value!==void 0&&l.value!==null))return;l=""+o._wrapperState.initialValue,f||l===o.value||(o.value=l),o.defaultValue=l}f=o.name,f!==""&&(o.name=""),o.defaultChecked=!!o._wrapperState.initialChecked,f!==""&&(o.name=f)}function gn(o,l,f){(l!=="number"||sn(o.ownerDocument)!==o)&&(f==null?o.defaultValue=""+o._wrapperState.initialValue:o.defaultValue!==""+f&&(o.defaultValue=""+f))}var _t=Array.isArray;function an(o,l,f,g){if(o=o.options,l){l={};for(var x=0;x<f.length;x++)l["$"+f[x]]=!0;for(f=0;f<o.length;f++)x=l.hasOwnProperty("$"+o[f].value),o[f].selected!==x&&(o[f].selected=x),x&&g&&(o[f].defaultSelected=!0)}else{for(f=""+be(f),l=null,x=0;x<o.length;x++){if(o[x].value===f){o[x].selected=!0,g&&(o[x].defaultSelected=!0);return}l!==null||o[x].disabled||(l=o[x])}l!==null&&(l.selected=!0)}}function Rn(o,l){if(l.dangerouslySetInnerHTML!=null)throw Error(t(91));return J({},l,{value:void 0,defaultValue:void 0,children:""+o._wrapperState.initialValue})}function Hr(o,l){var f=l.value;if(f==null){if(f=l.children,l=l.defaultValue,f!=null){if(l!=null)throw Error(t(92));if(_t(f)){if(1<f.length)throw Error(t(93));f=f[0]}l=f}l==null&&(l=""),f=l}o._wrapperState={initialValue:be(f)}}function on(o,l){var f=be(l.value),g=be(l.defaultValue);f!=null&&(f=""+f,f!==o.value&&(o.value=f),l.defaultValue==null&&o.defaultValue!==f&&(o.defaultValue=f)),g!=null&&(o.defaultValue=""+g)}function ei(o){var l=o.textContent;l===o._wrapperState.initialValue&&l!==""&&l!==null&&(o.value=l)}function ti(o){switch(o){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function xi(o,l){return o==null||o==="http://www.w3.org/1999/xhtml"?ti(l):o==="http://www.w3.org/2000/svg"&&l==="foreignObject"?"http://www.w3.org/1999/xhtml":o}var Qt,ln=(function(o){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(l,f,g,x){MSApp.execUnsafeLocalFunction(function(){return o(l,f,g,x)})}:o})(function(o,l){if(o.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in o)o.innerHTML=l;else{for(Qt=Qt||document.createElement("div"),Qt.innerHTML="<svg>"+l.valueOf().toString()+"</svg>",l=Qt.firstChild;o.firstChild;)o.removeChild(o.firstChild);for(;l.firstChild;)o.appendChild(l.firstChild)}});function ni(o,l){if(l){var f=o.firstChild;if(f&&f===o.lastChild&&f.nodeType===3){f.nodeValue=l;return}}o.textContent=l}var bn={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Aa=["Webkit","ms","Moz","O"];Object.keys(bn).forEach(function(o){Aa.forEach(function(l){l=l+o.charAt(0).toUpperCase()+o.substring(1),bn[l]=bn[o]})});function Jo(o,l,f){return l==null||typeof l=="boolean"||l===""?"":f||typeof l!="number"||l===0||bn.hasOwnProperty(o)&&bn[o]?(""+l).trim():l+"px"}function Un(o,l){o=o.style;for(var f in l)if(l.hasOwnProperty(f)){var g=f.indexOf("--")===0,x=Jo(f,l[f],g);f==="float"&&(f="cssFloat"),g?o.setProperty(f,x):o[f]=x}}var el=J({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ws(o,l){if(l){if(el[o]&&(l.children!=null||l.dangerouslySetInnerHTML!=null))throw Error(t(137,o));if(l.dangerouslySetInnerHTML!=null){if(l.children!=null)throw Error(t(60));if(typeof l.dangerouslySetInnerHTML!="object"||!("__html"in l.dangerouslySetInnerHTML))throw Error(t(61))}if(l.style!=null&&typeof l.style!="object")throw Error(t(62))}}function Ls(o,l){if(o.indexOf("-")===-1)return typeof l.is=="string";switch(o){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var wa=null;function Rs(o){return o=o.target||o.srcElement||window,o.correspondingUseElement&&(o=o.correspondingUseElement),o.nodeType===3?o.parentNode:o}var rr=null,Ui=null,Ei=null;function tl(o){if(o=Ka(o)){if(typeof rr!="function")throw Error(t(280));var l=o.stateNode;l&&(l=xl(l),rr(o.stateNode,o.type,l))}}function La(o){Ui?Ei?Ei.push(o):Ei=[o]:Ui=o}function nl(){if(Ui){var o=Ui,l=Ei;if(Ei=Ui=null,tl(o),l)for(o=0;o<l.length;o++)tl(l[o])}}function Ra(o,l){return o(l)}function zr(){}var sr=!1;function ba(o,l,f){if(sr)return o(l,f);sr=!0;try{return Ra(o,l,f)}finally{sr=!1,(Ui!==null||Ei!==null)&&(zr(),nl())}}function Kr(o,l){var f=o.stateNode;if(f===null)return null;var g=xl(f);if(g===null)return null;f=g[l];e:switch(l){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(g=!g.disabled)||(o=o.type,g=!(o==="button"||o==="input"||o==="select"||o==="textarea")),o=!g;break e;default:o=!1}if(o)return null;if(f&&typeof f!="function")throw Error(t(231,l,typeof f));return f}var Ia=!1;if(u)try{var B={};Object.defineProperty(B,"passive",{get:function(){Ia=!0}}),window.addEventListener("test",B,B),window.removeEventListener("test",B,B)}catch{Ia=!1}function H(o,l,f,g,x,T,I,N,$){var Z=Array.prototype.slice.call(arguments,3);try{l.apply(f,Z)}catch(ue){this.onError(ue)}}var Q=!1,le=null,pe=!1,Ce=null,_e={onError:function(o){Q=!0,le=o}};function Ee(o,l,f,g,x,T,I,N,$){Q=!1,le=null,H.apply(_e,arguments)}function Te(o,l,f,g,x,T,I,N,$){if(Ee.apply(this,arguments),Q){if(Q){var Z=le;Q=!1,le=null}else throw Error(t(198));pe||(pe=!0,Ce=Z)}}function Le(o){var l=o,f=o;if(o.alternate)for(;l.return;)l=l.return;else{o=l;do l=o,(l.flags&4098)!==0&&(f=l.return),o=l.return;while(o)}return l.tag===3?f:null}function Be(o){if(o.tag===13){var l=o.memoizedState;if(l===null&&(o=o.alternate,o!==null&&(l=o.memoizedState)),l!==null)return l.dehydrated}return null}function ke(o){if(Le(o)!==o)throw Error(t(188))}function je(o){var l=o.alternate;if(!l){if(l=Le(o),l===null)throw Error(t(188));return l!==o?null:o}for(var f=o,g=l;;){var x=f.return;if(x===null)break;var T=x.alternate;if(T===null){if(g=x.return,g!==null){f=g;continue}break}if(x.child===T.child){for(T=x.child;T;){if(T===f)return ke(x),o;if(T===g)return ke(x),l;T=T.sibling}throw Error(t(188))}if(f.return!==g.return)f=x,g=T;else{for(var I=!1,N=x.child;N;){if(N===f){I=!0,f=x,g=T;break}if(N===g){I=!0,g=x,f=T;break}N=N.sibling}if(!I){for(N=T.child;N;){if(N===f){I=!0,f=T,g=x;break}if(N===g){I=!0,g=T,f=x;break}N=N.sibling}if(!I)throw Error(t(189))}}if(f.alternate!==g)throw Error(t(190))}if(f.tag!==3)throw Error(t(188));return f.stateNode.current===f?o:l}function We(o){return o=je(o),o!==null?It(o):null}function It(o){if(o.tag===5||o.tag===6)return o;for(o=o.child;o!==null;){var l=It(o);if(l!==null)return l;o=o.sibling}return null}var wt=e.unstable_scheduleCallback,Ut=e.unstable_cancelCallback,Qe=e.unstable_shouldYield,yn=e.unstable_requestPaint,Je=e.unstable_now,Wr=e.unstable_getCurrentPriorityLevel,$n=e.unstable_ImmediatePriority,In=e.unstable_UserBlockingPriority,ar=e.unstable_NormalPriority,Yr=e.unstable_LowPriority,Si=e.unstable_IdlePriority,$i=null,un=null;function Ye(o){if(un&&typeof un.onCommitFiberRoot=="function")try{un.onCommitFiberRoot($i,o,void 0,(o.current.flags&128)===128)}catch{}}var it=Math.clz32?Math.clz32:ht,or=Math.log,ji=Math.LN2;function ht(o){return o>>>=0,o===0?32:31-(or(o)/ji|0)|0}var Vi=64,qr=4194304;function Xr(o){switch(o&-o){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return o&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return o}}function il(o,l){var f=o.pendingLanes;if(f===0)return 0;var g=0,x=o.suspendedLanes,T=o.pingedLanes,I=f&268435455;if(I!==0){var N=I&~x;N!==0?g=Xr(N):(T&=I,T!==0&&(g=Xr(T)))}else I=f&~x,I!==0?g=Xr(I):T!==0&&(g=Xr(T));if(g===0)return 0;if(l!==0&&l!==g&&(l&x)===0&&(x=g&-g,T=l&-l,x>=T||x===16&&(T&4194240)!==0))return l;if((g&4)!==0&&(g|=f&16),l=o.entangledLanes,l!==0)for(o=o.entanglements,l&=g;0<l;)f=31-it(l),x=1<<f,g|=o[f],l&=~x;return g}function s1(o,l){switch(o){case 1:case 2:case 4:return l+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return l+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function a1(o,l){for(var f=o.suspendedLanes,g=o.pingedLanes,x=o.expirationTimes,T=o.pendingLanes;0<T;){var I=31-it(T),N=1<<I,$=x[I];$===-1?((N&f)===0||(N&g)!==0)&&(x[I]=s1(N,l)):$<=l&&(o.expiredLanes|=N),T&=~N}}function Ac(o){return o=o.pendingLanes&-1073741825,o!==0?o:o&1073741824?1073741824:0}function vp(){var o=Vi;return Vi<<=1,(Vi&4194240)===0&&(Vi=64),o}function wc(o){for(var l=[],f=0;31>f;f++)l.push(o);return l}function Ca(o,l,f){o.pendingLanes|=l,l!==536870912&&(o.suspendedLanes=0,o.pingedLanes=0),o=o.eventTimes,l=31-it(l),o[l]=f}function o1(o,l){var f=o.pendingLanes&~l;o.pendingLanes=l,o.suspendedLanes=0,o.pingedLanes=0,o.expiredLanes&=l,o.mutableReadLanes&=l,o.entangledLanes&=l,l=o.entanglements;var g=o.eventTimes;for(o=o.expirationTimes;0<f;){var x=31-it(f),T=1<<x;l[x]=0,g[x]=-1,o[x]=-1,f&=~T}}function Lc(o,l){var f=o.entangledLanes|=l;for(o=o.entanglements;f;){var g=31-it(f),x=1<<g;x&l|o[g]&l&&(o[g]|=l),f&=~x}}var et=0;function xp(o){return o&=-o,1<o?4<o?(o&268435455)!==0?16:536870912:4:1}var Ep,Rc,Sp,Tp,Ap,bc=!1,rl=[],lr=null,ur=null,cr=null,Da=new Map,ka=new Map,dr=[],l1="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function wp(o,l){switch(o){case"focusin":case"focusout":lr=null;break;case"dragenter":case"dragleave":ur=null;break;case"mouseover":case"mouseout":cr=null;break;case"pointerover":case"pointerout":Da.delete(l.pointerId);break;case"gotpointercapture":case"lostpointercapture":ka.delete(l.pointerId)}}function Pa(o,l,f,g,x,T){return o===null||o.nativeEvent!==T?(o={blockedOn:l,domEventName:f,eventSystemFlags:g,nativeEvent:T,targetContainers:[x]},l!==null&&(l=Ka(l),l!==null&&Rc(l)),o):(o.eventSystemFlags|=g,l=o.targetContainers,x!==null&&l.indexOf(x)===-1&&l.push(x),o)}function u1(o,l,f,g,x){switch(l){case"focusin":return lr=Pa(lr,o,l,f,g,x),!0;case"dragenter":return ur=Pa(ur,o,l,f,g,x),!0;case"mouseover":return cr=Pa(cr,o,l,f,g,x),!0;case"pointerover":var T=x.pointerId;return Da.set(T,Pa(Da.get(T)||null,o,l,f,g,x)),!0;case"gotpointercapture":return T=x.pointerId,ka.set(T,Pa(ka.get(T)||null,o,l,f,g,x)),!0}return!1}function Lp(o){var l=Qr(o.target);if(l!==null){var f=Le(l);if(f!==null){if(l=f.tag,l===13){if(l=Be(f),l!==null){o.blockedOn=l,Ap(o.priority,function(){Sp(f)});return}}else if(l===3&&f.stateNode.current.memoizedState.isDehydrated){o.blockedOn=f.tag===3?f.stateNode.containerInfo:null;return}}}o.blockedOn=null}function sl(o){if(o.blockedOn!==null)return!1;for(var l=o.targetContainers;0<l.length;){var f=Cc(o.domEventName,o.eventSystemFlags,l[0],o.nativeEvent);if(f===null){f=o.nativeEvent;var g=new f.constructor(f.type,f);wa=g,f.target.dispatchEvent(g),wa=null}else return l=Ka(f),l!==null&&Rc(l),o.blockedOn=f,!1;l.shift()}return!0}function Rp(o,l,f){sl(o)&&f.delete(l)}function c1(){bc=!1,lr!==null&&sl(lr)&&(lr=null),ur!==null&&sl(ur)&&(ur=null),cr!==null&&sl(cr)&&(cr=null),Da.forEach(Rp),ka.forEach(Rp)}function _a(o,l){o.blockedOn===l&&(o.blockedOn=null,bc||(bc=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,c1)))}function Ma(o){function l(x){return _a(x,o)}if(0<rl.length){_a(rl[0],o);for(var f=1;f<rl.length;f++){var g=rl[f];g.blockedOn===o&&(g.blockedOn=null)}}for(lr!==null&&_a(lr,o),ur!==null&&_a(ur,o),cr!==null&&_a(cr,o),Da.forEach(l),ka.forEach(l),f=0;f<dr.length;f++)g=dr[f],g.blockedOn===o&&(g.blockedOn=null);for(;0<dr.length&&(f=dr[0],f.blockedOn===null);)Lp(f),f.blockedOn===null&&dr.shift()}var bs=D.ReactCurrentBatchConfig,al=!0;function d1(o,l,f,g){var x=et,T=bs.transition;bs.transition=null;try{et=1,Ic(o,l,f,g)}finally{et=x,bs.transition=T}}function h1(o,l,f,g){var x=et,T=bs.transition;bs.transition=null;try{et=4,Ic(o,l,f,g)}finally{et=x,bs.transition=T}}function Ic(o,l,f,g){if(al){var x=Cc(o,l,f,g);if(x===null)Kc(o,l,g,ol,f),wp(o,g);else if(u1(x,o,l,f,g))g.stopPropagation();else if(wp(o,g),l&4&&-1<l1.indexOf(o)){for(;x!==null;){var T=Ka(x);if(T!==null&&Ep(T),T=Cc(o,l,f,g),T===null&&Kc(o,l,g,ol,f),T===x)break;x=T}x!==null&&g.stopPropagation()}else Kc(o,l,g,null,f)}}var ol=null;function Cc(o,l,f,g){if(ol=null,o=Rs(g),o=Qr(o),o!==null)if(l=Le(o),l===null)o=null;else if(f=l.tag,f===13){if(o=Be(l),o!==null)return o;o=null}else if(f===3){if(l.stateNode.current.memoizedState.isDehydrated)return l.tag===3?l.stateNode.containerInfo:null;o=null}else l!==o&&(o=null);return ol=o,null}function bp(o){switch(o){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Wr()){case $n:return 1;case In:return 4;case ar:case Yr:return 16;case Si:return 536870912;default:return 16}default:return 16}}var hr=null,Dc=null,ll=null;function Ip(){if(ll)return ll;var o,l=Dc,f=l.length,g,x="value"in hr?hr.value:hr.textContent,T=x.length;for(o=0;o<f&&l[o]===x[o];o++);var I=f-o;for(g=1;g<=I&&l[f-g]===x[T-g];g++);return ll=x.slice(o,1<g?1-g:void 0)}function ul(o){var l=o.keyCode;return"charCode"in o?(o=o.charCode,o===0&&l===13&&(o=13)):o=l,o===10&&(o=13),32<=o||o===13?o:0}function cl(){return!0}function Cp(){return!1}function Cn(o){function l(f,g,x,T,I){this._reactName=f,this._targetInst=x,this.type=g,this.nativeEvent=T,this.target=I,this.currentTarget=null;for(var N in o)o.hasOwnProperty(N)&&(f=o[N],this[N]=f?f(T):T[N]);return this.isDefaultPrevented=(T.defaultPrevented!=null?T.defaultPrevented:T.returnValue===!1)?cl:Cp,this.isPropagationStopped=Cp,this}return J(l.prototype,{preventDefault:function(){this.defaultPrevented=!0;var f=this.nativeEvent;f&&(f.preventDefault?f.preventDefault():typeof f.returnValue!="unknown"&&(f.returnValue=!1),this.isDefaultPrevented=cl)},stopPropagation:function(){var f=this.nativeEvent;f&&(f.stopPropagation?f.stopPropagation():typeof f.cancelBubble!="unknown"&&(f.cancelBubble=!0),this.isPropagationStopped=cl)},persist:function(){},isPersistent:cl}),l}var Is={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(o){return o.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},kc=Cn(Is),Na=J({},Is,{view:0,detail:0}),f1=Cn(Na),Pc,_c,Oa,dl=J({},Na,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Nc,button:0,buttons:0,relatedTarget:function(o){return o.relatedTarget===void 0?o.fromElement===o.srcElement?o.toElement:o.fromElement:o.relatedTarget},movementX:function(o){return"movementX"in o?o.movementX:(o!==Oa&&(Oa&&o.type==="mousemove"?(Pc=o.screenX-Oa.screenX,_c=o.screenY-Oa.screenY):_c=Pc=0,Oa=o),Pc)},movementY:function(o){return"movementY"in o?o.movementY:_c}}),Dp=Cn(dl),m1=J({},dl,{dataTransfer:0}),p1=Cn(m1),g1=J({},Na,{relatedTarget:0}),Mc=Cn(g1),y1=J({},Is,{animationName:0,elapsedTime:0,pseudoElement:0}),v1=Cn(y1),x1=J({},Is,{clipboardData:function(o){return"clipboardData"in o?o.clipboardData:window.clipboardData}}),E1=Cn(x1),S1=J({},Is,{data:0}),kp=Cn(S1),T1={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},A1={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},w1={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function L1(o){var l=this.nativeEvent;return l.getModifierState?l.getModifierState(o):(o=w1[o])?!!l[o]:!1}function Nc(){return L1}var R1=J({},Na,{key:function(o){if(o.key){var l=T1[o.key]||o.key;if(l!=="Unidentified")return l}return o.type==="keypress"?(o=ul(o),o===13?"Enter":String.fromCharCode(o)):o.type==="keydown"||o.type==="keyup"?A1[o.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Nc,charCode:function(o){return o.type==="keypress"?ul(o):0},keyCode:function(o){return o.type==="keydown"||o.type==="keyup"?o.keyCode:0},which:function(o){return o.type==="keypress"?ul(o):o.type==="keydown"||o.type==="keyup"?o.keyCode:0}}),b1=Cn(R1),I1=J({},dl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Pp=Cn(I1),C1=J({},Na,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Nc}),D1=Cn(C1),k1=J({},Is,{propertyName:0,elapsedTime:0,pseudoElement:0}),P1=Cn(k1),_1=J({},dl,{deltaX:function(o){return"deltaX"in o?o.deltaX:"wheelDeltaX"in o?-o.wheelDeltaX:0},deltaY:function(o){return"deltaY"in o?o.deltaY:"wheelDeltaY"in o?-o.wheelDeltaY:"wheelDelta"in o?-o.wheelDelta:0},deltaZ:0,deltaMode:0}),M1=Cn(_1),N1=[9,13,27,32],Oc=u&&"CompositionEvent"in window,Fa=null;u&&"documentMode"in document&&(Fa=document.documentMode);var O1=u&&"TextEvent"in window&&!Fa,_p=u&&(!Oc||Fa&&8<Fa&&11>=Fa),Mp=" ",Np=!1;function Op(o,l){switch(o){case"keyup":return N1.indexOf(l.keyCode)!==-1;case"keydown":return l.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Fp(o){return o=o.detail,typeof o=="object"&&"data"in o?o.data:null}var Cs=!1;function F1(o,l){switch(o){case"compositionend":return Fp(l);case"keypress":return l.which!==32?null:(Np=!0,Mp);case"textInput":return o=l.data,o===Mp&&Np?null:o;default:return null}}function B1(o,l){if(Cs)return o==="compositionend"||!Oc&&Op(o,l)?(o=Ip(),ll=Dc=hr=null,Cs=!1,o):null;switch(o){case"paste":return null;case"keypress":if(!(l.ctrlKey||l.altKey||l.metaKey)||l.ctrlKey&&l.altKey){if(l.char&&1<l.char.length)return l.char;if(l.which)return String.fromCharCode(l.which)}return null;case"compositionend":return _p&&l.locale!=="ko"?null:l.data;default:return null}}var U1={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Bp(o){var l=o&&o.nodeName&&o.nodeName.toLowerCase();return l==="input"?!!U1[o.type]:l==="textarea"}function Up(o,l,f,g){La(g),l=gl(l,"onChange"),0<l.length&&(f=new kc("onChange","change",null,f,g),o.push({event:f,listeners:l}))}var Ba=null,Ua=null;function $1(o){ig(o,0)}function hl(o){var l=Ms(o);if(At(l))return o}function j1(o,l){if(o==="change")return l}var $p=!1;if(u){var Fc;if(u){var Bc="oninput"in document;if(!Bc){var jp=document.createElement("div");jp.setAttribute("oninput","return;"),Bc=typeof jp.oninput=="function"}Fc=Bc}else Fc=!1;$p=Fc&&(!document.documentMode||9<document.documentMode)}function Vp(){Ba&&(Ba.detachEvent("onpropertychange",Gp),Ua=Ba=null)}function Gp(o){if(o.propertyName==="value"&&hl(Ua)){var l=[];Up(l,Ua,o,Rs(o)),ba($1,l)}}function V1(o,l,f){o==="focusin"?(Vp(),Ba=l,Ua=f,Ba.attachEvent("onpropertychange",Gp)):o==="focusout"&&Vp()}function G1(o){if(o==="selectionchange"||o==="keyup"||o==="keydown")return hl(Ua)}function H1(o,l){if(o==="click")return hl(l)}function z1(o,l){if(o==="input"||o==="change")return hl(l)}function K1(o,l){return o===l&&(o!==0||1/o===1/l)||o!==o&&l!==l}var ii=typeof Object.is=="function"?Object.is:K1;function $a(o,l){if(ii(o,l))return!0;if(typeof o!="object"||o===null||typeof l!="object"||l===null)return!1;var f=Object.keys(o),g=Object.keys(l);if(f.length!==g.length)return!1;for(g=0;g<f.length;g++){var x=f[g];if(!d.call(l,x)||!ii(o[x],l[x]))return!1}return!0}function Hp(o){for(;o&&o.firstChild;)o=o.firstChild;return o}function zp(o,l){var f=Hp(o);o=0;for(var g;f;){if(f.nodeType===3){if(g=o+f.textContent.length,o<=l&&g>=l)return{node:f,offset:l-o};o=g}e:{for(;f;){if(f.nextSibling){f=f.nextSibling;break e}f=f.parentNode}f=void 0}f=Hp(f)}}function Kp(o,l){return o&&l?o===l?!0:o&&o.nodeType===3?!1:l&&l.nodeType===3?Kp(o,l.parentNode):"contains"in o?o.contains(l):o.compareDocumentPosition?!!(o.compareDocumentPosition(l)&16):!1:!1}function Wp(){for(var o=window,l=sn();l instanceof o.HTMLIFrameElement;){try{var f=typeof l.contentWindow.location.href=="string"}catch{f=!1}if(f)o=l.contentWindow;else break;l=sn(o.document)}return l}function Uc(o){var l=o&&o.nodeName&&o.nodeName.toLowerCase();return l&&(l==="input"&&(o.type==="text"||o.type==="search"||o.type==="tel"||o.type==="url"||o.type==="password")||l==="textarea"||o.contentEditable==="true")}function W1(o){var l=Wp(),f=o.focusedElem,g=o.selectionRange;if(l!==f&&f&&f.ownerDocument&&Kp(f.ownerDocument.documentElement,f)){if(g!==null&&Uc(f)){if(l=g.start,o=g.end,o===void 0&&(o=l),"selectionStart"in f)f.selectionStart=l,f.selectionEnd=Math.min(o,f.value.length);else if(o=(l=f.ownerDocument||document)&&l.defaultView||window,o.getSelection){o=o.getSelection();var x=f.textContent.length,T=Math.min(g.start,x);g=g.end===void 0?T:Math.min(g.end,x),!o.extend&&T>g&&(x=g,g=T,T=x),x=zp(f,T);var I=zp(f,g);x&&I&&(o.rangeCount!==1||o.anchorNode!==x.node||o.anchorOffset!==x.offset||o.focusNode!==I.node||o.focusOffset!==I.offset)&&(l=l.createRange(),l.setStart(x.node,x.offset),o.removeAllRanges(),T>g?(o.addRange(l),o.extend(I.node,I.offset)):(l.setEnd(I.node,I.offset),o.addRange(l)))}}for(l=[],o=f;o=o.parentNode;)o.nodeType===1&&l.push({element:o,left:o.scrollLeft,top:o.scrollTop});for(typeof f.focus=="function"&&f.focus(),f=0;f<l.length;f++)o=l[f],o.element.scrollLeft=o.left,o.element.scrollTop=o.top}}var Y1=u&&"documentMode"in document&&11>=document.documentMode,Ds=null,$c=null,ja=null,jc=!1;function Yp(o,l,f){var g=f.window===f?f.document:f.nodeType===9?f:f.ownerDocument;jc||Ds==null||Ds!==sn(g)||(g=Ds,"selectionStart"in g&&Uc(g)?g={start:g.selectionStart,end:g.selectionEnd}:(g=(g.ownerDocument&&g.ownerDocument.defaultView||window).getSelection(),g={anchorNode:g.anchorNode,anchorOffset:g.anchorOffset,focusNode:g.focusNode,focusOffset:g.focusOffset}),ja&&$a(ja,g)||(ja=g,g=gl($c,"onSelect"),0<g.length&&(l=new kc("onSelect","select",null,l,f),o.push({event:l,listeners:g}),l.target=Ds)))}function fl(o,l){var f={};return f[o.toLowerCase()]=l.toLowerCase(),f["Webkit"+o]="webkit"+l,f["Moz"+o]="moz"+l,f}var ks={animationend:fl("Animation","AnimationEnd"),animationiteration:fl("Animation","AnimationIteration"),animationstart:fl("Animation","AnimationStart"),transitionend:fl("Transition","TransitionEnd")},Vc={},qp={};u&&(qp=document.createElement("div").style,"AnimationEvent"in window||(delete ks.animationend.animation,delete ks.animationiteration.animation,delete ks.animationstart.animation),"TransitionEvent"in window||delete ks.transitionend.transition);function ml(o){if(Vc[o])return Vc[o];if(!ks[o])return o;var l=ks[o],f;for(f in l)if(l.hasOwnProperty(f)&&f in qp)return Vc[o]=l[f];return o}var Xp=ml("animationend"),Qp=ml("animationiteration"),Zp=ml("animationstart"),Jp=ml("transitionend"),eg=new Map,tg="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function fr(o,l){eg.set(o,l),s(l,[o])}for(var Gc=0;Gc<tg.length;Gc++){var Hc=tg[Gc],q1=Hc.toLowerCase(),X1=Hc[0].toUpperCase()+Hc.slice(1);fr(q1,"on"+X1)}fr(Xp,"onAnimationEnd"),fr(Qp,"onAnimationIteration"),fr(Zp,"onAnimationStart"),fr("dblclick","onDoubleClick"),fr("focusin","onFocus"),fr("focusout","onBlur"),fr(Jp,"onTransitionEnd"),a("onMouseEnter",["mouseout","mouseover"]),a("onMouseLeave",["mouseout","mouseover"]),a("onPointerEnter",["pointerout","pointerover"]),a("onPointerLeave",["pointerout","pointerover"]),s("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),s("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),s("onBeforeInput",["compositionend","keypress","textInput","paste"]),s("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),s("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),s("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Va="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Q1=new Set("cancel close invalid load scroll toggle".split(" ").concat(Va));function ng(o,l,f){var g=o.type||"unknown-event";o.currentTarget=f,Te(g,l,void 0,o),o.currentTarget=null}function ig(o,l){l=(l&4)!==0;for(var f=0;f<o.length;f++){var g=o[f],x=g.event;g=g.listeners;e:{var T=void 0;if(l)for(var I=g.length-1;0<=I;I--){var N=g[I],$=N.instance,Z=N.currentTarget;if(N=N.listener,$!==T&&x.isPropagationStopped())break e;ng(x,N,Z),T=$}else for(I=0;I<g.length;I++){if(N=g[I],$=N.instance,Z=N.currentTarget,N=N.listener,$!==T&&x.isPropagationStopped())break e;ng(x,N,Z),T=$}}}if(pe)throw o=Ce,pe=!1,Ce=null,o}function ct(o,l){var f=l[Zc];f===void 0&&(f=l[Zc]=new Set);var g=o+"__bubble";f.has(g)||(rg(l,o,2,!1),f.add(g))}function zc(o,l,f){var g=0;l&&(g|=4),rg(f,o,g,l)}var pl="_reactListening"+Math.random().toString(36).slice(2);function Ga(o){if(!o[pl]){o[pl]=!0,n.forEach(function(f){f!=="selectionchange"&&(Q1.has(f)||zc(f,!1,o),zc(f,!0,o))});var l=o.nodeType===9?o:o.ownerDocument;l===null||l[pl]||(l[pl]=!0,zc("selectionchange",!1,l))}}function rg(o,l,f,g){switch(bp(l)){case 1:var x=d1;break;case 4:x=h1;break;default:x=Ic}f=x.bind(null,l,f,o),x=void 0,!Ia||l!=="touchstart"&&l!=="touchmove"&&l!=="wheel"||(x=!0),g?x!==void 0?o.addEventListener(l,f,{capture:!0,passive:x}):o.addEventListener(l,f,!0):x!==void 0?o.addEventListener(l,f,{passive:x}):o.addEventListener(l,f,!1)}function Kc(o,l,f,g,x){var T=g;if((l&1)===0&&(l&2)===0&&g!==null)e:for(;;){if(g===null)return;var I=g.tag;if(I===3||I===4){var N=g.stateNode.containerInfo;if(N===x||N.nodeType===8&&N.parentNode===x)break;if(I===4)for(I=g.return;I!==null;){var $=I.tag;if(($===3||$===4)&&($=I.stateNode.containerInfo,$===x||$.nodeType===8&&$.parentNode===x))return;I=I.return}for(;N!==null;){if(I=Qr(N),I===null)return;if($=I.tag,$===5||$===6){g=T=I;continue e}N=N.parentNode}}g=g.return}ba(function(){var Z=T,ue=Rs(f),de=[];e:{var oe=eg.get(o);if(oe!==void 0){var ve=kc,Ae=o;switch(o){case"keypress":if(ul(f)===0)break e;case"keydown":case"keyup":ve=b1;break;case"focusin":Ae="focus",ve=Mc;break;case"focusout":Ae="blur",ve=Mc;break;case"beforeblur":case"afterblur":ve=Mc;break;case"click":if(f.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ve=Dp;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ve=p1;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ve=D1;break;case Xp:case Qp:case Zp:ve=v1;break;case Jp:ve=P1;break;case"scroll":ve=f1;break;case"wheel":ve=M1;break;case"copy":case"cut":case"paste":ve=E1;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ve=Pp}var Re=(l&4)!==0,Lt=!Re&&o==="scroll",q=Re?oe!==null?oe+"Capture":null:oe;Re=[];for(var V=Z,X;V!==null;){X=V;var me=X.stateNode;if(X.tag===5&&me!==null&&(X=me,q!==null&&(me=Kr(V,q),me!=null&&Re.push(Ha(V,me,X)))),Lt)break;V=V.return}0<Re.length&&(oe=new ve(oe,Ae,null,f,ue),de.push({event:oe,listeners:Re}))}}if((l&7)===0){e:{if(oe=o==="mouseover"||o==="pointerover",ve=o==="mouseout"||o==="pointerout",oe&&f!==wa&&(Ae=f.relatedTarget||f.fromElement)&&(Qr(Ae)||Ae[Gi]))break e;if((ve||oe)&&(oe=ue.window===ue?ue:(oe=ue.ownerDocument)?oe.defaultView||oe.parentWindow:window,ve?(Ae=f.relatedTarget||f.toElement,ve=Z,Ae=Ae?Qr(Ae):null,Ae!==null&&(Lt=Le(Ae),Ae!==Lt||Ae.tag!==5&&Ae.tag!==6)&&(Ae=null)):(ve=null,Ae=Z),ve!==Ae)){if(Re=Dp,me="onMouseLeave",q="onMouseEnter",V="mouse",(o==="pointerout"||o==="pointerover")&&(Re=Pp,me="onPointerLeave",q="onPointerEnter",V="pointer"),Lt=ve==null?oe:Ms(ve),X=Ae==null?oe:Ms(Ae),oe=new Re(me,V+"leave",ve,f,ue),oe.target=Lt,oe.relatedTarget=X,me=null,Qr(ue)===Z&&(Re=new Re(q,V+"enter",Ae,f,ue),Re.target=X,Re.relatedTarget=Lt,me=Re),Lt=me,ve&&Ae)t:{for(Re=ve,q=Ae,V=0,X=Re;X;X=Ps(X))V++;for(X=0,me=q;me;me=Ps(me))X++;for(;0<V-X;)Re=Ps(Re),V--;for(;0<X-V;)q=Ps(q),X--;for(;V--;){if(Re===q||q!==null&&Re===q.alternate)break t;Re=Ps(Re),q=Ps(q)}Re=null}else Re=null;ve!==null&&sg(de,oe,ve,Re,!1),Ae!==null&&Lt!==null&&sg(de,Lt,Ae,Re,!0)}}e:{if(oe=Z?Ms(Z):window,ve=oe.nodeName&&oe.nodeName.toLowerCase(),ve==="select"||ve==="input"&&oe.type==="file")var De=j1;else if(Bp(oe))if($p)De=z1;else{De=G1;var Me=V1}else(ve=oe.nodeName)&&ve.toLowerCase()==="input"&&(oe.type==="checkbox"||oe.type==="radio")&&(De=H1);if(De&&(De=De(o,Z))){Up(de,De,f,ue);break e}Me&&Me(o,oe,Z),o==="focusout"&&(Me=oe._wrapperState)&&Me.controlled&&oe.type==="number"&&gn(oe,"number",oe.value)}switch(Me=Z?Ms(Z):window,o){case"focusin":(Bp(Me)||Me.contentEditable==="true")&&(Ds=Me,$c=Z,ja=null);break;case"focusout":ja=$c=Ds=null;break;case"mousedown":jc=!0;break;case"contextmenu":case"mouseup":case"dragend":jc=!1,Yp(de,f,ue);break;case"selectionchange":if(Y1)break;case"keydown":case"keyup":Yp(de,f,ue)}var Ne;if(Oc)e:{switch(o){case"compositionstart":var Oe="onCompositionStart";break e;case"compositionend":Oe="onCompositionEnd";break e;case"compositionupdate":Oe="onCompositionUpdate";break e}Oe=void 0}else Cs?Op(o,f)&&(Oe="onCompositionEnd"):o==="keydown"&&f.keyCode===229&&(Oe="onCompositionStart");Oe&&(_p&&f.locale!=="ko"&&(Cs||Oe!=="onCompositionStart"?Oe==="onCompositionEnd"&&Cs&&(Ne=Ip()):(hr=ue,Dc="value"in hr?hr.value:hr.textContent,Cs=!0)),Me=gl(Z,Oe),0<Me.length&&(Oe=new kp(Oe,o,null,f,ue),de.push({event:Oe,listeners:Me}),Ne?Oe.data=Ne:(Ne=Fp(f),Ne!==null&&(Oe.data=Ne)))),(Ne=O1?F1(o,f):B1(o,f))&&(Z=gl(Z,"onBeforeInput"),0<Z.length&&(ue=new kp("onBeforeInput","beforeinput",null,f,ue),de.push({event:ue,listeners:Z}),ue.data=Ne))}ig(de,l)})}function Ha(o,l,f){return{instance:o,listener:l,currentTarget:f}}function gl(o,l){for(var f=l+"Capture",g=[];o!==null;){var x=o,T=x.stateNode;x.tag===5&&T!==null&&(x=T,T=Kr(o,f),T!=null&&g.unshift(Ha(o,T,x)),T=Kr(o,l),T!=null&&g.push(Ha(o,T,x))),o=o.return}return g}function Ps(o){if(o===null)return null;do o=o.return;while(o&&o.tag!==5);return o||null}function sg(o,l,f,g,x){for(var T=l._reactName,I=[];f!==null&&f!==g;){var N=f,$=N.alternate,Z=N.stateNode;if($!==null&&$===g)break;N.tag===5&&Z!==null&&(N=Z,x?($=Kr(f,T),$!=null&&I.unshift(Ha(f,$,N))):x||($=Kr(f,T),$!=null&&I.push(Ha(f,$,N)))),f=f.return}I.length!==0&&o.push({event:l,listeners:I})}var Z1=/\r\n?/g,J1=/\u0000|\uFFFD/g;function ag(o){return(typeof o=="string"?o:""+o).replace(Z1,`
`).replace(J1,"")}function yl(o,l,f){if(l=ag(l),ag(o)!==l&&f)throw Error(t(425))}function vl(){}var Wc=null,Yc=null;function qc(o,l){return o==="textarea"||o==="noscript"||typeof l.children=="string"||typeof l.children=="number"||typeof l.dangerouslySetInnerHTML=="object"&&l.dangerouslySetInnerHTML!==null&&l.dangerouslySetInnerHTML.__html!=null}var Xc=typeof setTimeout=="function"?setTimeout:void 0,ew=typeof clearTimeout=="function"?clearTimeout:void 0,og=typeof Promise=="function"?Promise:void 0,tw=typeof queueMicrotask=="function"?queueMicrotask:typeof og<"u"?function(o){return og.resolve(null).then(o).catch(nw)}:Xc;function nw(o){setTimeout(function(){throw o})}function Qc(o,l){var f=l,g=0;do{var x=f.nextSibling;if(o.removeChild(f),x&&x.nodeType===8)if(f=x.data,f==="/$"){if(g===0){o.removeChild(x),Ma(l);return}g--}else f!=="$"&&f!=="$?"&&f!=="$!"||g++;f=x}while(f);Ma(l)}function mr(o){for(;o!=null;o=o.nextSibling){var l=o.nodeType;if(l===1||l===3)break;if(l===8){if(l=o.data,l==="$"||l==="$!"||l==="$?")break;if(l==="/$")return null}}return o}function lg(o){o=o.previousSibling;for(var l=0;o;){if(o.nodeType===8){var f=o.data;if(f==="$"||f==="$!"||f==="$?"){if(l===0)return o;l--}else f==="/$"&&l++}o=o.previousSibling}return null}var _s=Math.random().toString(36).slice(2),Ti="__reactFiber$"+_s,za="__reactProps$"+_s,Gi="__reactContainer$"+_s,Zc="__reactEvents$"+_s,iw="__reactListeners$"+_s,rw="__reactHandles$"+_s;function Qr(o){var l=o[Ti];if(l)return l;for(var f=o.parentNode;f;){if(l=f[Gi]||f[Ti]){if(f=l.alternate,l.child!==null||f!==null&&f.child!==null)for(o=lg(o);o!==null;){if(f=o[Ti])return f;o=lg(o)}return l}o=f,f=o.parentNode}return null}function Ka(o){return o=o[Ti]||o[Gi],!o||o.tag!==5&&o.tag!==6&&o.tag!==13&&o.tag!==3?null:o}function Ms(o){if(o.tag===5||o.tag===6)return o.stateNode;throw Error(t(33))}function xl(o){return o[za]||null}var Jc=[],Ns=-1;function pr(o){return{current:o}}function dt(o){0>Ns||(o.current=Jc[Ns],Jc[Ns]=null,Ns--)}function lt(o,l){Ns++,Jc[Ns]=o.current,o.current=l}var gr={},Zt=pr(gr),vn=pr(!1),Zr=gr;function Os(o,l){var f=o.type.contextTypes;if(!f)return gr;var g=o.stateNode;if(g&&g.__reactInternalMemoizedUnmaskedChildContext===l)return g.__reactInternalMemoizedMaskedChildContext;var x={},T;for(T in f)x[T]=l[T];return g&&(o=o.stateNode,o.__reactInternalMemoizedUnmaskedChildContext=l,o.__reactInternalMemoizedMaskedChildContext=x),x}function xn(o){return o=o.childContextTypes,o!=null}function El(){dt(vn),dt(Zt)}function ug(o,l,f){if(Zt.current!==gr)throw Error(t(168));lt(Zt,l),lt(vn,f)}function cg(o,l,f){var g=o.stateNode;if(l=l.childContextTypes,typeof g.getChildContext!="function")return f;g=g.getChildContext();for(var x in g)if(!(x in l))throw Error(t(108,Pe(o)||"Unknown",x));return J({},f,g)}function Sl(o){return o=(o=o.stateNode)&&o.__reactInternalMemoizedMergedChildContext||gr,Zr=Zt.current,lt(Zt,o),lt(vn,vn.current),!0}function dg(o,l,f){var g=o.stateNode;if(!g)throw Error(t(169));f?(o=cg(o,l,Zr),g.__reactInternalMemoizedMergedChildContext=o,dt(vn),dt(Zt),lt(Zt,o)):dt(vn),lt(vn,f)}var Hi=null,Tl=!1,ed=!1;function hg(o){Hi===null?Hi=[o]:Hi.push(o)}function sw(o){Tl=!0,hg(o)}function yr(){if(!ed&&Hi!==null){ed=!0;var o=0,l=et;try{var f=Hi;for(et=1;o<f.length;o++){var g=f[o];do g=g(!0);while(g!==null)}Hi=null,Tl=!1}catch(x){throw Hi!==null&&(Hi=Hi.slice(o+1)),wt($n,yr),x}finally{et=l,ed=!1}}return null}var Fs=[],Bs=0,Al=null,wl=0,jn=[],Vn=0,Jr=null,zi=1,Ki="";function es(o,l){Fs[Bs++]=wl,Fs[Bs++]=Al,Al=o,wl=l}function fg(o,l,f){jn[Vn++]=zi,jn[Vn++]=Ki,jn[Vn++]=Jr,Jr=o;var g=zi;o=Ki;var x=32-it(g)-1;g&=~(1<<x),f+=1;var T=32-it(l)+x;if(30<T){var I=x-x%5;T=(g&(1<<I)-1).toString(32),g>>=I,x-=I,zi=1<<32-it(l)+x|f<<x|g,Ki=T+o}else zi=1<<T|f<<x|g,Ki=o}function td(o){o.return!==null&&(es(o,1),fg(o,1,0))}function nd(o){for(;o===Al;)Al=Fs[--Bs],Fs[Bs]=null,wl=Fs[--Bs],Fs[Bs]=null;for(;o===Jr;)Jr=jn[--Vn],jn[Vn]=null,Ki=jn[--Vn],jn[Vn]=null,zi=jn[--Vn],jn[Vn]=null}var Dn=null,kn=null,ft=!1,ri=null;function mg(o,l){var f=Kn(5,null,null,0);f.elementType="DELETED",f.stateNode=l,f.return=o,l=o.deletions,l===null?(o.deletions=[f],o.flags|=16):l.push(f)}function pg(o,l){switch(o.tag){case 5:var f=o.type;return l=l.nodeType!==1||f.toLowerCase()!==l.nodeName.toLowerCase()?null:l,l!==null?(o.stateNode=l,Dn=o,kn=mr(l.firstChild),!0):!1;case 6:return l=o.pendingProps===""||l.nodeType!==3?null:l,l!==null?(o.stateNode=l,Dn=o,kn=null,!0):!1;case 13:return l=l.nodeType!==8?null:l,l!==null?(f=Jr!==null?{id:zi,overflow:Ki}:null,o.memoizedState={dehydrated:l,treeContext:f,retryLane:1073741824},f=Kn(18,null,null,0),f.stateNode=l,f.return=o,o.child=f,Dn=o,kn=null,!0):!1;default:return!1}}function id(o){return(o.mode&1)!==0&&(o.flags&128)===0}function rd(o){if(ft){var l=kn;if(l){var f=l;if(!pg(o,l)){if(id(o))throw Error(t(418));l=mr(f.nextSibling);var g=Dn;l&&pg(o,l)?mg(g,f):(o.flags=o.flags&-4097|2,ft=!1,Dn=o)}}else{if(id(o))throw Error(t(418));o.flags=o.flags&-4097|2,ft=!1,Dn=o}}}function gg(o){for(o=o.return;o!==null&&o.tag!==5&&o.tag!==3&&o.tag!==13;)o=o.return;Dn=o}function Ll(o){if(o!==Dn)return!1;if(!ft)return gg(o),ft=!0,!1;var l;if((l=o.tag!==3)&&!(l=o.tag!==5)&&(l=o.type,l=l!=="head"&&l!=="body"&&!qc(o.type,o.memoizedProps)),l&&(l=kn)){if(id(o))throw yg(),Error(t(418));for(;l;)mg(o,l),l=mr(l.nextSibling)}if(gg(o),o.tag===13){if(o=o.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(t(317));e:{for(o=o.nextSibling,l=0;o;){if(o.nodeType===8){var f=o.data;if(f==="/$"){if(l===0){kn=mr(o.nextSibling);break e}l--}else f!=="$"&&f!=="$!"&&f!=="$?"||l++}o=o.nextSibling}kn=null}}else kn=Dn?mr(o.stateNode.nextSibling):null;return!0}function yg(){for(var o=kn;o;)o=mr(o.nextSibling)}function Us(){kn=Dn=null,ft=!1}function sd(o){ri===null?ri=[o]:ri.push(o)}var aw=D.ReactCurrentBatchConfig;function Wa(o,l,f){if(o=f.ref,o!==null&&typeof o!="function"&&typeof o!="object"){if(f._owner){if(f=f._owner,f){if(f.tag!==1)throw Error(t(309));var g=f.stateNode}if(!g)throw Error(t(147,o));var x=g,T=""+o;return l!==null&&l.ref!==null&&typeof l.ref=="function"&&l.ref._stringRef===T?l.ref:(l=function(I){var N=x.refs;I===null?delete N[T]:N[T]=I},l._stringRef=T,l)}if(typeof o!="string")throw Error(t(284));if(!f._owner)throw Error(t(290,o))}return o}function Rl(o,l){throw o=Object.prototype.toString.call(l),Error(t(31,o==="[object Object]"?"object with keys {"+Object.keys(l).join(", ")+"}":o))}function vg(o){var l=o._init;return l(o._payload)}function xg(o){function l(q,V){if(o){var X=q.deletions;X===null?(q.deletions=[V],q.flags|=16):X.push(V)}}function f(q,V){if(!o)return null;for(;V!==null;)l(q,V),V=V.sibling;return null}function g(q,V){for(q=new Map;V!==null;)V.key!==null?q.set(V.key,V):q.set(V.index,V),V=V.sibling;return q}function x(q,V){return q=Lr(q,V),q.index=0,q.sibling=null,q}function T(q,V,X){return q.index=X,o?(X=q.alternate,X!==null?(X=X.index,X<V?(q.flags|=2,V):X):(q.flags|=2,V)):(q.flags|=1048576,V)}function I(q){return o&&q.alternate===null&&(q.flags|=2),q}function N(q,V,X,me){return V===null||V.tag!==6?(V=Xd(X,q.mode,me),V.return=q,V):(V=x(V,X),V.return=q,V)}function $(q,V,X,me){var De=X.type;return De===C?ue(q,V,X.props.children,me,X.key):V!==null&&(V.elementType===De||typeof De=="object"&&De!==null&&De.$$typeof===ne&&vg(De)===V.type)?(me=x(V,X.props),me.ref=Wa(q,V,X),me.return=q,me):(me=Xl(X.type,X.key,X.props,null,q.mode,me),me.ref=Wa(q,V,X),me.return=q,me)}function Z(q,V,X,me){return V===null||V.tag!==4||V.stateNode.containerInfo!==X.containerInfo||V.stateNode.implementation!==X.implementation?(V=Qd(X,q.mode,me),V.return=q,V):(V=x(V,X.children||[]),V.return=q,V)}function ue(q,V,X,me,De){return V===null||V.tag!==7?(V=ls(X,q.mode,me,De),V.return=q,V):(V=x(V,X),V.return=q,V)}function de(q,V,X){if(typeof V=="string"&&V!==""||typeof V=="number")return V=Xd(""+V,q.mode,X),V.return=q,V;if(typeof V=="object"&&V!==null){switch(V.$$typeof){case k:return X=Xl(V.type,V.key,V.props,null,q.mode,X),X.ref=Wa(q,null,V),X.return=q,X;case U:return V=Qd(V,q.mode,X),V.return=q,V;case ne:var me=V._init;return de(q,me(V._payload),X)}if(_t(V)||ee(V))return V=ls(V,q.mode,X,null),V.return=q,V;Rl(q,V)}return null}function oe(q,V,X,me){var De=V!==null?V.key:null;if(typeof X=="string"&&X!==""||typeof X=="number")return De!==null?null:N(q,V,""+X,me);if(typeof X=="object"&&X!==null){switch(X.$$typeof){case k:return X.key===De?$(q,V,X,me):null;case U:return X.key===De?Z(q,V,X,me):null;case ne:return De=X._init,oe(q,V,De(X._payload),me)}if(_t(X)||ee(X))return De!==null?null:ue(q,V,X,me,null);Rl(q,X)}return null}function ve(q,V,X,me,De){if(typeof me=="string"&&me!==""||typeof me=="number")return q=q.get(X)||null,N(V,q,""+me,De);if(typeof me=="object"&&me!==null){switch(me.$$typeof){case k:return q=q.get(me.key===null?X:me.key)||null,$(V,q,me,De);case U:return q=q.get(me.key===null?X:me.key)||null,Z(V,q,me,De);case ne:var Me=me._init;return ve(q,V,X,Me(me._payload),De)}if(_t(me)||ee(me))return q=q.get(X)||null,ue(V,q,me,De,null);Rl(V,me)}return null}function Ae(q,V,X,me){for(var De=null,Me=null,Ne=V,Oe=V=0,Vt=null;Ne!==null&&Oe<X.length;Oe++){Ne.index>Oe?(Vt=Ne,Ne=null):Vt=Ne.sibling;var Xe=oe(q,Ne,X[Oe],me);if(Xe===null){Ne===null&&(Ne=Vt);break}o&&Ne&&Xe.alternate===null&&l(q,Ne),V=T(Xe,V,Oe),Me===null?De=Xe:Me.sibling=Xe,Me=Xe,Ne=Vt}if(Oe===X.length)return f(q,Ne),ft&&es(q,Oe),De;if(Ne===null){for(;Oe<X.length;Oe++)Ne=de(q,X[Oe],me),Ne!==null&&(V=T(Ne,V,Oe),Me===null?De=Ne:Me.sibling=Ne,Me=Ne);return ft&&es(q,Oe),De}for(Ne=g(q,Ne);Oe<X.length;Oe++)Vt=ve(Ne,q,Oe,X[Oe],me),Vt!==null&&(o&&Vt.alternate!==null&&Ne.delete(Vt.key===null?Oe:Vt.key),V=T(Vt,V,Oe),Me===null?De=Vt:Me.sibling=Vt,Me=Vt);return o&&Ne.forEach(function(Rr){return l(q,Rr)}),ft&&es(q,Oe),De}function Re(q,V,X,me){var De=ee(X);if(typeof De!="function")throw Error(t(150));if(X=De.call(X),X==null)throw Error(t(151));for(var Me=De=null,Ne=V,Oe=V=0,Vt=null,Xe=X.next();Ne!==null&&!Xe.done;Oe++,Xe=X.next()){Ne.index>Oe?(Vt=Ne,Ne=null):Vt=Ne.sibling;var Rr=oe(q,Ne,Xe.value,me);if(Rr===null){Ne===null&&(Ne=Vt);break}o&&Ne&&Rr.alternate===null&&l(q,Ne),V=T(Rr,V,Oe),Me===null?De=Rr:Me.sibling=Rr,Me=Rr,Ne=Vt}if(Xe.done)return f(q,Ne),ft&&es(q,Oe),De;if(Ne===null){for(;!Xe.done;Oe++,Xe=X.next())Xe=de(q,Xe.value,me),Xe!==null&&(V=T(Xe,V,Oe),Me===null?De=Xe:Me.sibling=Xe,Me=Xe);return ft&&es(q,Oe),De}for(Ne=g(q,Ne);!Xe.done;Oe++,Xe=X.next())Xe=ve(Ne,q,Oe,Xe.value,me),Xe!==null&&(o&&Xe.alternate!==null&&Ne.delete(Xe.key===null?Oe:Xe.key),V=T(Xe,V,Oe),Me===null?De=Xe:Me.sibling=Xe,Me=Xe);return o&&Ne.forEach(function(Uw){return l(q,Uw)}),ft&&es(q,Oe),De}function Lt(q,V,X,me){if(typeof X=="object"&&X!==null&&X.type===C&&X.key===null&&(X=X.props.children),typeof X=="object"&&X!==null){switch(X.$$typeof){case k:e:{for(var De=X.key,Me=V;Me!==null;){if(Me.key===De){if(De=X.type,De===C){if(Me.tag===7){f(q,Me.sibling),V=x(Me,X.props.children),V.return=q,q=V;break e}}else if(Me.elementType===De||typeof De=="object"&&De!==null&&De.$$typeof===ne&&vg(De)===Me.type){f(q,Me.sibling),V=x(Me,X.props),V.ref=Wa(q,Me,X),V.return=q,q=V;break e}f(q,Me);break}else l(q,Me);Me=Me.sibling}X.type===C?(V=ls(X.props.children,q.mode,me,X.key),V.return=q,q=V):(me=Xl(X.type,X.key,X.props,null,q.mode,me),me.ref=Wa(q,V,X),me.return=q,q=me)}return I(q);case U:e:{for(Me=X.key;V!==null;){if(V.key===Me)if(V.tag===4&&V.stateNode.containerInfo===X.containerInfo&&V.stateNode.implementation===X.implementation){f(q,V.sibling),V=x(V,X.children||[]),V.return=q,q=V;break e}else{f(q,V);break}else l(q,V);V=V.sibling}V=Qd(X,q.mode,me),V.return=q,q=V}return I(q);case ne:return Me=X._init,Lt(q,V,Me(X._payload),me)}if(_t(X))return Ae(q,V,X,me);if(ee(X))return Re(q,V,X,me);Rl(q,X)}return typeof X=="string"&&X!==""||typeof X=="number"?(X=""+X,V!==null&&V.tag===6?(f(q,V.sibling),V=x(V,X),V.return=q,q=V):(f(q,V),V=Xd(X,q.mode,me),V.return=q,q=V),I(q)):f(q,V)}return Lt}var $s=xg(!0),Eg=xg(!1),bl=pr(null),Il=null,js=null,ad=null;function od(){ad=js=Il=null}function ld(o){var l=bl.current;dt(bl),o._currentValue=l}function ud(o,l,f){for(;o!==null;){var g=o.alternate;if((o.childLanes&l)!==l?(o.childLanes|=l,g!==null&&(g.childLanes|=l)):g!==null&&(g.childLanes&l)!==l&&(g.childLanes|=l),o===f)break;o=o.return}}function Vs(o,l){Il=o,ad=js=null,o=o.dependencies,o!==null&&o.firstContext!==null&&((o.lanes&l)!==0&&(En=!0),o.firstContext=null)}function Gn(o){var l=o._currentValue;if(ad!==o)if(o={context:o,memoizedValue:l,next:null},js===null){if(Il===null)throw Error(t(308));js=o,Il.dependencies={lanes:0,firstContext:o}}else js=js.next=o;return l}var ts=null;function cd(o){ts===null?ts=[o]:ts.push(o)}function Sg(o,l,f,g){var x=l.interleaved;return x===null?(f.next=f,cd(l)):(f.next=x.next,x.next=f),l.interleaved=f,Wi(o,g)}function Wi(o,l){o.lanes|=l;var f=o.alternate;for(f!==null&&(f.lanes|=l),f=o,o=o.return;o!==null;)o.childLanes|=l,f=o.alternate,f!==null&&(f.childLanes|=l),f=o,o=o.return;return f.tag===3?f.stateNode:null}var vr=!1;function dd(o){o.updateQueue={baseState:o.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Tg(o,l){o=o.updateQueue,l.updateQueue===o&&(l.updateQueue={baseState:o.baseState,firstBaseUpdate:o.firstBaseUpdate,lastBaseUpdate:o.lastBaseUpdate,shared:o.shared,effects:o.effects})}function Yi(o,l){return{eventTime:o,lane:l,tag:0,payload:null,callback:null,next:null}}function xr(o,l,f){var g=o.updateQueue;if(g===null)return null;if(g=g.shared,(qe&2)!==0){var x=g.pending;return x===null?l.next=l:(l.next=x.next,x.next=l),g.pending=l,Wi(o,f)}return x=g.interleaved,x===null?(l.next=l,cd(g)):(l.next=x.next,x.next=l),g.interleaved=l,Wi(o,f)}function Cl(o,l,f){if(l=l.updateQueue,l!==null&&(l=l.shared,(f&4194240)!==0)){var g=l.lanes;g&=o.pendingLanes,f|=g,l.lanes=f,Lc(o,f)}}function Ag(o,l){var f=o.updateQueue,g=o.alternate;if(g!==null&&(g=g.updateQueue,f===g)){var x=null,T=null;if(f=f.firstBaseUpdate,f!==null){do{var I={eventTime:f.eventTime,lane:f.lane,tag:f.tag,payload:f.payload,callback:f.callback,next:null};T===null?x=T=I:T=T.next=I,f=f.next}while(f!==null);T===null?x=T=l:T=T.next=l}else x=T=l;f={baseState:g.baseState,firstBaseUpdate:x,lastBaseUpdate:T,shared:g.shared,effects:g.effects},o.updateQueue=f;return}o=f.lastBaseUpdate,o===null?f.firstBaseUpdate=l:o.next=l,f.lastBaseUpdate=l}function Dl(o,l,f,g){var x=o.updateQueue;vr=!1;var T=x.firstBaseUpdate,I=x.lastBaseUpdate,N=x.shared.pending;if(N!==null){x.shared.pending=null;var $=N,Z=$.next;$.next=null,I===null?T=Z:I.next=Z,I=$;var ue=o.alternate;ue!==null&&(ue=ue.updateQueue,N=ue.lastBaseUpdate,N!==I&&(N===null?ue.firstBaseUpdate=Z:N.next=Z,ue.lastBaseUpdate=$))}if(T!==null){var de=x.baseState;I=0,ue=Z=$=null,N=T;do{var oe=N.lane,ve=N.eventTime;if((g&oe)===oe){ue!==null&&(ue=ue.next={eventTime:ve,lane:0,tag:N.tag,payload:N.payload,callback:N.callback,next:null});e:{var Ae=o,Re=N;switch(oe=l,ve=f,Re.tag){case 1:if(Ae=Re.payload,typeof Ae=="function"){de=Ae.call(ve,de,oe);break e}de=Ae;break e;case 3:Ae.flags=Ae.flags&-65537|128;case 0:if(Ae=Re.payload,oe=typeof Ae=="function"?Ae.call(ve,de,oe):Ae,oe==null)break e;de=J({},de,oe);break e;case 2:vr=!0}}N.callback!==null&&N.lane!==0&&(o.flags|=64,oe=x.effects,oe===null?x.effects=[N]:oe.push(N))}else ve={eventTime:ve,lane:oe,tag:N.tag,payload:N.payload,callback:N.callback,next:null},ue===null?(Z=ue=ve,$=de):ue=ue.next=ve,I|=oe;if(N=N.next,N===null){if(N=x.shared.pending,N===null)break;oe=N,N=oe.next,oe.next=null,x.lastBaseUpdate=oe,x.shared.pending=null}}while(!0);if(ue===null&&($=de),x.baseState=$,x.firstBaseUpdate=Z,x.lastBaseUpdate=ue,l=x.shared.interleaved,l!==null){x=l;do I|=x.lane,x=x.next;while(x!==l)}else T===null&&(x.shared.lanes=0);rs|=I,o.lanes=I,o.memoizedState=de}}function wg(o,l,f){if(o=l.effects,l.effects=null,o!==null)for(l=0;l<o.length;l++){var g=o[l],x=g.callback;if(x!==null){if(g.callback=null,g=f,typeof x!="function")throw Error(t(191,x));x.call(g)}}}var Ya={},Ai=pr(Ya),qa=pr(Ya),Xa=pr(Ya);function ns(o){if(o===Ya)throw Error(t(174));return o}function hd(o,l){switch(lt(Xa,l),lt(qa,o),lt(Ai,Ya),o=l.nodeType,o){case 9:case 11:l=(l=l.documentElement)?l.namespaceURI:xi(null,"");break;default:o=o===8?l.parentNode:l,l=o.namespaceURI||null,o=o.tagName,l=xi(l,o)}dt(Ai),lt(Ai,l)}function Gs(){dt(Ai),dt(qa),dt(Xa)}function Lg(o){ns(Xa.current);var l=ns(Ai.current),f=xi(l,o.type);l!==f&&(lt(qa,o),lt(Ai,f))}function fd(o){qa.current===o&&(dt(Ai),dt(qa))}var mt=pr(0);function kl(o){for(var l=o;l!==null;){if(l.tag===13){var f=l.memoizedState;if(f!==null&&(f=f.dehydrated,f===null||f.data==="$?"||f.data==="$!"))return l}else if(l.tag===19&&l.memoizedProps.revealOrder!==void 0){if((l.flags&128)!==0)return l}else if(l.child!==null){l.child.return=l,l=l.child;continue}if(l===o)break;for(;l.sibling===null;){if(l.return===null||l.return===o)return null;l=l.return}l.sibling.return=l.return,l=l.sibling}return null}var md=[];function pd(){for(var o=0;o<md.length;o++)md[o]._workInProgressVersionPrimary=null;md.length=0}var Pl=D.ReactCurrentDispatcher,gd=D.ReactCurrentBatchConfig,is=0,pt=null,Mt=null,$t=null,_l=!1,Qa=!1,Za=0,ow=0;function Jt(){throw Error(t(321))}function yd(o,l){if(l===null)return!1;for(var f=0;f<l.length&&f<o.length;f++)if(!ii(o[f],l[f]))return!1;return!0}function vd(o,l,f,g,x,T){if(is=T,pt=l,l.memoizedState=null,l.updateQueue=null,l.lanes=0,Pl.current=o===null||o.memoizedState===null?dw:hw,o=f(g,x),Qa){T=0;do{if(Qa=!1,Za=0,25<=T)throw Error(t(301));T+=1,$t=Mt=null,l.updateQueue=null,Pl.current=fw,o=f(g,x)}while(Qa)}if(Pl.current=Ol,l=Mt!==null&&Mt.next!==null,is=0,$t=Mt=pt=null,_l=!1,l)throw Error(t(300));return o}function xd(){var o=Za!==0;return Za=0,o}function wi(){var o={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return $t===null?pt.memoizedState=$t=o:$t=$t.next=o,$t}function Hn(){if(Mt===null){var o=pt.alternate;o=o!==null?o.memoizedState:null}else o=Mt.next;var l=$t===null?pt.memoizedState:$t.next;if(l!==null)$t=l,Mt=o;else{if(o===null)throw Error(t(310));Mt=o,o={memoizedState:Mt.memoizedState,baseState:Mt.baseState,baseQueue:Mt.baseQueue,queue:Mt.queue,next:null},$t===null?pt.memoizedState=$t=o:$t=$t.next=o}return $t}function Ja(o,l){return typeof l=="function"?l(o):l}function Ed(o){var l=Hn(),f=l.queue;if(f===null)throw Error(t(311));f.lastRenderedReducer=o;var g=Mt,x=g.baseQueue,T=f.pending;if(T!==null){if(x!==null){var I=x.next;x.next=T.next,T.next=I}g.baseQueue=x=T,f.pending=null}if(x!==null){T=x.next,g=g.baseState;var N=I=null,$=null,Z=T;do{var ue=Z.lane;if((is&ue)===ue)$!==null&&($=$.next={lane:0,action:Z.action,hasEagerState:Z.hasEagerState,eagerState:Z.eagerState,next:null}),g=Z.hasEagerState?Z.eagerState:o(g,Z.action);else{var de={lane:ue,action:Z.action,hasEagerState:Z.hasEagerState,eagerState:Z.eagerState,next:null};$===null?(N=$=de,I=g):$=$.next=de,pt.lanes|=ue,rs|=ue}Z=Z.next}while(Z!==null&&Z!==T);$===null?I=g:$.next=N,ii(g,l.memoizedState)||(En=!0),l.memoizedState=g,l.baseState=I,l.baseQueue=$,f.lastRenderedState=g}if(o=f.interleaved,o!==null){x=o;do T=x.lane,pt.lanes|=T,rs|=T,x=x.next;while(x!==o)}else x===null&&(f.lanes=0);return[l.memoizedState,f.dispatch]}function Sd(o){var l=Hn(),f=l.queue;if(f===null)throw Error(t(311));f.lastRenderedReducer=o;var g=f.dispatch,x=f.pending,T=l.memoizedState;if(x!==null){f.pending=null;var I=x=x.next;do T=o(T,I.action),I=I.next;while(I!==x);ii(T,l.memoizedState)||(En=!0),l.memoizedState=T,l.baseQueue===null&&(l.baseState=T),f.lastRenderedState=T}return[T,g]}function Rg(){}function bg(o,l){var f=pt,g=Hn(),x=l(),T=!ii(g.memoizedState,x);if(T&&(g.memoizedState=x,En=!0),g=g.queue,Td(Dg.bind(null,f,g,o),[o]),g.getSnapshot!==l||T||$t!==null&&$t.memoizedState.tag&1){if(f.flags|=2048,eo(9,Cg.bind(null,f,g,x,l),void 0,null),jt===null)throw Error(t(349));(is&30)!==0||Ig(f,l,x)}return x}function Ig(o,l,f){o.flags|=16384,o={getSnapshot:l,value:f},l=pt.updateQueue,l===null?(l={lastEffect:null,stores:null},pt.updateQueue=l,l.stores=[o]):(f=l.stores,f===null?l.stores=[o]:f.push(o))}function Cg(o,l,f,g){l.value=f,l.getSnapshot=g,kg(l)&&Pg(o)}function Dg(o,l,f){return f(function(){kg(l)&&Pg(o)})}function kg(o){var l=o.getSnapshot;o=o.value;try{var f=l();return!ii(o,f)}catch{return!0}}function Pg(o){var l=Wi(o,1);l!==null&&li(l,o,1,-1)}function _g(o){var l=wi();return typeof o=="function"&&(o=o()),l.memoizedState=l.baseState=o,o={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ja,lastRenderedState:o},l.queue=o,o=o.dispatch=cw.bind(null,pt,o),[l.memoizedState,o]}function eo(o,l,f,g){return o={tag:o,create:l,destroy:f,deps:g,next:null},l=pt.updateQueue,l===null?(l={lastEffect:null,stores:null},pt.updateQueue=l,l.lastEffect=o.next=o):(f=l.lastEffect,f===null?l.lastEffect=o.next=o:(g=f.next,f.next=o,o.next=g,l.lastEffect=o)),o}function Mg(){return Hn().memoizedState}function Ml(o,l,f,g){var x=wi();pt.flags|=o,x.memoizedState=eo(1|l,f,void 0,g===void 0?null:g)}function Nl(o,l,f,g){var x=Hn();g=g===void 0?null:g;var T=void 0;if(Mt!==null){var I=Mt.memoizedState;if(T=I.destroy,g!==null&&yd(g,I.deps)){x.memoizedState=eo(l,f,T,g);return}}pt.flags|=o,x.memoizedState=eo(1|l,f,T,g)}function Ng(o,l){return Ml(8390656,8,o,l)}function Td(o,l){return Nl(2048,8,o,l)}function Og(o,l){return Nl(4,2,o,l)}function Fg(o,l){return Nl(4,4,o,l)}function Bg(o,l){if(typeof l=="function")return o=o(),l(o),function(){l(null)};if(l!=null)return o=o(),l.current=o,function(){l.current=null}}function Ug(o,l,f){return f=f!=null?f.concat([o]):null,Nl(4,4,Bg.bind(null,l,o),f)}function Ad(){}function $g(o,l){var f=Hn();l=l===void 0?null:l;var g=f.memoizedState;return g!==null&&l!==null&&yd(l,g[1])?g[0]:(f.memoizedState=[o,l],o)}function jg(o,l){var f=Hn();l=l===void 0?null:l;var g=f.memoizedState;return g!==null&&l!==null&&yd(l,g[1])?g[0]:(o=o(),f.memoizedState=[o,l],o)}function Vg(o,l,f){return(is&21)===0?(o.baseState&&(o.baseState=!1,En=!0),o.memoizedState=f):(ii(f,l)||(f=vp(),pt.lanes|=f,rs|=f,o.baseState=!0),l)}function lw(o,l){var f=et;et=f!==0&&4>f?f:4,o(!0);var g=gd.transition;gd.transition={};try{o(!1),l()}finally{et=f,gd.transition=g}}function Gg(){return Hn().memoizedState}function uw(o,l,f){var g=Ar(o);if(f={lane:g,action:f,hasEagerState:!1,eagerState:null,next:null},Hg(o))zg(l,f);else if(f=Sg(o,l,f,g),f!==null){var x=dn();li(f,o,g,x),Kg(f,l,g)}}function cw(o,l,f){var g=Ar(o),x={lane:g,action:f,hasEagerState:!1,eagerState:null,next:null};if(Hg(o))zg(l,x);else{var T=o.alternate;if(o.lanes===0&&(T===null||T.lanes===0)&&(T=l.lastRenderedReducer,T!==null))try{var I=l.lastRenderedState,N=T(I,f);if(x.hasEagerState=!0,x.eagerState=N,ii(N,I)){var $=l.interleaved;$===null?(x.next=x,cd(l)):(x.next=$.next,$.next=x),l.interleaved=x;return}}catch{}finally{}f=Sg(o,l,x,g),f!==null&&(x=dn(),li(f,o,g,x),Kg(f,l,g))}}function Hg(o){var l=o.alternate;return o===pt||l!==null&&l===pt}function zg(o,l){Qa=_l=!0;var f=o.pending;f===null?l.next=l:(l.next=f.next,f.next=l),o.pending=l}function Kg(o,l,f){if((f&4194240)!==0){var g=l.lanes;g&=o.pendingLanes,f|=g,l.lanes=f,Lc(o,f)}}var Ol={readContext:Gn,useCallback:Jt,useContext:Jt,useEffect:Jt,useImperativeHandle:Jt,useInsertionEffect:Jt,useLayoutEffect:Jt,useMemo:Jt,useReducer:Jt,useRef:Jt,useState:Jt,useDebugValue:Jt,useDeferredValue:Jt,useTransition:Jt,useMutableSource:Jt,useSyncExternalStore:Jt,useId:Jt,unstable_isNewReconciler:!1},dw={readContext:Gn,useCallback:function(o,l){return wi().memoizedState=[o,l===void 0?null:l],o},useContext:Gn,useEffect:Ng,useImperativeHandle:function(o,l,f){return f=f!=null?f.concat([o]):null,Ml(4194308,4,Bg.bind(null,l,o),f)},useLayoutEffect:function(o,l){return Ml(4194308,4,o,l)},useInsertionEffect:function(o,l){return Ml(4,2,o,l)},useMemo:function(o,l){var f=wi();return l=l===void 0?null:l,o=o(),f.memoizedState=[o,l],o},useReducer:function(o,l,f){var g=wi();return l=f!==void 0?f(l):l,g.memoizedState=g.baseState=l,o={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:o,lastRenderedState:l},g.queue=o,o=o.dispatch=uw.bind(null,pt,o),[g.memoizedState,o]},useRef:function(o){var l=wi();return o={current:o},l.memoizedState=o},useState:_g,useDebugValue:Ad,useDeferredValue:function(o){return wi().memoizedState=o},useTransition:function(){var o=_g(!1),l=o[0];return o=lw.bind(null,o[1]),wi().memoizedState=o,[l,o]},useMutableSource:function(){},useSyncExternalStore:function(o,l,f){var g=pt,x=wi();if(ft){if(f===void 0)throw Error(t(407));f=f()}else{if(f=l(),jt===null)throw Error(t(349));(is&30)!==0||Ig(g,l,f)}x.memoizedState=f;var T={value:f,getSnapshot:l};return x.queue=T,Ng(Dg.bind(null,g,T,o),[o]),g.flags|=2048,eo(9,Cg.bind(null,g,T,f,l),void 0,null),f},useId:function(){var o=wi(),l=jt.identifierPrefix;if(ft){var f=Ki,g=zi;f=(g&~(1<<32-it(g)-1)).toString(32)+f,l=":"+l+"R"+f,f=Za++,0<f&&(l+="H"+f.toString(32)),l+=":"}else f=ow++,l=":"+l+"r"+f.toString(32)+":";return o.memoizedState=l},unstable_isNewReconciler:!1},hw={readContext:Gn,useCallback:$g,useContext:Gn,useEffect:Td,useImperativeHandle:Ug,useInsertionEffect:Og,useLayoutEffect:Fg,useMemo:jg,useReducer:Ed,useRef:Mg,useState:function(){return Ed(Ja)},useDebugValue:Ad,useDeferredValue:function(o){var l=Hn();return Vg(l,Mt.memoizedState,o)},useTransition:function(){var o=Ed(Ja)[0],l=Hn().memoizedState;return[o,l]},useMutableSource:Rg,useSyncExternalStore:bg,useId:Gg,unstable_isNewReconciler:!1},fw={readContext:Gn,useCallback:$g,useContext:Gn,useEffect:Td,useImperativeHandle:Ug,useInsertionEffect:Og,useLayoutEffect:Fg,useMemo:jg,useReducer:Sd,useRef:Mg,useState:function(){return Sd(Ja)},useDebugValue:Ad,useDeferredValue:function(o){var l=Hn();return Mt===null?l.memoizedState=o:Vg(l,Mt.memoizedState,o)},useTransition:function(){var o=Sd(Ja)[0],l=Hn().memoizedState;return[o,l]},useMutableSource:Rg,useSyncExternalStore:bg,useId:Gg,unstable_isNewReconciler:!1};function si(o,l){if(o&&o.defaultProps){l=J({},l),o=o.defaultProps;for(var f in o)l[f]===void 0&&(l[f]=o[f]);return l}return l}function wd(o,l,f,g){l=o.memoizedState,f=f(g,l),f=f==null?l:J({},l,f),o.memoizedState=f,o.lanes===0&&(o.updateQueue.baseState=f)}var Fl={isMounted:function(o){return(o=o._reactInternals)?Le(o)===o:!1},enqueueSetState:function(o,l,f){o=o._reactInternals;var g=dn(),x=Ar(o),T=Yi(g,x);T.payload=l,f!=null&&(T.callback=f),l=xr(o,T,x),l!==null&&(li(l,o,x,g),Cl(l,o,x))},enqueueReplaceState:function(o,l,f){o=o._reactInternals;var g=dn(),x=Ar(o),T=Yi(g,x);T.tag=1,T.payload=l,f!=null&&(T.callback=f),l=xr(o,T,x),l!==null&&(li(l,o,x,g),Cl(l,o,x))},enqueueForceUpdate:function(o,l){o=o._reactInternals;var f=dn(),g=Ar(o),x=Yi(f,g);x.tag=2,l!=null&&(x.callback=l),l=xr(o,x,g),l!==null&&(li(l,o,g,f),Cl(l,o,g))}};function Wg(o,l,f,g,x,T,I){return o=o.stateNode,typeof o.shouldComponentUpdate=="function"?o.shouldComponentUpdate(g,T,I):l.prototype&&l.prototype.isPureReactComponent?!$a(f,g)||!$a(x,T):!0}function Yg(o,l,f){var g=!1,x=gr,T=l.contextType;return typeof T=="object"&&T!==null?T=Gn(T):(x=xn(l)?Zr:Zt.current,g=l.contextTypes,T=(g=g!=null)?Os(o,x):gr),l=new l(f,T),o.memoizedState=l.state!==null&&l.state!==void 0?l.state:null,l.updater=Fl,o.stateNode=l,l._reactInternals=o,g&&(o=o.stateNode,o.__reactInternalMemoizedUnmaskedChildContext=x,o.__reactInternalMemoizedMaskedChildContext=T),l}function qg(o,l,f,g){o=l.state,typeof l.componentWillReceiveProps=="function"&&l.componentWillReceiveProps(f,g),typeof l.UNSAFE_componentWillReceiveProps=="function"&&l.UNSAFE_componentWillReceiveProps(f,g),l.state!==o&&Fl.enqueueReplaceState(l,l.state,null)}function Ld(o,l,f,g){var x=o.stateNode;x.props=f,x.state=o.memoizedState,x.refs={},dd(o);var T=l.contextType;typeof T=="object"&&T!==null?x.context=Gn(T):(T=xn(l)?Zr:Zt.current,x.context=Os(o,T)),x.state=o.memoizedState,T=l.getDerivedStateFromProps,typeof T=="function"&&(wd(o,l,T,f),x.state=o.memoizedState),typeof l.getDerivedStateFromProps=="function"||typeof x.getSnapshotBeforeUpdate=="function"||typeof x.UNSAFE_componentWillMount!="function"&&typeof x.componentWillMount!="function"||(l=x.state,typeof x.componentWillMount=="function"&&x.componentWillMount(),typeof x.UNSAFE_componentWillMount=="function"&&x.UNSAFE_componentWillMount(),l!==x.state&&Fl.enqueueReplaceState(x,x.state,null),Dl(o,f,x,g),x.state=o.memoizedState),typeof x.componentDidMount=="function"&&(o.flags|=4194308)}function Hs(o,l){try{var f="",g=l;do f+=te(g),g=g.return;while(g);var x=f}catch(T){x=`
Error generating stack: `+T.message+`
`+T.stack}return{value:o,source:l,stack:x,digest:null}}function Rd(o,l,f){return{value:o,source:null,stack:f??null,digest:l??null}}function bd(o,l){try{console.error(l.value)}catch(f){setTimeout(function(){throw f})}}var mw=typeof WeakMap=="function"?WeakMap:Map;function Xg(o,l,f){f=Yi(-1,f),f.tag=3,f.payload={element:null};var g=l.value;return f.callback=function(){Hl||(Hl=!0,Vd=g),bd(o,l)},f}function Qg(o,l,f){f=Yi(-1,f),f.tag=3;var g=o.type.getDerivedStateFromError;if(typeof g=="function"){var x=l.value;f.payload=function(){return g(x)},f.callback=function(){bd(o,l)}}var T=o.stateNode;return T!==null&&typeof T.componentDidCatch=="function"&&(f.callback=function(){bd(o,l),typeof g!="function"&&(Sr===null?Sr=new Set([this]):Sr.add(this));var I=l.stack;this.componentDidCatch(l.value,{componentStack:I!==null?I:""})}),f}function Zg(o,l,f){var g=o.pingCache;if(g===null){g=o.pingCache=new mw;var x=new Set;g.set(l,x)}else x=g.get(l),x===void 0&&(x=new Set,g.set(l,x));x.has(f)||(x.add(f),o=Iw.bind(null,o,l,f),l.then(o,o))}function Jg(o){do{var l;if((l=o.tag===13)&&(l=o.memoizedState,l=l!==null?l.dehydrated!==null:!0),l)return o;o=o.return}while(o!==null);return null}function e0(o,l,f,g,x){return(o.mode&1)===0?(o===l?o.flags|=65536:(o.flags|=128,f.flags|=131072,f.flags&=-52805,f.tag===1&&(f.alternate===null?f.tag=17:(l=Yi(-1,1),l.tag=2,xr(f,l,1))),f.lanes|=1),o):(o.flags|=65536,o.lanes=x,o)}var pw=D.ReactCurrentOwner,En=!1;function cn(o,l,f,g){l.child=o===null?Eg(l,null,f,g):$s(l,o.child,f,g)}function t0(o,l,f,g,x){f=f.render;var T=l.ref;return Vs(l,x),g=vd(o,l,f,g,T,x),f=xd(),o!==null&&!En?(l.updateQueue=o.updateQueue,l.flags&=-2053,o.lanes&=~x,qi(o,l,x)):(ft&&f&&td(l),l.flags|=1,cn(o,l,g,x),l.child)}function n0(o,l,f,g,x){if(o===null){var T=f.type;return typeof T=="function"&&!qd(T)&&T.defaultProps===void 0&&f.compare===null&&f.defaultProps===void 0?(l.tag=15,l.type=T,i0(o,l,T,g,x)):(o=Xl(f.type,null,g,l,l.mode,x),o.ref=l.ref,o.return=l,l.child=o)}if(T=o.child,(o.lanes&x)===0){var I=T.memoizedProps;if(f=f.compare,f=f!==null?f:$a,f(I,g)&&o.ref===l.ref)return qi(o,l,x)}return l.flags|=1,o=Lr(T,g),o.ref=l.ref,o.return=l,l.child=o}function i0(o,l,f,g,x){if(o!==null){var T=o.memoizedProps;if($a(T,g)&&o.ref===l.ref)if(En=!1,l.pendingProps=g=T,(o.lanes&x)!==0)(o.flags&131072)!==0&&(En=!0);else return l.lanes=o.lanes,qi(o,l,x)}return Id(o,l,f,g,x)}function r0(o,l,f){var g=l.pendingProps,x=g.children,T=o!==null?o.memoizedState:null;if(g.mode==="hidden")if((l.mode&1)===0)l.memoizedState={baseLanes:0,cachePool:null,transitions:null},lt(Ks,Pn),Pn|=f;else{if((f&1073741824)===0)return o=T!==null?T.baseLanes|f:f,l.lanes=l.childLanes=1073741824,l.memoizedState={baseLanes:o,cachePool:null,transitions:null},l.updateQueue=null,lt(Ks,Pn),Pn|=o,null;l.memoizedState={baseLanes:0,cachePool:null,transitions:null},g=T!==null?T.baseLanes:f,lt(Ks,Pn),Pn|=g}else T!==null?(g=T.baseLanes|f,l.memoizedState=null):g=f,lt(Ks,Pn),Pn|=g;return cn(o,l,x,f),l.child}function s0(o,l){var f=l.ref;(o===null&&f!==null||o!==null&&o.ref!==f)&&(l.flags|=512,l.flags|=2097152)}function Id(o,l,f,g,x){var T=xn(f)?Zr:Zt.current;return T=Os(l,T),Vs(l,x),f=vd(o,l,f,g,T,x),g=xd(),o!==null&&!En?(l.updateQueue=o.updateQueue,l.flags&=-2053,o.lanes&=~x,qi(o,l,x)):(ft&&g&&td(l),l.flags|=1,cn(o,l,f,x),l.child)}function a0(o,l,f,g,x){if(xn(f)){var T=!0;Sl(l)}else T=!1;if(Vs(l,x),l.stateNode===null)Ul(o,l),Yg(l,f,g),Ld(l,f,g,x),g=!0;else if(o===null){var I=l.stateNode,N=l.memoizedProps;I.props=N;var $=I.context,Z=f.contextType;typeof Z=="object"&&Z!==null?Z=Gn(Z):(Z=xn(f)?Zr:Zt.current,Z=Os(l,Z));var ue=f.getDerivedStateFromProps,de=typeof ue=="function"||typeof I.getSnapshotBeforeUpdate=="function";de||typeof I.UNSAFE_componentWillReceiveProps!="function"&&typeof I.componentWillReceiveProps!="function"||(N!==g||$!==Z)&&qg(l,I,g,Z),vr=!1;var oe=l.memoizedState;I.state=oe,Dl(l,g,I,x),$=l.memoizedState,N!==g||oe!==$||vn.current||vr?(typeof ue=="function"&&(wd(l,f,ue,g),$=l.memoizedState),(N=vr||Wg(l,f,N,g,oe,$,Z))?(de||typeof I.UNSAFE_componentWillMount!="function"&&typeof I.componentWillMount!="function"||(typeof I.componentWillMount=="function"&&I.componentWillMount(),typeof I.UNSAFE_componentWillMount=="function"&&I.UNSAFE_componentWillMount()),typeof I.componentDidMount=="function"&&(l.flags|=4194308)):(typeof I.componentDidMount=="function"&&(l.flags|=4194308),l.memoizedProps=g,l.memoizedState=$),I.props=g,I.state=$,I.context=Z,g=N):(typeof I.componentDidMount=="function"&&(l.flags|=4194308),g=!1)}else{I=l.stateNode,Tg(o,l),N=l.memoizedProps,Z=l.type===l.elementType?N:si(l.type,N),I.props=Z,de=l.pendingProps,oe=I.context,$=f.contextType,typeof $=="object"&&$!==null?$=Gn($):($=xn(f)?Zr:Zt.current,$=Os(l,$));var ve=f.getDerivedStateFromProps;(ue=typeof ve=="function"||typeof I.getSnapshotBeforeUpdate=="function")||typeof I.UNSAFE_componentWillReceiveProps!="function"&&typeof I.componentWillReceiveProps!="function"||(N!==de||oe!==$)&&qg(l,I,g,$),vr=!1,oe=l.memoizedState,I.state=oe,Dl(l,g,I,x);var Ae=l.memoizedState;N!==de||oe!==Ae||vn.current||vr?(typeof ve=="function"&&(wd(l,f,ve,g),Ae=l.memoizedState),(Z=vr||Wg(l,f,Z,g,oe,Ae,$)||!1)?(ue||typeof I.UNSAFE_componentWillUpdate!="function"&&typeof I.componentWillUpdate!="function"||(typeof I.componentWillUpdate=="function"&&I.componentWillUpdate(g,Ae,$),typeof I.UNSAFE_componentWillUpdate=="function"&&I.UNSAFE_componentWillUpdate(g,Ae,$)),typeof I.componentDidUpdate=="function"&&(l.flags|=4),typeof I.getSnapshotBeforeUpdate=="function"&&(l.flags|=1024)):(typeof I.componentDidUpdate!="function"||N===o.memoizedProps&&oe===o.memoizedState||(l.flags|=4),typeof I.getSnapshotBeforeUpdate!="function"||N===o.memoizedProps&&oe===o.memoizedState||(l.flags|=1024),l.memoizedProps=g,l.memoizedState=Ae),I.props=g,I.state=Ae,I.context=$,g=Z):(typeof I.componentDidUpdate!="function"||N===o.memoizedProps&&oe===o.memoizedState||(l.flags|=4),typeof I.getSnapshotBeforeUpdate!="function"||N===o.memoizedProps&&oe===o.memoizedState||(l.flags|=1024),g=!1)}return Cd(o,l,f,g,T,x)}function Cd(o,l,f,g,x,T){s0(o,l);var I=(l.flags&128)!==0;if(!g&&!I)return x&&dg(l,f,!1),qi(o,l,T);g=l.stateNode,pw.current=l;var N=I&&typeof f.getDerivedStateFromError!="function"?null:g.render();return l.flags|=1,o!==null&&I?(l.child=$s(l,o.child,null,T),l.child=$s(l,null,N,T)):cn(o,l,N,T),l.memoizedState=g.state,x&&dg(l,f,!0),l.child}function o0(o){var l=o.stateNode;l.pendingContext?ug(o,l.pendingContext,l.pendingContext!==l.context):l.context&&ug(o,l.context,!1),hd(o,l.containerInfo)}function l0(o,l,f,g,x){return Us(),sd(x),l.flags|=256,cn(o,l,f,g),l.child}var Dd={dehydrated:null,treeContext:null,retryLane:0};function kd(o){return{baseLanes:o,cachePool:null,transitions:null}}function u0(o,l,f){var g=l.pendingProps,x=mt.current,T=!1,I=(l.flags&128)!==0,N;if((N=I)||(N=o!==null&&o.memoizedState===null?!1:(x&2)!==0),N?(T=!0,l.flags&=-129):(o===null||o.memoizedState!==null)&&(x|=1),lt(mt,x&1),o===null)return rd(l),o=l.memoizedState,o!==null&&(o=o.dehydrated,o!==null)?((l.mode&1)===0?l.lanes=1:o.data==="$!"?l.lanes=8:l.lanes=1073741824,null):(I=g.children,o=g.fallback,T?(g=l.mode,T=l.child,I={mode:"hidden",children:I},(g&1)===0&&T!==null?(T.childLanes=0,T.pendingProps=I):T=Ql(I,g,0,null),o=ls(o,g,f,null),T.return=l,o.return=l,T.sibling=o,l.child=T,l.child.memoizedState=kd(f),l.memoizedState=Dd,o):Pd(l,I));if(x=o.memoizedState,x!==null&&(N=x.dehydrated,N!==null))return gw(o,l,I,g,N,x,f);if(T){T=g.fallback,I=l.mode,x=o.child,N=x.sibling;var $={mode:"hidden",children:g.children};return(I&1)===0&&l.child!==x?(g=l.child,g.childLanes=0,g.pendingProps=$,l.deletions=null):(g=Lr(x,$),g.subtreeFlags=x.subtreeFlags&14680064),N!==null?T=Lr(N,T):(T=ls(T,I,f,null),T.flags|=2),T.return=l,g.return=l,g.sibling=T,l.child=g,g=T,T=l.child,I=o.child.memoizedState,I=I===null?kd(f):{baseLanes:I.baseLanes|f,cachePool:null,transitions:I.transitions},T.memoizedState=I,T.childLanes=o.childLanes&~f,l.memoizedState=Dd,g}return T=o.child,o=T.sibling,g=Lr(T,{mode:"visible",children:g.children}),(l.mode&1)===0&&(g.lanes=f),g.return=l,g.sibling=null,o!==null&&(f=l.deletions,f===null?(l.deletions=[o],l.flags|=16):f.push(o)),l.child=g,l.memoizedState=null,g}function Pd(o,l){return l=Ql({mode:"visible",children:l},o.mode,0,null),l.return=o,o.child=l}function Bl(o,l,f,g){return g!==null&&sd(g),$s(l,o.child,null,f),o=Pd(l,l.pendingProps.children),o.flags|=2,l.memoizedState=null,o}function gw(o,l,f,g,x,T,I){if(f)return l.flags&256?(l.flags&=-257,g=Rd(Error(t(422))),Bl(o,l,I,g)):l.memoizedState!==null?(l.child=o.child,l.flags|=128,null):(T=g.fallback,x=l.mode,g=Ql({mode:"visible",children:g.children},x,0,null),T=ls(T,x,I,null),T.flags|=2,g.return=l,T.return=l,g.sibling=T,l.child=g,(l.mode&1)!==0&&$s(l,o.child,null,I),l.child.memoizedState=kd(I),l.memoizedState=Dd,T);if((l.mode&1)===0)return Bl(o,l,I,null);if(x.data==="$!"){if(g=x.nextSibling&&x.nextSibling.dataset,g)var N=g.dgst;return g=N,T=Error(t(419)),g=Rd(T,g,void 0),Bl(o,l,I,g)}if(N=(I&o.childLanes)!==0,En||N){if(g=jt,g!==null){switch(I&-I){case 4:x=2;break;case 16:x=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:x=32;break;case 536870912:x=268435456;break;default:x=0}x=(x&(g.suspendedLanes|I))!==0?0:x,x!==0&&x!==T.retryLane&&(T.retryLane=x,Wi(o,x),li(g,o,x,-1))}return Yd(),g=Rd(Error(t(421))),Bl(o,l,I,g)}return x.data==="$?"?(l.flags|=128,l.child=o.child,l=Cw.bind(null,o),x._reactRetry=l,null):(o=T.treeContext,kn=mr(x.nextSibling),Dn=l,ft=!0,ri=null,o!==null&&(jn[Vn++]=zi,jn[Vn++]=Ki,jn[Vn++]=Jr,zi=o.id,Ki=o.overflow,Jr=l),l=Pd(l,g.children),l.flags|=4096,l)}function c0(o,l,f){o.lanes|=l;var g=o.alternate;g!==null&&(g.lanes|=l),ud(o.return,l,f)}function _d(o,l,f,g,x){var T=o.memoizedState;T===null?o.memoizedState={isBackwards:l,rendering:null,renderingStartTime:0,last:g,tail:f,tailMode:x}:(T.isBackwards=l,T.rendering=null,T.renderingStartTime=0,T.last=g,T.tail=f,T.tailMode=x)}function d0(o,l,f){var g=l.pendingProps,x=g.revealOrder,T=g.tail;if(cn(o,l,g.children,f),g=mt.current,(g&2)!==0)g=g&1|2,l.flags|=128;else{if(o!==null&&(o.flags&128)!==0)e:for(o=l.child;o!==null;){if(o.tag===13)o.memoizedState!==null&&c0(o,f,l);else if(o.tag===19)c0(o,f,l);else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===l)break e;for(;o.sibling===null;){if(o.return===null||o.return===l)break e;o=o.return}o.sibling.return=o.return,o=o.sibling}g&=1}if(lt(mt,g),(l.mode&1)===0)l.memoizedState=null;else switch(x){case"forwards":for(f=l.child,x=null;f!==null;)o=f.alternate,o!==null&&kl(o)===null&&(x=f),f=f.sibling;f=x,f===null?(x=l.child,l.child=null):(x=f.sibling,f.sibling=null),_d(l,!1,x,f,T);break;case"backwards":for(f=null,x=l.child,l.child=null;x!==null;){if(o=x.alternate,o!==null&&kl(o)===null){l.child=x;break}o=x.sibling,x.sibling=f,f=x,x=o}_d(l,!0,f,null,T);break;case"together":_d(l,!1,null,null,void 0);break;default:l.memoizedState=null}return l.child}function Ul(o,l){(l.mode&1)===0&&o!==null&&(o.alternate=null,l.alternate=null,l.flags|=2)}function qi(o,l,f){if(o!==null&&(l.dependencies=o.dependencies),rs|=l.lanes,(f&l.childLanes)===0)return null;if(o!==null&&l.child!==o.child)throw Error(t(153));if(l.child!==null){for(o=l.child,f=Lr(o,o.pendingProps),l.child=f,f.return=l;o.sibling!==null;)o=o.sibling,f=f.sibling=Lr(o,o.pendingProps),f.return=l;f.sibling=null}return l.child}function yw(o,l,f){switch(l.tag){case 3:o0(l),Us();break;case 5:Lg(l);break;case 1:xn(l.type)&&Sl(l);break;case 4:hd(l,l.stateNode.containerInfo);break;case 10:var g=l.type._context,x=l.memoizedProps.value;lt(bl,g._currentValue),g._currentValue=x;break;case 13:if(g=l.memoizedState,g!==null)return g.dehydrated!==null?(lt(mt,mt.current&1),l.flags|=128,null):(f&l.child.childLanes)!==0?u0(o,l,f):(lt(mt,mt.current&1),o=qi(o,l,f),o!==null?o.sibling:null);lt(mt,mt.current&1);break;case 19:if(g=(f&l.childLanes)!==0,(o.flags&128)!==0){if(g)return d0(o,l,f);l.flags|=128}if(x=l.memoizedState,x!==null&&(x.rendering=null,x.tail=null,x.lastEffect=null),lt(mt,mt.current),g)break;return null;case 22:case 23:return l.lanes=0,r0(o,l,f)}return qi(o,l,f)}var h0,Md,f0,m0;h0=function(o,l){for(var f=l.child;f!==null;){if(f.tag===5||f.tag===6)o.appendChild(f.stateNode);else if(f.tag!==4&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===l)break;for(;f.sibling===null;){if(f.return===null||f.return===l)return;f=f.return}f.sibling.return=f.return,f=f.sibling}},Md=function(){},f0=function(o,l,f,g){var x=o.memoizedProps;if(x!==g){o=l.stateNode,ns(Ai.current);var T=null;switch(f){case"input":x=vi(o,x),g=vi(o,g),T=[];break;case"select":x=J({},x,{value:void 0}),g=J({},g,{value:void 0}),T=[];break;case"textarea":x=Rn(o,x),g=Rn(o,g),T=[];break;default:typeof x.onClick!="function"&&typeof g.onClick=="function"&&(o.onclick=vl)}ws(f,g);var I;f=null;for(Z in x)if(!g.hasOwnProperty(Z)&&x.hasOwnProperty(Z)&&x[Z]!=null)if(Z==="style"){var N=x[Z];for(I in N)N.hasOwnProperty(I)&&(f||(f={}),f[I]="")}else Z!=="dangerouslySetInnerHTML"&&Z!=="children"&&Z!=="suppressContentEditableWarning"&&Z!=="suppressHydrationWarning"&&Z!=="autoFocus"&&(r.hasOwnProperty(Z)?T||(T=[]):(T=T||[]).push(Z,null));for(Z in g){var $=g[Z];if(N=x!=null?x[Z]:void 0,g.hasOwnProperty(Z)&&$!==N&&($!=null||N!=null))if(Z==="style")if(N){for(I in N)!N.hasOwnProperty(I)||$&&$.hasOwnProperty(I)||(f||(f={}),f[I]="");for(I in $)$.hasOwnProperty(I)&&N[I]!==$[I]&&(f||(f={}),f[I]=$[I])}else f||(T||(T=[]),T.push(Z,f)),f=$;else Z==="dangerouslySetInnerHTML"?($=$?$.__html:void 0,N=N?N.__html:void 0,$!=null&&N!==$&&(T=T||[]).push(Z,$)):Z==="children"?typeof $!="string"&&typeof $!="number"||(T=T||[]).push(Z,""+$):Z!=="suppressContentEditableWarning"&&Z!=="suppressHydrationWarning"&&(r.hasOwnProperty(Z)?($!=null&&Z==="onScroll"&&ct("scroll",o),T||N===$||(T=[])):(T=T||[]).push(Z,$))}f&&(T=T||[]).push("style",f);var Z=T;(l.updateQueue=Z)&&(l.flags|=4)}},m0=function(o,l,f,g){f!==g&&(l.flags|=4)};function to(o,l){if(!ft)switch(o.tailMode){case"hidden":l=o.tail;for(var f=null;l!==null;)l.alternate!==null&&(f=l),l=l.sibling;f===null?o.tail=null:f.sibling=null;break;case"collapsed":f=o.tail;for(var g=null;f!==null;)f.alternate!==null&&(g=f),f=f.sibling;g===null?l||o.tail===null?o.tail=null:o.tail.sibling=null:g.sibling=null}}function en(o){var l=o.alternate!==null&&o.alternate.child===o.child,f=0,g=0;if(l)for(var x=o.child;x!==null;)f|=x.lanes|x.childLanes,g|=x.subtreeFlags&14680064,g|=x.flags&14680064,x.return=o,x=x.sibling;else for(x=o.child;x!==null;)f|=x.lanes|x.childLanes,g|=x.subtreeFlags,g|=x.flags,x.return=o,x=x.sibling;return o.subtreeFlags|=g,o.childLanes=f,l}function vw(o,l,f){var g=l.pendingProps;switch(nd(l),l.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return en(l),null;case 1:return xn(l.type)&&El(),en(l),null;case 3:return g=l.stateNode,Gs(),dt(vn),dt(Zt),pd(),g.pendingContext&&(g.context=g.pendingContext,g.pendingContext=null),(o===null||o.child===null)&&(Ll(l)?l.flags|=4:o===null||o.memoizedState.isDehydrated&&(l.flags&256)===0||(l.flags|=1024,ri!==null&&(zd(ri),ri=null))),Md(o,l),en(l),null;case 5:fd(l);var x=ns(Xa.current);if(f=l.type,o!==null&&l.stateNode!=null)f0(o,l,f,g,x),o.ref!==l.ref&&(l.flags|=512,l.flags|=2097152);else{if(!g){if(l.stateNode===null)throw Error(t(166));return en(l),null}if(o=ns(Ai.current),Ll(l)){g=l.stateNode,f=l.type;var T=l.memoizedProps;switch(g[Ti]=l,g[za]=T,o=(l.mode&1)!==0,f){case"dialog":ct("cancel",g),ct("close",g);break;case"iframe":case"object":case"embed":ct("load",g);break;case"video":case"audio":for(x=0;x<Va.length;x++)ct(Va[x],g);break;case"source":ct("error",g);break;case"img":case"image":case"link":ct("error",g),ct("load",g);break;case"details":ct("toggle",g);break;case"input":Ta(g,T),ct("invalid",g);break;case"select":g._wrapperState={wasMultiple:!!T.multiple},ct("invalid",g);break;case"textarea":Hr(g,T),ct("invalid",g)}ws(f,T),x=null;for(var I in T)if(T.hasOwnProperty(I)){var N=T[I];I==="children"?typeof N=="string"?g.textContent!==N&&(T.suppressHydrationWarning!==!0&&yl(g.textContent,N,o),x=["children",N]):typeof N=="number"&&g.textContent!==""+N&&(T.suppressHydrationWarning!==!0&&yl(g.textContent,N,o),x=["children",""+N]):r.hasOwnProperty(I)&&N!=null&&I==="onScroll"&&ct("scroll",g)}switch(f){case"input":pn(g),Ht(g,T,!0);break;case"textarea":pn(g),ei(g);break;case"select":case"option":break;default:typeof T.onClick=="function"&&(g.onclick=vl)}g=x,l.updateQueue=g,g!==null&&(l.flags|=4)}else{I=x.nodeType===9?x:x.ownerDocument,o==="http://www.w3.org/1999/xhtml"&&(o=ti(f)),o==="http://www.w3.org/1999/xhtml"?f==="script"?(o=I.createElement("div"),o.innerHTML="<script><\/script>",o=o.removeChild(o.firstChild)):typeof g.is=="string"?o=I.createElement(f,{is:g.is}):(o=I.createElement(f),f==="select"&&(I=o,g.multiple?I.multiple=!0:g.size&&(I.size=g.size))):o=I.createElementNS(o,f),o[Ti]=l,o[za]=g,h0(o,l,!1,!1),l.stateNode=o;e:{switch(I=Ls(f,g),f){case"dialog":ct("cancel",o),ct("close",o),x=g;break;case"iframe":case"object":case"embed":ct("load",o),x=g;break;case"video":case"audio":for(x=0;x<Va.length;x++)ct(Va[x],o);x=g;break;case"source":ct("error",o),x=g;break;case"img":case"image":case"link":ct("error",o),ct("load",o),x=g;break;case"details":ct("toggle",o),x=g;break;case"input":Ta(o,g),x=vi(o,g),ct("invalid",o);break;case"option":x=g;break;case"select":o._wrapperState={wasMultiple:!!g.multiple},x=J({},g,{value:void 0}),ct("invalid",o);break;case"textarea":Hr(o,g),x=Rn(o,g),ct("invalid",o);break;default:x=g}ws(f,x),N=x;for(T in N)if(N.hasOwnProperty(T)){var $=N[T];T==="style"?Un(o,$):T==="dangerouslySetInnerHTML"?($=$?$.__html:void 0,$!=null&&ln(o,$)):T==="children"?typeof $=="string"?(f!=="textarea"||$!=="")&&ni(o,$):typeof $=="number"&&ni(o,""+$):T!=="suppressContentEditableWarning"&&T!=="suppressHydrationWarning"&&T!=="autoFocus"&&(r.hasOwnProperty(T)?$!=null&&T==="onScroll"&&ct("scroll",o):$!=null&&R(o,T,$,I))}switch(f){case"input":pn(o),Ht(o,g,!1);break;case"textarea":pn(o),ei(o);break;case"option":g.value!=null&&o.setAttribute("value",""+be(g.value));break;case"select":o.multiple=!!g.multiple,T=g.value,T!=null?an(o,!!g.multiple,T,!1):g.defaultValue!=null&&an(o,!!g.multiple,g.defaultValue,!0);break;default:typeof x.onClick=="function"&&(o.onclick=vl)}switch(f){case"button":case"input":case"select":case"textarea":g=!!g.autoFocus;break e;case"img":g=!0;break e;default:g=!1}}g&&(l.flags|=4)}l.ref!==null&&(l.flags|=512,l.flags|=2097152)}return en(l),null;case 6:if(o&&l.stateNode!=null)m0(o,l,o.memoizedProps,g);else{if(typeof g!="string"&&l.stateNode===null)throw Error(t(166));if(f=ns(Xa.current),ns(Ai.current),Ll(l)){if(g=l.stateNode,f=l.memoizedProps,g[Ti]=l,(T=g.nodeValue!==f)&&(o=Dn,o!==null))switch(o.tag){case 3:yl(g.nodeValue,f,(o.mode&1)!==0);break;case 5:o.memoizedProps.suppressHydrationWarning!==!0&&yl(g.nodeValue,f,(o.mode&1)!==0)}T&&(l.flags|=4)}else g=(f.nodeType===9?f:f.ownerDocument).createTextNode(g),g[Ti]=l,l.stateNode=g}return en(l),null;case 13:if(dt(mt),g=l.memoizedState,o===null||o.memoizedState!==null&&o.memoizedState.dehydrated!==null){if(ft&&kn!==null&&(l.mode&1)!==0&&(l.flags&128)===0)yg(),Us(),l.flags|=98560,T=!1;else if(T=Ll(l),g!==null&&g.dehydrated!==null){if(o===null){if(!T)throw Error(t(318));if(T=l.memoizedState,T=T!==null?T.dehydrated:null,!T)throw Error(t(317));T[Ti]=l}else Us(),(l.flags&128)===0&&(l.memoizedState=null),l.flags|=4;en(l),T=!1}else ri!==null&&(zd(ri),ri=null),T=!0;if(!T)return l.flags&65536?l:null}return(l.flags&128)!==0?(l.lanes=f,l):(g=g!==null,g!==(o!==null&&o.memoizedState!==null)&&g&&(l.child.flags|=8192,(l.mode&1)!==0&&(o===null||(mt.current&1)!==0?Nt===0&&(Nt=3):Yd())),l.updateQueue!==null&&(l.flags|=4),en(l),null);case 4:return Gs(),Md(o,l),o===null&&Ga(l.stateNode.containerInfo),en(l),null;case 10:return ld(l.type._context),en(l),null;case 17:return xn(l.type)&&El(),en(l),null;case 19:if(dt(mt),T=l.memoizedState,T===null)return en(l),null;if(g=(l.flags&128)!==0,I=T.rendering,I===null)if(g)to(T,!1);else{if(Nt!==0||o!==null&&(o.flags&128)!==0)for(o=l.child;o!==null;){if(I=kl(o),I!==null){for(l.flags|=128,to(T,!1),g=I.updateQueue,g!==null&&(l.updateQueue=g,l.flags|=4),l.subtreeFlags=0,g=f,f=l.child;f!==null;)T=f,o=g,T.flags&=14680066,I=T.alternate,I===null?(T.childLanes=0,T.lanes=o,T.child=null,T.subtreeFlags=0,T.memoizedProps=null,T.memoizedState=null,T.updateQueue=null,T.dependencies=null,T.stateNode=null):(T.childLanes=I.childLanes,T.lanes=I.lanes,T.child=I.child,T.subtreeFlags=0,T.deletions=null,T.memoizedProps=I.memoizedProps,T.memoizedState=I.memoizedState,T.updateQueue=I.updateQueue,T.type=I.type,o=I.dependencies,T.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext}),f=f.sibling;return lt(mt,mt.current&1|2),l.child}o=o.sibling}T.tail!==null&&Je()>Ws&&(l.flags|=128,g=!0,to(T,!1),l.lanes=4194304)}else{if(!g)if(o=kl(I),o!==null){if(l.flags|=128,g=!0,f=o.updateQueue,f!==null&&(l.updateQueue=f,l.flags|=4),to(T,!0),T.tail===null&&T.tailMode==="hidden"&&!I.alternate&&!ft)return en(l),null}else 2*Je()-T.renderingStartTime>Ws&&f!==1073741824&&(l.flags|=128,g=!0,to(T,!1),l.lanes=4194304);T.isBackwards?(I.sibling=l.child,l.child=I):(f=T.last,f!==null?f.sibling=I:l.child=I,T.last=I)}return T.tail!==null?(l=T.tail,T.rendering=l,T.tail=l.sibling,T.renderingStartTime=Je(),l.sibling=null,f=mt.current,lt(mt,g?f&1|2:f&1),l):(en(l),null);case 22:case 23:return Wd(),g=l.memoizedState!==null,o!==null&&o.memoizedState!==null!==g&&(l.flags|=8192),g&&(l.mode&1)!==0?(Pn&1073741824)!==0&&(en(l),l.subtreeFlags&6&&(l.flags|=8192)):en(l),null;case 24:return null;case 25:return null}throw Error(t(156,l.tag))}function xw(o,l){switch(nd(l),l.tag){case 1:return xn(l.type)&&El(),o=l.flags,o&65536?(l.flags=o&-65537|128,l):null;case 3:return Gs(),dt(vn),dt(Zt),pd(),o=l.flags,(o&65536)!==0&&(o&128)===0?(l.flags=o&-65537|128,l):null;case 5:return fd(l),null;case 13:if(dt(mt),o=l.memoizedState,o!==null&&o.dehydrated!==null){if(l.alternate===null)throw Error(t(340));Us()}return o=l.flags,o&65536?(l.flags=o&-65537|128,l):null;case 19:return dt(mt),null;case 4:return Gs(),null;case 10:return ld(l.type._context),null;case 22:case 23:return Wd(),null;case 24:return null;default:return null}}var $l=!1,tn=!1,Ew=typeof WeakSet=="function"?WeakSet:Set,Se=null;function zs(o,l){var f=o.ref;if(f!==null)if(typeof f=="function")try{f(null)}catch(g){Et(o,l,g)}else f.current=null}function Nd(o,l,f){try{f()}catch(g){Et(o,l,g)}}var p0=!1;function Sw(o,l){if(Wc=al,o=Wp(),Uc(o)){if("selectionStart"in o)var f={start:o.selectionStart,end:o.selectionEnd};else e:{f=(f=o.ownerDocument)&&f.defaultView||window;var g=f.getSelection&&f.getSelection();if(g&&g.rangeCount!==0){f=g.anchorNode;var x=g.anchorOffset,T=g.focusNode;g=g.focusOffset;try{f.nodeType,T.nodeType}catch{f=null;break e}var I=0,N=-1,$=-1,Z=0,ue=0,de=o,oe=null;t:for(;;){for(var ve;de!==f||x!==0&&de.nodeType!==3||(N=I+x),de!==T||g!==0&&de.nodeType!==3||($=I+g),de.nodeType===3&&(I+=de.nodeValue.length),(ve=de.firstChild)!==null;)oe=de,de=ve;for(;;){if(de===o)break t;if(oe===f&&++Z===x&&(N=I),oe===T&&++ue===g&&($=I),(ve=de.nextSibling)!==null)break;de=oe,oe=de.parentNode}de=ve}f=N===-1||$===-1?null:{start:N,end:$}}else f=null}f=f||{start:0,end:0}}else f=null;for(Yc={focusedElem:o,selectionRange:f},al=!1,Se=l;Se!==null;)if(l=Se,o=l.child,(l.subtreeFlags&1028)!==0&&o!==null)o.return=l,Se=o;else for(;Se!==null;){l=Se;try{var Ae=l.alternate;if((l.flags&1024)!==0)switch(l.tag){case 0:case 11:case 15:break;case 1:if(Ae!==null){var Re=Ae.memoizedProps,Lt=Ae.memoizedState,q=l.stateNode,V=q.getSnapshotBeforeUpdate(l.elementType===l.type?Re:si(l.type,Re),Lt);q.__reactInternalSnapshotBeforeUpdate=V}break;case 3:var X=l.stateNode.containerInfo;X.nodeType===1?X.textContent="":X.nodeType===9&&X.documentElement&&X.removeChild(X.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(t(163))}}catch(me){Et(l,l.return,me)}if(o=l.sibling,o!==null){o.return=l.return,Se=o;break}Se=l.return}return Ae=p0,p0=!1,Ae}function no(o,l,f){var g=l.updateQueue;if(g=g!==null?g.lastEffect:null,g!==null){var x=g=g.next;do{if((x.tag&o)===o){var T=x.destroy;x.destroy=void 0,T!==void 0&&Nd(l,f,T)}x=x.next}while(x!==g)}}function jl(o,l){if(l=l.updateQueue,l=l!==null?l.lastEffect:null,l!==null){var f=l=l.next;do{if((f.tag&o)===o){var g=f.create;f.destroy=g()}f=f.next}while(f!==l)}}function Od(o){var l=o.ref;if(l!==null){var f=o.stateNode;switch(o.tag){case 5:o=f;break;default:o=f}typeof l=="function"?l(o):l.current=o}}function g0(o){var l=o.alternate;l!==null&&(o.alternate=null,g0(l)),o.child=null,o.deletions=null,o.sibling=null,o.tag===5&&(l=o.stateNode,l!==null&&(delete l[Ti],delete l[za],delete l[Zc],delete l[iw],delete l[rw])),o.stateNode=null,o.return=null,o.dependencies=null,o.memoizedProps=null,o.memoizedState=null,o.pendingProps=null,o.stateNode=null,o.updateQueue=null}function y0(o){return o.tag===5||o.tag===3||o.tag===4}function v0(o){e:for(;;){for(;o.sibling===null;){if(o.return===null||y0(o.return))return null;o=o.return}for(o.sibling.return=o.return,o=o.sibling;o.tag!==5&&o.tag!==6&&o.tag!==18;){if(o.flags&2||o.child===null||o.tag===4)continue e;o.child.return=o,o=o.child}if(!(o.flags&2))return o.stateNode}}function Fd(o,l,f){var g=o.tag;if(g===5||g===6)o=o.stateNode,l?f.nodeType===8?f.parentNode.insertBefore(o,l):f.insertBefore(o,l):(f.nodeType===8?(l=f.parentNode,l.insertBefore(o,f)):(l=f,l.appendChild(o)),f=f._reactRootContainer,f!=null||l.onclick!==null||(l.onclick=vl));else if(g!==4&&(o=o.child,o!==null))for(Fd(o,l,f),o=o.sibling;o!==null;)Fd(o,l,f),o=o.sibling}function Bd(o,l,f){var g=o.tag;if(g===5||g===6)o=o.stateNode,l?f.insertBefore(o,l):f.appendChild(o);else if(g!==4&&(o=o.child,o!==null))for(Bd(o,l,f),o=o.sibling;o!==null;)Bd(o,l,f),o=o.sibling}var zt=null,ai=!1;function Er(o,l,f){for(f=f.child;f!==null;)x0(o,l,f),f=f.sibling}function x0(o,l,f){if(un&&typeof un.onCommitFiberUnmount=="function")try{un.onCommitFiberUnmount($i,f)}catch{}switch(f.tag){case 5:tn||zs(f,l);case 6:var g=zt,x=ai;zt=null,Er(o,l,f),zt=g,ai=x,zt!==null&&(ai?(o=zt,f=f.stateNode,o.nodeType===8?o.parentNode.removeChild(f):o.removeChild(f)):zt.removeChild(f.stateNode));break;case 18:zt!==null&&(ai?(o=zt,f=f.stateNode,o.nodeType===8?Qc(o.parentNode,f):o.nodeType===1&&Qc(o,f),Ma(o)):Qc(zt,f.stateNode));break;case 4:g=zt,x=ai,zt=f.stateNode.containerInfo,ai=!0,Er(o,l,f),zt=g,ai=x;break;case 0:case 11:case 14:case 15:if(!tn&&(g=f.updateQueue,g!==null&&(g=g.lastEffect,g!==null))){x=g=g.next;do{var T=x,I=T.destroy;T=T.tag,I!==void 0&&((T&2)!==0||(T&4)!==0)&&Nd(f,l,I),x=x.next}while(x!==g)}Er(o,l,f);break;case 1:if(!tn&&(zs(f,l),g=f.stateNode,typeof g.componentWillUnmount=="function"))try{g.props=f.memoizedProps,g.state=f.memoizedState,g.componentWillUnmount()}catch(N){Et(f,l,N)}Er(o,l,f);break;case 21:Er(o,l,f);break;case 22:f.mode&1?(tn=(g=tn)||f.memoizedState!==null,Er(o,l,f),tn=g):Er(o,l,f);break;default:Er(o,l,f)}}function E0(o){var l=o.updateQueue;if(l!==null){o.updateQueue=null;var f=o.stateNode;f===null&&(f=o.stateNode=new Ew),l.forEach(function(g){var x=Dw.bind(null,o,g);f.has(g)||(f.add(g),g.then(x,x))})}}function oi(o,l){var f=l.deletions;if(f!==null)for(var g=0;g<f.length;g++){var x=f[g];try{var T=o,I=l,N=I;e:for(;N!==null;){switch(N.tag){case 5:zt=N.stateNode,ai=!1;break e;case 3:zt=N.stateNode.containerInfo,ai=!0;break e;case 4:zt=N.stateNode.containerInfo,ai=!0;break e}N=N.return}if(zt===null)throw Error(t(160));x0(T,I,x),zt=null,ai=!1;var $=x.alternate;$!==null&&($.return=null),x.return=null}catch(Z){Et(x,l,Z)}}if(l.subtreeFlags&12854)for(l=l.child;l!==null;)S0(l,o),l=l.sibling}function S0(o,l){var f=o.alternate,g=o.flags;switch(o.tag){case 0:case 11:case 14:case 15:if(oi(l,o),Li(o),g&4){try{no(3,o,o.return),jl(3,o)}catch(Re){Et(o,o.return,Re)}try{no(5,o,o.return)}catch(Re){Et(o,o.return,Re)}}break;case 1:oi(l,o),Li(o),g&512&&f!==null&&zs(f,f.return);break;case 5:if(oi(l,o),Li(o),g&512&&f!==null&&zs(f,f.return),o.flags&32){var x=o.stateNode;try{ni(x,"")}catch(Re){Et(o,o.return,Re)}}if(g&4&&(x=o.stateNode,x!=null)){var T=o.memoizedProps,I=f!==null?f.memoizedProps:T,N=o.type,$=o.updateQueue;if(o.updateQueue=null,$!==null)try{N==="input"&&T.type==="radio"&&T.name!=null&&$e(x,T),Ls(N,I);var Z=Ls(N,T);for(I=0;I<$.length;I+=2){var ue=$[I],de=$[I+1];ue==="style"?Un(x,de):ue==="dangerouslySetInnerHTML"?ln(x,de):ue==="children"?ni(x,de):R(x,ue,de,Z)}switch(N){case"input":xt(x,T);break;case"textarea":on(x,T);break;case"select":var oe=x._wrapperState.wasMultiple;x._wrapperState.wasMultiple=!!T.multiple;var ve=T.value;ve!=null?an(x,!!T.multiple,ve,!1):oe!==!!T.multiple&&(T.defaultValue!=null?an(x,!!T.multiple,T.defaultValue,!0):an(x,!!T.multiple,T.multiple?[]:"",!1))}x[za]=T}catch(Re){Et(o,o.return,Re)}}break;case 6:if(oi(l,o),Li(o),g&4){if(o.stateNode===null)throw Error(t(162));x=o.stateNode,T=o.memoizedProps;try{x.nodeValue=T}catch(Re){Et(o,o.return,Re)}}break;case 3:if(oi(l,o),Li(o),g&4&&f!==null&&f.memoizedState.isDehydrated)try{Ma(l.containerInfo)}catch(Re){Et(o,o.return,Re)}break;case 4:oi(l,o),Li(o);break;case 13:oi(l,o),Li(o),x=o.child,x.flags&8192&&(T=x.memoizedState!==null,x.stateNode.isHidden=T,!T||x.alternate!==null&&x.alternate.memoizedState!==null||(jd=Je())),g&4&&E0(o);break;case 22:if(ue=f!==null&&f.memoizedState!==null,o.mode&1?(tn=(Z=tn)||ue,oi(l,o),tn=Z):oi(l,o),Li(o),g&8192){if(Z=o.memoizedState!==null,(o.stateNode.isHidden=Z)&&!ue&&(o.mode&1)!==0)for(Se=o,ue=o.child;ue!==null;){for(de=Se=ue;Se!==null;){switch(oe=Se,ve=oe.child,oe.tag){case 0:case 11:case 14:case 15:no(4,oe,oe.return);break;case 1:zs(oe,oe.return);var Ae=oe.stateNode;if(typeof Ae.componentWillUnmount=="function"){g=oe,f=oe.return;try{l=g,Ae.props=l.memoizedProps,Ae.state=l.memoizedState,Ae.componentWillUnmount()}catch(Re){Et(g,f,Re)}}break;case 5:zs(oe,oe.return);break;case 22:if(oe.memoizedState!==null){w0(de);continue}}ve!==null?(ve.return=oe,Se=ve):w0(de)}ue=ue.sibling}e:for(ue=null,de=o;;){if(de.tag===5){if(ue===null){ue=de;try{x=de.stateNode,Z?(T=x.style,typeof T.setProperty=="function"?T.setProperty("display","none","important"):T.display="none"):(N=de.stateNode,$=de.memoizedProps.style,I=$!=null&&$.hasOwnProperty("display")?$.display:null,N.style.display=Jo("display",I))}catch(Re){Et(o,o.return,Re)}}}else if(de.tag===6){if(ue===null)try{de.stateNode.nodeValue=Z?"":de.memoizedProps}catch(Re){Et(o,o.return,Re)}}else if((de.tag!==22&&de.tag!==23||de.memoizedState===null||de===o)&&de.child!==null){de.child.return=de,de=de.child;continue}if(de===o)break e;for(;de.sibling===null;){if(de.return===null||de.return===o)break e;ue===de&&(ue=null),de=de.return}ue===de&&(ue=null),de.sibling.return=de.return,de=de.sibling}}break;case 19:oi(l,o),Li(o),g&4&&E0(o);break;case 21:break;default:oi(l,o),Li(o)}}function Li(o){var l=o.flags;if(l&2){try{e:{for(var f=o.return;f!==null;){if(y0(f)){var g=f;break e}f=f.return}throw Error(t(160))}switch(g.tag){case 5:var x=g.stateNode;g.flags&32&&(ni(x,""),g.flags&=-33);var T=v0(o);Bd(o,T,x);break;case 3:case 4:var I=g.stateNode.containerInfo,N=v0(o);Fd(o,N,I);break;default:throw Error(t(161))}}catch($){Et(o,o.return,$)}o.flags&=-3}l&4096&&(o.flags&=-4097)}function Tw(o,l,f){Se=o,T0(o)}function T0(o,l,f){for(var g=(o.mode&1)!==0;Se!==null;){var x=Se,T=x.child;if(x.tag===22&&g){var I=x.memoizedState!==null||$l;if(!I){var N=x.alternate,$=N!==null&&N.memoizedState!==null||tn;N=$l;var Z=tn;if($l=I,(tn=$)&&!Z)for(Se=x;Se!==null;)I=Se,$=I.child,I.tag===22&&I.memoizedState!==null?L0(x):$!==null?($.return=I,Se=$):L0(x);for(;T!==null;)Se=T,T0(T),T=T.sibling;Se=x,$l=N,tn=Z}A0(o)}else(x.subtreeFlags&8772)!==0&&T!==null?(T.return=x,Se=T):A0(o)}}function A0(o){for(;Se!==null;){var l=Se;if((l.flags&8772)!==0){var f=l.alternate;try{if((l.flags&8772)!==0)switch(l.tag){case 0:case 11:case 15:tn||jl(5,l);break;case 1:var g=l.stateNode;if(l.flags&4&&!tn)if(f===null)g.componentDidMount();else{var x=l.elementType===l.type?f.memoizedProps:si(l.type,f.memoizedProps);g.componentDidUpdate(x,f.memoizedState,g.__reactInternalSnapshotBeforeUpdate)}var T=l.updateQueue;T!==null&&wg(l,T,g);break;case 3:var I=l.updateQueue;if(I!==null){if(f=null,l.child!==null)switch(l.child.tag){case 5:f=l.child.stateNode;break;case 1:f=l.child.stateNode}wg(l,I,f)}break;case 5:var N=l.stateNode;if(f===null&&l.flags&4){f=N;var $=l.memoizedProps;switch(l.type){case"button":case"input":case"select":case"textarea":$.autoFocus&&f.focus();break;case"img":$.src&&(f.src=$.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(l.memoizedState===null){var Z=l.alternate;if(Z!==null){var ue=Z.memoizedState;if(ue!==null){var de=ue.dehydrated;de!==null&&Ma(de)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(t(163))}tn||l.flags&512&&Od(l)}catch(oe){Et(l,l.return,oe)}}if(l===o){Se=null;break}if(f=l.sibling,f!==null){f.return=l.return,Se=f;break}Se=l.return}}function w0(o){for(;Se!==null;){var l=Se;if(l===o){Se=null;break}var f=l.sibling;if(f!==null){f.return=l.return,Se=f;break}Se=l.return}}function L0(o){for(;Se!==null;){var l=Se;try{switch(l.tag){case 0:case 11:case 15:var f=l.return;try{jl(4,l)}catch($){Et(l,f,$)}break;case 1:var g=l.stateNode;if(typeof g.componentDidMount=="function"){var x=l.return;try{g.componentDidMount()}catch($){Et(l,x,$)}}var T=l.return;try{Od(l)}catch($){Et(l,T,$)}break;case 5:var I=l.return;try{Od(l)}catch($){Et(l,I,$)}}}catch($){Et(l,l.return,$)}if(l===o){Se=null;break}var N=l.sibling;if(N!==null){N.return=l.return,Se=N;break}Se=l.return}}var Aw=Math.ceil,Vl=D.ReactCurrentDispatcher,Ud=D.ReactCurrentOwner,zn=D.ReactCurrentBatchConfig,qe=0,jt=null,Ct=null,Kt=0,Pn=0,Ks=pr(0),Nt=0,io=null,rs=0,Gl=0,$d=0,ro=null,Sn=null,jd=0,Ws=1/0,Xi=null,Hl=!1,Vd=null,Sr=null,zl=!1,Tr=null,Kl=0,so=0,Gd=null,Wl=-1,Yl=0;function dn(){return(qe&6)!==0?Je():Wl!==-1?Wl:Wl=Je()}function Ar(o){return(o.mode&1)===0?1:(qe&2)!==0&&Kt!==0?Kt&-Kt:aw.transition!==null?(Yl===0&&(Yl=vp()),Yl):(o=et,o!==0||(o=window.event,o=o===void 0?16:bp(o.type)),o)}function li(o,l,f,g){if(50<so)throw so=0,Gd=null,Error(t(185));Ca(o,f,g),((qe&2)===0||o!==jt)&&(o===jt&&((qe&2)===0&&(Gl|=f),Nt===4&&wr(o,Kt)),Tn(o,g),f===1&&qe===0&&(l.mode&1)===0&&(Ws=Je()+500,Tl&&yr()))}function Tn(o,l){var f=o.callbackNode;a1(o,l);var g=il(o,o===jt?Kt:0);if(g===0)f!==null&&Ut(f),o.callbackNode=null,o.callbackPriority=0;else if(l=g&-g,o.callbackPriority!==l){if(f!=null&&Ut(f),l===1)o.tag===0?sw(b0.bind(null,o)):hg(b0.bind(null,o)),tw(function(){(qe&6)===0&&yr()}),f=null;else{switch(xp(g)){case 1:f=$n;break;case 4:f=In;break;case 16:f=ar;break;case 536870912:f=Si;break;default:f=ar}f=N0(f,R0.bind(null,o))}o.callbackPriority=l,o.callbackNode=f}}function R0(o,l){if(Wl=-1,Yl=0,(qe&6)!==0)throw Error(t(327));var f=o.callbackNode;if(Ys()&&o.callbackNode!==f)return null;var g=il(o,o===jt?Kt:0);if(g===0)return null;if((g&30)!==0||(g&o.expiredLanes)!==0||l)l=ql(o,g);else{l=g;var x=qe;qe|=2;var T=C0();(jt!==o||Kt!==l)&&(Xi=null,Ws=Je()+500,as(o,l));do try{Rw();break}catch(N){I0(o,N)}while(!0);od(),Vl.current=T,qe=x,Ct!==null?l=0:(jt=null,Kt=0,l=Nt)}if(l!==0){if(l===2&&(x=Ac(o),x!==0&&(g=x,l=Hd(o,x))),l===1)throw f=io,as(o,0),wr(o,g),Tn(o,Je()),f;if(l===6)wr(o,g);else{if(x=o.current.alternate,(g&30)===0&&!ww(x)&&(l=ql(o,g),l===2&&(T=Ac(o),T!==0&&(g=T,l=Hd(o,T))),l===1))throw f=io,as(o,0),wr(o,g),Tn(o,Je()),f;switch(o.finishedWork=x,o.finishedLanes=g,l){case 0:case 1:throw Error(t(345));case 2:os(o,Sn,Xi);break;case 3:if(wr(o,g),(g&130023424)===g&&(l=jd+500-Je(),10<l)){if(il(o,0)!==0)break;if(x=o.suspendedLanes,(x&g)!==g){dn(),o.pingedLanes|=o.suspendedLanes&x;break}o.timeoutHandle=Xc(os.bind(null,o,Sn,Xi),l);break}os(o,Sn,Xi);break;case 4:if(wr(o,g),(g&4194240)===g)break;for(l=o.eventTimes,x=-1;0<g;){var I=31-it(g);T=1<<I,I=l[I],I>x&&(x=I),g&=~T}if(g=x,g=Je()-g,g=(120>g?120:480>g?480:1080>g?1080:1920>g?1920:3e3>g?3e3:4320>g?4320:1960*Aw(g/1960))-g,10<g){o.timeoutHandle=Xc(os.bind(null,o,Sn,Xi),g);break}os(o,Sn,Xi);break;case 5:os(o,Sn,Xi);break;default:throw Error(t(329))}}}return Tn(o,Je()),o.callbackNode===f?R0.bind(null,o):null}function Hd(o,l){var f=ro;return o.current.memoizedState.isDehydrated&&(as(o,l).flags|=256),o=ql(o,l),o!==2&&(l=Sn,Sn=f,l!==null&&zd(l)),o}function zd(o){Sn===null?Sn=o:Sn.push.apply(Sn,o)}function ww(o){for(var l=o;;){if(l.flags&16384){var f=l.updateQueue;if(f!==null&&(f=f.stores,f!==null))for(var g=0;g<f.length;g++){var x=f[g],T=x.getSnapshot;x=x.value;try{if(!ii(T(),x))return!1}catch{return!1}}}if(f=l.child,l.subtreeFlags&16384&&f!==null)f.return=l,l=f;else{if(l===o)break;for(;l.sibling===null;){if(l.return===null||l.return===o)return!0;l=l.return}l.sibling.return=l.return,l=l.sibling}}return!0}function wr(o,l){for(l&=~$d,l&=~Gl,o.suspendedLanes|=l,o.pingedLanes&=~l,o=o.expirationTimes;0<l;){var f=31-it(l),g=1<<f;o[f]=-1,l&=~g}}function b0(o){if((qe&6)!==0)throw Error(t(327));Ys();var l=il(o,0);if((l&1)===0)return Tn(o,Je()),null;var f=ql(o,l);if(o.tag!==0&&f===2){var g=Ac(o);g!==0&&(l=g,f=Hd(o,g))}if(f===1)throw f=io,as(o,0),wr(o,l),Tn(o,Je()),f;if(f===6)throw Error(t(345));return o.finishedWork=o.current.alternate,o.finishedLanes=l,os(o,Sn,Xi),Tn(o,Je()),null}function Kd(o,l){var f=qe;qe|=1;try{return o(l)}finally{qe=f,qe===0&&(Ws=Je()+500,Tl&&yr())}}function ss(o){Tr!==null&&Tr.tag===0&&(qe&6)===0&&Ys();var l=qe;qe|=1;var f=zn.transition,g=et;try{if(zn.transition=null,et=1,o)return o()}finally{et=g,zn.transition=f,qe=l,(qe&6)===0&&yr()}}function Wd(){Pn=Ks.current,dt(Ks)}function as(o,l){o.finishedWork=null,o.finishedLanes=0;var f=o.timeoutHandle;if(f!==-1&&(o.timeoutHandle=-1,ew(f)),Ct!==null)for(f=Ct.return;f!==null;){var g=f;switch(nd(g),g.tag){case 1:g=g.type.childContextTypes,g!=null&&El();break;case 3:Gs(),dt(vn),dt(Zt),pd();break;case 5:fd(g);break;case 4:Gs();break;case 13:dt(mt);break;case 19:dt(mt);break;case 10:ld(g.type._context);break;case 22:case 23:Wd()}f=f.return}if(jt=o,Ct=o=Lr(o.current,null),Kt=Pn=l,Nt=0,io=null,$d=Gl=rs=0,Sn=ro=null,ts!==null){for(l=0;l<ts.length;l++)if(f=ts[l],g=f.interleaved,g!==null){f.interleaved=null;var x=g.next,T=f.pending;if(T!==null){var I=T.next;T.next=x,g.next=I}f.pending=g}ts=null}return o}function I0(o,l){do{var f=Ct;try{if(od(),Pl.current=Ol,_l){for(var g=pt.memoizedState;g!==null;){var x=g.queue;x!==null&&(x.pending=null),g=g.next}_l=!1}if(is=0,$t=Mt=pt=null,Qa=!1,Za=0,Ud.current=null,f===null||f.return===null){Nt=1,io=l,Ct=null;break}e:{var T=o,I=f.return,N=f,$=l;if(l=Kt,N.flags|=32768,$!==null&&typeof $=="object"&&typeof $.then=="function"){var Z=$,ue=N,de=ue.tag;if((ue.mode&1)===0&&(de===0||de===11||de===15)){var oe=ue.alternate;oe?(ue.updateQueue=oe.updateQueue,ue.memoizedState=oe.memoizedState,ue.lanes=oe.lanes):(ue.updateQueue=null,ue.memoizedState=null)}var ve=Jg(I);if(ve!==null){ve.flags&=-257,e0(ve,I,N,T,l),ve.mode&1&&Zg(T,Z,l),l=ve,$=Z;var Ae=l.updateQueue;if(Ae===null){var Re=new Set;Re.add($),l.updateQueue=Re}else Ae.add($);break e}else{if((l&1)===0){Zg(T,Z,l),Yd();break e}$=Error(t(426))}}else if(ft&&N.mode&1){var Lt=Jg(I);if(Lt!==null){(Lt.flags&65536)===0&&(Lt.flags|=256),e0(Lt,I,N,T,l),sd(Hs($,N));break e}}T=$=Hs($,N),Nt!==4&&(Nt=2),ro===null?ro=[T]:ro.push(T),T=I;do{switch(T.tag){case 3:T.flags|=65536,l&=-l,T.lanes|=l;var q=Xg(T,$,l);Ag(T,q);break e;case 1:N=$;var V=T.type,X=T.stateNode;if((T.flags&128)===0&&(typeof V.getDerivedStateFromError=="function"||X!==null&&typeof X.componentDidCatch=="function"&&(Sr===null||!Sr.has(X)))){T.flags|=65536,l&=-l,T.lanes|=l;var me=Qg(T,N,l);Ag(T,me);break e}}T=T.return}while(T!==null)}k0(f)}catch(De){l=De,Ct===f&&f!==null&&(Ct=f=f.return);continue}break}while(!0)}function C0(){var o=Vl.current;return Vl.current=Ol,o===null?Ol:o}function Yd(){(Nt===0||Nt===3||Nt===2)&&(Nt=4),jt===null||(rs&268435455)===0&&(Gl&268435455)===0||wr(jt,Kt)}function ql(o,l){var f=qe;qe|=2;var g=C0();(jt!==o||Kt!==l)&&(Xi=null,as(o,l));do try{Lw();break}catch(x){I0(o,x)}while(!0);if(od(),qe=f,Vl.current=g,Ct!==null)throw Error(t(261));return jt=null,Kt=0,Nt}function Lw(){for(;Ct!==null;)D0(Ct)}function Rw(){for(;Ct!==null&&!Qe();)D0(Ct)}function D0(o){var l=M0(o.alternate,o,Pn);o.memoizedProps=o.pendingProps,l===null?k0(o):Ct=l,Ud.current=null}function k0(o){var l=o;do{var f=l.alternate;if(o=l.return,(l.flags&32768)===0){if(f=vw(f,l,Pn),f!==null){Ct=f;return}}else{if(f=xw(f,l),f!==null){f.flags&=32767,Ct=f;return}if(o!==null)o.flags|=32768,o.subtreeFlags=0,o.deletions=null;else{Nt=6,Ct=null;return}}if(l=l.sibling,l!==null){Ct=l;return}Ct=l=o}while(l!==null);Nt===0&&(Nt=5)}function os(o,l,f){var g=et,x=zn.transition;try{zn.transition=null,et=1,bw(o,l,f,g)}finally{zn.transition=x,et=g}return null}function bw(o,l,f,g){do Ys();while(Tr!==null);if((qe&6)!==0)throw Error(t(327));f=o.finishedWork;var x=o.finishedLanes;if(f===null)return null;if(o.finishedWork=null,o.finishedLanes=0,f===o.current)throw Error(t(177));o.callbackNode=null,o.callbackPriority=0;var T=f.lanes|f.childLanes;if(o1(o,T),o===jt&&(Ct=jt=null,Kt=0),(f.subtreeFlags&2064)===0&&(f.flags&2064)===0||zl||(zl=!0,N0(ar,function(){return Ys(),null})),T=(f.flags&15990)!==0,(f.subtreeFlags&15990)!==0||T){T=zn.transition,zn.transition=null;var I=et;et=1;var N=qe;qe|=4,Ud.current=null,Sw(o,f),S0(f,o),W1(Yc),al=!!Wc,Yc=Wc=null,o.current=f,Tw(f),yn(),qe=N,et=I,zn.transition=T}else o.current=f;if(zl&&(zl=!1,Tr=o,Kl=x),T=o.pendingLanes,T===0&&(Sr=null),Ye(f.stateNode),Tn(o,Je()),l!==null)for(g=o.onRecoverableError,f=0;f<l.length;f++)x=l[f],g(x.value,{componentStack:x.stack,digest:x.digest});if(Hl)throw Hl=!1,o=Vd,Vd=null,o;return(Kl&1)!==0&&o.tag!==0&&Ys(),T=o.pendingLanes,(T&1)!==0?o===Gd?so++:(so=0,Gd=o):so=0,yr(),null}function Ys(){if(Tr!==null){var o=xp(Kl),l=zn.transition,f=et;try{if(zn.transition=null,et=16>o?16:o,Tr===null)var g=!1;else{if(o=Tr,Tr=null,Kl=0,(qe&6)!==0)throw Error(t(331));var x=qe;for(qe|=4,Se=o.current;Se!==null;){var T=Se,I=T.child;if((Se.flags&16)!==0){var N=T.deletions;if(N!==null){for(var $=0;$<N.length;$++){var Z=N[$];for(Se=Z;Se!==null;){var ue=Se;switch(ue.tag){case 0:case 11:case 15:no(8,ue,T)}var de=ue.child;if(de!==null)de.return=ue,Se=de;else for(;Se!==null;){ue=Se;var oe=ue.sibling,ve=ue.return;if(g0(ue),ue===Z){Se=null;break}if(oe!==null){oe.return=ve,Se=oe;break}Se=ve}}}var Ae=T.alternate;if(Ae!==null){var Re=Ae.child;if(Re!==null){Ae.child=null;do{var Lt=Re.sibling;Re.sibling=null,Re=Lt}while(Re!==null)}}Se=T}}if((T.subtreeFlags&2064)!==0&&I!==null)I.return=T,Se=I;else e:for(;Se!==null;){if(T=Se,(T.flags&2048)!==0)switch(T.tag){case 0:case 11:case 15:no(9,T,T.return)}var q=T.sibling;if(q!==null){q.return=T.return,Se=q;break e}Se=T.return}}var V=o.current;for(Se=V;Se!==null;){I=Se;var X=I.child;if((I.subtreeFlags&2064)!==0&&X!==null)X.return=I,Se=X;else e:for(I=V;Se!==null;){if(N=Se,(N.flags&2048)!==0)try{switch(N.tag){case 0:case 11:case 15:jl(9,N)}}catch(De){Et(N,N.return,De)}if(N===I){Se=null;break e}var me=N.sibling;if(me!==null){me.return=N.return,Se=me;break e}Se=N.return}}if(qe=x,yr(),un&&typeof un.onPostCommitFiberRoot=="function")try{un.onPostCommitFiberRoot($i,o)}catch{}g=!0}return g}finally{et=f,zn.transition=l}}return!1}function P0(o,l,f){l=Hs(f,l),l=Xg(o,l,1),o=xr(o,l,1),l=dn(),o!==null&&(Ca(o,1,l),Tn(o,l))}function Et(o,l,f){if(o.tag===3)P0(o,o,f);else for(;l!==null;){if(l.tag===3){P0(l,o,f);break}else if(l.tag===1){var g=l.stateNode;if(typeof l.type.getDerivedStateFromError=="function"||typeof g.componentDidCatch=="function"&&(Sr===null||!Sr.has(g))){o=Hs(f,o),o=Qg(l,o,1),l=xr(l,o,1),o=dn(),l!==null&&(Ca(l,1,o),Tn(l,o));break}}l=l.return}}function Iw(o,l,f){var g=o.pingCache;g!==null&&g.delete(l),l=dn(),o.pingedLanes|=o.suspendedLanes&f,jt===o&&(Kt&f)===f&&(Nt===4||Nt===3&&(Kt&130023424)===Kt&&500>Je()-jd?as(o,0):$d|=f),Tn(o,l)}function _0(o,l){l===0&&((o.mode&1)===0?l=1:(l=qr,qr<<=1,(qr&130023424)===0&&(qr=4194304)));var f=dn();o=Wi(o,l),o!==null&&(Ca(o,l,f),Tn(o,f))}function Cw(o){var l=o.memoizedState,f=0;l!==null&&(f=l.retryLane),_0(o,f)}function Dw(o,l){var f=0;switch(o.tag){case 13:var g=o.stateNode,x=o.memoizedState;x!==null&&(f=x.retryLane);break;case 19:g=o.stateNode;break;default:throw Error(t(314))}g!==null&&g.delete(l),_0(o,f)}var M0;M0=function(o,l,f){if(o!==null)if(o.memoizedProps!==l.pendingProps||vn.current)En=!0;else{if((o.lanes&f)===0&&(l.flags&128)===0)return En=!1,yw(o,l,f);En=(o.flags&131072)!==0}else En=!1,ft&&(l.flags&1048576)!==0&&fg(l,wl,l.index);switch(l.lanes=0,l.tag){case 2:var g=l.type;Ul(o,l),o=l.pendingProps;var x=Os(l,Zt.current);Vs(l,f),x=vd(null,l,g,o,x,f);var T=xd();return l.flags|=1,typeof x=="object"&&x!==null&&typeof x.render=="function"&&x.$$typeof===void 0?(l.tag=1,l.memoizedState=null,l.updateQueue=null,xn(g)?(T=!0,Sl(l)):T=!1,l.memoizedState=x.state!==null&&x.state!==void 0?x.state:null,dd(l),x.updater=Fl,l.stateNode=x,x._reactInternals=l,Ld(l,g,o,f),l=Cd(null,l,g,!0,T,f)):(l.tag=0,ft&&T&&td(l),cn(null,l,x,f),l=l.child),l;case 16:g=l.elementType;e:{switch(Ul(o,l),o=l.pendingProps,x=g._init,g=x(g._payload),l.type=g,x=l.tag=Pw(g),o=si(g,o),x){case 0:l=Id(null,l,g,o,f);break e;case 1:l=a0(null,l,g,o,f);break e;case 11:l=t0(null,l,g,o,f);break e;case 14:l=n0(null,l,g,si(g.type,o),f);break e}throw Error(t(306,g,""))}return l;case 0:return g=l.type,x=l.pendingProps,x=l.elementType===g?x:si(g,x),Id(o,l,g,x,f);case 1:return g=l.type,x=l.pendingProps,x=l.elementType===g?x:si(g,x),a0(o,l,g,x,f);case 3:e:{if(o0(l),o===null)throw Error(t(387));g=l.pendingProps,T=l.memoizedState,x=T.element,Tg(o,l),Dl(l,g,null,f);var I=l.memoizedState;if(g=I.element,T.isDehydrated)if(T={element:g,isDehydrated:!1,cache:I.cache,pendingSuspenseBoundaries:I.pendingSuspenseBoundaries,transitions:I.transitions},l.updateQueue.baseState=T,l.memoizedState=T,l.flags&256){x=Hs(Error(t(423)),l),l=l0(o,l,g,f,x);break e}else if(g!==x){x=Hs(Error(t(424)),l),l=l0(o,l,g,f,x);break e}else for(kn=mr(l.stateNode.containerInfo.firstChild),Dn=l,ft=!0,ri=null,f=Eg(l,null,g,f),l.child=f;f;)f.flags=f.flags&-3|4096,f=f.sibling;else{if(Us(),g===x){l=qi(o,l,f);break e}cn(o,l,g,f)}l=l.child}return l;case 5:return Lg(l),o===null&&rd(l),g=l.type,x=l.pendingProps,T=o!==null?o.memoizedProps:null,I=x.children,qc(g,x)?I=null:T!==null&&qc(g,T)&&(l.flags|=32),s0(o,l),cn(o,l,I,f),l.child;case 6:return o===null&&rd(l),null;case 13:return u0(o,l,f);case 4:return hd(l,l.stateNode.containerInfo),g=l.pendingProps,o===null?l.child=$s(l,null,g,f):cn(o,l,g,f),l.child;case 11:return g=l.type,x=l.pendingProps,x=l.elementType===g?x:si(g,x),t0(o,l,g,x,f);case 7:return cn(o,l,l.pendingProps,f),l.child;case 8:return cn(o,l,l.pendingProps.children,f),l.child;case 12:return cn(o,l,l.pendingProps.children,f),l.child;case 10:e:{if(g=l.type._context,x=l.pendingProps,T=l.memoizedProps,I=x.value,lt(bl,g._currentValue),g._currentValue=I,T!==null)if(ii(T.value,I)){if(T.children===x.children&&!vn.current){l=qi(o,l,f);break e}}else for(T=l.child,T!==null&&(T.return=l);T!==null;){var N=T.dependencies;if(N!==null){I=T.child;for(var $=N.firstContext;$!==null;){if($.context===g){if(T.tag===1){$=Yi(-1,f&-f),$.tag=2;var Z=T.updateQueue;if(Z!==null){Z=Z.shared;var ue=Z.pending;ue===null?$.next=$:($.next=ue.next,ue.next=$),Z.pending=$}}T.lanes|=f,$=T.alternate,$!==null&&($.lanes|=f),ud(T.return,f,l),N.lanes|=f;break}$=$.next}}else if(T.tag===10)I=T.type===l.type?null:T.child;else if(T.tag===18){if(I=T.return,I===null)throw Error(t(341));I.lanes|=f,N=I.alternate,N!==null&&(N.lanes|=f),ud(I,f,l),I=T.sibling}else I=T.child;if(I!==null)I.return=T;else for(I=T;I!==null;){if(I===l){I=null;break}if(T=I.sibling,T!==null){T.return=I.return,I=T;break}I=I.return}T=I}cn(o,l,x.children,f),l=l.child}return l;case 9:return x=l.type,g=l.pendingProps.children,Vs(l,f),x=Gn(x),g=g(x),l.flags|=1,cn(o,l,g,f),l.child;case 14:return g=l.type,x=si(g,l.pendingProps),x=si(g.type,x),n0(o,l,g,x,f);case 15:return i0(o,l,l.type,l.pendingProps,f);case 17:return g=l.type,x=l.pendingProps,x=l.elementType===g?x:si(g,x),Ul(o,l),l.tag=1,xn(g)?(o=!0,Sl(l)):o=!1,Vs(l,f),Yg(l,g,x),Ld(l,g,x,f),Cd(null,l,g,!0,o,f);case 19:return d0(o,l,f);case 22:return r0(o,l,f)}throw Error(t(156,l.tag))};function N0(o,l){return wt(o,l)}function kw(o,l,f,g){this.tag=o,this.key=f,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=l,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=g,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Kn(o,l,f,g){return new kw(o,l,f,g)}function qd(o){return o=o.prototype,!(!o||!o.isReactComponent)}function Pw(o){if(typeof o=="function")return qd(o)?1:0;if(o!=null){if(o=o.$$typeof,o===z)return 11;if(o===ce)return 14}return 2}function Lr(o,l){var f=o.alternate;return f===null?(f=Kn(o.tag,l,o.key,o.mode),f.elementType=o.elementType,f.type=o.type,f.stateNode=o.stateNode,f.alternate=o,o.alternate=f):(f.pendingProps=l,f.type=o.type,f.flags=0,f.subtreeFlags=0,f.deletions=null),f.flags=o.flags&14680064,f.childLanes=o.childLanes,f.lanes=o.lanes,f.child=o.child,f.memoizedProps=o.memoizedProps,f.memoizedState=o.memoizedState,f.updateQueue=o.updateQueue,l=o.dependencies,f.dependencies=l===null?null:{lanes:l.lanes,firstContext:l.firstContext},f.sibling=o.sibling,f.index=o.index,f.ref=o.ref,f}function Xl(o,l,f,g,x,T){var I=2;if(g=o,typeof o=="function")qd(o)&&(I=1);else if(typeof o=="string")I=5;else e:switch(o){case C:return ls(f.children,x,T,l);case _:I=8,x|=8;break;case F:return o=Kn(12,f,l,x|2),o.elementType=F,o.lanes=T,o;case re:return o=Kn(13,f,l,x),o.elementType=re,o.lanes=T,o;case ae:return o=Kn(19,f,l,x),o.elementType=ae,o.lanes=T,o;case ie:return Ql(f,x,T,l);default:if(typeof o=="object"&&o!==null)switch(o.$$typeof){case O:I=10;break e;case W:I=9;break e;case z:I=11;break e;case ce:I=14;break e;case ne:I=16,g=null;break e}throw Error(t(130,o==null?o:typeof o,""))}return l=Kn(I,f,l,x),l.elementType=o,l.type=g,l.lanes=T,l}function ls(o,l,f,g){return o=Kn(7,o,g,l),o.lanes=f,o}function Ql(o,l,f,g){return o=Kn(22,o,g,l),o.elementType=ie,o.lanes=f,o.stateNode={isHidden:!1},o}function Xd(o,l,f){return o=Kn(6,o,null,l),o.lanes=f,o}function Qd(o,l,f){return l=Kn(4,o.children!==null?o.children:[],o.key,l),l.lanes=f,l.stateNode={containerInfo:o.containerInfo,pendingChildren:null,implementation:o.implementation},l}function _w(o,l,f,g,x){this.tag=l,this.containerInfo=o,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=wc(0),this.expirationTimes=wc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=wc(0),this.identifierPrefix=g,this.onRecoverableError=x,this.mutableSourceEagerHydrationData=null}function Zd(o,l,f,g,x,T,I,N,$){return o=new _w(o,l,f,N,$),l===1?(l=1,T===!0&&(l|=8)):l=0,T=Kn(3,null,null,l),o.current=T,T.stateNode=o,T.memoizedState={element:g,isDehydrated:f,cache:null,transitions:null,pendingSuspenseBoundaries:null},dd(T),o}function Mw(o,l,f){var g=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:U,key:g==null?null:""+g,children:o,containerInfo:l,implementation:f}}function O0(o){if(!o)return gr;o=o._reactInternals;e:{if(Le(o)!==o||o.tag!==1)throw Error(t(170));var l=o;do{switch(l.tag){case 3:l=l.stateNode.context;break e;case 1:if(xn(l.type)){l=l.stateNode.__reactInternalMemoizedMergedChildContext;break e}}l=l.return}while(l!==null);throw Error(t(171))}if(o.tag===1){var f=o.type;if(xn(f))return cg(o,f,l)}return l}function F0(o,l,f,g,x,T,I,N,$){return o=Zd(f,g,!0,o,x,T,I,N,$),o.context=O0(null),f=o.current,g=dn(),x=Ar(f),T=Yi(g,x),T.callback=l??null,xr(f,T,x),o.current.lanes=x,Ca(o,x,g),Tn(o,g),o}function Zl(o,l,f,g){var x=l.current,T=dn(),I=Ar(x);return f=O0(f),l.context===null?l.context=f:l.pendingContext=f,l=Yi(T,I),l.payload={element:o},g=g===void 0?null:g,g!==null&&(l.callback=g),o=xr(x,l,I),o!==null&&(li(o,x,I,T),Cl(o,x,I)),I}function Jl(o){if(o=o.current,!o.child)return null;switch(o.child.tag){case 5:return o.child.stateNode;default:return o.child.stateNode}}function B0(o,l){if(o=o.memoizedState,o!==null&&o.dehydrated!==null){var f=o.retryLane;o.retryLane=f!==0&&f<l?f:l}}function Jd(o,l){B0(o,l),(o=o.alternate)&&B0(o,l)}function Nw(){return null}var U0=typeof reportError=="function"?reportError:function(o){console.error(o)};function eh(o){this._internalRoot=o}eu.prototype.render=eh.prototype.render=function(o){var l=this._internalRoot;if(l===null)throw Error(t(409));Zl(o,l,null,null)},eu.prototype.unmount=eh.prototype.unmount=function(){var o=this._internalRoot;if(o!==null){this._internalRoot=null;var l=o.containerInfo;ss(function(){Zl(null,o,null,null)}),l[Gi]=null}};function eu(o){this._internalRoot=o}eu.prototype.unstable_scheduleHydration=function(o){if(o){var l=Tp();o={blockedOn:null,target:o,priority:l};for(var f=0;f<dr.length&&l!==0&&l<dr[f].priority;f++);dr.splice(f,0,o),f===0&&Lp(o)}};function th(o){return!(!o||o.nodeType!==1&&o.nodeType!==9&&o.nodeType!==11)}function tu(o){return!(!o||o.nodeType!==1&&o.nodeType!==9&&o.nodeType!==11&&(o.nodeType!==8||o.nodeValue!==" react-mount-point-unstable "))}function $0(){}function Ow(o,l,f,g,x){if(x){if(typeof g=="function"){var T=g;g=function(){var Z=Jl(I);T.call(Z)}}var I=F0(l,g,o,0,null,!1,!1,"",$0);return o._reactRootContainer=I,o[Gi]=I.current,Ga(o.nodeType===8?o.parentNode:o),ss(),I}for(;x=o.lastChild;)o.removeChild(x);if(typeof g=="function"){var N=g;g=function(){var Z=Jl($);N.call(Z)}}var $=Zd(o,0,!1,null,null,!1,!1,"",$0);return o._reactRootContainer=$,o[Gi]=$.current,Ga(o.nodeType===8?o.parentNode:o),ss(function(){Zl(l,$,f,g)}),$}function nu(o,l,f,g,x){var T=f._reactRootContainer;if(T){var I=T;if(typeof x=="function"){var N=x;x=function(){var $=Jl(I);N.call($)}}Zl(l,I,o,x)}else I=Ow(f,l,o,x,g);return Jl(I)}Ep=function(o){switch(o.tag){case 3:var l=o.stateNode;if(l.current.memoizedState.isDehydrated){var f=Xr(l.pendingLanes);f!==0&&(Lc(l,f|1),Tn(l,Je()),(qe&6)===0&&(Ws=Je()+500,yr()))}break;case 13:ss(function(){var g=Wi(o,1);if(g!==null){var x=dn();li(g,o,1,x)}}),Jd(o,1)}},Rc=function(o){if(o.tag===13){var l=Wi(o,134217728);if(l!==null){var f=dn();li(l,o,134217728,f)}Jd(o,134217728)}},Sp=function(o){if(o.tag===13){var l=Ar(o),f=Wi(o,l);if(f!==null){var g=dn();li(f,o,l,g)}Jd(o,l)}},Tp=function(){return et},Ap=function(o,l){var f=et;try{return et=o,l()}finally{et=f}},rr=function(o,l,f){switch(l){case"input":if(xt(o,f),l=f.name,f.type==="radio"&&l!=null){for(f=o;f.parentNode;)f=f.parentNode;for(f=f.querySelectorAll("input[name="+JSON.stringify(""+l)+'][type="radio"]'),l=0;l<f.length;l++){var g=f[l];if(g!==o&&g.form===o.form){var x=xl(g);if(!x)throw Error(t(90));At(g),xt(g,x)}}}break;case"textarea":on(o,f);break;case"select":l=f.value,l!=null&&an(o,!!f.multiple,l,!1)}},Ra=Kd,zr=ss;var Fw={usingClientEntryPoint:!1,Events:[Ka,Ms,xl,La,nl,Kd]},ao={findFiberByHostInstance:Qr,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Bw={bundleType:ao.bundleType,version:ao.version,rendererPackageName:ao.rendererPackageName,rendererConfig:ao.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:D.ReactCurrentDispatcher,findHostInstanceByFiber:function(o){return o=We(o),o===null?null:o.stateNode},findFiberByHostInstance:ao.findFiberByHostInstance||Nw,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var iu=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!iu.isDisabled&&iu.supportsFiber)try{$i=iu.inject(Bw),un=iu}catch{}}return An.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Fw,An.createPortal=function(o,l){var f=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!th(l))throw Error(t(200));return Mw(o,l,null,f)},An.createRoot=function(o,l){if(!th(o))throw Error(t(299));var f=!1,g="",x=U0;return l!=null&&(l.unstable_strictMode===!0&&(f=!0),l.identifierPrefix!==void 0&&(g=l.identifierPrefix),l.onRecoverableError!==void 0&&(x=l.onRecoverableError)),l=Zd(o,1,!1,null,null,f,!1,g,x),o[Gi]=l.current,Ga(o.nodeType===8?o.parentNode:o),new eh(l)},An.findDOMNode=function(o){if(o==null)return null;if(o.nodeType===1)return o;var l=o._reactInternals;if(l===void 0)throw typeof o.render=="function"?Error(t(188)):(o=Object.keys(o).join(","),Error(t(268,o)));return o=We(l),o=o===null?null:o.stateNode,o},An.flushSync=function(o){return ss(o)},An.hydrate=function(o,l,f){if(!tu(l))throw Error(t(200));return nu(null,o,l,!0,f)},An.hydrateRoot=function(o,l,f){if(!th(o))throw Error(t(405));var g=f!=null&&f.hydratedSources||null,x=!1,T="",I=U0;if(f!=null&&(f.unstable_strictMode===!0&&(x=!0),f.identifierPrefix!==void 0&&(T=f.identifierPrefix),f.onRecoverableError!==void 0&&(I=f.onRecoverableError)),l=F0(l,null,o,1,f??null,x,!1,T,I),o[Gi]=l.current,Ga(o),g)for(o=0;o<g.length;o++)f=g[o],x=f._getVersion,x=x(f._source),l.mutableSourceEagerHydrationData==null?l.mutableSourceEagerHydrationData=[f,x]:l.mutableSourceEagerHydrationData.push(f,x);return new eu(l)},An.render=function(o,l,f){if(!tu(l))throw Error(t(200));return nu(null,o,l,!1,f)},An.unmountComponentAtNode=function(o){if(!tu(o))throw Error(t(40));return o._reactRootContainer?(ss(function(){nu(null,null,o,!1,function(){o._reactRootContainer=null,o[Gi]=null})}),!0):!1},An.unstable_batchedUpdates=Kd,An.unstable_renderSubtreeIntoContainer=function(o,l,f,g){if(!tu(f))throw Error(t(200));if(o==null||o._reactInternals===void 0)throw Error(t(38));return nu(o,l,f,!1,g)},An.version="18.3.1-next-f1338f8080-20240426",An}var Y0;function Yw(){if(Y0)return rh.exports;Y0=1;function i(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i)}catch(e){console.error(e)}}return i(),rh.exports=Ww(),rh.exports}var q0;function qw(){if(q0)return ru;q0=1;var i=Yw();return ru.createRoot=i.createRoot,ru.hydrateRoot=i.hydrateRoot,ru}var Xw=qw(),M=tm();const Qw=jw(M),Zw=$w({__proto__:null,default:Qw},[M]);/**
 * react-router v7.13.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var rE=i=>{throw TypeError(i)},Jw=(i,e,t)=>e.has(i)||rE("Cannot "+t),oh=(i,e,t)=>(Jw(i,e,"read from private field"),t?t.call(i):e.get(i)),eL=(i,e,t)=>e.has(i)?rE("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(i):e.set(i,t),X0="popstate";function tL(i={}){function e(n,r){let{pathname:s,search:a,hash:u}=n.location;return bo("",{pathname:s,search:a,hash:u},r.state&&r.state.usr||null,r.state&&r.state.key||"default")}function t(n,r){return typeof r=="string"?r:Ni(r)}return iL(e,t,null,i)}function Ke(i,e){if(i===!1||i===null||typeof i>"u")throw new Error(e)}function bt(i,e){if(!i){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function nL(){return Math.random().toString(36).substring(2,10)}function Q0(i,e){return{usr:i.state,key:i.key,idx:e}}function bo(i,e,t=null,n){return{pathname:typeof i=="string"?i:i.pathname,search:"",hash:"",...typeof e=="string"?jr(e):e,state:t,key:e&&e.key||n||nL()}}function Ni({pathname:i="/",search:e="",hash:t=""}){return e&&e!=="?"&&(i+=e.charAt(0)==="?"?e:"?"+e),t&&t!=="#"&&(i+=t.charAt(0)==="#"?t:"#"+t),i}function jr(i){let e={};if(i){let t=i.indexOf("#");t>=0&&(e.hash=i.substring(t),i=i.substring(0,t));let n=i.indexOf("?");n>=0&&(e.search=i.substring(n),i=i.substring(0,n)),i&&(e.pathname=i)}return e}function iL(i,e,t,n={}){let{window:r=document.defaultView,v5Compat:s=!1}=n,a=r.history,u="POP",d=null,c=h();c==null&&(c=0,a.replaceState({...a.state,idx:c},""));function h(){return(a.state||{idx:null}).idx}function m(){u="POP";let S=h(),A=S==null?null:S-c;c=S,d&&d({action:u,location:E.location,delta:A})}function p(S,A){u="PUSH";let L=bo(E.location,S,A);c=h()+1;let R=Q0(L,c),D=E.createHref(L);try{a.pushState(R,"",D)}catch(k){if(k instanceof DOMException&&k.name==="DataCloneError")throw k;r.location.assign(D)}s&&d&&d({action:u,location:E.location,delta:1})}function y(S,A){u="REPLACE";let L=bo(E.location,S,A);c=h();let R=Q0(L,c),D=E.createHref(L);a.replaceState(R,"",D),s&&d&&d({action:u,location:E.location,delta:0})}function v(S){return sE(S)}let E={get action(){return u},get location(){return i(r,a)},listen(S){if(d)throw new Error("A history only accepts one active listener");return r.addEventListener(X0,m),d=S,()=>{r.removeEventListener(X0,m),d=null}},createHref(S){return e(r,S)},createURL:v,encodeLocation(S){let A=v(S);return{pathname:A.pathname,search:A.search,hash:A.hash}},push:p,replace:y,go(S){return a.go(S)}};return E}function sE(i,e=!1){let t="http://localhost";typeof window<"u"&&(t=window.location.origin!=="null"?window.location.origin:window.location.href),Ke(t,"No window.location.(origin|href) available to create URL");let n=typeof i=="string"?i:Ni(i);return n=n.replace(/ $/,"%20"),!e&&n.startsWith("//")&&(n=t+n),new URL(n,t)}var po,Z0=class{constructor(i){if(eL(this,po,new Map),i)for(let[e,t]of i)this.set(e,t)}get(i){if(oh(this,po).has(i))return oh(this,po).get(i);if(i.defaultValue!==void 0)return i.defaultValue;throw new Error("No value found for context")}set(i,e){oh(this,po).set(i,e)}};po=new WeakMap;var rL=new Set(["lazy","caseSensitive","path","id","index","children"]);function sL(i){return rL.has(i)}var aL=new Set(["lazy","caseSensitive","path","id","index","middleware","children"]);function oL(i){return aL.has(i)}function lL(i){return i.index===!0}function Io(i,e,t=[],n={},r=!1){return i.map((s,a)=>{let u=[...t,String(a)],d=typeof s.id=="string"?s.id:u.join("-");if(Ke(s.index!==!0||!s.children,"Cannot specify children on an index route"),Ke(r||!n[d],`Found a route id collision on id "${d}".  Route id's must be globally unique within Data Router usages`),lL(s)){let c={...s,id:d};return n[d]=J0(c,e(c)),c}else{let c={...s,id:d,children:void 0};return n[d]=J0(c,e(c)),s.children&&(c.children=Io(s.children,e,u,n,r)),c}})}function J0(i,e){return Object.assign(i,{...e,...typeof e.lazy=="object"&&e.lazy!=null?{lazy:{...i.lazy,...e.lazy}}:{}})}function _r(i,e,t="/"){return go(i,e,t,!1)}function go(i,e,t,n){let r=typeof e=="string"?jr(e):e,s=Xn(r.pathname||"/",t);if(s==null)return null;let a=aE(i);cL(a);let u=null;for(let d=0;u==null&&d<a.length;++d){let c=SL(s);u=xL(a[d],c,n)}return u}function uL(i,e){let{route:t,pathname:n,params:r}=i;return{id:t.id,pathname:n,params:r,data:e[t.id],loaderData:e[t.id],handle:t.handle}}function aE(i,e=[],t=[],n="",r=!1){let s=(a,u,d=r,c)=>{let h={relativePath:c===void 0?a.path||"":c,caseSensitive:a.caseSensitive===!0,childrenIndex:u,route:a};if(h.relativePath.startsWith("/")){if(!h.relativePath.startsWith(n)&&d)return;Ke(h.relativePath.startsWith(n),`Absolute route path "${h.relativePath}" nested under path "${n}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),h.relativePath=h.relativePath.slice(n.length)}let m=_i([n,h.relativePath]),p=t.concat(h);a.children&&a.children.length>0&&(Ke(a.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${m}".`),aE(a.children,e,p,m,d)),!(a.path==null&&!a.index)&&e.push({path:m,score:yL(m,a.index),routesMeta:p})};return i.forEach((a,u)=>{var d;if(a.path===""||!((d=a.path)!=null&&d.includes("?")))s(a,u);else for(let c of oE(a.path))s(a,u,!0,c)}),e}function oE(i){let e=i.split("/");if(e.length===0)return[];let[t,...n]=e,r=t.endsWith("?"),s=t.replace(/\?$/,"");if(n.length===0)return r?[s,""]:[s];let a=oE(n.join("/")),u=[];return u.push(...a.map(d=>d===""?s:[s,d].join("/"))),r&&u.push(...a),u.map(d=>i.startsWith("/")&&d===""?"/":d)}function cL(i){i.sort((e,t)=>e.score!==t.score?t.score-e.score:vL(e.routesMeta.map(n=>n.childrenIndex),t.routesMeta.map(n=>n.childrenIndex)))}var dL=/^:[\w-]+$/,hL=3,fL=2,mL=1,pL=10,gL=-2,ey=i=>i==="*";function yL(i,e){let t=i.split("/"),n=t.length;return t.some(ey)&&(n+=gL),e&&(n+=fL),t.filter(r=>!ey(r)).reduce((r,s)=>r+(dL.test(s)?hL:s===""?mL:pL),n)}function vL(i,e){return i.length===e.length&&i.slice(0,-1).every((n,r)=>n===e[r])?i[i.length-1]-e[e.length-1]:0}function xL(i,e,t=!1){let{routesMeta:n}=i,r={},s="/",a=[];for(let u=0;u<n.length;++u){let d=n[u],c=u===n.length-1,h=s==="/"?e:e.slice(s.length)||"/",m=Wu({path:d.relativePath,caseSensitive:d.caseSensitive,end:c},h),p=d.route;if(!m&&c&&t&&!n[n.length-1].route.index&&(m=Wu({path:d.relativePath,caseSensitive:d.caseSensitive,end:!1},h)),!m)return null;Object.assign(r,m.params),a.push({params:r,pathname:_i([s,m.pathname]),pathnameBase:wL(_i([s,m.pathnameBase])),route:p}),m.pathnameBase!=="/"&&(s=_i([s,m.pathnameBase]))}return a}function Wu(i,e){typeof i=="string"&&(i={path:i,caseSensitive:!1,end:!0});let[t,n]=EL(i.path,i.caseSensitive,i.end),r=e.match(t);if(!r)return null;let s=r[0],a=s.replace(/(.)\/+$/,"$1"),u=r.slice(1);return{params:n.reduce((c,{paramName:h,isOptional:m},p)=>{if(h==="*"){let v=u[p]||"";a=s.slice(0,s.length-v.length).replace(/(.)\/+$/,"$1")}const y=u[p];return m&&!y?c[h]=void 0:c[h]=(y||"").replace(/%2F/g,"/"),c},{}),pathname:s,pathnameBase:a,pattern:i}}function EL(i,e=!1,t=!0){bt(i==="*"||!i.endsWith("*")||i.endsWith("/*"),`Route path "${i}" will be treated as if it were "${i.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${i.replace(/\*$/,"/*")}".`);let n=[],r="^"+i.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(a,u,d)=>(n.push({paramName:u,isOptional:d!=null}),d?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return i.endsWith("*")?(n.push({paramName:"*"}),r+=i==="*"||i==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?r+="\\/*$":i!==""&&i!=="/"&&(r+="(?:(?=\\/|$))"),[new RegExp(r,e?void 0:"i"),n]}function SL(i){try{return i.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return bt(!1,`The URL path "${i}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),i}}function Xn(i,e){if(e==="/")return i;if(!i.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,n=i.charAt(t);return n&&n!=="/"?null:i.slice(t)||"/"}function TL({basename:i,pathname:e}){return e==="/"?i:_i([i,e])}var lE=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,nm=i=>lE.test(i);function AL(i,e="/"){let{pathname:t,search:n="",hash:r=""}=typeof i=="string"?jr(i):i,s;return t?(t=t.replace(/\/\/+/g,"/"),t.startsWith("/")?s=ty(t.substring(1),"/"):s=ty(t,e)):s=e,{pathname:s,search:LL(n),hash:RL(r)}}function ty(i,e){let t=e.replace(/\/+$/,"").split("/");return i.split("/").forEach(r=>{r===".."?t.length>1&&t.pop():r!=="."&&t.push(r)}),t.length>1?t.join("/"):"/"}function lh(i,e,t,n){return`Cannot include a '${i}' character in a manually specified \`to.${e}\` field [${JSON.stringify(n)}].  Please separate it out to the \`to.${t}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function uE(i){return i.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function im(i){let e=uE(i);return e.map((t,n)=>n===e.length-1?t.pathname:t.pathnameBase)}function rm(i,e,t,n=!1){let r;typeof i=="string"?r=jr(i):(r={...i},Ke(!r.pathname||!r.pathname.includes("?"),lh("?","pathname","search",r)),Ke(!r.pathname||!r.pathname.includes("#"),lh("#","pathname","hash",r)),Ke(!r.search||!r.search.includes("#"),lh("#","search","hash",r)));let s=i===""||r.pathname==="",a=s?"/":r.pathname,u;if(a==null)u=t;else{let m=e.length-1;if(!n&&a.startsWith("..")){let p=a.split("/");for(;p[0]==="..";)p.shift(),m-=1;r.pathname=p.join("/")}u=m>=0?e[m]:"/"}let d=AL(r,u),c=a&&a!=="/"&&a.endsWith("/"),h=(s||a===".")&&t.endsWith("/");return!d.pathname.endsWith("/")&&(c||h)&&(d.pathname+="/"),d}var _i=i=>i.join("/").replace(/\/\/+/g,"/"),wL=i=>i.replace(/\/+$/,"").replace(/^\/*/,"/"),LL=i=>!i||i==="?"?"":i.startsWith("?")?i:"?"+i,RL=i=>!i||i==="#"?"":i.startsWith("#")?i:"#"+i,Ho=class{constructor(i,e,t,n=!1){this.status=i,this.statusText=e||"",this.internal=n,t instanceof Error?(this.data=t.toString(),this.error=t):this.data=t}};function Co(i){return i!=null&&typeof i.status=="number"&&typeof i.statusText=="string"&&typeof i.internal=="boolean"&&"data"in i}function zo(i){return i.map(e=>e.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var cE=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function dE(i,e){let t=i;if(typeof t!="string"||!lE.test(t))return{absoluteURL:void 0,isExternal:!1,to:t};let n=t,r=!1;if(cE)try{let s=new URL(window.location.href),a=t.startsWith("//")?new URL(s.protocol+t):new URL(t),u=Xn(a.pathname,e);a.origin===s.origin&&u!=null?t=u+a.search+a.hash:r=!0}catch{bt(!1,`<Link to="${t}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}return{absoluteURL:n,isExternal:r,to:t}}var Nr=Symbol("Uninstrumented");function bL(i,e){let t={lazy:[],"lazy.loader":[],"lazy.action":[],"lazy.middleware":[],middleware:[],loader:[],action:[]};i.forEach(r=>r({id:e.id,index:e.index,path:e.path,instrument(s){let a=Object.keys(t);for(let u of a)s[u]&&t[u].push(s[u])}}));let n={};if(typeof e.lazy=="function"&&t.lazy.length>0){let r=ia(t.lazy,e.lazy,()=>{});r&&(n.lazy=r)}if(typeof e.lazy=="object"){let r=e.lazy;["middleware","loader","action"].forEach(s=>{let a=r[s],u=t[`lazy.${s}`];if(typeof a=="function"&&u.length>0){let d=ia(u,a,()=>{});d&&(n.lazy=Object.assign(n.lazy||{},{[s]:d}))}})}return["loader","action"].forEach(r=>{let s=e[r];if(typeof s=="function"&&t[r].length>0){let a=s[Nr]??s,u=ia(t[r],a,(...d)=>ny(d[0]));u&&(r==="loader"&&a.hydrate===!0&&(u.hydrate=!0),u[Nr]=a,n[r]=u)}}),e.middleware&&e.middleware.length>0&&t.middleware.length>0&&(n.middleware=e.middleware.map(r=>{let s=r[Nr]??r,a=ia(t.middleware,s,(...u)=>ny(u[0]));return a?(a[Nr]=s,a):r})),n}function IL(i,e){let t={navigate:[],fetch:[]};if(e.forEach(n=>n({instrument(r){let s=Object.keys(r);for(let a of s)r[a]&&t[a].push(r[a])}})),t.navigate.length>0){let n=i.navigate[Nr]??i.navigate,r=ia(t.navigate,n,(...s)=>{let[a,u]=s;return{to:typeof a=="number"||typeof a=="string"?a:a?Ni(a):".",...iy(i,u??{})}});r&&(r[Nr]=n,i.navigate=r)}if(t.fetch.length>0){let n=i.fetch[Nr]??i.fetch,r=ia(t.fetch,n,(...s)=>{let[a,,u,d]=s;return{href:u??".",fetcherKey:a,...iy(i,d??{})}});r&&(r[Nr]=n,i.fetch=r)}return i}function ia(i,e,t){return i.length===0?null:async(...n)=>{let r=await hE(i,t(...n),()=>e(...n),i.length-1);if(r.type==="error")throw r.value;return r.value}}async function hE(i,e,t,n){let r=i[n],s;if(r){let a,u=async()=>(a?console.error("You cannot call instrumented handlers more than once"):a=hE(i,e,t,n-1),s=await a,Ke(s,"Expected a result"),s.type==="error"&&s.value instanceof Error?{status:"error",error:s.value}:{status:"success",error:void 0});try{await r(u,e)}catch(d){console.error("An instrumentation function threw an error:",d)}a||await u(),await a}else try{s={type:"success",value:await t()}}catch(a){s={type:"error",value:a}}return s||{type:"error",value:new Error("No result assigned in instrumentation chain.")}}function ny(i){let{request:e,context:t,params:n,unstable_pattern:r}=i;return{request:CL(e),params:{...n},unstable_pattern:r,context:DL(t)}}function iy(i,e){return{currentUrl:Ni(i.state.location),..."formMethod"in e?{formMethod:e.formMethod}:{},..."formEncType"in e?{formEncType:e.formEncType}:{},..."formData"in e?{formData:e.formData}:{},..."body"in e?{body:e.body}:{}}}function CL(i){return{method:i.method,url:i.url,headers:{get:(...e)=>i.headers.get(...e)}}}function DL(i){if(PL(i)){let e={...i};return Object.freeze(e),e}else return{get:e=>i.get(e)}}var kL=Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function PL(i){if(i===null||typeof i!="object")return!1;const e=Object.getPrototypeOf(i);return e===Object.prototype||e===null||Object.getOwnPropertyNames(e).sort().join("\0")===kL}var fE=["POST","PUT","PATCH","DELETE"],_L=new Set(fE),ML=["GET",...fE],NL=new Set(ML),mE=new Set([301,302,303,307,308]),OL=new Set([307,308]),uh={state:"idle",location:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},FL={state:"idle",data:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},lo={state:"unblocked",proceed:void 0,reset:void 0,location:void 0},BL=i=>({hasErrorBoundary:!!i.hasErrorBoundary}),pE="remix-router-transitions",gE=Symbol("ResetLoaderData");function UL(i){const e=i.window?i.window:typeof window<"u"?window:void 0,t=typeof e<"u"&&typeof e.document<"u"&&typeof e.document.createElement<"u";Ke(i.routes.length>0,"You must provide a non-empty routes array to createRouter");let n=i.hydrationRouteProperties||[],r=i.mapRouteProperties||BL,s=r;if(i.unstable_instrumentations){let B=i.unstable_instrumentations;s=H=>({...r(H),...bL(B.map(Q=>Q.route).filter(Boolean),H)})}let a={},u=Io(i.routes,s,void 0,a),d,c=i.basename||"/";c.startsWith("/")||(c=`/${c}`);let h=i.dataStrategy||HL,m={...i.future},p=null,y=new Set,v=null,E=null,S=null,A=i.hydrationData!=null,L=_r(u,i.history.location,c),R=!1,D=null,k;if(L==null&&!i.patchRoutesOnNavigation){let B=Wn(404,{pathname:i.history.location.pathname}),{matches:H,route:Q}=su(u);k=!0,L=H,D={[Q.id]:B}}else if(L&&!i.hydrationData&&zr(L,u,i.history.location.pathname).active&&(L=null),L)if(L.some(B=>B.route.lazy))k=!1;else if(!L.some(B=>sm(B.route)))k=!0;else{let B=i.hydrationData?i.hydrationData.loaderData:null,H=i.hydrationData?i.hydrationData.errors:null;if(H){let Q=L.findIndex(le=>H[le.route.id]!==void 0);k=L.slice(0,Q+1).every(le=>!sf(le.route,B,H))}else k=L.every(Q=>!sf(Q.route,B,H))}else{k=!1,L=[];let B=zr(null,u,i.history.location.pathname);B.active&&B.matches&&(R=!0,L=B.matches)}let U,C={historyAction:i.history.action,location:i.history.location,matches:L,initialized:k,navigation:uh,restoreScrollPosition:i.hydrationData!=null?!1:null,preventScrollReset:!1,revalidation:"idle",loaderData:i.hydrationData&&i.hydrationData.loaderData||{},actionData:i.hydrationData&&i.hydrationData.actionData||null,errors:i.hydrationData&&i.hydrationData.errors||D,fetchers:new Map,blockers:new Map},_="POP",F=null,O=!1,W,z=!1,re=new Map,ae=null,ce=!1,ne=!1,ie=new Set,G=new Map,ee=0,J=-1,P=new Map,j=new Set,he=new Map,ge=new Map,te=new Set,fe=new Map,Pe,be=null;function Ve(){if(p=i.history.listen(({action:B,location:H,delta:Q})=>{if(Pe){Pe(),Pe=void 0;return}bt(fe.size===0||Q!=null,"You are trying to use a blocker on a POP navigation to a location that was not created by @remix-run/router. This will fail silently in production. This can happen if you are navigating outside the router via `window.history.pushState`/`window.location.hash` instead of using router navigation APIs.  This can also happen if you are using createHashRouter and the user manually changes the URL.");let le=Ui({currentLocation:C.location,nextLocation:H,historyAction:B});if(le&&Q!=null){let pe=new Promise(Ce=>{Pe=Ce});i.history.go(Q*-1),rr(le,{state:"blocked",location:H,proceed(){rr(le,{state:"proceeding",proceed:void 0,reset:void 0,location:H}),pe.then(()=>i.history.go(Q))},reset(){let Ce=new Map(C.blockers);Ce.set(le,lo),At({blockers:Ce})}}),F==null||F.resolve(),F=null;return}return $e(B,H)}),t){lR(e,re);let B=()=>uR(e,re);e.addEventListener("pagehide",B),ae=()=>e.removeEventListener("pagehide",B)}return C.initialized||$e("POP",C.location,{initialHydration:!0}),U}function Ze(){p&&p(),ae&&ae(),y.clear(),W&&W.abort(),C.fetchers.forEach((B,H)=>Aa(H)),C.blockers.forEach((B,H)=>Rs(H))}function pn(B){return y.add(B),()=>y.delete(B)}function At(B,H={}){B.matches&&(B.matches=B.matches.map(pe=>{let Ce=a[pe.route.id],_e=pe.route;return _e.element!==Ce.element||_e.errorElement!==Ce.errorElement||_e.hydrateFallbackElement!==Ce.hydrateFallbackElement?{...pe,route:Ce}:pe})),C={...C,...B};let Q=[],le=[];C.fetchers.forEach((pe,Ce)=>{pe.state==="idle"&&(te.has(Ce)?Q.push(Ce):le.push(Ce))}),te.forEach(pe=>{!C.fetchers.has(pe)&&!G.has(pe)&&Q.push(pe)}),[...y].forEach(pe=>pe(C,{deletedFetchers:Q,newErrors:B.errors??null,viewTransitionOpts:H.viewTransitionOpts,flushSync:H.flushSync===!0})),Q.forEach(pe=>Aa(pe)),le.forEach(pe=>C.fetchers.delete(pe))}function sn(B,H,{flushSync:Q}={}){var Be,ke;let le=C.actionData!=null&&C.navigation.formMethod!=null&&nn(C.navigation.formMethod)&&C.navigation.state==="loading"&&((Be=B.state)==null?void 0:Be._isRedirect)!==!0,pe;H.actionData?Object.keys(H.actionData).length>0?pe=H.actionData:pe=null:le?pe=C.actionData:pe=null;let Ce=H.loaderData?fy(C.loaderData,H.loaderData,H.matches||[],H.errors):C.loaderData,_e=C.blockers;_e.size>0&&(_e=new Map(_e),_e.forEach((je,We)=>_e.set(We,lo)));let Ee=ce?!1:Ra(B,H.matches||C.matches),Te=O===!0||C.navigation.formMethod!=null&&nn(C.navigation.formMethod)&&((ke=B.state)==null?void 0:ke._isRedirect)!==!0;d&&(u=d,d=void 0),ce||_==="POP"||(_==="PUSH"?i.history.push(B,B.state):_==="REPLACE"&&i.history.replace(B,B.state));let Le;if(_==="POP"){let je=re.get(C.location.pathname);je&&je.has(B.pathname)?Le={currentLocation:C.location,nextLocation:B}:re.has(B.pathname)&&(Le={currentLocation:B,nextLocation:C.location})}else if(z){let je=re.get(C.location.pathname);je?je.add(B.pathname):(je=new Set([B.pathname]),re.set(C.location.pathname,je)),Le={currentLocation:C.location,nextLocation:B}}At({...H,actionData:pe,loaderData:Ce,historyAction:_,location:B,initialized:!0,navigation:uh,revalidation:"idle",restoreScrollPosition:Ee,preventScrollReset:Te,blockers:_e},{viewTransitionOpts:Le,flushSync:Q===!0}),_="POP",O=!1,z=!1,ce=!1,ne=!1,F==null||F.resolve(),F=null,be==null||be.resolve(),be=null}async function vi(B,H){if(F==null||F.resolve(),F=null,typeof B=="number"){F||(F=yy());let We=F.promise;return i.history.go(B),We}let Q=rf(C.location,C.matches,c,B,H==null?void 0:H.fromRouteId,H==null?void 0:H.relative),{path:le,submission:pe,error:Ce}=ry(!1,Q,H),_e=C.location,Ee=bo(C.location,le,H&&H.state);Ee={...Ee,...i.history.encodeLocation(Ee)};let Te=H&&H.replace!=null?H.replace:void 0,Le="PUSH";Te===!0?Le="REPLACE":Te===!1||pe!=null&&nn(pe.formMethod)&&pe.formAction===C.location.pathname+C.location.search&&(Le="REPLACE");let Be=H&&"preventScrollReset"in H?H.preventScrollReset===!0:void 0,ke=(H&&H.flushSync)===!0,je=Ui({currentLocation:_e,nextLocation:Ee,historyAction:Le});if(je){rr(je,{state:"blocked",location:Ee,proceed(){rr(je,{state:"proceeding",proceed:void 0,reset:void 0,location:Ee}),vi(B,H)},reset(){let We=new Map(C.blockers);We.set(je,lo),At({blockers:We})}});return}await $e(Le,Ee,{submission:pe,pendingError:Ce,preventScrollReset:Be,replace:H&&H.replace,enableViewTransition:H&&H.viewTransition,flushSync:ke,callSiteDefaultShouldRevalidate:H&&H.unstable_defaultShouldRevalidate})}function Ta(){be||(be=yy()),xi(),At({revalidation:"loading"});let B=be.promise;return C.navigation.state==="submitting"?B:C.navigation.state==="idle"?($e(C.historyAction,C.location,{startUninterruptedRevalidation:!0}),B):($e(_||C.historyAction,C.navigation.location,{overrideNavigation:C.navigation,enableViewTransition:z===!0}),B)}async function $e(B,H,Q){W&&W.abort(),W=null,_=B,ce=(Q&&Q.startUninterruptedRevalidation)===!0,nl(C.location,C.matches),O=(Q&&Q.preventScrollReset)===!0,z=(Q&&Q.enableViewTransition)===!0;let le=d||u,pe=Q&&Q.overrideNavigation,Ce=Q!=null&&Q.initialHydration&&C.matches&&C.matches.length>0&&!R?C.matches:_r(le,H,c),_e=(Q&&Q.flushSync)===!0;if(Ce&&C.initialized&&!ne&&ZL(C.location,H)&&!(Q&&Q.submission&&nn(Q.submission.formMethod))){sn(H,{matches:Ce},{flushSync:_e});return}let Ee=zr(Ce,le,H.pathname);if(Ee.active&&Ee.matches&&(Ce=Ee.matches),!Ce){let{error:wt,notFoundMatches:Ut,route:Qe}=Ei(H.pathname);sn(H,{matches:Ut,loaderData:{},errors:{[Qe.id]:wt}},{flushSync:_e});return}W=new AbortController;let Te=ea(i.history,H,W.signal,Q&&Q.submission),Le=i.getContext?await i.getContext():new Z0,Be;if(Q&&Q.pendingError)Be=[Mr(Ce).route.id,{type:"error",error:Q.pendingError}];else if(Q&&Q.submission&&nn(Q.submission.formMethod)){let wt=await xt(Te,H,Q.submission,Ce,Le,Ee.active,Q&&Q.initialHydration===!0,{replace:Q.replace,flushSync:_e});if(wt.shortCircuited)return;if(wt.pendingActionResult){let[Ut,Qe]=wt.pendingActionResult;if(On(Qe)&&Co(Qe.error)&&Qe.error.status===404){W=null,sn(H,{matches:wt.matches,loaderData:{},errors:{[Ut]:Qe.error}});return}}Ce=wt.matches||Ce,Be=wt.pendingActionResult,pe=ch(H,Q.submission),_e=!1,Ee.active=!1,Te=ea(i.history,Te.url,Te.signal)}let{shortCircuited:ke,matches:je,loaderData:We,errors:It}=await Ht(Te,H,Ce,Le,Ee.active,pe,Q&&Q.submission,Q&&Q.fetcherSubmission,Q&&Q.replace,Q&&Q.initialHydration===!0,_e,Be,Q&&Q.callSiteDefaultShouldRevalidate);ke||(W=null,sn(H,{matches:je||Ce,...my(Be),loaderData:We,errors:It}))}async function xt(B,H,Q,le,pe,Ce,_e,Ee={}){xi();let Te=aR(H,Q);if(At({navigation:Te},{flushSync:Ee.flushSync===!0}),Ce){let ke=await sr(le,H.pathname,B.signal);if(ke.type==="aborted")return{shortCircuited:!0};if(ke.type==="error"){if(ke.partialMatches.length===0){let{matches:We,route:It}=su(u);return{matches:We,pendingActionResult:[It.id,{type:"error",error:ke.error}]}}let je=Mr(ke.partialMatches).route.id;return{matches:ke.partialMatches,pendingActionResult:[je,{type:"error",error:ke.error}]}}else if(ke.matches)le=ke.matches;else{let{notFoundMatches:je,error:We,route:It}=Ei(H.pathname);return{matches:je,pendingActionResult:[It.id,{type:"error",error:We}]}}}let Le,Be=Cu(le,H);if(!Be.route.action&&!Be.route.lazy)Le={type:"error",error:Wn(405,{method:B.method,pathname:H.pathname,routeId:Be.route.id})};else{let ke=ca(s,a,B,le,Be,_e?[]:n,pe),je=await ei(B,ke,pe,null);if(Le=je[Be.route.id],!Le){for(let We of le)if(je[We.route.id]){Le=je[We.route.id];break}}if(B.signal.aborted)return{shortCircuited:!0}}if(ps(Le)){let ke;return Ee&&Ee.replace!=null?ke=Ee.replace:ke=cy(Le.response.headers.get("Location"),new URL(B.url),c,i.history)===C.location.pathname+C.location.search,await on(B,Le,!0,{submission:Q,replace:ke}),{shortCircuited:!0}}if(On(Le)){let ke=Mr(le,Be.route.id);return(Ee&&Ee.replace)!==!0&&(_="PUSH"),{matches:le,pendingActionResult:[ke.route.id,Le,Be.route.id]}}return{matches:le,pendingActionResult:[Be.route.id,Le]}}async function Ht(B,H,Q,le,pe,Ce,_e,Ee,Te,Le,Be,ke,je){let We=Ce||ch(H,_e),It=_e||Ee||gy(We),wt=!ce&&!Le;if(pe){if(wt){let it=gn(ke);At({navigation:We,...it!==void 0?{actionData:it}:{}},{flushSync:Be})}let Ye=await sr(Q,H.pathname,B.signal);if(Ye.type==="aborted")return{shortCircuited:!0};if(Ye.type==="error"){if(Ye.partialMatches.length===0){let{matches:or,route:ji}=su(u);return{matches:or,loaderData:{},errors:{[ji.id]:Ye.error}}}let it=Mr(Ye.partialMatches).route.id;return{matches:Ye.partialMatches,loaderData:{},errors:{[it]:Ye.error}}}else if(Ye.matches)Q=Ye.matches;else{let{error:it,notFoundMatches:or,route:ji}=Ei(H.pathname);return{matches:or,loaderData:{},errors:{[ji.id]:it}}}}let Ut=d||u,{dsMatches:Qe,revalidatingFetchers:yn}=sy(B,le,s,a,i.history,C,Q,It,H,Le?[]:n,Le===!0,ne,ie,te,he,j,Ut,c,i.patchRoutesOnNavigation!=null,ke,je);if(J=++ee,!i.dataStrategy&&!Qe.some(Ye=>Ye.shouldLoad)&&!Qe.some(Ye=>Ye.route.middleware&&Ye.route.middleware.length>0)&&yn.length===0){let Ye=ws();return sn(H,{matches:Q,loaderData:{},errors:ke&&On(ke[1])?{[ke[0]]:ke[1].error}:null,...my(ke),...Ye?{fetchers:new Map(C.fetchers)}:{}},{flushSync:Be}),{shortCircuited:!0}}if(wt){let Ye={};if(!pe){Ye.navigation=We;let it=gn(ke);it!==void 0&&(Ye.actionData=it)}yn.length>0&&(Ye.fetchers=_t(yn)),At(Ye,{flushSync:Be})}yn.forEach(Ye=>{Un(Ye.key),Ye.controller&&G.set(Ye.key,Ye.controller)});let Je=()=>yn.forEach(Ye=>Un(Ye.key));W&&W.signal.addEventListener("abort",Je);let{loaderResults:Wr,fetcherResults:$n}=await ti(Qe,yn,B,le);if(B.signal.aborted)return{shortCircuited:!0};W&&W.signal.removeEventListener("abort",Je),yn.forEach(Ye=>G.delete(Ye.key));let In=au(Wr);if(In)return await on(B,In.result,!0,{replace:Te}),{shortCircuited:!0};if(In=au($n),In)return j.add(In.key),await on(B,In.result,!0,{replace:Te}),{shortCircuited:!0};let{loaderData:ar,errors:Yr}=hy(C,Q,Wr,ke,yn,$n);Le&&C.errors&&(Yr={...C.errors,...Yr});let Si=ws(),$i=Ls(J),un=Si||$i||yn.length>0;return{matches:Q,loaderData:ar,errors:Yr,...un?{fetchers:new Map(C.fetchers)}:{}}}function gn(B){if(B&&!On(B[1]))return{[B[0]]:B[1].data};if(C.actionData)return Object.keys(C.actionData).length===0?null:C.actionData}function _t(B){return B.forEach(H=>{let Q=C.fetchers.get(H.key),le=uo(void 0,Q?Q.data:void 0);C.fetchers.set(H.key,le)}),new Map(C.fetchers)}async function an(B,H,Q,le){Un(B);let pe=(le&&le.flushSync)===!0,Ce=d||u,_e=rf(C.location,C.matches,c,Q,H,le==null?void 0:le.relative),Ee=_r(Ce,_e,c),Te=zr(Ee,Ce,_e);if(Te.active&&Te.matches&&(Ee=Te.matches),!Ee){ln(B,H,Wn(404,{pathname:_e}),{flushSync:pe});return}let{path:Le,submission:Be,error:ke}=ry(!0,_e,le);if(ke){ln(B,H,ke,{flushSync:pe});return}let je=i.getContext?await i.getContext():new Z0,We=(le&&le.preventScrollReset)===!0;if(Be&&nn(Be.formMethod)){await Rn(B,H,Le,Ee,je,Te.active,pe,We,Be,le&&le.unstable_defaultShouldRevalidate);return}he.set(B,{routeId:H,path:Le}),await Hr(B,H,Le,Ee,je,Te.active,pe,We,Be)}async function Rn(B,H,Q,le,pe,Ce,_e,Ee,Te,Le){xi(),he.delete(B);let Be=C.fetchers.get(B);Qt(B,oR(Te,Be),{flushSync:_e});let ke=new AbortController,je=ea(i.history,Q,ke.signal,Te);if(Ce){let ht=await sr(le,new URL(je.url).pathname,je.signal,B);if(ht.type==="aborted")return;if(ht.type==="error"){ln(B,H,ht.error,{flushSync:_e});return}else if(ht.matches)le=ht.matches;else{ln(B,H,Wn(404,{pathname:Q}),{flushSync:_e});return}}let We=Cu(le,Q);if(!We.route.action&&!We.route.lazy){let ht=Wn(405,{method:Te.formMethod,pathname:Q,routeId:H});ln(B,H,ht,{flushSync:_e});return}G.set(B,ke);let It=ee,wt=ca(s,a,je,le,We,n,pe),Ut=await ei(je,wt,pe,B),Qe=Ut[We.route.id];if(!Qe){for(let ht of wt)if(Ut[ht.route.id]){Qe=Ut[ht.route.id];break}}if(je.signal.aborted){G.get(B)===ke&&G.delete(B);return}if(te.has(B)){if(ps(Qe)||On(Qe)){Qt(B,Ji(void 0));return}}else{if(ps(Qe))if(G.delete(B),J>It){Qt(B,Ji(void 0));return}else return j.add(B),Qt(B,uo(Te)),on(je,Qe,!1,{fetcherSubmission:Te,preventScrollReset:Ee});if(On(Qe)){ln(B,H,Qe.error);return}}let yn=C.navigation.location||C.location,Je=ea(i.history,yn,ke.signal),Wr=d||u,$n=C.navigation.state!=="idle"?_r(Wr,C.navigation.location,c):C.matches;Ke($n,"Didn't find any matches after fetcher action");let In=++ee;P.set(B,In);let ar=uo(Te,Qe.data);C.fetchers.set(B,ar);let{dsMatches:Yr,revalidatingFetchers:Si}=sy(Je,pe,s,a,i.history,C,$n,Te,yn,n,!1,ne,ie,te,he,j,Wr,c,i.patchRoutesOnNavigation!=null,[We.route.id,Qe],Le);Si.filter(ht=>ht.key!==B).forEach(ht=>{let Vi=ht.key,qr=C.fetchers.get(Vi),Xr=uo(void 0,qr?qr.data:void 0);C.fetchers.set(Vi,Xr),Un(Vi),ht.controller&&G.set(Vi,ht.controller)}),At({fetchers:new Map(C.fetchers)});let $i=()=>Si.forEach(ht=>Un(ht.key));ke.signal.addEventListener("abort",$i);let{loaderResults:un,fetcherResults:Ye}=await ti(Yr,Si,Je,pe);if(ke.signal.aborted)return;if(ke.signal.removeEventListener("abort",$i),P.delete(B),G.delete(B),Si.forEach(ht=>G.delete(ht.key)),C.fetchers.has(B)){let ht=Ji(Qe.data);C.fetchers.set(B,ht)}let it=au(un);if(it)return on(Je,it.result,!1,{preventScrollReset:Ee});if(it=au(Ye),it)return j.add(it.key),on(Je,it.result,!1,{preventScrollReset:Ee});let{loaderData:or,errors:ji}=hy(C,$n,un,void 0,Si,Ye);Ls(In),C.navigation.state==="loading"&&In>J?(Ke(_,"Expected pending action"),W&&W.abort(),sn(C.navigation.location,{matches:$n,loaderData:or,errors:ji,fetchers:new Map(C.fetchers)})):(At({errors:ji,loaderData:fy(C.loaderData,or,$n,ji),fetchers:new Map(C.fetchers)}),ne=!1)}async function Hr(B,H,Q,le,pe,Ce,_e,Ee,Te){let Le=C.fetchers.get(B);Qt(B,uo(Te,Le?Le.data:void 0),{flushSync:_e});let Be=new AbortController,ke=ea(i.history,Q,Be.signal);if(Ce){let Qe=await sr(le,new URL(ke.url).pathname,ke.signal,B);if(Qe.type==="aborted")return;if(Qe.type==="error"){ln(B,H,Qe.error,{flushSync:_e});return}else if(Qe.matches)le=Qe.matches;else{ln(B,H,Wn(404,{pathname:Q}),{flushSync:_e});return}}let je=Cu(le,Q);G.set(B,Be);let We=ee,It=ca(s,a,ke,le,je,n,pe),Ut=(await ei(ke,It,pe,B))[je.route.id];if(G.get(B)===Be&&G.delete(B),!ke.signal.aborted){if(te.has(B)){Qt(B,Ji(void 0));return}if(ps(Ut))if(J>We){Qt(B,Ji(void 0));return}else{j.add(B),await on(ke,Ut,!1,{preventScrollReset:Ee});return}if(On(Ut)){ln(B,H,Ut.error);return}Qt(B,Ji(Ut.data))}}async function on(B,H,Q,{submission:le,fetcherSubmission:pe,preventScrollReset:Ce,replace:_e}={}){Q||(F==null||F.resolve(),F=null),H.response.headers.has("X-Remix-Revalidate")&&(ne=!0);let Ee=H.response.headers.get("Location");Ke(Ee,"Expected a Location header on the redirect Response"),Ee=cy(Ee,new URL(B.url),c,i.history);let Te=bo(C.location,Ee,{_isRedirect:!0});if(t){let It=!1;if(H.response.headers.has("X-Remix-Reload-Document"))It=!0;else if(nm(Ee)){const wt=sE(Ee,!0);It=wt.origin!==e.location.origin||Xn(wt.pathname,c)==null}if(It){_e?e.location.replace(Ee):e.location.assign(Ee);return}}W=null;let Le=_e===!0||H.response.headers.has("X-Remix-Replace")?"REPLACE":"PUSH",{formMethod:Be,formAction:ke,formEncType:je}=C.navigation;!le&&!pe&&Be&&ke&&je&&(le=gy(C.navigation));let We=le||pe;if(OL.has(H.response.status)&&We&&nn(We.formMethod))await $e(Le,Te,{submission:{...We,formAction:Ee},preventScrollReset:Ce||O,enableViewTransition:Q?z:void 0});else{let It=ch(Te,le);await $e(Le,Te,{overrideNavigation:It,fetcherSubmission:pe,preventScrollReset:Ce||O,enableViewTransition:Q?z:void 0})}}async function ei(B,H,Q,le){var _e;let pe,Ce={};try{pe=await KL(h,B,H,le,Q,!1)}catch(Ee){return H.filter(Te=>Te.shouldLoad).forEach(Te=>{Ce[Te.route.id]={type:"error",error:Ee}}),Ce}if(B.signal.aborted)return Ce;if(!nn(B.method))for(let Ee of H){if(((_e=pe[Ee.route.id])==null?void 0:_e.type)==="error")break;!pe.hasOwnProperty(Ee.route.id)&&!C.loaderData.hasOwnProperty(Ee.route.id)&&(!C.errors||!C.errors.hasOwnProperty(Ee.route.id))&&Ee.shouldCallHandler()&&(pe[Ee.route.id]={type:"error",result:new Error(`No result returned from dataStrategy for route ${Ee.route.id}`)})}for(let[Ee,Te]of Object.entries(pe))if(nR(Te)){let Le=Te.result;Ce[Ee]={type:"redirect",response:XL(Le,B,Ee,H,c)}}else Ce[Ee]=await qL(Te);return Ce}async function ti(B,H,Q,le){let pe=ei(Q,B,le,null),Ce=Promise.all(H.map(async Te=>{if(Te.matches&&Te.match&&Te.request&&Te.controller){let Be=(await ei(Te.request,Te.matches,le,Te.key))[Te.match.route.id];return{[Te.key]:Be}}else return Promise.resolve({[Te.key]:{type:"error",error:Wn(404,{pathname:Te.path})}})})),_e=await pe,Ee=(await Ce).reduce((Te,Le)=>Object.assign(Te,Le),{});return{loaderResults:_e,fetcherResults:Ee}}function xi(){ne=!0,he.forEach((B,H)=>{G.has(H)&&ie.add(H),Un(H)})}function Qt(B,H,Q={}){C.fetchers.set(B,H),At({fetchers:new Map(C.fetchers)},{flushSync:(Q&&Q.flushSync)===!0})}function ln(B,H,Q,le={}){let pe=Mr(C.matches,H);Aa(B),At({errors:{[pe.route.id]:Q},fetchers:new Map(C.fetchers)},{flushSync:(le&&le.flushSync)===!0})}function ni(B){return ge.set(B,(ge.get(B)||0)+1),te.has(B)&&te.delete(B),C.fetchers.get(B)||FL}function bn(B,H){Un(B,H==null?void 0:H.reason),Qt(B,Ji(null))}function Aa(B){let H=C.fetchers.get(B);G.has(B)&&!(H&&H.state==="loading"&&P.has(B))&&Un(B),he.delete(B),P.delete(B),j.delete(B),te.delete(B),ie.delete(B),C.fetchers.delete(B)}function Jo(B){let H=(ge.get(B)||0)-1;H<=0?(ge.delete(B),te.add(B)):ge.set(B,H),At({fetchers:new Map(C.fetchers)})}function Un(B,H){let Q=G.get(B);Q&&(Q.abort(H),G.delete(B))}function el(B){for(let H of B){let Q=ni(H),le=Ji(Q.data);C.fetchers.set(H,le)}}function ws(){let B=[],H=!1;for(let Q of j){let le=C.fetchers.get(Q);Ke(le,`Expected fetcher: ${Q}`),le.state==="loading"&&(j.delete(Q),B.push(Q),H=!0)}return el(B),H}function Ls(B){let H=[];for(let[Q,le]of P)if(le<B){let pe=C.fetchers.get(Q);Ke(pe,`Expected fetcher: ${Q}`),pe.state==="loading"&&(Un(Q),P.delete(Q),H.push(Q))}return el(H),H.length>0}function wa(B,H){let Q=C.blockers.get(B)||lo;return fe.get(B)!==H&&fe.set(B,H),Q}function Rs(B){C.blockers.delete(B),fe.delete(B)}function rr(B,H){let Q=C.blockers.get(B)||lo;Ke(Q.state==="unblocked"&&H.state==="blocked"||Q.state==="blocked"&&H.state==="blocked"||Q.state==="blocked"&&H.state==="proceeding"||Q.state==="blocked"&&H.state==="unblocked"||Q.state==="proceeding"&&H.state==="unblocked",`Invalid blocker state transition: ${Q.state} -> ${H.state}`);let le=new Map(C.blockers);le.set(B,H),At({blockers:le})}function Ui({currentLocation:B,nextLocation:H,historyAction:Q}){if(fe.size===0)return;fe.size>1&&bt(!1,"A router only supports one blocker at a time");let le=Array.from(fe.entries()),[pe,Ce]=le[le.length-1],_e=C.blockers.get(pe);if(!(_e&&_e.state==="proceeding")&&Ce({currentLocation:B,nextLocation:H,historyAction:Q}))return pe}function Ei(B){let H=Wn(404,{pathname:B}),Q=d||u,{matches:le,route:pe}=su(Q);return{notFoundMatches:le,route:pe,error:H}}function tl(B,H,Q){if(v=B,S=H,E=Q||null,!A&&C.navigation===uh){A=!0;let le=Ra(C.location,C.matches);le!=null&&At({restoreScrollPosition:le})}return()=>{v=null,S=null,E=null}}function La(B,H){return E&&E(B,H.map(le=>uL(le,C.loaderData)))||B.key}function nl(B,H){if(v&&S){let Q=La(B,H);v[Q]=S()}}function Ra(B,H){if(v){let Q=La(B,H),le=v[Q];if(typeof le=="number")return le}return null}function zr(B,H,Q){if(i.patchRoutesOnNavigation)if(B){if(Object.keys(B[0].params).length>0)return{active:!0,matches:go(H,Q,c,!0)}}else return{active:!0,matches:go(H,Q,c,!0)||[]};return{active:!1,matches:null}}async function sr(B,H,Q,le){if(!i.patchRoutesOnNavigation)return{type:"success",matches:B};let pe=B;for(;;){let Ce=d==null,_e=d||u,Ee=a;try{await i.patchRoutesOnNavigation({signal:Q,path:H,matches:pe,fetcherKey:le,patch:(Be,ke)=>{Q.aborted||ay(Be,ke,_e,Ee,s,!1)}})}catch(Be){return{type:"error",error:Be,partialMatches:pe}}finally{Ce&&!Q.aborted&&(u=[...u])}if(Q.aborted)return{type:"aborted"};let Te=_r(_e,H,c),Le=null;if(Te){if(Object.keys(Te[0].params).length===0)return{type:"success",matches:Te};if(Le=go(_e,H,c,!0),!(Le&&pe.length<Le.length&&ba(pe,Le.slice(0,pe.length))))return{type:"success",matches:Te}}if(Le||(Le=go(_e,H,c,!0)),!Le||ba(pe,Le))return{type:"success",matches:null};pe=Le}}function ba(B,H){return B.length===H.length&&B.every((Q,le)=>Q.route.id===H[le].route.id)}function Kr(B){a={},d=Io(B,s,void 0,a)}function Ia(B,H,Q=!1){let le=d==null;ay(B,H,d||u,a,s,Q),le&&(u=[...u],At({}))}return U={get basename(){return c},get future(){return m},get state(){return C},get routes(){return u},get window(){return e},initialize:Ve,subscribe:pn,enableScrollRestoration:tl,navigate:vi,fetch:an,revalidate:Ta,createHref:B=>i.history.createHref(B),encodeLocation:B=>i.history.encodeLocation(B),getFetcher:ni,resetFetcher:bn,deleteFetcher:Jo,dispose:Ze,getBlocker:wa,deleteBlocker:Rs,patchRoutes:Ia,_internalFetchControllers:G,_internalSetRoutes:Kr,_internalSetStateDoNotUseOrYouWillBreakYourApp(B){At(B)}},i.unstable_instrumentations&&(U=IL(U,i.unstable_instrumentations.map(B=>B.router).filter(Boolean))),U}function $L(i){return i!=null&&("formData"in i&&i.formData!=null||"body"in i&&i.body!==void 0)}function rf(i,e,t,n,r,s){let a,u;if(r){a=[];for(let c of e)if(a.push(c),c.route.id===r){u=c;break}}else a=e,u=e[e.length-1];let d=rm(n||".",im(a),Xn(i.pathname,t)||i.pathname,s==="path");if(n==null&&(d.search=i.search,d.hash=i.hash),(n==null||n===""||n===".")&&u){let c=om(d.search);if(u.route.index&&!c)d.search=d.search?d.search.replace(/^\?/,"?index&"):"?index";else if(!u.route.index&&c){let h=new URLSearchParams(d.search),m=h.getAll("index");h.delete("index"),m.filter(y=>y).forEach(y=>h.append("index",y));let p=h.toString();d.search=p?`?${p}`:""}}return t!=="/"&&(d.pathname=TL({basename:t,pathname:d.pathname})),Ni(d)}function ry(i,e,t){if(!t||!$L(t))return{path:e};if(t.formMethod&&!sR(t.formMethod))return{path:e,error:Wn(405,{method:t.formMethod})};let n=()=>({path:e,error:Wn(400,{type:"invalid-body"})}),s=(t.formMethod||"get").toUpperCase(),a=TE(e);if(t.body!==void 0){if(t.formEncType==="text/plain"){if(!nn(s))return n();let m=typeof t.body=="string"?t.body:t.body instanceof FormData||t.body instanceof URLSearchParams?Array.from(t.body.entries()).reduce((p,[y,v])=>`${p}${y}=${v}
`,""):String(t.body);return{path:e,submission:{formMethod:s,formAction:a,formEncType:t.formEncType,formData:void 0,json:void 0,text:m}}}else if(t.formEncType==="application/json"){if(!nn(s))return n();try{let m=typeof t.body=="string"?JSON.parse(t.body):t.body;return{path:e,submission:{formMethod:s,formAction:a,formEncType:t.formEncType,formData:void 0,json:m,text:void 0}}}catch{return n()}}}Ke(typeof FormData=="function","FormData is not available in this environment");let u,d;if(t.formData)u=of(t.formData),d=t.formData;else if(t.body instanceof FormData)u=of(t.body),d=t.body;else if(t.body instanceof URLSearchParams)u=t.body,d=dy(u);else if(t.body==null)u=new URLSearchParams,d=new FormData;else try{u=new URLSearchParams(t.body),d=dy(u)}catch{return n()}let c={formMethod:s,formAction:a,formEncType:t&&t.formEncType||"application/x-www-form-urlencoded",formData:d,json:void 0,text:void 0};if(nn(c.formMethod))return{path:e,submission:c};let h=jr(e);return i&&h.search&&om(h.search)&&u.append("index",""),h.search=`?${u}`,{path:Ni(h),submission:c}}function sy(i,e,t,n,r,s,a,u,d,c,h,m,p,y,v,E,S,A,L,R,D){var ce;let k=R?On(R[1])?R[1].error:R[1].data:void 0,U=r.createURL(s.location),C=r.createURL(d),_;if(h&&s.errors){let ne=Object.keys(s.errors)[0];_=a.findIndex(ie=>ie.route.id===ne)}else if(R&&On(R[1])){let ne=R[0];_=a.findIndex(ie=>ie.route.id===ne)-1}let F=R?R[1].statusCode:void 0,O=F&&F>=400,W={currentUrl:U,currentParams:((ce=s.matches[0])==null?void 0:ce.params)||{},nextUrl:C,nextParams:a[0].params,...u,actionResult:k,actionStatus:F},z=zo(a),re=a.map((ne,ie)=>{let{route:G}=ne,ee=null;if(_!=null&&ie>_?ee=!1:G.lazy?ee=!0:sm(G)?h?ee=sf(G,s.loaderData,s.errors):jL(s.loaderData,s.matches[ie],ne)&&(ee=!0):ee=!1,ee!==null)return af(t,n,i,z,ne,c,e,ee);let J=!1;typeof D=="boolean"?J=D:O?J=!1:(m||U.pathname+U.search===C.pathname+C.search||U.search!==C.search||VL(s.matches[ie],ne))&&(J=!0);let P={...W,defaultShouldRevalidate:J},j=xo(ne,P);return af(t,n,i,z,ne,c,e,j,P,D)}),ae=[];return v.forEach((ne,ie)=>{if(h||!a.some(te=>te.route.id===ne.routeId)||y.has(ie))return;let G=s.fetchers.get(ie),ee=G&&G.state!=="idle"&&G.data===void 0,J=_r(S,ne.path,A);if(!J){if(L&&ee)return;ae.push({key:ie,routeId:ne.routeId,path:ne.path,matches:null,match:null,request:null,controller:null});return}if(E.has(ie))return;let P=Cu(J,ne.path),j=new AbortController,he=ea(r,ne.path,j.signal),ge=null;if(p.has(ie))p.delete(ie),ge=ca(t,n,he,J,P,c,e);else if(ee)m&&(ge=ca(t,n,he,J,P,c,e));else{let te;typeof D=="boolean"?te=D:O?te=!1:te=m;let fe={...W,defaultShouldRevalidate:te};xo(P,fe)&&(ge=ca(t,n,he,J,P,c,e,fe))}ge&&ae.push({key:ie,routeId:ne.routeId,path:ne.path,matches:ge,match:P,request:he,controller:j})}),{dsMatches:re,revalidatingFetchers:ae}}function sm(i){return i.loader!=null||i.middleware!=null&&i.middleware.length>0}function sf(i,e,t){if(i.lazy)return!0;if(!sm(i))return!1;let n=e!=null&&i.id in e,r=t!=null&&t[i.id]!==void 0;return!n&&r?!1:typeof i.loader=="function"&&i.loader.hydrate===!0?!0:!n&&!r}function jL(i,e,t){let n=!e||t.route.id!==e.route.id,r=!i.hasOwnProperty(t.route.id);return n||r}function VL(i,e){let t=i.route.path;return i.pathname!==e.pathname||t!=null&&t.endsWith("*")&&i.params["*"]!==e.params["*"]}function xo(i,e){if(i.route.shouldRevalidate){let t=i.route.shouldRevalidate(e);if(typeof t=="boolean")return t}return e.defaultShouldRevalidate}function ay(i,e,t,n,r,s){let a;if(i){let c=n[i];Ke(c,`No route found to patch children into: routeId = ${i}`),c.children||(c.children=[]),a=c.children}else a=t;let u=[],d=[];if(e.forEach(c=>{let h=a.find(m=>yE(c,m));h?d.push({existingRoute:h,newRoute:c}):u.push(c)}),u.length>0){let c=Io(u,r,[i||"_","patch",String((a==null?void 0:a.length)||"0")],n);a.push(...c)}if(s&&d.length>0)for(let c=0;c<d.length;c++){let{existingRoute:h,newRoute:m}=d[c],p=h,[y]=Io([m],r,[],{},!0);Object.assign(p,{element:y.element?y.element:p.element,errorElement:y.errorElement?y.errorElement:p.errorElement,hydrateFallbackElement:y.hydrateFallbackElement?y.hydrateFallbackElement:p.hydrateFallbackElement})}}function yE(i,e){return"id"in i&&"id"in e&&i.id===e.id?!0:i.index===e.index&&i.path===e.path&&i.caseSensitive===e.caseSensitive?(!i.children||i.children.length===0)&&(!e.children||e.children.length===0)?!0:i.children.every((t,n)=>{var r;return(r=e.children)==null?void 0:r.some(s=>yE(t,s))}):!1}var oy=new WeakMap,vE=({key:i,route:e,manifest:t,mapRouteProperties:n})=>{let r=t[e.id];if(Ke(r,"No route found in manifest"),!r.lazy||typeof r.lazy!="object")return;let s=r.lazy[i];if(!s)return;let a=oy.get(r);a||(a={},oy.set(r,a));let u=a[i];if(u)return u;let d=(async()=>{let c=sL(i),m=r[i]!==void 0&&i!=="hasErrorBoundary";if(c)bt(!c,"Route property "+i+" is not a supported lazy route property. This property will be ignored."),a[i]=Promise.resolve();else if(m)bt(!1,`Route "${r.id}" has a static property "${i}" defined. The lazy property will be ignored.`);else{let p=await s();p!=null&&(Object.assign(r,{[i]:p}),Object.assign(r,n(r)))}typeof r.lazy=="object"&&(r.lazy[i]=void 0,Object.values(r.lazy).every(p=>p===void 0)&&(r.lazy=void 0))})();return a[i]=d,d},ly=new WeakMap;function GL(i,e,t,n,r){let s=t[i.id];if(Ke(s,"No route found in manifest"),!i.lazy)return{lazyRoutePromise:void 0,lazyHandlerPromise:void 0};if(typeof i.lazy=="function"){let h=ly.get(s);if(h)return{lazyRoutePromise:h,lazyHandlerPromise:h};let m=(async()=>{Ke(typeof i.lazy=="function","No lazy route function found");let p=await i.lazy(),y={};for(let v in p){let E=p[v];if(E===void 0)continue;let S=oL(v),L=s[v]!==void 0&&v!=="hasErrorBoundary";S?bt(!S,"Route property "+v+" is not a supported property to be returned from a lazy route function. This property will be ignored."):L?bt(!L,`Route "${s.id}" has a static property "${v}" defined but its lazy function is also returning a value for this property. The lazy route property "${v}" will be ignored.`):y[v]=E}Object.assign(s,y),Object.assign(s,{...n(s),lazy:void 0})})();return ly.set(s,m),m.catch(()=>{}),{lazyRoutePromise:m,lazyHandlerPromise:m}}let a=Object.keys(i.lazy),u=[],d;for(let h of a){if(r&&r.includes(h))continue;let m=vE({key:h,route:i,manifest:t,mapRouteProperties:n});m&&(u.push(m),h===e&&(d=m))}let c=u.length>0?Promise.all(u).then(()=>{}):void 0;return c==null||c.catch(()=>{}),d==null||d.catch(()=>{}),{lazyRoutePromise:c,lazyHandlerPromise:d}}async function uy(i){let e=i.matches.filter(r=>r.shouldLoad),t={};return(await Promise.all(e.map(r=>r.resolve()))).forEach((r,s)=>{t[e[s].route.id]=r}),t}async function HL(i){return i.matches.some(e=>e.route.middleware)?xE(i,()=>uy(i)):uy(i)}function xE(i,e){return zL(i,e,n=>{if(rR(n))throw n;return n},eR,t);function t(n,r,s){if(s)return Promise.resolve(Object.assign(s.value,{[r]:{type:"error",result:n}}));{let{matches:a}=i,u=Math.min(Math.max(a.findIndex(c=>c.route.id===r),0),Math.max(a.findIndex(c=>c.shouldCallHandler()),0)),d=Mr(a,a[u].route.id).route.id;return Promise.resolve({[d]:{type:"error",result:n}})}}}async function zL(i,e,t,n,r){let{matches:s,request:a,params:u,context:d,unstable_pattern:c}=i,h=s.flatMap(p=>p.route.middleware?p.route.middleware.map(y=>[p.route.id,y]):[]);return await EE({request:a,params:u,context:d,unstable_pattern:c},h,e,t,n,r)}async function EE(i,e,t,n,r,s,a=0){let{request:u}=i;if(u.signal.aborted)throw u.signal.reason??new Error(`Request aborted: ${u.method} ${u.url}`);let d=e[a];if(!d)return await t();let[c,h]=d,m,p=async()=>{if(m)throw new Error("You may only call `next()` once per middleware");try{return m={value:await EE(i,e,t,n,r,s,a+1)},m.value}catch(y){return m={value:await s(y,c,m)},m.value}};try{let y=await h(i,p),v=y!=null?n(y):void 0;return r(v)?v:m?v??m.value:(m={value:await p()},m.value)}catch(y){return await s(y,c,m)}}function SE(i,e,t,n,r){let s=vE({key:"middleware",route:n.route,manifest:e,mapRouteProperties:i}),a=GL(n.route,nn(t.method)?"action":"loader",e,i,r);return{middleware:s,route:a.lazyRoutePromise,handler:a.lazyHandlerPromise}}function af(i,e,t,n,r,s,a,u,d=null,c){let h=!1,m=SE(i,e,t,r,s);return{...r,_lazyPromises:m,shouldLoad:u,shouldRevalidateArgs:d,shouldCallHandler(p){return h=!0,d?typeof c=="boolean"?xo(r,{...d,defaultShouldRevalidate:c}):typeof p=="boolean"?xo(r,{...d,defaultShouldRevalidate:p}):xo(r,d):u},resolve(p){let{lazy:y,loader:v,middleware:E}=r.route,S=h||u||p&&!nn(t.method)&&(y||v),A=E&&E.length>0&&!v&&!y;return S&&(nn(t.method)||!A)?WL({request:t,unstable_pattern:n,match:r,lazyHandlerPromise:m==null?void 0:m.handler,lazyRoutePromise:m==null?void 0:m.route,handlerOverride:p,scopedContext:a}):Promise.resolve({type:"data",result:void 0})}}}function ca(i,e,t,n,r,s,a,u=null){return n.map(d=>d.route.id!==r.route.id?{...d,shouldLoad:!1,shouldRevalidateArgs:u,shouldCallHandler:()=>!1,_lazyPromises:SE(i,e,t,d,s),resolve:()=>Promise.resolve({type:"data",result:void 0})}:af(i,e,t,zo(n),d,s,a,!0,u))}async function KL(i,e,t,n,r,s){t.some(c=>{var h;return(h=c._lazyPromises)==null?void 0:h.middleware})&&await Promise.all(t.map(c=>{var h;return(h=c._lazyPromises)==null?void 0:h.middleware}));let a={request:e,unstable_pattern:zo(t),params:t[0].params,context:r,matches:t},d=await i({...a,fetcherKey:n,runClientMiddleware:c=>{let h=a;return xE(h,()=>c({...h,fetcherKey:n,runClientMiddleware:()=>{throw new Error("Cannot call `runClientMiddleware()` from within an `runClientMiddleware` handler")}}))}});try{await Promise.all(t.flatMap(c=>{var h,m;return[(h=c._lazyPromises)==null?void 0:h.handler,(m=c._lazyPromises)==null?void 0:m.route]}))}catch{}return d}async function WL({request:i,unstable_pattern:e,match:t,lazyHandlerPromise:n,lazyRoutePromise:r,handlerOverride:s,scopedContext:a}){let u,d,c=nn(i.method),h=c?"action":"loader",m=p=>{let y,v=new Promise((A,L)=>y=L);d=()=>y(),i.signal.addEventListener("abort",d);let E=A=>typeof p!="function"?Promise.reject(new Error(`You cannot call the handler for a route which defines a boolean "${h}" [routeId: ${t.route.id}]`)):p({request:i,unstable_pattern:e,params:t.params,context:a},...A!==void 0?[A]:[]),S=(async()=>{try{return{type:"data",result:await(s?s(L=>E(L)):E())}}catch(A){return{type:"error",result:A}}})();return Promise.race([S,v])};try{let p=c?t.route.action:t.route.loader;if(n||r)if(p){let y,[v]=await Promise.all([m(p).catch(E=>{y=E}),n,r]);if(y!==void 0)throw y;u=v}else{await n;let y=c?t.route.action:t.route.loader;if(y)[u]=await Promise.all([m(y),r]);else if(h==="action"){let v=new URL(i.url),E=v.pathname+v.search;throw Wn(405,{method:i.method,pathname:E,routeId:t.route.id})}else return{type:"data",result:void 0}}else if(p)u=await m(p);else{let y=new URL(i.url),v=y.pathname+y.search;throw Wn(404,{pathname:v})}}catch(p){return{type:"error",result:p}}finally{d&&i.signal.removeEventListener("abort",d)}return u}async function YL(i){let e=i.headers.get("Content-Type");return e&&/\bapplication\/json\b/.test(e)?i.body==null?null:i.json():i.text()}async function qL(i){var n,r,s,a,u;let{result:e,type:t}=i;if(am(e)){let d;try{d=await YL(e)}catch(c){return{type:"error",error:c}}return t==="error"?{type:"error",error:new Ho(e.status,e.statusText,d),statusCode:e.status,headers:e.headers}:{type:"data",data:d,statusCode:e.status,headers:e.headers}}return t==="error"?py(e)?e.data instanceof Error?{type:"error",error:e.data,statusCode:(n=e.init)==null?void 0:n.status,headers:(r=e.init)!=null&&r.headers?new Headers(e.init.headers):void 0}:{type:"error",error:JL(e),statusCode:Co(e)?e.status:void 0,headers:(s=e.init)!=null&&s.headers?new Headers(e.init.headers):void 0}:{type:"error",error:e,statusCode:Co(e)?e.status:void 0}:py(e)?{type:"data",data:e.data,statusCode:(a=e.init)==null?void 0:a.status,headers:(u=e.init)!=null&&u.headers?new Headers(e.init.headers):void 0}:{type:"data",data:e}}function XL(i,e,t,n,r){let s=i.headers.get("Location");if(Ke(s,"Redirects returned/thrown from loaders/actions must have a Location header"),!nm(s)){let a=n.slice(0,n.findIndex(u=>u.route.id===t)+1);s=rf(new URL(e.url),a,r,s),i.headers.set("Location",s)}return i}function cy(i,e,t,n){let r=["about:","blob:","chrome:","chrome-untrusted:","content:","data:","devtools:","file:","filesystem:","javascript:"];if(nm(i)){let s=i,a=s.startsWith("//")?new URL(e.protocol+s):new URL(s);if(r.includes(a.protocol))throw new Error("Invalid redirect location");let u=Xn(a.pathname,t)!=null;if(a.origin===e.origin&&u)return a.pathname+a.search+a.hash}try{let s=n.createURL(i);if(r.includes(s.protocol))throw new Error("Invalid redirect location")}catch{}return i}function ea(i,e,t,n){let r=i.createURL(TE(e)).toString(),s={signal:t};if(n&&nn(n.formMethod)){let{formMethod:a,formEncType:u}=n;s.method=a.toUpperCase(),u==="application/json"?(s.headers=new Headers({"Content-Type":u}),s.body=JSON.stringify(n.json)):u==="text/plain"?s.body=n.text:u==="application/x-www-form-urlencoded"&&n.formData?s.body=of(n.formData):s.body=n.formData}return new Request(r,s)}function of(i){let e=new URLSearchParams;for(let[t,n]of i.entries())e.append(t,typeof n=="string"?n:n.name);return e}function dy(i){let e=new FormData;for(let[t,n]of i.entries())e.append(t,n);return e}function QL(i,e,t,n=!1,r=!1){let s={},a=null,u,d=!1,c={},h=t&&On(t[1])?t[1].error:void 0;return i.forEach(m=>{if(!(m.route.id in e))return;let p=m.route.id,y=e[p];if(Ke(!ps(y),"Cannot handle redirect results in processLoaderData"),On(y)){let v=y.error;if(h!==void 0&&(v=h,h=void 0),a=a||{},r)a[p]=v;else{let E=Mr(i,p);a[E.route.id]==null&&(a[E.route.id]=v)}n||(s[p]=gE),d||(d=!0,u=Co(y.error)?y.error.status:500),y.headers&&(c[p]=y.headers)}else s[p]=y.data,y.statusCode&&y.statusCode!==200&&!d&&(u=y.statusCode),y.headers&&(c[p]=y.headers)}),h!==void 0&&t&&(a={[t[0]]:h},t[2]&&(s[t[2]]=void 0)),{loaderData:s,errors:a,statusCode:u||200,loaderHeaders:c}}function hy(i,e,t,n,r,s){let{loaderData:a,errors:u}=QL(e,t,n);return r.filter(d=>!d.matches||d.matches.some(c=>c.shouldLoad)).forEach(d=>{let{key:c,match:h,controller:m}=d;if(m&&m.signal.aborted)return;let p=s[c];if(Ke(p,"Did not find corresponding fetcher result"),On(p)){let y=Mr(i.matches,h==null?void 0:h.route.id);u&&u[y.route.id]||(u={...u,[y.route.id]:p.error}),i.fetchers.delete(c)}else if(ps(p))Ke(!1,"Unhandled fetcher revalidation redirect");else{let y=Ji(p.data);i.fetchers.set(c,y)}}),{loaderData:a,errors:u}}function fy(i,e,t,n){let r=Object.entries(e).filter(([,s])=>s!==gE).reduce((s,[a,u])=>(s[a]=u,s),{});for(let s of t){let a=s.route.id;if(!e.hasOwnProperty(a)&&i.hasOwnProperty(a)&&s.route.loader&&(r[a]=i[a]),n&&n.hasOwnProperty(a))break}return r}function my(i){return i?On(i[1])?{actionData:{}}:{actionData:{[i[0]]:i[1].data}}:{}}function Mr(i,e){return(e?i.slice(0,i.findIndex(n=>n.route.id===e)+1):[...i]).reverse().find(n=>n.route.hasErrorBoundary===!0)||i[0]}function su(i){let e=i.length===1?i[0]:i.find(t=>t.index||!t.path||t.path==="/")||{id:"__shim-error-route__"};return{matches:[{params:{},pathname:"",pathnameBase:"",route:e}],route:e}}function Wn(i,{pathname:e,routeId:t,method:n,type:r,message:s}={}){let a="Unknown Server Error",u="Unknown @remix-run/router error";return i===400?(a="Bad Request",n&&e&&t?u=`You made a ${n} request to "${e}" but did not provide a \`loader\` for route "${t}", so there is no way to handle the request.`:r==="invalid-body"&&(u="Unable to encode submission body")):i===403?(a="Forbidden",u=`Route "${t}" does not match URL "${e}"`):i===404?(a="Not Found",u=`No route matches URL "${e}"`):i===405&&(a="Method Not Allowed",n&&e&&t?u=`You made a ${n.toUpperCase()} request to "${e}" but did not provide an \`action\` for route "${t}", so there is no way to handle the request.`:n&&(u=`Invalid request method "${n.toUpperCase()}"`)),new Ho(i||500,a,new Error(u),!0)}function au(i){let e=Object.entries(i);for(let t=e.length-1;t>=0;t--){let[n,r]=e[t];if(ps(r))return{key:n,result:r}}}function TE(i){let e=typeof i=="string"?jr(i):i;return Ni({...e,hash:""})}function ZL(i,e){return i.pathname!==e.pathname||i.search!==e.search?!1:i.hash===""?e.hash!=="":i.hash===e.hash?!0:e.hash!==""}function JL(i){var e,t;return new Ho(((e=i.init)==null?void 0:e.status)??500,((t=i.init)==null?void 0:t.statusText)??"Internal Server Error",i.data)}function eR(i){return i!=null&&typeof i=="object"&&Object.entries(i).every(([e,t])=>typeof e=="string"&&tR(t))}function tR(i){return i!=null&&typeof i=="object"&&"type"in i&&"result"in i&&(i.type==="data"||i.type==="error")}function nR(i){return am(i.result)&&mE.has(i.result.status)}function On(i){return i.type==="error"}function ps(i){return(i&&i.type)==="redirect"}function py(i){return typeof i=="object"&&i!=null&&"type"in i&&"data"in i&&"init"in i&&i.type==="DataWithResponseInit"}function am(i){return i!=null&&typeof i.status=="number"&&typeof i.statusText=="string"&&typeof i.headers=="object"&&typeof i.body<"u"}function iR(i){return mE.has(i)}function rR(i){return am(i)&&iR(i.status)&&i.headers.has("Location")}function sR(i){return NL.has(i.toUpperCase())}function nn(i){return _L.has(i.toUpperCase())}function om(i){return new URLSearchParams(i).getAll("index").some(e=>e==="")}function Cu(i,e){let t=typeof e=="string"?jr(e).search:e.search;if(i[i.length-1].route.index&&om(t||""))return i[i.length-1];let n=uE(i);return n[n.length-1]}function gy(i){let{formMethod:e,formAction:t,formEncType:n,text:r,formData:s,json:a}=i;if(!(!e||!t||!n)){if(r!=null)return{formMethod:e,formAction:t,formEncType:n,formData:void 0,json:void 0,text:r};if(s!=null)return{formMethod:e,formAction:t,formEncType:n,formData:s,json:void 0,text:void 0};if(a!==void 0)return{formMethod:e,formAction:t,formEncType:n,formData:void 0,json:a,text:void 0}}}function ch(i,e){return e?{state:"loading",location:i,formMethod:e.formMethod,formAction:e.formAction,formEncType:e.formEncType,formData:e.formData,json:e.json,text:e.text}:{state:"loading",location:i,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0}}function aR(i,e){return{state:"submitting",location:i,formMethod:e.formMethod,formAction:e.formAction,formEncType:e.formEncType,formData:e.formData,json:e.json,text:e.text}}function uo(i,e){return i?{state:"loading",formMethod:i.formMethod,formAction:i.formAction,formEncType:i.formEncType,formData:i.formData,json:i.json,text:i.text,data:e}:{state:"loading",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:e}}function oR(i,e){return{state:"submitting",formMethod:i.formMethod,formAction:i.formAction,formEncType:i.formEncType,formData:i.formData,json:i.json,text:i.text,data:e?e.data:void 0}}function Ji(i){return{state:"idle",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:i}}function lR(i,e){try{let t=i.sessionStorage.getItem(pE);if(t){let n=JSON.parse(t);for(let[r,s]of Object.entries(n||{}))s&&Array.isArray(s)&&e.set(r,new Set(s||[]))}}catch{}}function uR(i,e){if(e.size>0){let t={};for(let[n,r]of e)t[n]=[...r];try{i.sessionStorage.setItem(pE,JSON.stringify(t))}catch(n){bt(!1,`Failed to save applied view transitions in sessionStorage (${n}).`)}}}function yy(){let i,e,t=new Promise((n,r)=>{i=async s=>{n(s);try{await t}catch{}},e=async s=>{r(s);try{await t}catch{}}});return{promise:t,resolve:i,reject:e}}var Ts=M.createContext(null);Ts.displayName="DataRouter";var Ko=M.createContext(null);Ko.displayName="DataRouterState";var AE=M.createContext(!1);function cR(){return M.useContext(AE)}var lm=M.createContext({isTransitioning:!1});lm.displayName="ViewTransition";var wE=M.createContext(new Map);wE.displayName="Fetchers";var dR=M.createContext(null);dR.displayName="Await";var Zn=M.createContext(null);Zn.displayName="Navigation";var mc=M.createContext(null);mc.displayName="Location";var yi=M.createContext({outlet:null,matches:[],isDataRoute:!1});yi.displayName="Route";var um=M.createContext(null);um.displayName="RouteError";var LE="REACT_ROUTER_ERROR",hR="REDIRECT",fR="ROUTE_ERROR_RESPONSE";function mR(i){if(i.startsWith(`${LE}:${hR}:{`))try{let e=JSON.parse(i.slice(28));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.location=="string"&&typeof e.reloadDocument=="boolean"&&typeof e.replace=="boolean")return e}catch{}}function pR(i){if(i.startsWith(`${LE}:${fR}:{`))try{let e=JSON.parse(i.slice(40));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string")return new Ho(e.status,e.statusText,e.data)}catch{}}function gR(i,{relative:e}={}){Ke(Wo(),"useHref() may be used only in the context of a <Router> component.");let{basename:t,navigator:n}=M.useContext(Zn),{hash:r,pathname:s,search:a}=Yo(i,{relative:e}),u=s;return t!=="/"&&(u=s==="/"?t:_i([t,s])),n.createHref({pathname:u,search:a,hash:r})}function Wo(){return M.useContext(mc)!=null}function Vr(){return Ke(Wo(),"useLocation() may be used only in the context of a <Router> component."),M.useContext(mc).location}var RE="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function bE(i){M.useContext(Zn).static||M.useLayoutEffect(i)}function As(){let{isDataRoute:i}=M.useContext(yi);return i?kR():yR()}function yR(){Ke(Wo(),"useNavigate() may be used only in the context of a <Router> component.");let i=M.useContext(Ts),{basename:e,navigator:t}=M.useContext(Zn),{matches:n}=M.useContext(yi),{pathname:r}=Vr(),s=JSON.stringify(im(n)),a=M.useRef(!1);return bE(()=>{a.current=!0}),M.useCallback((d,c={})=>{if(bt(a.current,RE),!a.current)return;if(typeof d=="number"){t.go(d);return}let h=rm(d,JSON.parse(s),r,c.relative==="path");i==null&&e!=="/"&&(h.pathname=h.pathname==="/"?e:_i([e,h.pathname])),(c.replace?t.replace:t.push)(h,c.state,c)},[e,t,s,r,i])}var vR=M.createContext(null);function xR(i){let e=M.useContext(yi).outlet;return M.useMemo(()=>e&&M.createElement(vR.Provider,{value:i},e),[e,i])}function IE(){let{matches:i}=M.useContext(yi),e=i[i.length-1];return e?e.params:{}}function Yo(i,{relative:e}={}){let{matches:t}=M.useContext(yi),{pathname:n}=Vr(),r=JSON.stringify(im(t));return M.useMemo(()=>rm(i,JSON.parse(r),n,e==="path"),[i,r,n,e])}function ER(i,e,t,n,r){Ke(Wo(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:s}=M.useContext(Zn),{matches:a}=M.useContext(yi),u=a[a.length-1],d=u?u.params:{},c=u?u.pathname:"/",h=u?u.pathnameBase:"/",m=u&&u.route;{let L=m&&m.path||"";DE(c,!m||L.endsWith("*")||L.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${c}" (under <Route path="${L}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${L}"> to <Route path="${L==="/"?"*":`${L}/*`}">.`)}let p=Vr(),y;y=p;let v=y.pathname||"/",E=v;if(h!=="/"){let L=h.replace(/^\//,"").split("/");E="/"+v.replace(/^\//,"").split("/").slice(L.length).join("/")}let S=_r(i,{pathname:E});return bt(m||S!=null,`No routes matched location "${y.pathname}${y.search}${y.hash}" `),bt(S==null||S[S.length-1].route.element!==void 0||S[S.length-1].route.Component!==void 0||S[S.length-1].route.lazy!==void 0,`Matched leaf route at location "${y.pathname}${y.search}${y.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`),LR(S&&S.map(L=>Object.assign({},L,{params:Object.assign({},d,L.params),pathname:_i([h,s.encodeLocation?s.encodeLocation(L.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:L.pathname]),pathnameBase:L.pathnameBase==="/"?h:_i([h,s.encodeLocation?s.encodeLocation(L.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:L.pathnameBase])})),a,t,n,r)}function SR(){let i=DR(),e=Co(i)?`${i.status} ${i.statusText}`:i instanceof Error?i.message:JSON.stringify(i),t=i instanceof Error?i.stack:null,n="rgba(200,200,200, 0.5)",r={padding:"0.5rem",backgroundColor:n},s={padding:"2px 4px",backgroundColor:n},a=null;return console.error("Error handled by React Router default ErrorBoundary:",i),a=M.createElement(M.Fragment,null,M.createElement("p",null," Hey developer "),M.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",M.createElement("code",{style:s},"ErrorBoundary")," or"," ",M.createElement("code",{style:s},"errorElement")," prop on your route.")),M.createElement(M.Fragment,null,M.createElement("h2",null,"Unexpected Application Error!"),M.createElement("h3",{style:{fontStyle:"italic"}},e),t?M.createElement("pre",{style:r},t):null,a)}var TR=M.createElement(SR,null),CE=class extends M.Component{constructor(i){super(i),this.state={location:i.location,revalidation:i.revalidation,error:i.error}}static getDerivedStateFromError(i){return{error:i}}static getDerivedStateFromProps(i,e){return e.location!==i.location||e.revalidation!=="idle"&&i.revalidation==="idle"?{error:i.error,location:i.location,revalidation:i.revalidation}:{error:i.error!==void 0?i.error:e.error,location:e.location,revalidation:i.revalidation||e.revalidation}}componentDidCatch(i,e){this.props.onError?this.props.onError(i,e):console.error("React Router caught the following error during render",i)}render(){let i=this.state.error;if(this.context&&typeof i=="object"&&i&&"digest"in i&&typeof i.digest=="string"){const t=pR(i.digest);t&&(i=t)}let e=i!==void 0?M.createElement(yi.Provider,{value:this.props.routeContext},M.createElement(um.Provider,{value:i,children:this.props.component})):this.props.children;return this.context?M.createElement(AR,{error:i},e):e}};CE.contextType=AE;var dh=new WeakMap;function AR({children:i,error:e}){let{basename:t}=M.useContext(Zn);if(typeof e=="object"&&e&&"digest"in e&&typeof e.digest=="string"){let n=mR(e.digest);if(n){let r=dh.get(e);if(r)throw r;let s=dE(n.location,t);if(cE&&!dh.get(e))if(s.isExternal||n.reloadDocument)window.location.href=s.absoluteURL||s.to;else{const a=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(s.to,{replace:n.replace}));throw dh.set(e,a),a}return M.createElement("meta",{httpEquiv:"refresh",content:`0;url=${s.absoluteURL||s.to}`})}}return i}function wR({routeContext:i,match:e,children:t}){let n=M.useContext(Ts);return n&&n.static&&n.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(n.staticContext._deepestRenderedBoundaryId=e.route.id),M.createElement(yi.Provider,{value:i},t)}function LR(i,e=[],t=null,n=null,r=null){if(i==null){if(!t)return null;if(t.errors)i=t.matches;else if(e.length===0&&!t.initialized&&t.matches.length>0)i=t.matches;else return null}let s=i,a=t==null?void 0:t.errors;if(a!=null){let h=s.findIndex(m=>m.route.id&&(a==null?void 0:a[m.route.id])!==void 0);Ke(h>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(a).join(",")}`),s=s.slice(0,Math.min(s.length,h+1))}let u=!1,d=-1;if(t)for(let h=0;h<s.length;h++){let m=s[h];if((m.route.HydrateFallback||m.route.hydrateFallbackElement)&&(d=h),m.route.id){let{loaderData:p,errors:y}=t,v=m.route.loader&&!p.hasOwnProperty(m.route.id)&&(!y||y[m.route.id]===void 0);if(m.route.lazy||v){u=!0,d>=0?s=s.slice(0,d+1):s=[s[0]];break}}}let c=t&&n?(h,m)=>{var p,y;n(h,{location:t.location,params:((y=(p=t.matches)==null?void 0:p[0])==null?void 0:y.params)??{},unstable_pattern:zo(t.matches),errorInfo:m})}:void 0;return s.reduceRight((h,m,p)=>{let y,v=!1,E=null,S=null;t&&(y=a&&m.route.id?a[m.route.id]:void 0,E=m.route.errorElement||TR,u&&(d<0&&p===0?(DE("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),v=!0,S=null):d===p&&(v=!0,S=m.route.hydrateFallbackElement||null)));let A=e.concat(s.slice(0,p+1)),L=()=>{let R;return y?R=E:v?R=S:m.route.Component?R=M.createElement(m.route.Component,null):m.route.element?R=m.route.element:R=h,M.createElement(wR,{match:m,routeContext:{outlet:h,matches:A,isDataRoute:t!=null},children:R})};return t&&(m.route.ErrorBoundary||m.route.errorElement||p===0)?M.createElement(CE,{location:t.location,revalidation:t.revalidation,component:E,error:y,children:L(),routeContext:{outlet:null,matches:A,isDataRoute:!0},onError:c}):L()},null)}function cm(i){return`${i} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function RR(i){let e=M.useContext(Ts);return Ke(e,cm(i)),e}function bR(i){let e=M.useContext(Ko);return Ke(e,cm(i)),e}function IR(i){let e=M.useContext(yi);return Ke(e,cm(i)),e}function dm(i){let e=IR(i),t=e.matches[e.matches.length-1];return Ke(t.route.id,`${i} can only be used on routes that contain a unique "id"`),t.route.id}function CR(){return dm("useRouteId")}function DR(){var n;let i=M.useContext(um),e=bR("useRouteError"),t=dm("useRouteError");return i!==void 0?i:(n=e.errors)==null?void 0:n[t]}function kR(){let{router:i}=RR("useNavigate"),e=dm("useNavigate"),t=M.useRef(!1);return bE(()=>{t.current=!0}),M.useCallback(async(r,s={})=>{bt(t.current,RE),t.current&&(typeof r=="number"?await i.navigate(r):await i.navigate(r,{fromRouteId:e,...s}))},[i,e])}var vy={};function DE(i,e,t){!e&&!vy[i]&&(vy[i]=!0,bt(!1,t))}var xy={};function Ey(i,e){!i&&!xy[e]&&(xy[e]=!0,console.warn(e))}var PR="useOptimistic",Sy=Zw[PR],_R=()=>{};function MR(i){return Sy?Sy(i):[i,_R]}function NR(i){let e={hasErrorBoundary:i.hasErrorBoundary||i.ErrorBoundary!=null||i.errorElement!=null};return i.Component&&(i.element&&bt(!1,"You should not include both `Component` and `element` on your route - `Component` will be used."),Object.assign(e,{element:M.createElement(i.Component),Component:void 0})),i.HydrateFallback&&(i.hydrateFallbackElement&&bt(!1,"You should not include both `HydrateFallback` and `hydrateFallbackElement` on your route - `HydrateFallback` will be used."),Object.assign(e,{hydrateFallbackElement:M.createElement(i.HydrateFallback),HydrateFallback:void 0})),i.ErrorBoundary&&(i.errorElement&&bt(!1,"You should not include both `ErrorBoundary` and `errorElement` on your route - `ErrorBoundary` will be used."),Object.assign(e,{errorElement:M.createElement(i.ErrorBoundary),ErrorBoundary:void 0})),e}var OR=["HydrateFallback","hydrateFallbackElement"],FR=class{constructor(){this.status="pending",this.promise=new Promise((i,e)=>{this.resolve=t=>{this.status==="pending"&&(this.status="resolved",i(t))},this.reject=t=>{this.status==="pending"&&(this.status="rejected",e(t))}})}};function BR({router:i,flushSync:e,onError:t,unstable_useTransitions:n}){n=cR()||n;let[s,a]=M.useState(i.state),[u,d]=MR(s),[c,h]=M.useState(),[m,p]=M.useState({isTransitioning:!1}),[y,v]=M.useState(),[E,S]=M.useState(),[A,L]=M.useState(),R=M.useRef(new Map),D=M.useCallback((_,{deletedFetchers:F,newErrors:O,flushSync:W,viewTransitionOpts:z})=>{O&&t&&Object.values(O).forEach(ae=>{var ce;return t(ae,{location:_.location,params:((ce=_.matches[0])==null?void 0:ce.params)??{},unstable_pattern:zo(_.matches)})}),_.fetchers.forEach((ae,ce)=>{ae.data!==void 0&&R.current.set(ce,ae.data)}),F.forEach(ae=>R.current.delete(ae)),Ey(W===!1||e!=null,'You provided the `flushSync` option to a router update, but you are not using the `<RouterProvider>` from `react-router/dom` so `ReactDOM.flushSync()` is unavailable.  Please update your app to `import { RouterProvider } from "react-router/dom"` and ensure you have `react-dom` installed as a dependency to use the `flushSync` option.');let re=i.window!=null&&i.window.document!=null&&typeof i.window.document.startViewTransition=="function";if(Ey(z==null||re,"You provided the `viewTransition` option to a router update, but you do not appear to be running in a DOM environment as `window.startViewTransition` is not available."),!z||!re){e&&W?e(()=>a(_)):n===!1?a(_):M.startTransition(()=>{n===!0&&d(ae=>Ty(ae,_)),a(_)});return}if(e&&W){e(()=>{E&&(y==null||y.resolve(),E.skipTransition()),p({isTransitioning:!0,flushSync:!0,currentLocation:z.currentLocation,nextLocation:z.nextLocation})});let ae=i.window.document.startViewTransition(()=>{e(()=>a(_))});ae.finished.finally(()=>{e(()=>{v(void 0),S(void 0),h(void 0),p({isTransitioning:!1})})}),e(()=>S(ae));return}E?(y==null||y.resolve(),E.skipTransition(),L({state:_,currentLocation:z.currentLocation,nextLocation:z.nextLocation})):(h(_),p({isTransitioning:!0,flushSync:!1,currentLocation:z.currentLocation,nextLocation:z.nextLocation}))},[i.window,e,E,y,n,d,t]);M.useLayoutEffect(()=>i.subscribe(D),[i,D]),M.useEffect(()=>{m.isTransitioning&&!m.flushSync&&v(new FR)},[m]),M.useEffect(()=>{if(y&&c&&i.window){let _=c,F=y.promise,O=i.window.document.startViewTransition(async()=>{n===!1?a(_):M.startTransition(()=>{n===!0&&d(W=>Ty(W,_)),a(_)}),await F});O.finished.finally(()=>{v(void 0),S(void 0),h(void 0),p({isTransitioning:!1})}),S(O)}},[c,y,i.window,n,d]),M.useEffect(()=>{y&&c&&u.location.key===c.location.key&&y.resolve()},[y,E,u.location,c]),M.useEffect(()=>{!m.isTransitioning&&A&&(h(A.state),p({isTransitioning:!0,flushSync:!1,currentLocation:A.currentLocation,nextLocation:A.nextLocation}),L(void 0))},[m.isTransitioning,A]);let k=M.useMemo(()=>({createHref:i.createHref,encodeLocation:i.encodeLocation,go:_=>i.navigate(_),push:(_,F,O)=>i.navigate(_,{state:F,preventScrollReset:O==null?void 0:O.preventScrollReset}),replace:(_,F,O)=>i.navigate(_,{replace:!0,state:F,preventScrollReset:O==null?void 0:O.preventScrollReset})}),[i]),U=i.basename||"/",C=M.useMemo(()=>({router:i,navigator:k,static:!1,basename:U,onError:t}),[i,k,U,t]);return M.createElement(M.Fragment,null,M.createElement(Ts.Provider,{value:C},M.createElement(Ko.Provider,{value:u},M.createElement(wE.Provider,{value:R.current},M.createElement(lm.Provider,{value:m},M.createElement(VR,{basename:U,location:u.location,navigationType:u.historyAction,navigator:k,unstable_useTransitions:n},M.createElement(UR,{routes:i.routes,future:i.future,state:u,onError:t})))))),null)}function Ty(i,e){return{...i,navigation:e.navigation.state!=="idle"?e.navigation:i.navigation,revalidation:e.revalidation!=="idle"?e.revalidation:i.revalidation,actionData:e.navigation.state!=="submitting"?e.actionData:i.actionData,fetchers:e.fetchers}}var UR=M.memo($R);function $R({routes:i,future:e,state:t,onError:n}){return ER(i,void 0,t,n,e)}function jR(i){return xR(i.context)}function VR({basename:i="/",children:e=null,location:t,navigationType:n="POP",navigator:r,static:s=!1,unstable_useTransitions:a}){Ke(!Wo(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let u=i.replace(/^\/*/,"/"),d=M.useMemo(()=>({basename:u,navigator:r,static:s,unstable_useTransitions:a,future:{}}),[u,r,s,a]);typeof t=="string"&&(t=jr(t));let{pathname:c="/",search:h="",hash:m="",state:p=null,key:y="default"}=t,v=M.useMemo(()=>{let E=Xn(c,u);return E==null?null:{location:{pathname:E,search:h,hash:m,state:p,key:y},navigationType:n}},[u,c,h,m,p,y,n]);return bt(v!=null,`<Router basename="${u}"> is not able to match the URL "${c}${h}${m}" because it does not start with the basename, so the <Router> won't render anything.`),v==null?null:M.createElement(Zn.Provider,{value:d},M.createElement(mc.Provider,{children:e,value:v}))}var Du="get",ku="application/x-www-form-urlencoded";function pc(i){return typeof HTMLElement<"u"&&i instanceof HTMLElement}function GR(i){return pc(i)&&i.tagName.toLowerCase()==="button"}function HR(i){return pc(i)&&i.tagName.toLowerCase()==="form"}function zR(i){return pc(i)&&i.tagName.toLowerCase()==="input"}function KR(i){return!!(i.metaKey||i.altKey||i.ctrlKey||i.shiftKey)}function WR(i,e){return i.button===0&&(!e||e==="_self")&&!KR(i)}function lf(i=""){return new URLSearchParams(typeof i=="string"||Array.isArray(i)||i instanceof URLSearchParams?i:Object.keys(i).reduce((e,t)=>{let n=i[t];return e.concat(Array.isArray(n)?n.map(r=>[t,r]):[[t,n]])},[]))}function YR(i,e){let t=lf(i);return e&&e.forEach((n,r)=>{t.has(r)||e.getAll(r).forEach(s=>{t.append(r,s)})}),t}var ou=null;function qR(){if(ou===null)try{new FormData(document.createElement("form"),0),ou=!1}catch{ou=!0}return ou}var XR=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function hh(i){return i!=null&&!XR.has(i)?(bt(!1,`"${i}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${ku}"`),null):i}function QR(i,e){let t,n,r,s,a;if(HR(i)){let u=i.getAttribute("action");n=u?Xn(u,e):null,t=i.getAttribute("method")||Du,r=hh(i.getAttribute("enctype"))||ku,s=new FormData(i)}else if(GR(i)||zR(i)&&(i.type==="submit"||i.type==="image")){let u=i.form;if(u==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let d=i.getAttribute("formaction")||u.getAttribute("action");if(n=d?Xn(d,e):null,t=i.getAttribute("formmethod")||u.getAttribute("method")||Du,r=hh(i.getAttribute("formenctype"))||hh(u.getAttribute("enctype"))||ku,s=new FormData(u,i),!qR()){let{name:c,type:h,value:m}=i;if(h==="image"){let p=c?`${c}.`:"";s.append(`${p}x`,"0"),s.append(`${p}y`,"0")}else c&&s.append(c,m)}}else{if(pc(i))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');t=Du,n=null,r=ku,a=i}return s&&r==="text/plain"&&(a=s,s=void 0),{action:n,method:t.toLowerCase(),encType:r,formData:s,body:a}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function hm(i,e){if(i===!1||i===null||typeof i>"u")throw new Error(e)}function ZR(i,e,t,n){let r=typeof i=="string"?new URL(i,typeof window>"u"?"server://singlefetch/":window.location.origin):i;return t?r.pathname.endsWith("/")?r.pathname=`${r.pathname}_.${n}`:r.pathname=`${r.pathname}.${n}`:r.pathname==="/"?r.pathname=`_root.${n}`:e&&Xn(r.pathname,e)==="/"?r.pathname=`${e.replace(/\/$/,"")}/_root.${n}`:r.pathname=`${r.pathname.replace(/\/$/,"")}.${n}`,r}async function JR(i,e){if(i.id in e)return e[i.id];try{let t=await import(i.module);return e[i.id]=t,t}catch(t){return console.error(`Error loading route module \`${i.module}\`, reloading page...`),console.error(t),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function eb(i){return i==null?!1:i.href==null?i.rel==="preload"&&typeof i.imageSrcSet=="string"&&typeof i.imageSizes=="string":typeof i.rel=="string"&&typeof i.href=="string"}async function tb(i,e,t){let n=await Promise.all(i.map(async r=>{let s=e.routes[r.route.id];if(s){let a=await JR(s,t);return a.links?a.links():[]}return[]}));return sb(n.flat(1).filter(eb).filter(r=>r.rel==="stylesheet"||r.rel==="preload").map(r=>r.rel==="stylesheet"?{...r,rel:"prefetch",as:"style"}:{...r,rel:"prefetch"}))}function Ay(i,e,t,n,r,s){let a=(d,c)=>t[c]?d.route.id!==t[c].route.id:!0,u=(d,c)=>{var h;return t[c].pathname!==d.pathname||((h=t[c].route.path)==null?void 0:h.endsWith("*"))&&t[c].params["*"]!==d.params["*"]};return s==="assets"?e.filter((d,c)=>a(d,c)||u(d,c)):s==="data"?e.filter((d,c)=>{var m;let h=n.routes[d.route.id];if(!h||!h.hasLoader)return!1;if(a(d,c)||u(d,c))return!0;if(d.route.shouldRevalidate){let p=d.route.shouldRevalidate({currentUrl:new URL(r.pathname+r.search+r.hash,window.origin),currentParams:((m=t[0])==null?void 0:m.params)||{},nextUrl:new URL(i,window.origin),nextParams:d.params,defaultShouldRevalidate:!0});if(typeof p=="boolean")return p}return!0}):[]}function nb(i,e,{includeHydrateFallback:t}={}){return ib(i.map(n=>{let r=e.routes[n.route.id];if(!r)return[];let s=[r.module];return r.clientActionModule&&(s=s.concat(r.clientActionModule)),r.clientLoaderModule&&(s=s.concat(r.clientLoaderModule)),t&&r.hydrateFallbackModule&&(s=s.concat(r.hydrateFallbackModule)),r.imports&&(s=s.concat(r.imports)),s}).flat(1))}function ib(i){return[...new Set(i)]}function rb(i){let e={},t=Object.keys(i).sort();for(let n of t)e[n]=i[n];return e}function sb(i,e){let t=new Set;return new Set(e),i.reduce((n,r)=>{let s=JSON.stringify(rb(r));return t.has(s)||(t.add(s),n.push({key:s,link:r})),n},[])}function kE(){let i=M.useContext(Ts);return hm(i,"You must render this element inside a <DataRouterContext.Provider> element"),i}function ab(){let i=M.useContext(Ko);return hm(i,"You must render this element inside a <DataRouterStateContext.Provider> element"),i}var fm=M.createContext(void 0);fm.displayName="FrameworkContext";function PE(){let i=M.useContext(fm);return hm(i,"You must render this element inside a <HydratedRouter> element"),i}function ob(i,e){let t=M.useContext(fm),[n,r]=M.useState(!1),[s,a]=M.useState(!1),{onFocus:u,onBlur:d,onMouseEnter:c,onMouseLeave:h,onTouchStart:m}=e,p=M.useRef(null);M.useEffect(()=>{if(i==="render"&&a(!0),i==="viewport"){let E=A=>{A.forEach(L=>{a(L.isIntersecting)})},S=new IntersectionObserver(E,{threshold:.5});return p.current&&S.observe(p.current),()=>{S.disconnect()}}},[i]),M.useEffect(()=>{if(n){let E=setTimeout(()=>{a(!0)},100);return()=>{clearTimeout(E)}}},[n]);let y=()=>{r(!0)},v=()=>{r(!1),a(!1)};return t?i!=="intent"?[s,p,{}]:[s,p,{onFocus:co(u,y),onBlur:co(d,v),onMouseEnter:co(c,y),onMouseLeave:co(h,v),onTouchStart:co(m,y)}]:[!1,p,{}]}function co(i,e){return t=>{i&&i(t),t.defaultPrevented||e(t)}}function lb({page:i,...e}){let{router:t}=kE(),n=M.useMemo(()=>_r(t.routes,i,t.basename),[t.routes,i,t.basename]);return n?M.createElement(cb,{page:i,matches:n,...e}):null}function ub(i){let{manifest:e,routeModules:t}=PE(),[n,r]=M.useState([]);return M.useEffect(()=>{let s=!1;return tb(i,e,t).then(a=>{s||r(a)}),()=>{s=!0}},[i,e,t]),n}function cb({page:i,matches:e,...t}){let n=Vr(),{future:r,manifest:s,routeModules:a}=PE(),{basename:u}=kE(),{loaderData:d,matches:c}=ab(),h=M.useMemo(()=>Ay(i,e,c,s,n,"data"),[i,e,c,s,n]),m=M.useMemo(()=>Ay(i,e,c,s,n,"assets"),[i,e,c,s,n]),p=M.useMemo(()=>{if(i===n.pathname+n.search+n.hash)return[];let E=new Set,S=!1;if(e.forEach(L=>{var D;let R=s.routes[L.route.id];!R||!R.hasLoader||(!h.some(k=>k.route.id===L.route.id)&&L.route.id in d&&((D=a[L.route.id])!=null&&D.shouldRevalidate)||R.hasClientLoader?S=!0:E.add(L.route.id))}),E.size===0)return[];let A=ZR(i,u,r.unstable_trailingSlashAwareDataRequests,"data");return S&&E.size>0&&A.searchParams.set("_routes",e.filter(L=>E.has(L.route.id)).map(L=>L.route.id).join(",")),[A.pathname+A.search]},[u,r.unstable_trailingSlashAwareDataRequests,d,n,s,h,e,i,a]),y=M.useMemo(()=>nb(m,s),[m,s]),v=ub(m);return M.createElement(M.Fragment,null,p.map(E=>M.createElement("link",{key:E,rel:"prefetch",as:"fetch",href:E,...t})),y.map(E=>M.createElement("link",{key:E,rel:"modulepreload",href:E,...t})),v.map(({key:E,link:S})=>M.createElement("link",{key:E,nonce:t.nonce,...S,crossOrigin:S.crossOrigin??t.crossOrigin})))}function db(...i){return e=>{i.forEach(t=>{typeof t=="function"?t(e):t!=null&&(t.current=e)})}}var hb=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{hb&&(window.__reactRouterVersion="7.13.0")}catch{}function fb(i,e){return UL({basename:e==null?void 0:e.basename,getContext:e==null?void 0:e.getContext,future:e==null?void 0:e.future,history:tL({window:e==null?void 0:e.window}),hydrationData:mb(),routes:i,mapRouteProperties:NR,hydrationRouteProperties:OR,dataStrategy:e==null?void 0:e.dataStrategy,patchRoutesOnNavigation:e==null?void 0:e.patchRoutesOnNavigation,window:e==null?void 0:e.window,unstable_instrumentations:e==null?void 0:e.unstable_instrumentations}).initialize()}function mb(){let i=window==null?void 0:window.__staticRouterHydrationData;return i&&i.errors&&(i={...i,errors:pb(i.errors)}),i}function pb(i){if(!i)return null;let e=Object.entries(i),t={};for(let[n,r]of e)if(r&&r.__type==="RouteErrorResponse")t[n]=new Ho(r.status,r.statusText,r.data,r.internal===!0);else if(r&&r.__type==="Error"){if(r.__subType){let s=window[r.__subType];if(typeof s=="function")try{let a=new s(r.message);a.stack="",t[n]=a}catch{}}if(t[n]==null){let s=new Error(r.message);s.stack="",t[n]=s}}else t[n]=r;return t}var _E=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,kt=M.forwardRef(function({onClick:e,discover:t="render",prefetch:n="none",relative:r,reloadDocument:s,replace:a,state:u,target:d,to:c,preventScrollReset:h,viewTransition:m,unstable_defaultShouldRevalidate:p,...y},v){let{basename:E,unstable_useTransitions:S}=M.useContext(Zn),A=typeof c=="string"&&_E.test(c),L=dE(c,E);c=L.to;let R=gR(c,{relative:r}),[D,k,U]=ob(n,y),C=xb(c,{replace:a,state:u,target:d,preventScrollReset:h,relative:r,viewTransition:m,unstable_defaultShouldRevalidate:p,unstable_useTransitions:S});function _(O){e&&e(O),O.defaultPrevented||C(O)}let F=M.createElement("a",{...y,...U,href:L.absoluteURL||R,onClick:L.isExternal||s?e:_,ref:db(v,k),target:d,"data-discover":!A&&t==="render"?"true":void 0});return D&&!A?M.createElement(M.Fragment,null,F,M.createElement(lb,{page:R})):F});kt.displayName="Link";var gb=M.forwardRef(function({"aria-current":e="page",caseSensitive:t=!1,className:n="",end:r=!1,style:s,to:a,viewTransition:u,children:d,...c},h){let m=Yo(a,{relative:c.relative}),p=Vr(),y=M.useContext(Ko),{navigator:v,basename:E}=M.useContext(Zn),S=y!=null&&wb(m)&&u===!0,A=v.encodeLocation?v.encodeLocation(m).pathname:m.pathname,L=p.pathname,R=y&&y.navigation&&y.navigation.location?y.navigation.location.pathname:null;t||(L=L.toLowerCase(),R=R?R.toLowerCase():null,A=A.toLowerCase()),R&&E&&(R=Xn(R,E)||R);const D=A!=="/"&&A.endsWith("/")?A.length-1:A.length;let k=L===A||!r&&L.startsWith(A)&&L.charAt(D)==="/",U=R!=null&&(R===A||!r&&R.startsWith(A)&&R.charAt(A.length)==="/"),C={isActive:k,isPending:U,isTransitioning:S},_=k?e:void 0,F;typeof n=="function"?F=n(C):F=[n,k?"active":null,U?"pending":null,S?"transitioning":null].filter(Boolean).join(" ");let O=typeof s=="function"?s(C):s;return M.createElement(kt,{...c,"aria-current":_,className:F,ref:h,style:O,to:a,viewTransition:u},typeof d=="function"?d(C):d)});gb.displayName="NavLink";var yb=M.forwardRef(({discover:i="render",fetcherKey:e,navigate:t,reloadDocument:n,replace:r,state:s,method:a=Du,action:u,onSubmit:d,relative:c,preventScrollReset:h,viewTransition:m,unstable_defaultShouldRevalidate:p,...y},v)=>{let{unstable_useTransitions:E}=M.useContext(Zn),S=Tb(),A=Ab(u,{relative:c}),L=a.toLowerCase()==="get"?"get":"post",R=typeof u=="string"&&_E.test(u),D=k=>{if(d&&d(k),k.defaultPrevented)return;k.preventDefault();let U=k.nativeEvent.submitter,C=(U==null?void 0:U.getAttribute("formmethod"))||a,_=()=>S(U||k.currentTarget,{fetcherKey:e,method:C,navigate:t,replace:r,state:s,relative:c,preventScrollReset:h,viewTransition:m,unstable_defaultShouldRevalidate:p});E&&t!==!1?M.startTransition(()=>_()):_()};return M.createElement("form",{ref:v,method:L,action:A,onSubmit:n?d:D,...y,"data-discover":!R&&i==="render"?"true":void 0})});yb.displayName="Form";function vb(i){return`${i} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function ME(i){let e=M.useContext(Ts);return Ke(e,vb(i)),e}function xb(i,{target:e,replace:t,state:n,preventScrollReset:r,relative:s,viewTransition:a,unstable_defaultShouldRevalidate:u,unstable_useTransitions:d}={}){let c=As(),h=Vr(),m=Yo(i,{relative:s});return M.useCallback(p=>{if(WR(p,e)){p.preventDefault();let y=t!==void 0?t:Ni(h)===Ni(m),v=()=>c(i,{replace:y,state:n,preventScrollReset:r,relative:s,viewTransition:a,unstable_defaultShouldRevalidate:u});d?M.startTransition(()=>v()):v()}},[h,c,m,t,n,e,i,r,s,a,u,d])}function NE(i){bt(typeof URLSearchParams<"u","You cannot use the `useSearchParams` hook in a browser that does not support the URLSearchParams API. If you need to support Internet Explorer 11, we recommend you load a polyfill such as https://github.com/ungap/url-search-params.");let e=M.useRef(lf(i)),t=M.useRef(!1),n=Vr(),r=M.useMemo(()=>YR(n.search,t.current?null:e.current),[n.search]),s=As(),a=M.useCallback((u,d)=>{const c=lf(typeof u=="function"?u(new URLSearchParams(r)):u);t.current=!0,s("?"+c,d)},[s,r]);return[r,a]}var Eb=0,Sb=()=>`__${String(++Eb)}__`;function Tb(){let{router:i}=ME("useSubmit"),{basename:e}=M.useContext(Zn),t=CR(),n=i.fetch,r=i.navigate;return M.useCallback(async(s,a={})=>{let{action:u,method:d,encType:c,formData:h,body:m}=QR(s,e);if(a.navigate===!1){let p=a.fetcherKey||Sb();await n(p,t,a.action||u,{unstable_defaultShouldRevalidate:a.unstable_defaultShouldRevalidate,preventScrollReset:a.preventScrollReset,formData:h,body:m,formMethod:a.method||d,formEncType:a.encType||c,flushSync:a.flushSync})}else await r(a.action||u,{unstable_defaultShouldRevalidate:a.unstable_defaultShouldRevalidate,preventScrollReset:a.preventScrollReset,formData:h,body:m,formMethod:a.method||d,formEncType:a.encType||c,replace:a.replace,state:a.state,fromRouteId:t,flushSync:a.flushSync,viewTransition:a.viewTransition})},[n,r,e,t])}function Ab(i,{relative:e}={}){let{basename:t}=M.useContext(Zn),n=M.useContext(yi);Ke(n,"useFormAction must be used inside a RouteContext");let[r]=n.matches.slice(-1),s={...Yo(i||".",{relative:e})},a=Vr();if(i==null){s.search=a.search;let u=new URLSearchParams(s.search),d=u.getAll("index");if(d.some(h=>h==="")){u.delete("index"),d.filter(m=>m).forEach(m=>u.append("index",m));let h=u.toString();s.search=h?`?${h}`:""}}return(!i||i===".")&&r.route.index&&(s.search=s.search?s.search.replace(/^\?/,"?index&"):"?index"),t!=="/"&&(s.pathname=s.pathname==="/"?t:_i([t,s.pathname])),Ni(s)}function wb(i,{relative:e}={}){let t=M.useContext(lm);Ke(t!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:n}=ME("useViewTransitionState"),r=Yo(i,{relative:e});if(!t.isTransitioning)return!1;let s=Xn(t.currentLocation.pathname,n)||t.currentLocation.pathname,a=Xn(t.nextLocation.pathname,n)||t.nextLocation.pathname;return Wu(r.pathname,a)!=null||Wu(r.pathname,s)!=null}/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lb=i=>i.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Rb=i=>i.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,n)=>n?n.toUpperCase():t.toLowerCase()),wy=i=>{const e=Rb(i);return e.charAt(0).toUpperCase()+e.slice(1)},OE=(...i)=>i.filter((e,t,n)=>!!e&&e.trim()!==""&&n.indexOf(e)===t).join(" ").trim();/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var bb={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ib=M.forwardRef(({color:i="currentColor",size:e=24,strokeWidth:t=2,absoluteStrokeWidth:n,className:r="",children:s,iconNode:a,...u},d)=>M.createElement("svg",{ref:d,...bb,width:e,height:e,stroke:i,strokeWidth:n?Number(t)*24/Number(e):t,className:OE("lucide",r),...u},[...a.map(([c,h])=>M.createElement(c,h)),...Array.isArray(s)?s:[s]]));/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const st=(i,e)=>{const t=M.forwardRef(({className:n,...r},s)=>M.createElement(Ib,{ref:s,iconNode:e,className:OE(`lucide-${Lb(wy(i))}`,`lucide-${i}`,n),...r}));return t.displayName=wy(i),t};/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cb=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],FE=st("arrow-left",Cb);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Db=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],kb=st("calendar",Db);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pb=[["rect",{width:"18",height:"14",x:"3",y:"5",rx:"2",ry:"2",key:"12ruh7"}],["path",{d:"M7 15h4M15 15h2M7 11h2M13 11h4",key:"1ueiar"}]],_b=st("captions",Pb);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mb=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],mm=st("check",Mb);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nb=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],Ob=st("chevron-left",Nb);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fb=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],Bb=st("chevron-right",Fb);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ub=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]],uf=st("clock",Ub);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $b=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M7 3v18",key:"bbkbws"}],["path",{d:"M3 7.5h4",key:"zfgn84"}],["path",{d:"M3 12h18",key:"1i2n21"}],["path",{d:"M3 16.5h4",key:"1230mu"}],["path",{d:"M17 3v18",key:"in4fa5"}],["path",{d:"M17 7.5h4",key:"myr1c1"}],["path",{d:"M17 16.5h4",key:"go4c1d"}]],cf=st("film",$b);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jb=[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]],BE=st("house",jb);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vb=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],UE=st("info",Vb);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gb=[["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 18h.01",key:"1tta3j"}],["path",{d:"M3 6h.01",key:"1rqtza"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 18h13",key:"1lx6n3"}],["path",{d:"M8 6h13",key:"ik3vkj"}]],df=st("list",Gb);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hb=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],zb=st("lock",Hb);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kb=[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]],Wb=st("log-out",Kb);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yb=[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]],qb=st("mail",Yb);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xb=[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]],Qb=st("maximize",Xb);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zb=[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]],Jb=st("pause",Zb);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eI=[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]],Es=st("play",eI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tI=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],pm=st("plus",tI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nI=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]],Do=st("search",nI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iI=[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],rI=st("settings",iI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sI=[["polygon",{points:"5 4 15 12 5 20 5 4",key:"16p6eg"}],["line",{x1:"19",x2:"19",y1:"5",y2:"19",key:"futhcm"}]],aI=st("skip-forward",sI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oI=[["line",{x1:"21",x2:"14",y1:"4",y2:"4",key:"obuewd"}],["line",{x1:"10",x2:"3",y1:"4",y2:"4",key:"1q6298"}],["line",{x1:"21",x2:"12",y1:"12",y2:"12",key:"1iu8h1"}],["line",{x1:"8",x2:"3",y1:"12",y2:"12",key:"ntss68"}],["line",{x1:"21",x2:"16",y1:"20",y2:"20",key:"14d8ph"}],["line",{x1:"12",x2:"3",y1:"20",y2:"20",key:"m0wm8r"}],["line",{x1:"14",x2:"14",y1:"2",y2:"6",key:"14e1ph"}],["line",{x1:"8",x2:"8",y1:"10",y2:"14",key:"1i6ji0"}],["line",{x1:"16",x2:"16",y1:"18",y2:"22",key:"1lctlv"}]],lI=st("sliders-horizontal",oI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uI=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],$E=st("star",uI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cI=[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]],fh=st("trash-2",cI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dI=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],jE=st("user",dI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hI=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]],fI=st("volume-2",hI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mI=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]],pI=st("volume-x",mI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gI=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],yI=st("x",gI),lu="ott_auth_user",mh="ott_watchlist",uu="ott_history",ko={getCurrentUser(){const i=localStorage.getItem(lu);if(!i)return null;try{return JSON.parse(i)}catch{return null}},login(i,e){if(!i||!e)return{success:!1,error:"Email v mt khu khng c  trng"};const t={id:`user_${Date.now()}`,email:i,name:i.split("@")[0],avatar:`https://ui-avatars.com/api/?name=${encodeURIComponent(i)}&background=random`,createdAt:new Date().toISOString()};return localStorage.setItem(lu,JSON.stringify(t)),{success:!0,user:t}},register(i,e,t){if(!i||!e||!t)return{success:!1,error:"Vui lng in y  thng tin"};const n={id:`user_${Date.now()}`,email:i,name:t,avatar:`https://ui-avatars.com/api/?name=${encodeURIComponent(t)}&background=random`,createdAt:new Date().toISOString()};return localStorage.setItem(lu,JSON.stringify(n)),{success:!0,user:n}},logout(){localStorage.removeItem(lu)},isAuthenticated(){return this.getCurrentUser()!==null}},mi={getWatchlist(){const i=localStorage.getItem(mh);if(!i)return[];try{return JSON.parse(i)}catch{return[]}},addToWatchlist(i){const e=this.getWatchlist();e.some(n=>n.movieId===i)||(e.push({movieId:i,addedAt:new Date().toISOString()}),localStorage.setItem(mh,JSON.stringify(e)))},removeFromWatchlist(i){const t=this.getWatchlist().filter(n=>n.movieId!==i);localStorage.setItem(mh,JSON.stringify(t))},isInWatchlist(i){return this.getWatchlist().some(t=>t.movieId===i)}},Pu={getHistory(){const i=localStorage.getItem(uu);if(!i)return[];try{return JSON.parse(i)}catch{return[]}},addToHistory(i,e,t){const n=this.getHistory(),r=n.findIndex(s=>s.movieId===i);r>=0?n[r]={movieId:i,watchedAt:new Date().toISOString(),progress:e,episodeNumber:t}:n.unshift({movieId:i,watchedAt:new Date().toISOString(),progress:e,episodeNumber:t}),n.length>50&&n.splice(50),localStorage.setItem(uu,JSON.stringify(n))},getProgress(i){return this.getHistory().find(t=>t.movieId===i)},removeFromHistory(i){const t=this.getHistory().filter(n=>n.movieId!==i);localStorage.setItem(uu,JSON.stringify(t))},clearHistory(){localStorage.removeItem(uu)}};function vI(){const i=As(),[e,t]=M.useState(""),n=ko.getCurrentUser(),r=a=>{a.preventDefault(),e.trim()&&(i(`/search?q=${encodeURIComponent(e.trim())}`),t(""))},s=()=>{ko.logout(),i("/login")};return b.jsx("nav",{className:"fixed top-0 left-0 right-0 z-50 bg-black/95 backdrop-blur-sm border-b border-white/10",children:b.jsxs("div",{className:"max-w-[1920px] mx-auto px-4 sm:px-6 lg:px-8",children:[b.jsxs("div",{className:"flex items-center justify-between h-16",children:[b.jsxs(kt,{to:"/",className:"flex items-center gap-2 group",children:[b.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-red-600 to-red-800 rounded-lg flex items-center justify-center transform group-hover:scale-110 transition-transform",children:b.jsx(cf,{className:"w-6 h-6 text-white"})}),b.jsx("span",{className:"text-xl font-bold bg-gradient-to-r from-white to-gray-300 bg-clip-text text-transparent",children:"VieStream"})]}),b.jsxs("div",{className:"hidden md:flex items-center gap-8",children:[b.jsxs(kt,{to:"/",className:"flex items-center gap-2 text-sm text-gray-300 hover:text-white transition-colors",children:[b.jsx(BE,{className:"w-4 h-4"}),"Trang ch"]}),b.jsxs(kt,{to:"/search",className:"flex items-center gap-2 text-sm text-gray-300 hover:text-white transition-colors",children:[b.jsx(cf,{className:"w-4 h-4"}),"Phim"]})]}),b.jsx("form",{onSubmit:r,className:"hidden sm:block flex-1 max-w-md mx-8",children:b.jsxs("div",{className:"relative",children:[b.jsx("input",{type:"text",value:e,onChange:a=>t(a.target.value),placeholder:"Tm kim phim...",className:"w-full bg-white/10 border border-white/20 rounded-lg px-4 py-2 pl-10 text-sm text-white placeholder-gray-400 focus:outline-none focus:border-red-500 focus:bg-white/15 transition-all"}),b.jsx(Do,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"})]})}),b.jsx("div",{className:"flex items-center gap-4",children:n?b.jsxs(b.Fragment,{children:[b.jsxs(kt,{to:"/profile",className:"hidden sm:flex items-center gap-2 text-sm text-gray-300 hover:text-white transition-colors",children:[b.jsx(df,{className:"w-4 h-4"}),"Danh sch"]}),b.jsxs("div",{className:"flex items-center gap-3",children:[b.jsxs(kt,{to:"/profile",className:"flex items-center gap-2 px-3 py-1.5 rounded-lg hover:bg-white/10 transition-colors",children:[b.jsx("img",{src:n.avatar,alt:n.name,className:"w-8 h-8 rounded-full border border-white/20"}),b.jsx("span",{className:"hidden md:block text-sm text-white",children:n.name})]}),b.jsx("button",{onClick:s,className:"p-2 hover:bg-white/10 rounded-lg transition-colors",title:"ng xut",children:b.jsx(Wb,{className:"w-4 h-4 text-gray-300"})})]})]}):b.jsxs(kt,{to:"/login",className:"flex items-center gap-2 px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg text-sm font-medium transition-colors",children:[b.jsx(jE,{className:"w-4 h-4"}),"ng nhp"]})})]}),b.jsx("form",{onSubmit:r,className:"sm:hidden pb-3",children:b.jsxs("div",{className:"relative",children:[b.jsx("input",{type:"text",value:e,onChange:a=>t(a.target.value),placeholder:"Tm kim phim...",className:"w-full bg-white/10 border border-white/20 rounded-lg px-4 py-2 pl-10 text-sm text-white placeholder-gray-400 focus:outline-none focus:border-red-500 focus:bg-white/15 transition-all"}),b.jsx(Do,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"})]})})]})})}function xI(){return b.jsxs("div",{className:"min-h-screen bg-[#0a0a0a] text-white",children:[b.jsx(vI,{}),b.jsx("main",{className:"pt-16",children:b.jsx(jR,{})})]})}const gm=M.createContext({});function ym(i){const e=M.useRef(null);return e.current===null&&(e.current=i()),e.current}const VE=typeof window<"u",GE=VE?M.useLayoutEffect:M.useEffect,gc=M.createContext(null);function vm(i,e){i.indexOf(e)===-1&&i.push(e)}function Yu(i,e){const t=i.indexOf(e);t>-1&&i.splice(t,1)}const Oi=(i,e,t)=>t>e?e:t<i?i:t;let xm=()=>{};const nr={},HE=i=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(i);function zE(i){return typeof i=="object"&&i!==null}const KE=i=>/^0[^.\s]+$/u.test(i);function WE(i){let e;return()=>(e===void 0&&(e=i()),e)}const qn=i=>i,EI=(i,e)=>t=>e(i(t)),qo=(...i)=>i.reduce(EI),Po=(i,e,t)=>{const n=e-i;return n===0?1:(t-i)/n};class Em{constructor(){this.subscriptions=[]}add(e){return vm(this.subscriptions,e),()=>Yu(this.subscriptions,e)}notify(e,t,n){const r=this.subscriptions.length;if(r)if(r===1)this.subscriptions[0](e,t,n);else for(let s=0;s<r;s++){const a=this.subscriptions[s];a&&a(e,t,n)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const pi=i=>i*1e3,Yn=i=>i/1e3;function YE(i,e){return e?i*(1e3/e):0}const qE=(i,e,t)=>(((1-3*t+3*e)*i+(3*t-6*e))*i+3*e)*i,SI=1e-7,TI=12;function AI(i,e,t,n,r){let s,a,u=0;do a=e+(t-e)/2,s=qE(a,n,r)-i,s>0?t=a:e=a;while(Math.abs(s)>SI&&++u<TI);return a}function Xo(i,e,t,n){if(i===e&&t===n)return qn;const r=s=>AI(s,0,1,i,t);return s=>s===0||s===1?s:qE(r(s),e,n)}const XE=i=>e=>e<=.5?i(2*e)/2:(2-i(2*(1-e)))/2,QE=i=>e=>1-i(1-e),ZE=Xo(.33,1.53,.69,.99),Sm=QE(ZE),JE=XE(Sm),eS=i=>(i*=2)<1?.5*Sm(i):.5*(2-Math.pow(2,-10*(i-1))),Tm=i=>1-Math.sin(Math.acos(i)),tS=QE(Tm),nS=XE(Tm),wI=Xo(.42,0,1,1),LI=Xo(0,0,.58,1),iS=Xo(.42,0,.58,1),RI=i=>Array.isArray(i)&&typeof i[0]!="number",rS=i=>Array.isArray(i)&&typeof i[0]=="number",bI={linear:qn,easeIn:wI,easeInOut:iS,easeOut:LI,circIn:Tm,circInOut:nS,circOut:tS,backIn:Sm,backInOut:JE,backOut:ZE,anticipate:eS},II=i=>typeof i=="string",Ly=i=>{if(rS(i)){xm(i.length===4);const[e,t,n,r]=i;return Xo(e,t,n,r)}else if(II(i))return bI[i];return i},cu=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function CI(i,e){let t=new Set,n=new Set,r=!1,s=!1;const a=new WeakSet;let u={delta:0,timestamp:0,isProcessing:!1};function d(h){a.has(h)&&(c.schedule(h),i()),h(u)}const c={schedule:(h,m=!1,p=!1)=>{const v=p&&r?t:n;return m&&a.add(h),v.has(h)||v.add(h),h},cancel:h=>{n.delete(h),a.delete(h)},process:h=>{if(u=h,r){s=!0;return}r=!0,[t,n]=[n,t],t.forEach(d),t.clear(),r=!1,s&&(s=!1,c.process(h))}};return c}const DI=40;function sS(i,e){let t=!1,n=!0;const r={delta:0,timestamp:0,isProcessing:!1},s=()=>t=!0,a=cu.reduce((R,D)=>(R[D]=CI(s),R),{}),{setup:u,read:d,resolveKeyframes:c,preUpdate:h,update:m,preRender:p,render:y,postRender:v}=a,E=()=>{const R=nr.useManualTiming?r.timestamp:performance.now();t=!1,nr.useManualTiming||(r.delta=n?1e3/60:Math.max(Math.min(R-r.timestamp,DI),1)),r.timestamp=R,r.isProcessing=!0,u.process(r),d.process(r),c.process(r),h.process(r),m.process(r),p.process(r),y.process(r),v.process(r),r.isProcessing=!1,t&&e&&(n=!1,i(E))},S=()=>{t=!0,n=!0,r.isProcessing||i(E)};return{schedule:cu.reduce((R,D)=>{const k=a[D];return R[D]=(U,C=!1,_=!1)=>(t||S(),k.schedule(U,C,_)),R},{}),cancel:R=>{for(let D=0;D<cu.length;D++)a[cu[D]].cancel(R)},state:r,steps:a}}const{schedule:ut,cancel:Br,state:Wt,steps:ph}=sS(typeof requestAnimationFrame<"u"?requestAnimationFrame:qn,!0);let _u;function kI(){_u=void 0}const hn={now:()=>(_u===void 0&&hn.set(Wt.isProcessing||nr.useManualTiming?Wt.timestamp:performance.now()),_u),set:i=>{_u=i,queueMicrotask(kI)}},aS=i=>e=>typeof e=="string"&&e.startsWith(i),oS=aS("--"),PI=aS("var(--"),Am=i=>PI(i)?_I.test(i.split("/*")[0].trim()):!1,_I=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu;function Ry(i){return typeof i!="string"?!1:i.split("/*")[0].includes("var(--")}const xa={test:i=>typeof i=="number",parse:parseFloat,transform:i=>i},_o={...xa,transform:i=>Oi(0,1,i)},du={...xa,default:1},Eo=i=>Math.round(i*1e5)/1e5,wm=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function MI(i){return i==null}const NI=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,Lm=(i,e)=>t=>!!(typeof t=="string"&&NI.test(t)&&t.startsWith(i)||e&&!MI(t)&&Object.prototype.hasOwnProperty.call(t,e)),lS=(i,e,t)=>n=>{if(typeof n!="string")return n;const[r,s,a,u]=n.match(wm);return{[i]:parseFloat(r),[e]:parseFloat(s),[t]:parseFloat(a),alpha:u!==void 0?parseFloat(u):1}},OI=i=>Oi(0,255,i),gh={...xa,transform:i=>Math.round(OI(i))},gs={test:Lm("rgb","red"),parse:lS("red","green","blue"),transform:({red:i,green:e,blue:t,alpha:n=1})=>"rgba("+gh.transform(i)+", "+gh.transform(e)+", "+gh.transform(t)+", "+Eo(_o.transform(n))+")"};function FI(i){let e="",t="",n="",r="";return i.length>5?(e=i.substring(1,3),t=i.substring(3,5),n=i.substring(5,7),r=i.substring(7,9)):(e=i.substring(1,2),t=i.substring(2,3),n=i.substring(3,4),r=i.substring(4,5),e+=e,t+=t,n+=n,r+=r),{red:parseInt(e,16),green:parseInt(t,16),blue:parseInt(n,16),alpha:r?parseInt(r,16)/255:1}}const hf={test:Lm("#"),parse:FI,transform:gs.transform},Qo=i=>({test:e=>typeof e=="string"&&e.endsWith(i)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${i}`}),Cr=Qo("deg"),Mi=Qo("%"),we=Qo("px"),BI=Qo("vh"),UI=Qo("vw"),by={...Mi,parse:i=>Mi.parse(i)/100,transform:i=>Mi.transform(i*100)},ra={test:Lm("hsl","hue"),parse:lS("hue","saturation","lightness"),transform:({hue:i,saturation:e,lightness:t,alpha:n=1})=>"hsla("+Math.round(i)+", "+Mi.transform(Eo(e))+", "+Mi.transform(Eo(t))+", "+Eo(_o.transform(n))+")"},Dt={test:i=>gs.test(i)||hf.test(i)||ra.test(i),parse:i=>gs.test(i)?gs.parse(i):ra.test(i)?ra.parse(i):hf.parse(i),transform:i=>typeof i=="string"?i:i.hasOwnProperty("red")?gs.transform(i):ra.transform(i),getAnimatableNone:i=>{const e=Dt.parse(i);return e.alpha=0,Dt.transform(e)}},$I=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function jI(i){var e,t;return isNaN(i)&&typeof i=="string"&&(((e=i.match(wm))==null?void 0:e.length)||0)+(((t=i.match($I))==null?void 0:t.length)||0)>0}const uS="number",cS="color",VI="var",GI="var(",Iy="${}",HI=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function Mo(i){const e=i.toString(),t=[],n={color:[],number:[],var:[]},r=[];let s=0;const u=e.replace(HI,d=>(Dt.test(d)?(n.color.push(s),r.push(cS),t.push(Dt.parse(d))):d.startsWith(GI)?(n.var.push(s),r.push(VI),t.push(d)):(n.number.push(s),r.push(uS),t.push(parseFloat(d))),++s,Iy)).split(Iy);return{values:t,split:u,indexes:n,types:r}}function dS(i){return Mo(i).values}function hS(i){const{split:e,types:t}=Mo(i),n=e.length;return r=>{let s="";for(let a=0;a<n;a++)if(s+=e[a],r[a]!==void 0){const u=t[a];u===uS?s+=Eo(r[a]):u===cS?s+=Dt.transform(r[a]):s+=r[a]}return s}}const zI=i=>typeof i=="number"?0:Dt.test(i)?Dt.getAnimatableNone(i):i;function KI(i){const e=dS(i);return hS(i)(e.map(zI))}const gi={test:jI,parse:dS,createTransformer:hS,getAnimatableNone:KI};function yh(i,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?i+(e-i)*6*t:t<1/2?e:t<2/3?i+(e-i)*(2/3-t)*6:i}function WI({hue:i,saturation:e,lightness:t,alpha:n}){i/=360,e/=100,t/=100;let r=0,s=0,a=0;if(!e)r=s=a=t;else{const u=t<.5?t*(1+e):t+e-t*e,d=2*t-u;r=yh(d,u,i+1/3),s=yh(d,u,i),a=yh(d,u,i-1/3)}return{red:Math.round(r*255),green:Math.round(s*255),blue:Math.round(a*255),alpha:n}}function qu(i,e){return t=>t>0?e:i}const vt=(i,e,t)=>i+(e-i)*t,vh=(i,e,t)=>{const n=i*i,r=t*(e*e-n)+n;return r<0?0:Math.sqrt(r)},YI=[hf,gs,ra],qI=i=>YI.find(e=>e.test(i));function Cy(i){const e=qI(i);if(!e)return!1;let t=e.parse(i);return e===ra&&(t=WI(t)),t}const Dy=(i,e)=>{const t=Cy(i),n=Cy(e);if(!t||!n)return qu(i,e);const r={...t};return s=>(r.red=vh(t.red,n.red,s),r.green=vh(t.green,n.green,s),r.blue=vh(t.blue,n.blue,s),r.alpha=vt(t.alpha,n.alpha,s),gs.transform(r))},ff=new Set(["none","hidden"]);function XI(i,e){return ff.has(i)?t=>t<=0?i:e:t=>t>=1?e:i}function QI(i,e){return t=>vt(i,e,t)}function Rm(i){return typeof i=="number"?QI:typeof i=="string"?Am(i)?qu:Dt.test(i)?Dy:eC:Array.isArray(i)?fS:typeof i=="object"?Dt.test(i)?Dy:ZI:qu}function fS(i,e){const t=[...i],n=t.length,r=i.map((s,a)=>Rm(s)(s,e[a]));return s=>{for(let a=0;a<n;a++)t[a]=r[a](s);return t}}function ZI(i,e){const t={...i,...e},n={};for(const r in t)i[r]!==void 0&&e[r]!==void 0&&(n[r]=Rm(i[r])(i[r],e[r]));return r=>{for(const s in n)t[s]=n[s](r);return t}}function JI(i,e){const t=[],n={color:0,var:0,number:0};for(let r=0;r<e.values.length;r++){const s=e.types[r],a=i.indexes[s][n[s]],u=i.values[a]??0;t[r]=u,n[s]++}return t}const eC=(i,e)=>{const t=gi.createTransformer(e),n=Mo(i),r=Mo(e);return n.indexes.var.length===r.indexes.var.length&&n.indexes.color.length===r.indexes.color.length&&n.indexes.number.length>=r.indexes.number.length?ff.has(i)&&!r.values.length||ff.has(e)&&!n.values.length?XI(i,e):qo(fS(JI(n,r),r.values),t):qu(i,e)};function mS(i,e,t){return typeof i=="number"&&typeof e=="number"&&typeof t=="number"?vt(i,e,t):Rm(i)(i,e)}const tC=i=>{const e=({timestamp:t})=>i(t);return{start:(t=!0)=>ut.update(e,t),stop:()=>Br(e),now:()=>Wt.isProcessing?Wt.timestamp:hn.now()}},pS=(i,e,t=10)=>{let n="";const r=Math.max(Math.round(e/t),2);for(let s=0;s<r;s++)n+=Math.round(i(s/(r-1))*1e4)/1e4+", ";return`linear(${n.substring(0,n.length-2)})`},Xu=2e4;function bm(i){let e=0;const t=50;let n=i.next(e);for(;!n.done&&e<Xu;)e+=t,n=i.next(e);return e>=Xu?1/0:e}function nC(i,e=100,t){const n=t({...i,keyframes:[0,e]}),r=Math.min(bm(n),Xu);return{type:"keyframes",ease:s=>n.next(r*s).value/e,duration:Yn(r)}}const iC=5;function gS(i,e,t){const n=Math.max(e-iC,0);return YE(t-i(n),e-n)}const Tt={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},xh=.001;function rC({duration:i=Tt.duration,bounce:e=Tt.bounce,velocity:t=Tt.velocity,mass:n=Tt.mass}){let r,s,a=1-e;a=Oi(Tt.minDamping,Tt.maxDamping,a),i=Oi(Tt.minDuration,Tt.maxDuration,Yn(i)),a<1?(r=c=>{const h=c*a,m=h*i,p=h-t,y=mf(c,a),v=Math.exp(-m);return xh-p/y*v},s=c=>{const m=c*a*i,p=m*t+t,y=Math.pow(a,2)*Math.pow(c,2)*i,v=Math.exp(-m),E=mf(Math.pow(c,2),a);return(-r(c)+xh>0?-1:1)*((p-y)*v)/E}):(r=c=>{const h=Math.exp(-c*i),m=(c-t)*i+1;return-xh+h*m},s=c=>{const h=Math.exp(-c*i),m=(t-c)*(i*i);return h*m});const u=5/i,d=aC(r,s,u);if(i=pi(i),isNaN(d))return{stiffness:Tt.stiffness,damping:Tt.damping,duration:i};{const c=Math.pow(d,2)*n;return{stiffness:c,damping:a*2*Math.sqrt(n*c),duration:i}}}const sC=12;function aC(i,e,t){let n=t;for(let r=1;r<sC;r++)n=n-i(n)/e(n);return n}function mf(i,e){return i*Math.sqrt(1-e*e)}const oC=["duration","bounce"],lC=["stiffness","damping","mass"];function ky(i,e){return e.some(t=>i[t]!==void 0)}function uC(i){let e={velocity:Tt.velocity,stiffness:Tt.stiffness,damping:Tt.damping,mass:Tt.mass,isResolvedFromDuration:!1,...i};if(!ky(i,lC)&&ky(i,oC))if(e.velocity=0,i.visualDuration){const t=i.visualDuration,n=2*Math.PI/(t*1.2),r=n*n,s=2*Oi(.05,1,1-(i.bounce||0))*Math.sqrt(r);e={...e,mass:Tt.mass,stiffness:r,damping:s}}else{const t=rC({...i,velocity:0});e={...e,...t,mass:Tt.mass},e.isResolvedFromDuration=!0}return e}function Qu(i=Tt.visualDuration,e=Tt.bounce){const t=typeof i!="object"?{visualDuration:i,keyframes:[0,1],bounce:e}:i;let{restSpeed:n,restDelta:r}=t;const s=t.keyframes[0],a=t.keyframes[t.keyframes.length-1],u={done:!1,value:s},{stiffness:d,damping:c,mass:h,duration:m,velocity:p,isResolvedFromDuration:y}=uC({...t,velocity:-Yn(t.velocity||0)}),v=p||0,E=c/(2*Math.sqrt(d*h)),S=a-s,A=Yn(Math.sqrt(d/h)),L=Math.abs(S)<5;n||(n=L?Tt.restSpeed.granular:Tt.restSpeed.default),r||(r=L?Tt.restDelta.granular:Tt.restDelta.default);let R;if(E<1){const k=mf(A,E);R=U=>{const C=Math.exp(-E*A*U);return a-C*((v+E*A*S)/k*Math.sin(k*U)+S*Math.cos(k*U))}}else if(E===1)R=k=>a-Math.exp(-A*k)*(S+(v+A*S)*k);else{const k=A*Math.sqrt(E*E-1);R=U=>{const C=Math.exp(-E*A*U),_=Math.min(k*U,300);return a-C*((v+E*A*S)*Math.sinh(_)+k*S*Math.cosh(_))/k}}const D={calculatedDuration:y&&m||null,next:k=>{const U=R(k);if(y)u.done=k>=m;else{let C=k===0?v:0;E<1&&(C=k===0?pi(v):gS(R,k,U));const _=Math.abs(C)<=n,F=Math.abs(a-U)<=r;u.done=_&&F}return u.value=u.done?a:U,u},toString:()=>{const k=Math.min(bm(D),Xu),U=pS(C=>D.next(k*C).value,k,30);return k+"ms "+U},toTransition:()=>{}};return D}Qu.applyToOptions=i=>{const e=nC(i,100,Qu);return i.ease=e.ease,i.duration=pi(e.duration),i.type="keyframes",i};function pf({keyframes:i,velocity:e=0,power:t=.8,timeConstant:n=325,bounceDamping:r=10,bounceStiffness:s=500,modifyTarget:a,min:u,max:d,restDelta:c=.5,restSpeed:h}){const m=i[0],p={done:!1,value:m},y=_=>u!==void 0&&_<u||d!==void 0&&_>d,v=_=>u===void 0?d:d===void 0||Math.abs(u-_)<Math.abs(d-_)?u:d;let E=t*e;const S=m+E,A=a===void 0?S:a(S);A!==S&&(E=A-m);const L=_=>-E*Math.exp(-_/n),R=_=>A+L(_),D=_=>{const F=L(_),O=R(_);p.done=Math.abs(F)<=c,p.value=p.done?A:O};let k,U;const C=_=>{y(p.value)&&(k=_,U=Qu({keyframes:[p.value,v(p.value)],velocity:gS(R,_,p.value),damping:r,stiffness:s,restDelta:c,restSpeed:h}))};return C(0),{calculatedDuration:null,next:_=>{let F=!1;return!U&&k===void 0&&(F=!0,D(_),C(_)),k!==void 0&&_>=k?U.next(_-k):(!F&&D(_),p)}}}function cC(i,e,t){const n=[],r=t||nr.mix||mS,s=i.length-1;for(let a=0;a<s;a++){let u=r(i[a],i[a+1]);if(e){const d=Array.isArray(e)?e[a]||qn:e;u=qo(d,u)}n.push(u)}return n}function dC(i,e,{clamp:t=!0,ease:n,mixer:r}={}){const s=i.length;if(xm(s===e.length),s===1)return()=>e[0];if(s===2&&e[0]===e[1])return()=>e[1];const a=i[0]===i[1];i[0]>i[s-1]&&(i=[...i].reverse(),e=[...e].reverse());const u=cC(e,n,r),d=u.length,c=h=>{if(a&&h<i[0])return e[0];let m=0;if(d>1)for(;m<i.length-2&&!(h<i[m+1]);m++);const p=Po(i[m],i[m+1],h);return u[m](p)};return t?h=>c(Oi(i[0],i[s-1],h)):c}function hC(i,e){const t=i[i.length-1];for(let n=1;n<=e;n++){const r=Po(0,e,n);i.push(vt(t,1,r))}}function fC(i){const e=[0];return hC(e,i.length-1),e}function mC(i,e){return i.map(t=>t*e)}function pC(i,e){return i.map(()=>e||iS).splice(0,i.length-1)}function So({duration:i=300,keyframes:e,times:t,ease:n="easeInOut"}){const r=RI(n)?n.map(Ly):Ly(n),s={done:!1,value:e[0]},a=mC(t&&t.length===e.length?t:fC(e),i),u=dC(a,e,{ease:Array.isArray(r)?r:pC(e,r)});return{calculatedDuration:i,next:d=>(s.value=u(d),s.done=d>=i,s)}}const gC=i=>i!==null;function Im(i,{repeat:e,repeatType:t="loop"},n,r=1){const s=i.filter(gC),u=r<0||e&&t!=="loop"&&e%2===1?0:s.length-1;return!u||n===void 0?s[u]:n}const yC={decay:pf,inertia:pf,tween:So,keyframes:So,spring:Qu};function yS(i){typeof i.type=="string"&&(i.type=yC[i.type])}class Cm{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(e=>{this.resolve=e})}notifyFinished(){this.resolve()}then(e,t){return this.finished.then(e,t)}}const vC=i=>i/100;class Dm extends Cm{constructor(e){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{var n,r;const{motionValue:t}=this.options;t&&t.updatedAt!==hn.now()&&this.tick(hn.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),(r=(n=this.options).onStop)==null||r.call(n))},this.options=e,this.initAnimation(),this.play(),e.autoplay===!1&&this.pause()}initAnimation(){const{options:e}=this;yS(e);const{type:t=So,repeat:n=0,repeatDelay:r=0,repeatType:s,velocity:a=0}=e;let{keyframes:u}=e;const d=t||So;d!==So&&typeof u[0]!="number"&&(this.mixKeyframes=qo(vC,mS(u[0],u[1])),u=[0,100]);const c=d({...e,keyframes:u});s==="mirror"&&(this.mirroredGenerator=d({...e,keyframes:[...u].reverse(),velocity:-a})),c.calculatedDuration===null&&(c.calculatedDuration=bm(c));const{calculatedDuration:h}=c;this.calculatedDuration=h,this.resolvedDuration=h+r,this.totalDuration=this.resolvedDuration*(n+1)-r,this.generator=c}updateTime(e){const t=Math.round(e-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=t}tick(e,t=!1){const{generator:n,totalDuration:r,mixKeyframes:s,mirroredGenerator:a,resolvedDuration:u,calculatedDuration:d}=this;if(this.startTime===null)return n.next(0);const{delay:c=0,keyframes:h,repeat:m,repeatType:p,repeatDelay:y,type:v,onUpdate:E,finalKeyframe:S}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-r/this.speed,this.startTime)),t?this.currentTime=e:this.updateTime(e);const A=this.currentTime-c*(this.playbackSpeed>=0?1:-1),L=this.playbackSpeed>=0?A<0:A>r;this.currentTime=Math.max(A,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=r);let R=this.currentTime,D=n;if(m){const _=Math.min(this.currentTime,r)/u;let F=Math.floor(_),O=_%1;!O&&_>=1&&(O=1),O===1&&F--,F=Math.min(F,m+1),!!(F%2)&&(p==="reverse"?(O=1-O,y&&(O-=y/u)):p==="mirror"&&(D=a)),R=Oi(0,1,O)*u}const k=L?{done:!1,value:h[0]}:D.next(R);s&&(k.value=s(k.value));let{done:U}=k;!L&&d!==null&&(U=this.playbackSpeed>=0?this.currentTime>=r:this.currentTime<=0);const C=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&U);return C&&v!==pf&&(k.value=Im(h,this.options,S,this.speed)),E&&E(k.value),C&&this.finish(),k}then(e,t){return this.finished.then(e,t)}get duration(){return Yn(this.calculatedDuration)}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+Yn(e)}get time(){return Yn(this.currentTime)}set time(e){var t;e=pi(e),this.currentTime=e,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.playbackSpeed),(t=this.driver)==null||t.start(!1)}get speed(){return this.playbackSpeed}set speed(e){this.updateTime(hn.now());const t=this.playbackSpeed!==e;this.playbackSpeed=e,t&&(this.time=Yn(this.currentTime))}play(){var r,s;if(this.isStopped)return;const{driver:e=tC,startTime:t}=this.options;this.driver||(this.driver=e(a=>this.tick(a))),(s=(r=this.options).onPlay)==null||s.call(r);const n=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=n):this.holdTime!==null?this.startTime=n-this.holdTime:this.startTime||(this.startTime=t??n),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(hn.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){var e,t;this.notifyFinished(),this.teardown(),this.state="finished",(t=(e=this.options).onComplete)==null||t.call(e)}cancel(){var e,t;this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),(t=(e=this.options).onCancel)==null||t.call(e)}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}attachTimeline(e){var t;return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),(t=this.driver)==null||t.stop(),e.observe(this)}}function xC(i){for(let e=1;e<i.length;e++)i[e]??(i[e]=i[e-1])}const ys=i=>i*180/Math.PI,gf=i=>{const e=ys(Math.atan2(i[1],i[0]));return yf(e)},EC={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:i=>(Math.abs(i[0])+Math.abs(i[3]))/2,rotate:gf,rotateZ:gf,skewX:i=>ys(Math.atan(i[1])),skewY:i=>ys(Math.atan(i[2])),skew:i=>(Math.abs(i[1])+Math.abs(i[2]))/2},yf=i=>(i=i%360,i<0&&(i+=360),i),Py=gf,_y=i=>Math.sqrt(i[0]*i[0]+i[1]*i[1]),My=i=>Math.sqrt(i[4]*i[4]+i[5]*i[5]),SC={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:_y,scaleY:My,scale:i=>(_y(i)+My(i))/2,rotateX:i=>yf(ys(Math.atan2(i[6],i[5]))),rotateY:i=>yf(ys(Math.atan2(-i[2],i[0]))),rotateZ:Py,rotate:Py,skewX:i=>ys(Math.atan(i[4])),skewY:i=>ys(Math.atan(i[1])),skew:i=>(Math.abs(i[1])+Math.abs(i[4]))/2};function vf(i){return i.includes("scale")?1:0}function xf(i,e){if(!i||i==="none")return vf(e);const t=i.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let n,r;if(t)n=SC,r=t;else{const u=i.match(/^matrix\(([-\d.e\s,]+)\)$/u);n=EC,r=u}if(!r)return vf(e);const s=n[e],a=r[1].split(",").map(AC);return typeof s=="function"?s(a):a[s]}const TC=(i,e)=>{const{transform:t="none"}=getComputedStyle(i);return xf(t,e)};function AC(i){return parseFloat(i.trim())}const Ea=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],Sa=new Set(Ea),Ny=i=>i===xa||i===we,wC=new Set(["x","y","z"]),LC=Ea.filter(i=>!wC.has(i));function RC(i){const e=[];return LC.forEach(t=>{const n=i.getValue(t);n!==void 0&&(e.push([t,n.get()]),n.set(t.startsWith("scale")?1:0))}),e}const Or={width:({x:i},{paddingLeft:e="0",paddingRight:t="0"})=>i.max-i.min-parseFloat(e)-parseFloat(t),height:({y:i},{paddingTop:e="0",paddingBottom:t="0"})=>i.max-i.min-parseFloat(e)-parseFloat(t),top:(i,{top:e})=>parseFloat(e),left:(i,{left:e})=>parseFloat(e),bottom:({y:i},{top:e})=>parseFloat(e)+(i.max-i.min),right:({x:i},{left:e})=>parseFloat(e)+(i.max-i.min),x:(i,{transform:e})=>xf(e,"x"),y:(i,{transform:e})=>xf(e,"y")};Or.translateX=Or.x;Or.translateY=Or.y;const vs=new Set;let Ef=!1,Sf=!1,Tf=!1;function vS(){if(Sf){const i=Array.from(vs).filter(n=>n.needsMeasurement),e=new Set(i.map(n=>n.element)),t=new Map;e.forEach(n=>{const r=RC(n);r.length&&(t.set(n,r),n.render())}),i.forEach(n=>n.measureInitialState()),e.forEach(n=>{n.render();const r=t.get(n);r&&r.forEach(([s,a])=>{var u;(u=n.getValue(s))==null||u.set(a)})}),i.forEach(n=>n.measureEndState()),i.forEach(n=>{n.suspendedScrollY!==void 0&&window.scrollTo(0,n.suspendedScrollY)})}Sf=!1,Ef=!1,vs.forEach(i=>i.complete(Tf)),vs.clear()}function xS(){vs.forEach(i=>{i.readKeyframes(),i.needsMeasurement&&(Sf=!0)})}function bC(){Tf=!0,xS(),vS(),Tf=!1}class km{constructor(e,t,n,r,s,a=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...e],this.onComplete=t,this.name=n,this.motionValue=r,this.element=s,this.isAsync=a}scheduleResolve(){this.state="scheduled",this.isAsync?(vs.add(this),Ef||(Ef=!0,ut.read(xS),ut.resolveKeyframes(vS))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:t,element:n,motionValue:r}=this;if(e[0]===null){const s=r==null?void 0:r.get(),a=e[e.length-1];if(s!==void 0)e[0]=s;else if(n&&t){const u=n.readValue(t,a);u!=null&&(e[0]=u)}e[0]===void 0&&(e[0]=a),r&&s===void 0&&r.set(e[0])}xC(e)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(e=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,e),vs.delete(this)}cancel(){this.state==="scheduled"&&(vs.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const IC=i=>i.startsWith("--");function CC(i,e,t){IC(e)?i.style.setProperty(e,t):i.style[e]=t}const DC={};function ES(i,e){const t=WE(i);return()=>DC[e]??t()}const kC=ES(()=>window.ScrollTimeline!==void 0,"scrollTimeline"),SS=ES(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),yo=([i,e,t,n])=>`cubic-bezier(${i}, ${e}, ${t}, ${n})`,Oy={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:yo([0,.65,.55,1]),circOut:yo([.55,0,1,.45]),backIn:yo([.31,.01,.66,-.59]),backOut:yo([.33,1.53,.69,.99])};function TS(i,e){if(i)return typeof i=="function"?SS()?pS(i,e):"ease-out":rS(i)?yo(i):Array.isArray(i)?i.map(t=>TS(t,e)||Oy.easeOut):Oy[i]}function PC(i,e,t,{delay:n=0,duration:r=300,repeat:s=0,repeatType:a="loop",ease:u="easeOut",times:d}={},c=void 0){const h={[e]:t};d&&(h.offset=d);const m=TS(u,r);Array.isArray(m)&&(h.easing=m);const p={delay:n,duration:r,easing:Array.isArray(m)?"linear":m,fill:"both",iterations:s+1,direction:a==="reverse"?"alternate":"normal"};return c&&(p.pseudoElement=c),i.animate(h,p)}function AS(i){return typeof i=="function"&&"applyToOptions"in i}function _C({type:i,...e}){return AS(i)&&SS()?i.applyToOptions(e):(e.duration??(e.duration=300),e.ease??(e.ease="easeOut"),e)}class wS extends Cm{constructor(e){if(super(),this.finishedTime=null,this.isStopped=!1,this.manualStartTime=null,!e)return;const{element:t,name:n,keyframes:r,pseudoElement:s,allowFlatten:a=!1,finalKeyframe:u,onComplete:d}=e;this.isPseudoElement=!!s,this.allowFlatten=a,this.options=e,xm(typeof e.type!="string");const c=_C(e);this.animation=PC(t,n,r,c,s),c.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!s){const h=Im(r,this.options,u,this.speed);this.updateMotionValue?this.updateMotionValue(h):CC(t,n,h),this.animation.cancel()}d==null||d(),this.notifyFinished()}}play(){this.isStopped||(this.manualStartTime=null,this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){var e,t;(t=(e=this.animation).finish)==null||t.call(e)}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:e}=this;e==="idle"||e==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){var t,n,r;const e=(t=this.options)==null?void 0:t.element;!this.isPseudoElement&&(e!=null&&e.isConnected)&&((r=(n=this.animation).commitStyles)==null||r.call(n))}get duration(){var t,n;const e=((n=(t=this.animation.effect)==null?void 0:t.getComputedTiming)==null?void 0:n.call(t).duration)||0;return Yn(Number(e))}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+Yn(e)}get time(){return Yn(Number(this.animation.currentTime)||0)}set time(e){this.manualStartTime=null,this.finishedTime=null,this.animation.currentTime=pi(e)}get speed(){return this.animation.playbackRate}set speed(e){e<0&&(this.finishedTime=null),this.animation.playbackRate=e}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return this.manualStartTime??Number(this.animation.startTime)}set startTime(e){this.manualStartTime=this.animation.startTime=e}attachTimeline({timeline:e,observe:t}){var n;return this.allowFlatten&&((n=this.animation.effect)==null||n.updateTiming({easing:"linear"})),this.animation.onfinish=null,e&&kC()?(this.animation.timeline=e,qn):t(this)}}const LS={anticipate:eS,backInOut:JE,circInOut:nS};function MC(i){return i in LS}function NC(i){typeof i.ease=="string"&&MC(i.ease)&&(i.ease=LS[i.ease])}const Eh=10;class OC extends wS{constructor(e){NC(e),yS(e),super(e),e.startTime!==void 0&&(this.startTime=e.startTime),this.options=e}updateMotionValue(e){const{motionValue:t,onUpdate:n,onComplete:r,element:s,...a}=this.options;if(!t)return;if(e!==void 0){t.set(e);return}const u=new Dm({...a,autoplay:!1}),d=Math.max(Eh,hn.now()-this.startTime),c=Oi(0,Eh,d-Eh);t.setWithVelocity(u.sample(Math.max(0,d-c)).value,u.sample(d).value,c),u.stop()}}const Fy=(i,e)=>e==="zIndex"?!1:!!(typeof i=="number"||Array.isArray(i)||typeof i=="string"&&(gi.test(i)||i==="0")&&!i.startsWith("url("));function FC(i){const e=i[0];if(i.length===1)return!0;for(let t=0;t<i.length;t++)if(i[t]!==e)return!0}function BC(i,e,t,n){const r=i[0];if(r===null)return!1;if(e==="display"||e==="visibility")return!0;const s=i[i.length-1],a=Fy(r,e),u=Fy(s,e);return!a||!u?!1:FC(i)||(t==="spring"||AS(t))&&n}function Af(i){i.duration=0,i.type="keyframes"}const UC=new Set(["opacity","clipPath","filter","transform"]),$C=WE(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function jC(i){var h;const{motionValue:e,name:t,repeatDelay:n,repeatType:r,damping:s,type:a}=i;if(!(((h=e==null?void 0:e.owner)==null?void 0:h.current)instanceof HTMLElement))return!1;const{onUpdate:d,transformTemplate:c}=e.owner.getProps();return $C()&&t&&UC.has(t)&&(t!=="transform"||!c)&&!d&&!n&&r!=="mirror"&&s!==0&&a!=="inertia"}const VC=40;class GC extends Cm{constructor({autoplay:e=!0,delay:t=0,type:n="keyframes",repeat:r=0,repeatDelay:s=0,repeatType:a="loop",keyframes:u,name:d,motionValue:c,element:h,...m}){var v;super(),this.stop=()=>{var E,S;this._animation&&(this._animation.stop(),(E=this.stopTimeline)==null||E.call(this)),(S=this.keyframeResolver)==null||S.cancel()},this.createdAt=hn.now();const p={autoplay:e,delay:t,type:n,repeat:r,repeatDelay:s,repeatType:a,name:d,motionValue:c,element:h,...m},y=(h==null?void 0:h.KeyframeResolver)||km;this.keyframeResolver=new y(u,(E,S,A)=>this.onKeyframesResolved(E,S,p,!A),d,c,h),(v=this.keyframeResolver)==null||v.scheduleResolve()}onKeyframesResolved(e,t,n,r){var S,A;this.keyframeResolver=void 0;const{name:s,type:a,velocity:u,delay:d,isHandoff:c,onUpdate:h}=n;this.resolvedAt=hn.now(),BC(e,s,a,u)||((nr.instantAnimations||!d)&&(h==null||h(Im(e,n,t))),e[0]=e[e.length-1],Af(n),n.repeat=0);const p={startTime:r?this.resolvedAt?this.resolvedAt-this.createdAt>VC?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:t,...n,keyframes:e},y=!c&&jC(p),v=(A=(S=p.motionValue)==null?void 0:S.owner)==null?void 0:A.current,E=y?new OC({...p,element:v}):new Dm(p);E.finished.then(()=>{this.notifyFinished()}).catch(qn),this.pendingTimeline&&(this.stopTimeline=E.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=E}get finished(){return this._animation?this.animation.finished:this._finished}then(e,t){return this.finished.finally(e).then(()=>{})}get animation(){var e;return this._animation||((e=this.keyframeResolver)==null||e.resume(),bC()),this._animation}get duration(){return this.animation.duration}get iterationDuration(){return this.animation.iterationDuration}get time(){return this.animation.time}set time(e){this.animation.time=e}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(e){this.animation.speed=e}get startTime(){return this.animation.startTime}attachTimeline(e){return this._animation?this.stopTimeline=this.animation.attachTimeline(e):this.pendingTimeline=e,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){var e;this._animation&&this.animation.cancel(),(e=this.keyframeResolver)==null||e.cancel()}}function RS(i,e,t,n=0,r=1){const s=Array.from(i).sort((c,h)=>c.sortNodePosition(h)).indexOf(e),a=i.size,u=(a-1)*n;return typeof t=="function"?t(s,a):r===1?s*n:u-s*n}const HC=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function zC(i){const e=HC.exec(i);if(!e)return[,];const[,t,n,r]=e;return[`--${t??n}`,r]}function bS(i,e,t=1){const[n,r]=zC(i);if(!n)return;const s=window.getComputedStyle(e).getPropertyValue(n);if(s){const a=s.trim();return HE(a)?parseFloat(a):a}return Am(r)?bS(r,e,t+1):r}const KC={type:"spring",stiffness:500,damping:25,restSpeed:10},WC=i=>({type:"spring",stiffness:550,damping:i===0?2*Math.sqrt(550):30,restSpeed:10}),YC={type:"keyframes",duration:.8},qC={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},XC=(i,{keyframes:e})=>e.length>2?YC:Sa.has(i)?i.startsWith("scale")?WC(e[1]):KC:qC,QC=i=>i!==null;function ZC(i,{repeat:e,repeatType:t="loop"},n){const r=i.filter(QC),s=e&&t!=="loop"&&e%2===1?0:r.length-1;return r[s]}function IS(i,e){if(i!=null&&i.inherit&&e){const{inherit:t,...n}=i;return{...e,...n}}return i}function Pm(i,e){const t=(i==null?void 0:i[e])??(i==null?void 0:i.default)??i;return t!==i?IS(t,i):t}function JC({when:i,delay:e,delayChildren:t,staggerChildren:n,staggerDirection:r,repeat:s,repeatType:a,repeatDelay:u,from:d,elapsed:c,...h}){return!!Object.keys(h).length}const _m=(i,e,t,n={},r,s)=>a=>{const u=Pm(n,i)||{},d=u.delay||n.delay||0;let{elapsed:c=0}=n;c=c-pi(d);const h={keyframes:Array.isArray(t)?t:[null,t],ease:"easeOut",velocity:e.getVelocity(),...u,delay:-c,onUpdate:p=>{e.set(p),u.onUpdate&&u.onUpdate(p)},onComplete:()=>{a(),u.onComplete&&u.onComplete()},name:i,motionValue:e,element:s?void 0:r};JC(u)||Object.assign(h,XC(i,h)),h.duration&&(h.duration=pi(h.duration)),h.repeatDelay&&(h.repeatDelay=pi(h.repeatDelay)),h.from!==void 0&&(h.keyframes[0]=h.from);let m=!1;if((h.type===!1||h.duration===0&&!h.repeatDelay)&&(Af(h),h.delay===0&&(m=!0)),(nr.instantAnimations||nr.skipAnimations||r!=null&&r.shouldSkipAnimations)&&(m=!0,Af(h),h.delay=0),h.allowFlatten=!u.type&&!u.ease,m&&!s&&e.get()!==void 0){const p=ZC(h.keyframes,u);if(p!==void 0){ut.update(()=>{h.onUpdate(p),h.onComplete()});return}}return u.isSync?new Dm(h):new GC(h)};function By(i){const e=[{},{}];return i==null||i.values.forEach((t,n)=>{e[0][n]=t.get(),e[1][n]=t.getVelocity()}),e}function Mm(i,e,t,n){if(typeof e=="function"){const[r,s]=By(n);e=e(t!==void 0?t:i.custom,r,s)}if(typeof e=="string"&&(e=i.variants&&i.variants[e]),typeof e=="function"){const[r,s]=By(n);e=e(t!==void 0?t:i.custom,r,s)}return e}function da(i,e,t){const n=i.getProps();return Mm(n,e,t!==void 0?t:n.custom,i)}const CS=new Set(["width","height","top","left","right","bottom",...Ea]),Uy=30,eD=i=>!isNaN(parseFloat(i));class tD{constructor(e,t={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=n=>{var s;const r=hn.now();if(this.updatedAt!==r&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(n),this.current!==this.prev&&((s=this.events.change)==null||s.notify(this.current),this.dependents))for(const a of this.dependents)a.dirty()},this.hasAnimated=!1,this.setCurrent(e),this.owner=t.owner}setCurrent(e){this.current=e,this.updatedAt=hn.now(),this.canTrackVelocity===null&&e!==void 0&&(this.canTrackVelocity=eD(this.current))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,t){this.events[e]||(this.events[e]=new Em);const n=this.events[e].add(t);return e==="change"?()=>{n(),ut.read(()=>{this.events.change.getSize()||this.stop()})}:n}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,t){this.passiveEffect=e,this.stopPassiveEffect=t}set(e){this.passiveEffect?this.passiveEffect(e,this.updateAndNotify):this.updateAndNotify(e)}setWithVelocity(e,t,n){this.set(t),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-n}jump(e,t=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,t&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){var e;(e=this.events.change)==null||e.notify(this.current)}addDependent(e){this.dependents||(this.dependents=new Set),this.dependents.add(e)}removeDependent(e){this.dependents&&this.dependents.delete(e)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const e=hn.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||e-this.updatedAt>Uy)return 0;const t=Math.min(this.updatedAt-this.prevUpdatedAt,Uy);return YE(parseFloat(this.current)-parseFloat(this.prevFrameValue),t)}start(e){return this.stop(),new Promise(t=>{this.hasAnimated=!0,this.animation=e(t),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){var e,t;(e=this.dependents)==null||e.clear(),(t=this.events.destroy)==null||t.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function ga(i,e){return new tD(i,e)}const wf=i=>Array.isArray(i);function nD(i,e,t){i.hasValue(e)?i.getValue(e).set(t):i.addValue(e,ga(t))}function iD(i){return wf(i)?i[i.length-1]||0:i}function rD(i,e){const t=da(i,e);let{transitionEnd:n={},transition:r={},...s}=t||{};s={...s,...n};for(const a in s){const u=iD(s[a]);nD(i,a,u)}}const rn=i=>!!(i&&i.getVelocity);function sD(i){return!!(rn(i)&&i.add)}function Lf(i,e){const t=i.getValue("willChange");if(sD(t))return t.add(e);if(!t&&nr.WillChange){const n=new nr.WillChange("auto");i.addValue("willChange",n),n.add(e)}}function Nm(i){return i.replace(/([A-Z])/g,e=>`-${e.toLowerCase()}`)}const aD="framerAppearId",DS="data-"+Nm(aD);function kS(i){return i.props[DS]}function oD({protectedKeys:i,needsAnimating:e},t){const n=i.hasOwnProperty(t)&&e[t]!==!0;return e[t]=!1,n}function PS(i,e,{delay:t=0,transitionOverride:n,type:r}={}){let{transition:s,transitionEnd:a,...u}=e;const d=i.getDefaultTransition();s=s?IS(s,d):d;const c=s==null?void 0:s.reduceMotion;n&&(s=n);const h=[],m=r&&i.animationState&&i.animationState.getState()[r];for(const p in u){const y=i.getValue(p,i.latestValues[p]??null),v=u[p];if(v===void 0||m&&oD(m,p))continue;const E={delay:t,...Pm(s||{},p)},S=y.get();if(S!==void 0&&!y.isAnimating&&!Array.isArray(v)&&v===S&&!E.velocity)continue;let A=!1;if(window.MotionHandoffAnimation){const D=kS(i);if(D){const k=window.MotionHandoffAnimation(D,p,ut);k!==null&&(E.startTime=k,A=!0)}}Lf(i,p);const L=c??i.shouldReduceMotion;y.start(_m(p,y,v,L&&CS.has(p)?{type:!1}:E,i,A));const R=y.animation;R&&h.push(R)}if(a){const p=()=>ut.update(()=>{a&&rD(i,a)});h.length?Promise.all(h).then(p):p()}return h}function Rf(i,e,t={}){var d;const n=da(i,e,t.type==="exit"?(d=i.presenceContext)==null?void 0:d.custom:void 0);let{transition:r=i.getDefaultTransition()||{}}=n||{};t.transitionOverride&&(r=t.transitionOverride);const s=n?()=>Promise.all(PS(i,n,t)):()=>Promise.resolve(),a=i.variantChildren&&i.variantChildren.size?(c=0)=>{const{delayChildren:h=0,staggerChildren:m,staggerDirection:p}=r;return lD(i,e,c,h,m,p,t)}:()=>Promise.resolve(),{when:u}=r;if(u){const[c,h]=u==="beforeChildren"?[s,a]:[a,s];return c().then(()=>h())}else return Promise.all([s(),a(t.delay)])}function lD(i,e,t=0,n=0,r=0,s=1,a){const u=[];for(const d of i.variantChildren)d.notify("AnimationStart",e),u.push(Rf(d,e,{...a,delay:t+(typeof n=="function"?0:n)+RS(i.variantChildren,d,n,r,s)}).then(()=>d.notify("AnimationComplete",e)));return Promise.all(u)}function uD(i,e,t={}){i.notify("AnimationStart",e);let n;if(Array.isArray(e)){const r=e.map(s=>Rf(i,s,t));n=Promise.all(r)}else if(typeof e=="string")n=Rf(i,e,t);else{const r=typeof e=="function"?da(i,e,t.custom):e;n=Promise.all(PS(i,r,t))}return n.then(()=>{i.notify("AnimationComplete",e)})}const cD={test:i=>i==="auto",parse:i=>i},_S=i=>e=>e.test(i),MS=[xa,we,Mi,Cr,UI,BI,cD],$y=i=>MS.find(_S(i));function dD(i){return typeof i=="number"?i===0:i!==null?i==="none"||i==="0"||KE(i):!0}const hD=new Set(["brightness","contrast","saturate","opacity"]);function fD(i){const[e,t]=i.slice(0,-1).split("(");if(e==="drop-shadow")return i;const[n]=t.match(wm)||[];if(!n)return i;const r=t.replace(n,"");let s=hD.has(e)?1:0;return n!==t&&(s*=100),e+"("+s+r+")"}const mD=/\b([a-z-]*)\(.*?\)/gu,bf={...gi,getAnimatableNone:i=>{const e=i.match(mD);return e?e.map(fD).join(" "):i}},If={...gi,getAnimatableNone:i=>{const e=gi.parse(i);return gi.createTransformer(i)(e.map(n=>typeof n=="number"?0:typeof n=="object"?{...n,alpha:1}:n))}},jy={...xa,transform:Math.round},pD={rotate:Cr,rotateX:Cr,rotateY:Cr,rotateZ:Cr,scale:du,scaleX:du,scaleY:du,scaleZ:du,skew:Cr,skewX:Cr,skewY:Cr,distance:we,translateX:we,translateY:we,translateZ:we,x:we,y:we,z:we,perspective:we,transformPerspective:we,opacity:_o,originX:by,originY:by,originZ:we},Om={borderWidth:we,borderTopWidth:we,borderRightWidth:we,borderBottomWidth:we,borderLeftWidth:we,borderRadius:we,borderTopLeftRadius:we,borderTopRightRadius:we,borderBottomRightRadius:we,borderBottomLeftRadius:we,width:we,maxWidth:we,height:we,maxHeight:we,top:we,right:we,bottom:we,left:we,inset:we,insetBlock:we,insetBlockStart:we,insetBlockEnd:we,insetInline:we,insetInlineStart:we,insetInlineEnd:we,padding:we,paddingTop:we,paddingRight:we,paddingBottom:we,paddingLeft:we,paddingBlock:we,paddingBlockStart:we,paddingBlockEnd:we,paddingInline:we,paddingInlineStart:we,paddingInlineEnd:we,margin:we,marginTop:we,marginRight:we,marginBottom:we,marginLeft:we,marginBlock:we,marginBlockStart:we,marginBlockEnd:we,marginInline:we,marginInlineStart:we,marginInlineEnd:we,fontSize:we,backgroundPositionX:we,backgroundPositionY:we,...pD,zIndex:jy,fillOpacity:_o,strokeOpacity:_o,numOctaves:jy},gD={...Om,color:Dt,backgroundColor:Dt,outlineColor:Dt,fill:Dt,stroke:Dt,borderColor:Dt,borderTopColor:Dt,borderRightColor:Dt,borderBottomColor:Dt,borderLeftColor:Dt,filter:bf,WebkitFilter:bf,mask:If,WebkitMask:If},NS=i=>gD[i],yD=new Set([bf,If]);function OS(i,e){let t=NS(i);return yD.has(t)||(t=gi),t.getAnimatableNone?t.getAnimatableNone(e):void 0}const vD=new Set(["auto","none","0"]);function xD(i,e,t){let n=0,r;for(;n<i.length&&!r;){const s=i[n];typeof s=="string"&&!vD.has(s)&&Mo(s).values.length&&(r=i[n]),n++}if(r&&t)for(const s of e)i[s]=OS(t,r)}class ED extends km{constructor(e,t,n,r,s){super(e,t,n,r,s,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:t,name:n}=this;if(!t||!t.current)return;super.readKeyframes();for(let h=0;h<e.length;h++){let m=e[h];if(typeof m=="string"&&(m=m.trim(),Am(m))){const p=bS(m,t.current);p!==void 0&&(e[h]=p),h===e.length-1&&(this.finalKeyframe=m)}}if(this.resolveNoneKeyframes(),!CS.has(n)||e.length!==2)return;const[r,s]=e,a=$y(r),u=$y(s),d=Ry(r),c=Ry(s);if(d!==c&&Or[n]){this.needsMeasurement=!0;return}if(a!==u)if(Ny(a)&&Ny(u))for(let h=0;h<e.length;h++){const m=e[h];typeof m=="string"&&(e[h]=parseFloat(m))}else Or[n]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:t}=this,n=[];for(let r=0;r<e.length;r++)(e[r]===null||dD(e[r]))&&n.push(r);n.length&&xD(e,n,t)}measureInitialState(){const{element:e,unresolvedKeyframes:t,name:n}=this;if(!e||!e.current)return;n==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=Or[n](e.measureViewportBox(),window.getComputedStyle(e.current)),t[0]=this.measuredOrigin;const r=t[t.length-1];r!==void 0&&e.getValue(n,r).jump(r,!1)}measureEndState(){var u;const{element:e,name:t,unresolvedKeyframes:n}=this;if(!e||!e.current)return;const r=e.getValue(t);r&&r.jump(this.measuredOrigin,!1);const s=n.length-1,a=n[s];n[s]=Or[t](e.measureViewportBox(),window.getComputedStyle(e.current)),a!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=a),(u=this.removedTransforms)!=null&&u.length&&this.removedTransforms.forEach(([d,c])=>{e.getValue(d).set(c)}),this.resolveNoneKeyframes()}}const SD=new Set(["opacity","clipPath","filter","transform"]);function FS(i,e,t){if(i==null)return[];if(i instanceof EventTarget)return[i];if(typeof i=="string"){let n=document;const r=(t==null?void 0:t[i])??n.querySelectorAll(i);return r?Array.from(r):[]}return Array.from(i).filter(n=>n!=null)}const BS=(i,e)=>e&&typeof i=="number"?e.transform(i):i;function Cf(i){return zE(i)&&"offsetHeight"in i}const{schedule:Fm}=sS(queueMicrotask,!1),di={x:!1,y:!1};function US(){return di.x||di.y}function TD(i){return i==="x"||i==="y"?di[i]?null:(di[i]=!0,()=>{di[i]=!1}):di.x||di.y?null:(di.x=di.y=!0,()=>{di.x=di.y=!1})}function $S(i,e){const t=FS(i),n=new AbortController,r={passive:!0,...e,signal:n.signal};return[t,r,()=>n.abort()]}function AD(i){return!(i.pointerType==="touch"||US())}function wD(i,e,t={}){const[n,r,s]=$S(i,t);return n.forEach(a=>{let u=!1,d=!1,c;const h=()=>{a.removeEventListener("pointerleave",v)},m=S=>{c&&(c(S),c=void 0),h()},p=S=>{u=!1,window.removeEventListener("pointerup",p),window.removeEventListener("pointercancel",p),d&&(d=!1,m(S))},y=()=>{u=!0,window.addEventListener("pointerup",p,r),window.addEventListener("pointercancel",p,r)},v=S=>{if(S.pointerType!=="touch"){if(u){d=!0;return}m(S)}},E=S=>{if(!AD(S))return;d=!1;const A=e(a,S);typeof A=="function"&&(c=A,a.addEventListener("pointerleave",v,r))};a.addEventListener("pointerenter",E,r),a.addEventListener("pointerdown",y,r)}),s}const jS=(i,e)=>e?i===e?!0:jS(i,e.parentElement):!1,Bm=i=>i.pointerType==="mouse"?typeof i.button!="number"||i.button<=0:i.isPrimary!==!1,LD=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function RD(i){return LD.has(i.tagName)||i.isContentEditable===!0}const bD=new Set(["INPUT","SELECT","TEXTAREA"]);function ID(i){return bD.has(i.tagName)||i.isContentEditable===!0}const Mu=new WeakSet;function Vy(i){return e=>{e.key==="Enter"&&i(e)}}function Sh(i,e){i.dispatchEvent(new PointerEvent("pointer"+e,{isPrimary:!0,bubbles:!0}))}const CD=(i,e)=>{const t=i.currentTarget;if(!t)return;const n=Vy(()=>{if(Mu.has(t))return;Sh(t,"down");const r=Vy(()=>{Sh(t,"up")}),s=()=>Sh(t,"cancel");t.addEventListener("keyup",r,e),t.addEventListener("blur",s,e)});t.addEventListener("keydown",n,e),t.addEventListener("blur",()=>t.removeEventListener("keydown",n),e)};function Gy(i){return Bm(i)&&!US()}const Hy=new WeakSet;function DD(i,e,t={}){const[n,r,s]=$S(i,t),a=u=>{const d=u.currentTarget;if(!Gy(u)||Hy.has(u))return;Mu.add(d),t.stopPropagation&&Hy.add(u);const c=e(d,u),h=(y,v)=>{window.removeEventListener("pointerup",m),window.removeEventListener("pointercancel",p),Mu.has(d)&&Mu.delete(d),Gy(y)&&typeof c=="function"&&c(y,{success:v})},m=y=>{h(y,d===window||d===document||t.useGlobalTarget||jS(d,y.target))},p=y=>{h(y,!1)};window.addEventListener("pointerup",m,r),window.addEventListener("pointercancel",p,r)};return n.forEach(u=>{(t.useGlobalTarget?window:u).addEventListener("pointerdown",a,r),Cf(u)&&(u.addEventListener("focus",c=>CD(c,r)),!RD(u)&&!u.hasAttribute("tabindex")&&(u.tabIndex=0))}),s}function Um(i){return zE(i)&&"ownerSVGElement"in i}const Nu=new WeakMap;let Dr;const VS=(i,e,t)=>(n,r)=>r&&r[0]?r[0][i+"Size"]:Um(n)&&"getBBox"in n?n.getBBox()[e]:n[t],kD=VS("inline","width","offsetWidth"),PD=VS("block","height","offsetHeight");function _D({target:i,borderBoxSize:e}){var t;(t=Nu.get(i))==null||t.forEach(n=>{n(i,{get width(){return kD(i,e)},get height(){return PD(i,e)}})})}function MD(i){i.forEach(_D)}function ND(){typeof ResizeObserver>"u"||(Dr=new ResizeObserver(MD))}function OD(i,e){Dr||ND();const t=FS(i);return t.forEach(n=>{let r=Nu.get(n);r||(r=new Set,Nu.set(n,r)),r.add(e),Dr==null||Dr.observe(n)}),()=>{t.forEach(n=>{const r=Nu.get(n);r==null||r.delete(e),r!=null&&r.size||Dr==null||Dr.unobserve(n)})}}const Ou=new Set;let sa;function FD(){sa=()=>{const i={get width(){return window.innerWidth},get height(){return window.innerHeight}};Ou.forEach(e=>e(i))},window.addEventListener("resize",sa)}function BD(i){return Ou.add(i),sa||FD(),()=>{Ou.delete(i),!Ou.size&&typeof sa=="function"&&(window.removeEventListener("resize",sa),sa=void 0)}}function zy(i,e){return typeof i=="function"?BD(i):OD(i,e)}function UD(i){return Um(i)&&i.tagName==="svg"}const $D=[...MS,Dt,gi],jD=i=>$D.find(_S(i)),Ky=()=>({translate:0,scale:1,origin:0,originPoint:0}),aa=()=>({x:Ky(),y:Ky()}),Wy=()=>({min:0,max:0}),Ot=()=>({x:Wy(),y:Wy()}),VD=new WeakMap;function yc(i){return i!==null&&typeof i=="object"&&typeof i.start=="function"}function No(i){return typeof i=="string"||Array.isArray(i)}const $m=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],jm=["initial",...$m];function vc(i){return yc(i.animate)||jm.some(e=>No(i[e]))}function GS(i){return!!(vc(i)||i.variants)}function GD(i,e,t){for(const n in e){const r=e[n],s=t[n];if(rn(r))i.addValue(n,r);else if(rn(s))i.addValue(n,ga(r,{owner:i}));else if(s!==r)if(i.hasValue(n)){const a=i.getValue(n);a.liveStyle===!0?a.jump(r):a.hasAnimated||a.set(r)}else{const a=i.getStaticValue(n);i.addValue(n,ga(a!==void 0?a:r,{owner:i}))}}for(const n in t)e[n]===void 0&&i.removeValue(n);return e}const Df={current:null},HS={current:!1},HD=typeof window<"u";function zD(){if(HS.current=!0,!!HD)if(window.matchMedia){const i=window.matchMedia("(prefers-reduced-motion)"),e=()=>Df.current=i.matches;i.addEventListener("change",e),e()}else Df.current=!1}const Yy=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];let Zu={};function zS(i){Zu=i}function KD(){return Zu}class WD{scrapeMotionValuesFromProps(e,t,n){return{}}constructor({parent:e,props:t,presenceContext:n,reducedMotionConfig:r,skipAnimations:s,blockInitialAnimation:a,visualState:u},d={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.shouldSkipAnimations=!1,this.values=new Map,this.KeyframeResolver=km,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.hasBeenMounted=!1,this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const y=hn.now();this.renderScheduledAt<y&&(this.renderScheduledAt=y,ut.render(this.render,!1,!0))};const{latestValues:c,renderState:h}=u;this.latestValues=c,this.baseTarget={...c},this.initialValues=t.initial?{...c}:{},this.renderState=h,this.parent=e,this.props=t,this.presenceContext=n,this.depth=e?e.depth+1:0,this.reducedMotionConfig=r,this.skipAnimationsConfig=s,this.options=d,this.blockInitialAnimation=!!a,this.isControllingVariants=vc(t),this.isVariantNode=GS(t),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:m,...p}=this.scrapeMotionValuesFromProps(t,{},this);for(const y in p){const v=p[y];c[y]!==void 0&&rn(v)&&v.set(c[y])}}mount(e){var t,n;if(this.hasBeenMounted)for(const r in this.initialValues)(t=this.values.get(r))==null||t.jump(this.initialValues[r]),this.latestValues[r]=this.initialValues[r];this.current=e,VD.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((r,s)=>this.bindToMotionValue(s,r)),this.reducedMotionConfig==="never"?this.shouldReduceMotion=!1:this.reducedMotionConfig==="always"?this.shouldReduceMotion=!0:(HS.current||zD(),this.shouldReduceMotion=Df.current),this.shouldSkipAnimations=this.skipAnimationsConfig??!1,(n=this.parent)==null||n.addChild(this),this.update(this.props,this.presenceContext),this.hasBeenMounted=!0}unmount(){var e;this.projection&&this.projection.unmount(),Br(this.notifyUpdate),Br(this.render),this.valueSubscriptions.forEach(t=>t()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),(e=this.parent)==null||e.removeChild(this);for(const t in this.events)this.events[t].clear();for(const t in this.features){const n=this.features[t];n&&(n.unmount(),n.isMounted=!1)}this.current=null}addChild(e){this.children.add(e),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(e)}removeChild(e){this.children.delete(e),this.enteringChildren&&this.enteringChildren.delete(e)}bindToMotionValue(e,t){if(this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)(),t.accelerate&&SD.has(e)&&this.current instanceof HTMLElement){const{factory:a,keyframes:u,times:d,ease:c,duration:h}=t.accelerate,m=new wS({element:this.current,name:e,keyframes:u,times:d,ease:c,duration:pi(h)}),p=a(m);this.valueSubscriptions.set(e,()=>{p(),m.cancel()});return}const n=Sa.has(e);n&&this.onBindTransform&&this.onBindTransform();const r=t.on("change",a=>{this.latestValues[e]=a,this.props.onUpdate&&ut.preRender(this.notifyUpdate),n&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let s;typeof window<"u"&&window.MotionCheckAppearSync&&(s=window.MotionCheckAppearSync(this,e,t)),this.valueSubscriptions.set(e,()=>{r(),s&&s(),t.owner&&t.stop()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}updateFeatures(){let e="animation";for(e in Zu){const t=Zu[e];if(!t)continue;const{isEnabled:n,Feature:r}=t;if(!this.features[e]&&r&&n(this.props)&&(this.features[e]=new r(this)),this.features[e]){const s=this.features[e];s.isMounted?s.update():(s.mount(),s.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):Ot()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,t){this.latestValues[e]=t}update(e,t){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=t;for(let n=0;n<Yy.length;n++){const r=Yy[n];this.propEventSubscriptions[r]&&(this.propEventSubscriptions[r](),delete this.propEventSubscriptions[r]);const s="on"+r,a=e[s];a&&(this.propEventSubscriptions[r]=this.on(r,a))}this.prevMotionValues=GD(this,this.scrapeMotionValuesFromProps(e,this.prevProps||{},this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const t=this.getClosestVariantNode();if(t)return t.variantChildren&&t.variantChildren.add(e),()=>t.variantChildren.delete(e)}addValue(e,t){const n=this.values.get(e);t!==n&&(n&&this.removeValue(e),this.bindToMotionValue(e,t),this.values.set(e,t),this.latestValues[e]=t.get())}removeValue(e){this.values.delete(e);const t=this.valueSubscriptions.get(e);t&&(t(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,t){if(this.props.values&&this.props.values[e])return this.props.values[e];let n=this.values.get(e);return n===void 0&&t!==void 0&&(n=ga(t===null?void 0:t,{owner:this}),this.addValue(e,n)),n}readValue(e,t){let n=this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:this.getBaseTargetFromProps(this.props,e)??this.readValueFromInstance(this.current,e,this.options);return n!=null&&(typeof n=="string"&&(HE(n)||KE(n))?n=parseFloat(n):!jD(n)&&gi.test(t)&&(n=OS(e,t)),this.setBaseTarget(e,rn(n)?n.get():n)),rn(n)?n.get():n}setBaseTarget(e,t){this.baseTarget[e]=t}getBaseTarget(e){var s;const{initial:t}=this.props;let n;if(typeof t=="string"||typeof t=="object"){const a=Mm(this.props,t,(s=this.presenceContext)==null?void 0:s.custom);a&&(n=a[e])}if(t&&n!==void 0)return n;const r=this.getBaseTargetFromProps(this.props,e);return r!==void 0&&!rn(r)?r:this.initialValues[e]!==void 0&&n===void 0?void 0:this.baseTarget[e]}on(e,t){return this.events[e]||(this.events[e]=new Em),this.events[e].add(t)}notify(e,...t){this.events[e]&&this.events[e].notify(...t)}scheduleRenderMicrotask(){Fm.render(this.render)}}class KS extends WD{constructor(){super(...arguments),this.KeyframeResolver=ED}sortInstanceNodePosition(e,t){return e.compareDocumentPosition(t)&2?1:-1}getBaseTargetFromProps(e,t){const n=e.style;return n?n[t]:void 0}removeValueFromRenderState(e,{vars:t,style:n}){delete t[e],delete n[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;rn(e)&&(this.childSubscription=e.on("change",t=>{this.current&&(this.current.textContent=`${t}`)}))}}class Gr{constructor(e){this.isMounted=!1,this.node=e}update(){}}function WS({top:i,left:e,right:t,bottom:n}){return{x:{min:e,max:t},y:{min:i,max:n}}}function YD({x:i,y:e}){return{top:e.min,right:i.max,bottom:e.max,left:i.min}}function qD(i,e){if(!e)return i;const t=e({x:i.left,y:i.top}),n=e({x:i.right,y:i.bottom});return{top:t.y,left:t.x,bottom:n.y,right:n.x}}function Th(i){return i===void 0||i===1}function kf({scale:i,scaleX:e,scaleY:t}){return!Th(i)||!Th(e)||!Th(t)}function fs(i){return kf(i)||YS(i)||i.z||i.rotate||i.rotateX||i.rotateY||i.skewX||i.skewY}function YS(i){return qy(i.x)||qy(i.y)}function qy(i){return i&&i!=="0%"}function Ju(i,e,t){const n=i-t,r=e*n;return t+r}function Xy(i,e,t,n,r){return r!==void 0&&(i=Ju(i,r,n)),Ju(i,t,n)+e}function Pf(i,e=0,t=1,n,r){i.min=Xy(i.min,e,t,n,r),i.max=Xy(i.max,e,t,n,r)}function qS(i,{x:e,y:t}){Pf(i.x,e.translate,e.scale,e.originPoint),Pf(i.y,t.translate,t.scale,t.originPoint)}const Qy=.999999999999,Zy=1.0000000000001;function XD(i,e,t,n=!1){const r=t.length;if(!r)return;e.x=e.y=1;let s,a;for(let u=0;u<r;u++){s=t[u],a=s.projectionDelta;const{visualElement:d}=s.options;d&&d.props.style&&d.props.style.display==="contents"||(n&&s.options.layoutScroll&&s.scroll&&s!==s.root&&la(i,{x:-s.scroll.offset.x,y:-s.scroll.offset.y}),a&&(e.x*=a.x.scale,e.y*=a.y.scale,qS(i,a)),n&&fs(s.latestValues)&&la(i,s.latestValues))}e.x<Zy&&e.x>Qy&&(e.x=1),e.y<Zy&&e.y>Qy&&(e.y=1)}function oa(i,e){i.min=i.min+e,i.max=i.max+e}function Jy(i,e,t,n,r=.5){const s=vt(i.min,i.max,r);Pf(i,e,t,s,n)}function la(i,e){Jy(i.x,e.x,e.scaleX,e.scale,e.originX),Jy(i.y,e.y,e.scaleY,e.scale,e.originY)}function XS(i,e){return WS(qD(i.getBoundingClientRect(),e))}function QD(i,e,t){const n=XS(i,t),{scroll:r}=e;return r&&(oa(n.x,r.offset.x),oa(n.y,r.offset.y)),n}const ZD={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},JD=Ea.length;function ek(i,e,t){let n="",r=!0;for(let s=0;s<JD;s++){const a=Ea[s],u=i[a];if(u===void 0)continue;let d=!0;if(typeof u=="number")d=u===(a.startsWith("scale")?1:0);else{const c=parseFloat(u);d=a.startsWith("scale")?c===1:c===0}if(!d||t){const c=BS(u,Om[a]);if(!d){r=!1;const h=ZD[a]||a;n+=`${h}(${c}) `}t&&(e[a]=c)}}return n=n.trim(),t?n=t(e,r?"":n):r&&(n="none"),n}function Vm(i,e,t){const{style:n,vars:r,transformOrigin:s}=i;let a=!1,u=!1;for(const d in e){const c=e[d];if(Sa.has(d)){a=!0;continue}else if(oS(d)){r[d]=c;continue}else{const h=BS(c,Om[d]);d.startsWith("origin")?(u=!0,s[d]=h):n[d]=h}}if(e.transform||(a||t?n.transform=ek(e,i.transform,t):n.transform&&(n.transform="none")),u){const{originX:d="50%",originY:c="50%",originZ:h=0}=s;n.transformOrigin=`${d} ${c} ${h}`}}function QS(i,{style:e,vars:t},n,r){const s=i.style;let a;for(a in e)s[a]=e[a];r==null||r.applyProjectionStyles(s,n);for(a in t)s.setProperty(a,t[a])}function ev(i,e){return e.max===e.min?0:i/(e.max-e.min)*100}const ho={correct:(i,e)=>{if(!e.target)return i;if(typeof i=="string")if(we.test(i))i=parseFloat(i);else return i;const t=ev(i,e.target.x),n=ev(i,e.target.y);return`${t}% ${n}%`}},tk={correct:(i,{treeScale:e,projectionDelta:t})=>{const n=i,r=gi.parse(i);if(r.length>5)return n;const s=gi.createTransformer(i),a=typeof r[0]!="number"?1:0,u=t.x.scale*e.x,d=t.y.scale*e.y;r[0+a]/=u,r[1+a]/=d;const c=vt(u,d,.5);return typeof r[2+a]=="number"&&(r[2+a]/=c),typeof r[3+a]=="number"&&(r[3+a]/=c),s(r)}},_f={borderRadius:{...ho,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:ho,borderTopRightRadius:ho,borderBottomLeftRadius:ho,borderBottomRightRadius:ho,boxShadow:tk};function ZS(i,{layout:e,layoutId:t}){return Sa.has(i)||i.startsWith("origin")||(e||t!==void 0)&&(!!_f[i]||i==="opacity")}function Gm(i,e,t){var a;const n=i.style,r=e==null?void 0:e.style,s={};if(!n)return s;for(const u in n)(rn(n[u])||r&&rn(r[u])||ZS(u,i)||((a=t==null?void 0:t.getValue(u))==null?void 0:a.liveStyle)!==void 0)&&(s[u]=n[u]);return s}function nk(i){return window.getComputedStyle(i)}class ik extends KS{constructor(){super(...arguments),this.type="html",this.renderInstance=QS}readValueFromInstance(e,t){var n;if(Sa.has(t))return(n=this.projection)!=null&&n.isProjecting?vf(t):TC(e,t);{const r=nk(e),s=(oS(t)?r.getPropertyValue(t):r[t])||0;return typeof s=="string"?s.trim():s}}measureInstanceViewportBox(e,{transformPagePoint:t}){return XS(e,t)}build(e,t,n){Vm(e,t,n.transformTemplate)}scrapeMotionValuesFromProps(e,t,n){return Gm(e,t,n)}}const rk={offset:"stroke-dashoffset",array:"stroke-dasharray"},sk={offset:"strokeDashoffset",array:"strokeDasharray"};function ak(i,e,t=1,n=0,r=!0){i.pathLength=1;const s=r?rk:sk;i[s.offset]=`${-n}`,i[s.array]=`${e} ${t}`}const ok=["offsetDistance","offsetPath","offsetRotate","offsetAnchor"];function JS(i,{attrX:e,attrY:t,attrScale:n,pathLength:r,pathSpacing:s=1,pathOffset:a=0,...u},d,c,h){if(Vm(i,u,c),d){i.style.viewBox&&(i.attrs.viewBox=i.style.viewBox);return}i.attrs=i.style,i.style={};const{attrs:m,style:p}=i;m.transform&&(p.transform=m.transform,delete m.transform),(p.transform||m.transformOrigin)&&(p.transformOrigin=m.transformOrigin??"50% 50%",delete m.transformOrigin),p.transform&&(p.transformBox=(h==null?void 0:h.transformBox)??"fill-box",delete m.transformBox);for(const y of ok)m[y]!==void 0&&(p[y]=m[y],delete m[y]);e!==void 0&&(m.x=e),t!==void 0&&(m.y=t),n!==void 0&&(m.scale=n),r!==void 0&&ak(m,r,s,a,!1)}const eT=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]),tT=i=>typeof i=="string"&&i.toLowerCase()==="svg";function lk(i,e,t,n){QS(i,e,void 0,n);for(const r in e.attrs)i.setAttribute(eT.has(r)?r:Nm(r),e.attrs[r])}function nT(i,e,t){const n=Gm(i,e,t);for(const r in i)if(rn(i[r])||rn(e[r])){const s=Ea.indexOf(r)!==-1?"attr"+r.charAt(0).toUpperCase()+r.substring(1):r;n[s]=i[r]}return n}class uk extends KS{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=Ot}getBaseTargetFromProps(e,t){return e[t]}readValueFromInstance(e,t){if(Sa.has(t)){const n=NS(t);return n&&n.default||0}return t=eT.has(t)?t:Nm(t),e.getAttribute(t)}scrapeMotionValuesFromProps(e,t,n){return nT(e,t,n)}build(e,t,n){JS(e,t,this.isSVGTag,n.transformTemplate,n.style)}renderInstance(e,t,n,r){lk(e,t,n,r)}mount(e){this.isSVGTag=tT(e.tagName),super.mount(e)}}const ck=jm.length;function iT(i){if(!i)return;if(!i.isControllingVariants){const t=i.parent?iT(i.parent)||{}:{};return i.props.initial!==void 0&&(t.initial=i.props.initial),t}const e={};for(let t=0;t<ck;t++){const n=jm[t],r=i.props[n];(No(r)||r===!1)&&(e[n]=r)}return e}function rT(i,e){if(!Array.isArray(e))return!1;const t=e.length;if(t!==i.length)return!1;for(let n=0;n<t;n++)if(e[n]!==i[n])return!1;return!0}const dk=[...$m].reverse(),hk=$m.length;function fk(i){return e=>Promise.all(e.map(({animation:t,options:n})=>uD(i,t,n)))}function mk(i){let e=fk(i),t=tv(),n=!0;const r=d=>(c,h)=>{var p;const m=da(i,h,d==="exit"?(p=i.presenceContext)==null?void 0:p.custom:void 0);if(m){const{transition:y,transitionEnd:v,...E}=m;c={...c,...E,...v}}return c};function s(d){e=d(i)}function a(d){const{props:c}=i,h=iT(i.parent)||{},m=[],p=new Set;let y={},v=1/0;for(let S=0;S<hk;S++){const A=dk[S],L=t[A],R=c[A]!==void 0?c[A]:h[A],D=No(R),k=A===d?L.isActive:null;k===!1&&(v=S);let U=R===h[A]&&R!==c[A]&&D;if(U&&n&&i.manuallyAnimateOnMount&&(U=!1),L.protectedKeys={...y},!L.isActive&&k===null||!R&&!L.prevProp||yc(R)||typeof R=="boolean")continue;if(A==="exit"&&L.isActive&&k!==!0){L.prevResolvedValues&&(y={...y,...L.prevResolvedValues});continue}const C=pk(L.prevProp,R);let _=C||A===d&&L.isActive&&!U&&D||S>v&&D,F=!1;const O=Array.isArray(R)?R:[R];let W=O.reduce(r(A),{});k===!1&&(W={});const{prevResolvedValues:z={}}=L,re={...z,...W},ae=ie=>{_=!0,p.has(ie)&&(F=!0,p.delete(ie)),L.needsAnimating[ie]=!0;const G=i.getValue(ie);G&&(G.liveStyle=!1)};for(const ie in re){const G=W[ie],ee=z[ie];if(y.hasOwnProperty(ie))continue;let J=!1;wf(G)&&wf(ee)?J=!rT(G,ee):J=G!==ee,J?G!=null?ae(ie):p.add(ie):G!==void 0&&p.has(ie)?ae(ie):L.protectedKeys[ie]=!0}L.prevProp=R,L.prevResolvedValues=W,L.isActive&&(y={...y,...W}),n&&i.blockInitialAnimation&&(_=!1);const ce=U&&C;_&&(!ce||F)&&m.push(...O.map(ie=>{const G={type:A};if(typeof ie=="string"&&n&&!ce&&i.manuallyAnimateOnMount&&i.parent){const{parent:ee}=i,J=da(ee,ie);if(ee.enteringChildren&&J){const{delayChildren:P}=J.transition||{};G.delay=RS(ee.enteringChildren,i,P)}}return{animation:ie,options:G}}))}if(p.size){const S={};if(typeof c.initial!="boolean"){const A=da(i,Array.isArray(c.initial)?c.initial[0]:c.initial);A&&A.transition&&(S.transition=A.transition)}p.forEach(A=>{const L=i.getBaseTarget(A),R=i.getValue(A);R&&(R.liveStyle=!0),S[A]=L??null}),m.push({animation:S})}let E=!!m.length;return n&&(c.initial===!1||c.initial===c.animate)&&!i.manuallyAnimateOnMount&&(E=!1),n=!1,E?e(m):Promise.resolve()}function u(d,c){var m;if(t[d].isActive===c)return Promise.resolve();(m=i.variantChildren)==null||m.forEach(p=>{var y;return(y=p.animationState)==null?void 0:y.setActive(d,c)}),t[d].isActive=c;const h=a(d);for(const p in t)t[p].protectedKeys={};return h}return{animateChanges:a,setActive:u,setAnimateFunction:s,getState:()=>t,reset:()=>{t=tv()}}}function pk(i,e){return typeof e=="string"?e!==i:Array.isArray(e)?!rT(e,i):!1}function us(i=!1){return{isActive:i,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function tv(){return{animate:us(!0),whileInView:us(),whileHover:us(),whileTap:us(),whileDrag:us(),whileFocus:us(),exit:us()}}function nv(i,e){i.min=e.min,i.max=e.max}function ui(i,e){nv(i.x,e.x),nv(i.y,e.y)}function iv(i,e){i.translate=e.translate,i.scale=e.scale,i.originPoint=e.originPoint,i.origin=e.origin}const sT=1e-4,gk=1-sT,yk=1+sT,aT=.01,vk=0-aT,xk=0+aT;function fn(i){return i.max-i.min}function Ek(i,e,t){return Math.abs(i-e)<=t}function rv(i,e,t,n=.5){i.origin=n,i.originPoint=vt(e.min,e.max,i.origin),i.scale=fn(t)/fn(e),i.translate=vt(t.min,t.max,i.origin)-i.originPoint,(i.scale>=gk&&i.scale<=yk||isNaN(i.scale))&&(i.scale=1),(i.translate>=vk&&i.translate<=xk||isNaN(i.translate))&&(i.translate=0)}function To(i,e,t,n){rv(i.x,e.x,t.x,n?n.originX:void 0),rv(i.y,e.y,t.y,n?n.originY:void 0)}function sv(i,e,t){i.min=t.min+e.min,i.max=i.min+fn(e)}function Sk(i,e,t){sv(i.x,e.x,t.x),sv(i.y,e.y,t.y)}function av(i,e,t){i.min=e.min-t.min,i.max=i.min+fn(e)}function ec(i,e,t){av(i.x,e.x,t.x),av(i.y,e.y,t.y)}function ov(i,e,t,n,r){return i-=e,i=Ju(i,1/t,n),r!==void 0&&(i=Ju(i,1/r,n)),i}function Tk(i,e=0,t=1,n=.5,r,s=i,a=i){if(Mi.test(e)&&(e=parseFloat(e),e=vt(a.min,a.max,e/100)-a.min),typeof e!="number")return;let u=vt(s.min,s.max,n);i===s&&(u-=e),i.min=ov(i.min,e,t,u,r),i.max=ov(i.max,e,t,u,r)}function lv(i,e,[t,n,r],s,a){Tk(i,e[t],e[n],e[r],e.scale,s,a)}const Ak=["x","scaleX","originX"],wk=["y","scaleY","originY"];function uv(i,e,t,n){lv(i.x,e,Ak,t?t.x:void 0,n?n.x:void 0),lv(i.y,e,wk,t?t.y:void 0,n?n.y:void 0)}function cv(i){return i.translate===0&&i.scale===1}function oT(i){return cv(i.x)&&cv(i.y)}function dv(i,e){return i.min===e.min&&i.max===e.max}function Lk(i,e){return dv(i.x,e.x)&&dv(i.y,e.y)}function hv(i,e){return Math.round(i.min)===Math.round(e.min)&&Math.round(i.max)===Math.round(e.max)}function lT(i,e){return hv(i.x,e.x)&&hv(i.y,e.y)}function fv(i){return fn(i.x)/fn(i.y)}function mv(i,e){return i.translate===e.translate&&i.scale===e.scale&&i.originPoint===e.originPoint}function Ii(i){return[i("x"),i("y")]}function Rk(i,e,t){let n="";const r=i.x.translate/e.x,s=i.y.translate/e.y,a=(t==null?void 0:t.z)||0;if((r||s||a)&&(n=`translate3d(${r}px, ${s}px, ${a}px) `),(e.x!==1||e.y!==1)&&(n+=`scale(${1/e.x}, ${1/e.y}) `),t){const{transformPerspective:c,rotate:h,rotateX:m,rotateY:p,skewX:y,skewY:v}=t;c&&(n=`perspective(${c}px) ${n}`),h&&(n+=`rotate(${h}deg) `),m&&(n+=`rotateX(${m}deg) `),p&&(n+=`rotateY(${p}deg) `),y&&(n+=`skewX(${y}deg) `),v&&(n+=`skewY(${v}deg) `)}const u=i.x.scale*e.x,d=i.y.scale*e.y;return(u!==1||d!==1)&&(n+=`scale(${u}, ${d})`),n||"none"}const uT=["TopLeft","TopRight","BottomLeft","BottomRight"],bk=uT.length,pv=i=>typeof i=="string"?parseFloat(i):i,gv=i=>typeof i=="number"||we.test(i);function Ik(i,e,t,n,r,s){r?(i.opacity=vt(0,t.opacity??1,Ck(n)),i.opacityExit=vt(e.opacity??1,0,Dk(n))):s&&(i.opacity=vt(e.opacity??1,t.opacity??1,n));for(let a=0;a<bk;a++){const u=`border${uT[a]}Radius`;let d=yv(e,u),c=yv(t,u);if(d===void 0&&c===void 0)continue;d||(d=0),c||(c=0),d===0||c===0||gv(d)===gv(c)?(i[u]=Math.max(vt(pv(d),pv(c),n),0),(Mi.test(c)||Mi.test(d))&&(i[u]+="%")):i[u]=c}(e.rotate||t.rotate)&&(i.rotate=vt(e.rotate||0,t.rotate||0,n))}function yv(i,e){return i[e]!==void 0?i[e]:i.borderRadius}const Ck=cT(0,.5,tS),Dk=cT(.5,.95,qn);function cT(i,e,t){return n=>n<i?0:n>e?1:t(Po(i,e,n))}function kk(i,e,t){const n=rn(i)?i:ga(i);return n.start(_m("",n,e,t)),n.animation}function Oo(i,e,t,n={passive:!0}){return i.addEventListener(e,t,n),()=>i.removeEventListener(e,t)}const Pk=(i,e)=>i.depth-e.depth;class _k{constructor(){this.children=[],this.isDirty=!1}add(e){vm(this.children,e),this.isDirty=!0}remove(e){Yu(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(Pk),this.isDirty=!1,this.children.forEach(e)}}function Mk(i,e){const t=hn.now(),n=({timestamp:r})=>{const s=r-t;s>=e&&(Br(n),i(s-e))};return ut.setup(n,!0),()=>Br(n)}function Fu(i){return rn(i)?i.get():i}class Nk{constructor(){this.members=[]}add(e){vm(this.members,e);for(let t=this.members.length-1;t>=0;t--){const n=this.members[t];if(n===e||n===this.lead||n===this.prevLead)continue;const r=n.instance;r&&r.isConnected===!1&&n.isPresent!==!1&&!n.snapshot&&Yu(this.members,n)}e.scheduleRender()}remove(e){if(Yu(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const t=this.members[this.members.length-1];t&&this.promote(t)}}relegate(e){const t=this.members.findIndex(r=>e===r);if(t===0)return!1;let n;for(let r=t;r>=0;r--){const s=this.members[r],a=s.instance;if(s.isPresent!==!1&&(!a||a.isConnected!==!1)){n=s;break}}return n?(this.promote(n),!0):!1}promote(e,t){const n=this.lead;if(e!==n&&(this.prevLead=n,this.lead=e,e.show(),n)){n.instance&&n.scheduleRender(),e.scheduleRender();const r=n.options.layoutDependency,s=e.options.layoutDependency;if(!(r!==void 0&&s!==void 0&&r===s)){const d=n.instance;d&&d.isConnected===!1&&!n.snapshot||(e.resumeFrom=n,t&&(e.resumeFrom.preserveOpacity=!0),n.snapshot&&(e.snapshot=n.snapshot,e.snapshot.latestValues=n.animationValues||n.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0))}const{crossfade:u}=e.options;u===!1&&n.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:t,resumingFrom:n}=e;t.onExitComplete&&t.onExitComplete(),n&&n.options.onExitComplete&&n.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}const Bu={hasAnimatedSinceResize:!0,hasEverUpdated:!1},Ah=["","X","Y","Z"],Ok=1e3;let Fk=0;function wh(i,e,t,n){const{latestValues:r}=e;r[i]&&(t[i]=r[i],e.setStaticValue(i,0),n&&(n[i]=0))}function dT(i){if(i.hasCheckedOptimisedAppear=!0,i.root===i)return;const{visualElement:e}=i.options;if(!e)return;const t=kS(e);if(window.MotionHasOptimisedAnimation(t,"transform")){const{layout:r,layoutId:s}=i.options;window.MotionCancelOptimisedAnimation(t,"transform",ut,!(r||s))}const{parent:n}=i;n&&!n.hasCheckedOptimisedAppear&&dT(n)}function hT({attachResizeListener:i,defaultParent:e,measureScroll:t,checkIsScrollRoot:n,resetTransform:r}){return class{constructor(a={},u=e==null?void 0:e()){this.id=Fk++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.layoutVersion=0,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach($k),this.nodes.forEach(Hk),this.nodes.forEach(zk),this.nodes.forEach(jk)},this.resolvedRelativeTargetAt=0,this.linkedParentVersion=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=a,this.root=u?u.root||u:this,this.path=u?[...u.path,u]:[],this.parent=u,this.depth=u?u.depth+1:0;for(let d=0;d<this.path.length;d++)this.path[d].shouldResetTransform=!0;this.root===this&&(this.nodes=new _k)}addEventListener(a,u){return this.eventHandlers.has(a)||this.eventHandlers.set(a,new Em),this.eventHandlers.get(a).add(u)}notifyListeners(a,...u){const d=this.eventHandlers.get(a);d&&d.notify(...u)}hasListeners(a){return this.eventHandlers.has(a)}mount(a){if(this.instance)return;this.isSVG=Um(a)&&!UD(a),this.instance=a;const{layoutId:u,layout:d,visualElement:c}=this.options;if(c&&!c.current&&c.mount(a),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(d||u)&&(this.isLayoutDirty=!0),i){let h,m=0;const p=()=>this.root.updateBlockedByResize=!1;ut.read(()=>{m=window.innerWidth}),i(a,()=>{const y=window.innerWidth;y!==m&&(m=y,this.root.updateBlockedByResize=!0,h&&h(),h=Mk(p,250),Bu.hasAnimatedSinceResize&&(Bu.hasAnimatedSinceResize=!1,this.nodes.forEach(Ev)))})}u&&this.root.registerSharedNode(u,this),this.options.animate!==!1&&c&&(u||d)&&this.addEventListener("didUpdate",({delta:h,hasLayoutChanged:m,hasRelativeLayoutChanged:p,layout:y})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const v=this.options.transition||c.getDefaultTransition()||Xk,{onLayoutAnimationStart:E,onLayoutAnimationComplete:S}=c.getProps(),A=!this.targetLayout||!lT(this.targetLayout,y),L=!m&&p;if(this.options.layoutRoot||this.resumeFrom||L||m&&(A||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const R={...Pm(v,"layout"),onPlay:E,onComplete:S};(c.shouldReduceMotion||this.options.layoutRoot)&&(R.delay=0,R.type=!1),this.startAnimation(R),this.setAnimationOrigin(h,L)}else m||Ev(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=y})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const a=this.getStack();a&&a.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),Br(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(Kk),this.animationId++)}getTransformTemplate(){const{visualElement:a}=this.options;return a&&a.getProps().transformTemplate}willUpdate(a=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&dT(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let h=0;h<this.path.length;h++){const m=this.path[h];m.shouldResetTransform=!0,m.updateScroll("snapshot"),m.options.layoutRoot&&m.willUpdate(!1)}const{layoutId:u,layout:d}=this.options;if(u===void 0&&!d)return;const c=this.getTransformTemplate();this.prevTransformTemplateValue=c?c(this.latestValues,""):void 0,this.updateSnapshot(),a&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(vv);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(xv);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(Gk),this.nodes.forEach(Bk),this.nodes.forEach(Uk)):this.nodes.forEach(xv),this.clearAllSnapshots();const u=hn.now();Wt.delta=Oi(0,1e3/60,u-Wt.timestamp),Wt.timestamp=u,Wt.isProcessing=!0,ph.update.process(Wt),ph.preRender.process(Wt),ph.render.process(Wt),Wt.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,Fm.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(Vk),this.sharedNodes.forEach(Wk)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,ut.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){ut.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!fn(this.snapshot.measuredBox.x)&&!fn(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let d=0;d<this.path.length;d++)this.path[d].updateScroll();const a=this.layout;this.layout=this.measure(!1),this.layoutVersion++,this.layoutCorrected=Ot(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:u}=this.options;u&&u.notify("LayoutMeasure",this.layout.layoutBox,a?a.layoutBox:void 0)}updateScroll(a="measure"){let u=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===a&&(u=!1),u&&this.instance){const d=n(this.instance);this.scroll={animationId:this.root.animationId,phase:a,isRoot:d,offset:t(this.instance),wasRoot:this.scroll?this.scroll.isRoot:d}}}resetTransform(){if(!r)return;const a=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,u=this.projectionDelta&&!oT(this.projectionDelta),d=this.getTransformTemplate(),c=d?d(this.latestValues,""):void 0,h=c!==this.prevTransformTemplateValue;a&&this.instance&&(u||fs(this.latestValues)||h)&&(r(this.instance,c),this.shouldResetTransform=!1,this.scheduleRender())}measure(a=!0){const u=this.measurePageBox();let d=this.removeElementScroll(u);return a&&(d=this.removeTransform(d)),Qk(d),{animationId:this.root.animationId,measuredBox:u,layoutBox:d,latestValues:{},source:this.id}}measurePageBox(){var c;const{visualElement:a}=this.options;if(!a)return Ot();const u=a.measureViewportBox();if(!(((c=this.scroll)==null?void 0:c.wasRoot)||this.path.some(Zk))){const{scroll:h}=this.root;h&&(oa(u.x,h.offset.x),oa(u.y,h.offset.y))}return u}removeElementScroll(a){var d;const u=Ot();if(ui(u,a),(d=this.scroll)!=null&&d.wasRoot)return u;for(let c=0;c<this.path.length;c++){const h=this.path[c],{scroll:m,options:p}=h;h!==this.root&&m&&p.layoutScroll&&(m.wasRoot&&ui(u,a),oa(u.x,m.offset.x),oa(u.y,m.offset.y))}return u}applyTransform(a,u=!1){const d=Ot();ui(d,a);for(let c=0;c<this.path.length;c++){const h=this.path[c];!u&&h.options.layoutScroll&&h.scroll&&h!==h.root&&la(d,{x:-h.scroll.offset.x,y:-h.scroll.offset.y}),fs(h.latestValues)&&la(d,h.latestValues)}return fs(this.latestValues)&&la(d,this.latestValues),d}removeTransform(a){const u=Ot();ui(u,a);for(let d=0;d<this.path.length;d++){const c=this.path[d];if(!c.instance||!fs(c.latestValues))continue;kf(c.latestValues)&&c.updateSnapshot();const h=Ot(),m=c.measurePageBox();ui(h,m),uv(u,c.latestValues,c.snapshot?c.snapshot.layoutBox:void 0,h)}return fs(this.latestValues)&&uv(u,this.latestValues),u}setTargetDelta(a){this.targetDelta=a,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(a){this.options={...this.options,...a,crossfade:a.crossfade!==void 0?a.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Wt.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(a=!1){var y;const u=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=u.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=u.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=u.isSharedProjectionDirty);const d=!!this.resumingFrom||this!==u;if(!(a||d&&this.isSharedProjectionDirty||this.isProjectionDirty||(y=this.parent)!=null&&y.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:h,layoutId:m}=this.options;if(!this.layout||!(h||m))return;this.resolvedRelativeTargetAt=Wt.timestamp;const p=this.getClosestProjectingParent();p&&this.linkedParentVersion!==p.layoutVersion&&!p.options.layoutRoot&&this.removeRelativeTarget(),!this.targetDelta&&!this.relativeTarget&&(p&&p.layout?this.createRelativeTarget(p,this.layout.layoutBox,p.layout.layoutBox):this.removeRelativeTarget()),!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=Ot(),this.targetWithTransforms=Ot()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),Sk(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):ui(this.target,this.layout.layoutBox),qS(this.target,this.targetDelta)):ui(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget&&(this.attemptToResolveRelativeTarget=!1,p&&!!p.resumingFrom==!!this.resumingFrom&&!p.options.layoutScroll&&p.target&&this.animationProgress!==1?this.createRelativeTarget(p,this.target,p.target):this.relativeParent=this.relativeTarget=void 0))}getClosestProjectingParent(){if(!(!this.parent||kf(this.parent.latestValues)||YS(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}createRelativeTarget(a,u,d){this.relativeParent=a,this.linkedParentVersion=a.layoutVersion,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Ot(),this.relativeTargetOrigin=Ot(),ec(this.relativeTargetOrigin,u,d),ui(this.relativeTarget,this.relativeTargetOrigin)}removeRelativeTarget(){this.relativeParent=this.relativeTarget=void 0}calcProjection(){var v;const a=this.getLead(),u=!!this.resumingFrom||this!==a;let d=!0;if((this.isProjectionDirty||(v=this.parent)!=null&&v.isProjectionDirty)&&(d=!1),u&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(d=!1),this.resolvedRelativeTargetAt===Wt.timestamp&&(d=!1),d)return;const{layout:c,layoutId:h}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(c||h))return;ui(this.layoutCorrected,this.layout.layoutBox);const m=this.treeScale.x,p=this.treeScale.y;XD(this.layoutCorrected,this.treeScale,this.path,u),a.layout&&!a.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(a.target=a.layout.layoutBox,a.targetWithTransforms=Ot());const{target:y}=a;if(!y){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(iv(this.prevProjectionDelta.x,this.projectionDelta.x),iv(this.prevProjectionDelta.y,this.projectionDelta.y)),To(this.projectionDelta,this.layoutCorrected,y,this.latestValues),(this.treeScale.x!==m||this.treeScale.y!==p||!mv(this.projectionDelta.x,this.prevProjectionDelta.x)||!mv(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",y))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(a=!0){var u;if((u=this.options.visualElement)==null||u.scheduleRender(),a){const d=this.getStack();d&&d.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=aa(),this.projectionDelta=aa(),this.projectionDeltaWithTransform=aa()}setAnimationOrigin(a,u=!1){const d=this.snapshot,c=d?d.latestValues:{},h={...this.latestValues},m=aa();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!u;const p=Ot(),y=d?d.source:void 0,v=this.layout?this.layout.source:void 0,E=y!==v,S=this.getStack(),A=!S||S.members.length<=1,L=!!(E&&!A&&this.options.crossfade===!0&&!this.path.some(qk));this.animationProgress=0;let R;this.mixTargetDelta=D=>{const k=D/1e3;Sv(m.x,a.x,k),Sv(m.y,a.y,k),this.setTargetDelta(m),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(ec(p,this.layout.layoutBox,this.relativeParent.layout.layoutBox),Yk(this.relativeTarget,this.relativeTargetOrigin,p,k),R&&Lk(this.relativeTarget,R)&&(this.isProjectionDirty=!1),R||(R=Ot()),ui(R,this.relativeTarget)),E&&(this.animationValues=h,Ik(h,c,this.latestValues,k,L,A)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=k},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(a){var u,d,c;this.notifyListeners("animationStart"),(u=this.currentAnimation)==null||u.stop(),(c=(d=this.resumingFrom)==null?void 0:d.currentAnimation)==null||c.stop(),this.pendingAnimation&&(Br(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=ut.update(()=>{Bu.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=ga(0)),this.motionValue.jump(0,!1),this.currentAnimation=kk(this.motionValue,[0,1e3],{...a,velocity:0,isSync:!0,onUpdate:h=>{this.mixTargetDelta(h),a.onUpdate&&a.onUpdate(h)},onStop:()=>{},onComplete:()=>{a.onComplete&&a.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const a=this.getStack();a&&a.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(Ok),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const a=this.getLead();let{targetWithTransforms:u,target:d,layout:c,latestValues:h}=a;if(!(!u||!d||!c)){if(this!==a&&this.layout&&c&&fT(this.options.animationType,this.layout.layoutBox,c.layoutBox)){d=this.target||Ot();const m=fn(this.layout.layoutBox.x);d.x.min=a.target.x.min,d.x.max=d.x.min+m;const p=fn(this.layout.layoutBox.y);d.y.min=a.target.y.min,d.y.max=d.y.min+p}ui(u,d),la(u,h),To(this.projectionDeltaWithTransform,this.layoutCorrected,u,h)}}registerSharedNode(a,u){this.sharedNodes.has(a)||this.sharedNodes.set(a,new Nk),this.sharedNodes.get(a).add(u);const c=u.options.initialPromotionConfig;u.promote({transition:c?c.transition:void 0,preserveFollowOpacity:c&&c.shouldPreserveFollowOpacity?c.shouldPreserveFollowOpacity(u):void 0})}isLead(){const a=this.getStack();return a?a.lead===this:!0}getLead(){var u;const{layoutId:a}=this.options;return a?((u=this.getStack())==null?void 0:u.lead)||this:this}getPrevLead(){var u;const{layoutId:a}=this.options;return a?(u=this.getStack())==null?void 0:u.prevLead:void 0}getStack(){const{layoutId:a}=this.options;if(a)return this.root.sharedNodes.get(a)}promote({needsReset:a,transition:u,preserveFollowOpacity:d}={}){const c=this.getStack();c&&c.promote(this,d),a&&(this.projectionDelta=void 0,this.needsReset=!0),u&&this.setOptions({transition:u})}relegate(){const a=this.getStack();return a?a.relegate(this):!1}resetSkewAndRotation(){const{visualElement:a}=this.options;if(!a)return;let u=!1;const{latestValues:d}=a;if((d.z||d.rotate||d.rotateX||d.rotateY||d.rotateZ||d.skewX||d.skewY)&&(u=!0),!u)return;const c={};d.z&&wh("z",a,c,this.animationValues);for(let h=0;h<Ah.length;h++)wh(`rotate${Ah[h]}`,a,c,this.animationValues),wh(`skew${Ah[h]}`,a,c,this.animationValues);a.render();for(const h in c)a.setStaticValue(h,c[h]),this.animationValues&&(this.animationValues[h]=c[h]);a.scheduleRender()}applyProjectionStyles(a,u){if(!this.instance||this.isSVG)return;if(!this.isVisible){a.visibility="hidden";return}const d=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,a.visibility="",a.opacity="",a.pointerEvents=Fu(u==null?void 0:u.pointerEvents)||"",a.transform=d?d(this.latestValues,""):"none";return}const c=this.getLead();if(!this.projectionDelta||!this.layout||!c.target){this.options.layoutId&&(a.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,a.pointerEvents=Fu(u==null?void 0:u.pointerEvents)||""),this.hasProjected&&!fs(this.latestValues)&&(a.transform=d?d({},""):"none",this.hasProjected=!1);return}a.visibility="";const h=c.animationValues||c.latestValues;this.applyTransformsToTarget();let m=Rk(this.projectionDeltaWithTransform,this.treeScale,h);d&&(m=d(h,m)),a.transform=m;const{x:p,y}=this.projectionDelta;a.transformOrigin=`${p.origin*100}% ${y.origin*100}% 0`,c.animationValues?a.opacity=c===this?h.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:h.opacityExit:a.opacity=c===this?h.opacity!==void 0?h.opacity:"":h.opacityExit!==void 0?h.opacityExit:0;for(const v in _f){if(h[v]===void 0)continue;const{correct:E,applyTo:S,isCSSVariable:A}=_f[v],L=m==="none"?h[v]:E(h[v],c);if(S){const R=S.length;for(let D=0;D<R;D++)a[S[D]]=L}else A?this.options.visualElement.renderState.vars[v]=L:a[v]=L}this.options.layoutId&&(a.pointerEvents=c===this?Fu(u==null?void 0:u.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(a=>{var u;return(u=a.currentAnimation)==null?void 0:u.stop()}),this.root.nodes.forEach(vv),this.root.sharedNodes.clear()}}}function Bk(i){i.updateLayout()}function Uk(i){var t;const e=((t=i.resumeFrom)==null?void 0:t.snapshot)||i.snapshot;if(i.isLead()&&i.layout&&e&&i.hasListeners("didUpdate")){const{layoutBox:n,measuredBox:r}=i.layout,{animationType:s}=i.options,a=e.source!==i.layout.source;s==="size"?Ii(m=>{const p=a?e.measuredBox[m]:e.layoutBox[m],y=fn(p);p.min=n[m].min,p.max=p.min+y}):fT(s,e.layoutBox,n)&&Ii(m=>{const p=a?e.measuredBox[m]:e.layoutBox[m],y=fn(n[m]);p.max=p.min+y,i.relativeTarget&&!i.currentAnimation&&(i.isProjectionDirty=!0,i.relativeTarget[m].max=i.relativeTarget[m].min+y)});const u=aa();To(u,n,e.layoutBox);const d=aa();a?To(d,i.applyTransform(r,!0),e.measuredBox):To(d,n,e.layoutBox);const c=!oT(u);let h=!1;if(!i.resumeFrom){const m=i.getClosestProjectingParent();if(m&&!m.resumeFrom){const{snapshot:p,layout:y}=m;if(p&&y){const v=Ot();ec(v,e.layoutBox,p.layoutBox);const E=Ot();ec(E,n,y.layoutBox),lT(v,E)||(h=!0),m.options.layoutRoot&&(i.relativeTarget=E,i.relativeTargetOrigin=v,i.relativeParent=m)}}}i.notifyListeners("didUpdate",{layout:n,snapshot:e,delta:d,layoutDelta:u,hasLayoutChanged:c,hasRelativeLayoutChanged:h})}else if(i.isLead()){const{onExitComplete:n}=i.options;n&&n()}i.options.transition=void 0}function $k(i){i.parent&&(i.isProjecting()||(i.isProjectionDirty=i.parent.isProjectionDirty),i.isSharedProjectionDirty||(i.isSharedProjectionDirty=!!(i.isProjectionDirty||i.parent.isProjectionDirty||i.parent.isSharedProjectionDirty)),i.isTransformDirty||(i.isTransformDirty=i.parent.isTransformDirty))}function jk(i){i.isProjectionDirty=i.isSharedProjectionDirty=i.isTransformDirty=!1}function Vk(i){i.clearSnapshot()}function vv(i){i.clearMeasurements()}function xv(i){i.isLayoutDirty=!1}function Gk(i){const{visualElement:e}=i.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),i.resetTransform()}function Ev(i){i.finishAnimation(),i.targetDelta=i.relativeTarget=i.target=void 0,i.isProjectionDirty=!0}function Hk(i){i.resolveTargetDelta()}function zk(i){i.calcProjection()}function Kk(i){i.resetSkewAndRotation()}function Wk(i){i.removeLeadSnapshot()}function Sv(i,e,t){i.translate=vt(e.translate,0,t),i.scale=vt(e.scale,1,t),i.origin=e.origin,i.originPoint=e.originPoint}function Tv(i,e,t,n){i.min=vt(e.min,t.min,n),i.max=vt(e.max,t.max,n)}function Yk(i,e,t,n){Tv(i.x,e.x,t.x,n),Tv(i.y,e.y,t.y,n)}function qk(i){return i.animationValues&&i.animationValues.opacityExit!==void 0}const Xk={duration:.45,ease:[.4,0,.1,1]},Av=i=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(i),wv=Av("applewebkit/")&&!Av("chrome/")?Math.round:qn;function Lv(i){i.min=wv(i.min),i.max=wv(i.max)}function Qk(i){Lv(i.x),Lv(i.y)}function fT(i,e,t){return i==="position"||i==="preserve-aspect"&&!Ek(fv(e),fv(t),.2)}function Zk(i){var e;return i!==i.root&&((e=i.scroll)==null?void 0:e.wasRoot)}const Jk=hT({attachResizeListener:(i,e)=>Oo(i,"resize",e),measureScroll:()=>{var i,e;return{x:document.documentElement.scrollLeft||((i=document.body)==null?void 0:i.scrollLeft)||0,y:document.documentElement.scrollTop||((e=document.body)==null?void 0:e.scrollTop)||0}},checkIsScrollRoot:()=>!0}),Lh={current:void 0},mT=hT({measureScroll:i=>({x:i.scrollLeft,y:i.scrollTop}),defaultParent:()=>{if(!Lh.current){const i=new Jk({});i.mount(window),i.setOptions({layoutScroll:!0}),Lh.current=i}return Lh.current},resetTransform:(i,e)=>{i.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:i=>window.getComputedStyle(i).position==="fixed"}),Hm=M.createContext({transformPagePoint:i=>i,isStatic:!1,reducedMotion:"never"});function Rv(i,e){if(typeof i=="function")return i(e);i!=null&&(i.current=e)}function eP(...i){return e=>{let t=!1;const n=i.map(r=>{const s=Rv(r,e);return!t&&typeof s=="function"&&(t=!0),s});if(t)return()=>{for(let r=0;r<n.length;r++){const s=n[r];typeof s=="function"?s():Rv(i[r],null)}}}}function tP(...i){return M.useCallback(eP(...i),i)}class nP extends M.Component{getSnapshotBeforeUpdate(e){const t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent&&this.props.pop!==!1){const n=t.offsetParent,r=Cf(n)&&n.offsetWidth||0,s=Cf(n)&&n.offsetHeight||0,a=this.props.sizeRef.current;a.height=t.offsetHeight||0,a.width=t.offsetWidth||0,a.top=t.offsetTop,a.left=t.offsetLeft,a.right=r-a.width-a.left,a.bottom=s-a.height-a.top}return null}componentDidUpdate(){}render(){return this.props.children}}function iP({children:i,isPresent:e,anchorX:t,anchorY:n,root:r,pop:s}){var p;const a=M.useId(),u=M.useRef(null),d=M.useRef({width:0,height:0,top:0,left:0,right:0,bottom:0}),{nonce:c}=M.useContext(Hm),h=((p=i.props)==null?void 0:p.ref)??(i==null?void 0:i.ref),m=tP(u,h);return M.useInsertionEffect(()=>{const{width:y,height:v,top:E,left:S,right:A,bottom:L}=d.current;if(e||s===!1||!u.current||!y||!v)return;const R=t==="left"?`left: ${S}`:`right: ${A}`,D=n==="bottom"?`bottom: ${L}`:`top: ${E}`;u.current.dataset.motionPopId=a;const k=document.createElement("style");c&&(k.nonce=c);const U=r??document.head;return U.appendChild(k),k.sheet&&k.sheet.insertRule(`
          [data-motion-pop-id="${a}"] {
            position: absolute !important;
            width: ${y}px !important;
            height: ${v}px !important;
            ${R}px !important;
            ${D}px !important;
          }
        `),()=>{U.contains(k)&&U.removeChild(k)}},[e]),b.jsx(nP,{isPresent:e,childRef:u,sizeRef:d,pop:s,children:s===!1?i:M.cloneElement(i,{ref:m})})}const rP=({children:i,initial:e,isPresent:t,onExitComplete:n,custom:r,presenceAffectsLayout:s,mode:a,anchorX:u,anchorY:d,root:c})=>{const h=ym(sP),m=M.useId();let p=!0,y=M.useMemo(()=>(p=!1,{id:m,initial:e,isPresent:t,custom:r,onExitComplete:v=>{h.set(v,!0);for(const E of h.values())if(!E)return;n&&n()},register:v=>(h.set(v,!1),()=>h.delete(v))}),[t,h,n]);return s&&p&&(y={...y}),M.useMemo(()=>{h.forEach((v,E)=>h.set(E,!1))},[t]),M.useEffect(()=>{!t&&!h.size&&n&&n()},[t]),i=b.jsx(iP,{pop:a==="popLayout",isPresent:t,anchorX:u,anchorY:d,root:c,children:i}),b.jsx(gc.Provider,{value:y,children:i})};function sP(){return new Map}function pT(i=!0){const e=M.useContext(gc);if(e===null)return[!0,null];const{isPresent:t,onExitComplete:n,register:r}=e,s=M.useId();M.useEffect(()=>{if(i)return r(s)},[i]);const a=M.useCallback(()=>i&&n&&n(s),[s,n,i]);return!t&&n?[!1,a]:[!0]}const hu=i=>i.key||"";function bv(i){const e=[];return M.Children.forEach(i,t=>{M.isValidElement(t)&&e.push(t)}),e}const aP=({children:i,custom:e,initial:t=!0,onExitComplete:n,presenceAffectsLayout:r=!0,mode:s="sync",propagate:a=!1,anchorX:u="left",anchorY:d="top",root:c})=>{const[h,m]=pT(a),p=M.useMemo(()=>bv(i),[i]),y=a&&!h?[]:p.map(hu),v=M.useRef(!0),E=M.useRef(p),S=ym(()=>new Map),A=M.useRef(new Set),[L,R]=M.useState(p),[D,k]=M.useState(p);GE(()=>{v.current=!1,E.current=p;for(let _=0;_<D.length;_++){const F=hu(D[_]);y.includes(F)?(S.delete(F),A.current.delete(F)):S.get(F)!==!0&&S.set(F,!1)}},[D,y.length,y.join("-")]);const U=[];if(p!==L){let _=[...p];for(let F=0;F<D.length;F++){const O=D[F],W=hu(O);y.includes(W)||(_.splice(F,0,O),U.push(O))}return s==="wait"&&U.length&&(_=U),k(bv(_)),R(p),null}const{forceRender:C}=M.useContext(gm);return b.jsx(b.Fragment,{children:D.map(_=>{const F=hu(_),O=a&&!h?!1:p===D||y.includes(F),W=()=>{if(A.current.has(F))return;if(A.current.add(F),S.has(F))S.set(F,!0);else return;let z=!0;S.forEach(re=>{re||(z=!1)}),z&&(C==null||C(),k(E.current),a&&(m==null||m()),n&&n())};return b.jsx(rP,{isPresent:O,initial:!v.current||t?void 0:!1,custom:e,presenceAffectsLayout:r,mode:s,root:c,onExitComplete:O?void 0:W,anchorX:u,anchorY:d,children:_},F)})})},gT=M.createContext({strict:!1}),Iv={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]};let Cv=!1;function oP(){if(Cv)return;const i={};for(const e in Iv)i[e]={isEnabled:t=>Iv[e].some(n=>!!t[n])};zS(i),Cv=!0}function yT(){return oP(),KD()}function lP(i){const e=yT();for(const t in i)e[t]={...e[t],...i[t]};zS(e)}const uP=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","propagate","ignoreStrict","viewport"]);function tc(i){return i.startsWith("while")||i.startsWith("drag")&&i!=="draggable"||i.startsWith("layout")||i.startsWith("onTap")||i.startsWith("onPan")||i.startsWith("onLayout")||uP.has(i)}let vT=i=>!tc(i);function cP(i){typeof i=="function"&&(vT=e=>e.startsWith("on")?!tc(e):i(e))}try{cP(require("@emotion/is-prop-valid").default)}catch{}function dP(i,e,t){const n={};for(const r in i)r==="values"&&typeof i.values=="object"||(vT(r)||t===!0&&tc(r)||!e&&!tc(r)||i.draggable&&r.startsWith("onDrag"))&&(n[r]=i[r]);return n}const xc=M.createContext({});function hP(i,e){if(vc(i)){const{initial:t,animate:n}=i;return{initial:t===!1||No(t)?t:void 0,animate:No(n)?n:void 0}}return i.inherit!==!1?e:{}}function fP(i){const{initial:e,animate:t}=hP(i,M.useContext(xc));return M.useMemo(()=>({initial:e,animate:t}),[Dv(e),Dv(t)])}function Dv(i){return Array.isArray(i)?i.join(" "):i}const zm=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function xT(i,e,t){for(const n in e)!rn(e[n])&&!ZS(n,t)&&(i[n]=e[n])}function mP({transformTemplate:i},e){return M.useMemo(()=>{const t=zm();return Vm(t,e,i),Object.assign({},t.vars,t.style)},[e])}function pP(i,e){const t=i.style||{},n={};return xT(n,t,i),Object.assign(n,mP(i,e)),n}function gP(i,e){const t={},n=pP(i,e);return i.drag&&i.dragListener!==!1&&(t.draggable=!1,n.userSelect=n.WebkitUserSelect=n.WebkitTouchCallout="none",n.touchAction=i.drag===!0?"none":`pan-${i.drag==="x"?"y":"x"}`),i.tabIndex===void 0&&(i.onTap||i.onTapStart||i.whileTap)&&(t.tabIndex=0),t.style=n,t}const ET=()=>({...zm(),attrs:{}});function yP(i,e,t,n){const r=M.useMemo(()=>{const s=ET();return JS(s,e,tT(n),i.transformTemplate,i.style),{...s.attrs,style:{...s.style}}},[e]);if(i.style){const s={};xT(s,i.style,i),r.style={...s,...r.style}}return r}const vP=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function Km(i){return typeof i!="string"||i.includes("-")?!1:!!(vP.indexOf(i)>-1||/[A-Z]/u.test(i))}function xP(i,e,t,{latestValues:n},r,s=!1,a){const d=(a??Km(i)?yP:gP)(e,n,r,i),c=dP(e,typeof i=="string",s),h=i!==M.Fragment?{...c,...d,ref:t}:{},{children:m}=e,p=M.useMemo(()=>rn(m)?m.get():m,[m]);return M.createElement(i,{...h,children:p})}function EP({scrapeMotionValuesFromProps:i,createRenderState:e},t,n,r){return{latestValues:SP(t,n,r,i),renderState:e()}}function SP(i,e,t,n){const r={},s=n(i,{});for(const p in s)r[p]=Fu(s[p]);let{initial:a,animate:u}=i;const d=vc(i),c=GS(i);e&&c&&!d&&i.inherit!==!1&&(a===void 0&&(a=e.initial),u===void 0&&(u=e.animate));let h=t?t.initial===!1:!1;h=h||a===!1;const m=h?u:a;if(m&&typeof m!="boolean"&&!yc(m)){const p=Array.isArray(m)?m:[m];for(let y=0;y<p.length;y++){const v=Mm(i,p[y]);if(v){const{transitionEnd:E,transition:S,...A}=v;for(const L in A){let R=A[L];if(Array.isArray(R)){const D=h?R.length-1:0;R=R[D]}R!==null&&(r[L]=R)}for(const L in E)r[L]=E[L]}}}return r}const ST=i=>(e,t)=>{const n=M.useContext(xc),r=M.useContext(gc),s=()=>EP(i,e,n,r);return t?s():ym(s)},TP=ST({scrapeMotionValuesFromProps:Gm,createRenderState:zm}),AP=ST({scrapeMotionValuesFromProps:nT,createRenderState:ET}),wP=Symbol.for("motionComponentSymbol");function LP(i,e,t){const n=M.useRef(t);M.useInsertionEffect(()=>{n.current=t});const r=M.useRef(null);return M.useCallback(s=>{var u;s&&((u=i.onMount)==null||u.call(i,s)),e&&(s?e.mount(s):e.unmount());const a=n.current;if(typeof a=="function")if(s){const d=a(s);typeof d=="function"&&(r.current=d)}else r.current?(r.current(),r.current=null):a(s);else a&&(a.current=s)},[e])}const TT=M.createContext({});function ta(i){return i&&typeof i=="object"&&Object.prototype.hasOwnProperty.call(i,"current")}function RP(i,e,t,n,r,s){var R,D;const{visualElement:a}=M.useContext(xc),u=M.useContext(gT),d=M.useContext(gc),c=M.useContext(Hm),h=c.reducedMotion,m=c.skipAnimations,p=M.useRef(null),y=M.useRef(!1);n=n||u.renderer,!p.current&&n&&(p.current=n(i,{visualState:e,parent:a,props:t,presenceContext:d,blockInitialAnimation:d?d.initial===!1:!1,reducedMotionConfig:h,skipAnimations:m,isSVG:s}),y.current&&p.current&&(p.current.manuallyAnimateOnMount=!0));const v=p.current,E=M.useContext(TT);v&&!v.projection&&r&&(v.type==="html"||v.type==="svg")&&bP(p.current,t,r,E);const S=M.useRef(!1);M.useInsertionEffect(()=>{v&&S.current&&v.update(t,d)});const A=t[DS],L=M.useRef(!!A&&!((R=window.MotionHandoffIsComplete)!=null&&R.call(window,A))&&((D=window.MotionHasOptimisedAnimation)==null?void 0:D.call(window,A)));return GE(()=>{y.current=!0,v&&(S.current=!0,window.MotionIsMounted=!0,v.updateFeatures(),v.scheduleRenderMicrotask(),L.current&&v.animationState&&v.animationState.animateChanges())}),M.useEffect(()=>{v&&(!L.current&&v.animationState&&v.animationState.animateChanges(),L.current&&(queueMicrotask(()=>{var k;(k=window.MotionHandoffMarkAsComplete)==null||k.call(window,A)}),L.current=!1),v.enteringChildren=void 0)}),v}function bP(i,e,t,n){const{layoutId:r,layout:s,drag:a,dragConstraints:u,layoutScroll:d,layoutRoot:c,layoutCrossfade:h}=e;i.projection=new t(i.latestValues,e["data-framer-portal-id"]?void 0:AT(i.parent)),i.projection.setOptions({layoutId:r,layout:s,alwaysMeasureLayout:!!a||u&&ta(u),visualElement:i,animationType:typeof s=="string"?s:"both",initialPromotionConfig:n,crossfade:h,layoutScroll:d,layoutRoot:c})}function AT(i){if(i)return i.options.allowProjection!==!1?i.projection:AT(i.parent)}function Rh(i,{forwardMotionProps:e=!1,type:t}={},n,r){n&&lP(n);const s=t?t==="svg":Km(i),a=s?AP:TP;function u(c,h){let m;const p={...M.useContext(Hm),...c,layoutId:IP(c)},{isStatic:y}=p,v=fP(c),E=a(c,y);if(!y&&VE){CP();const S=DP(p);m=S.MeasureLayout,v.visualElement=RP(i,E,p,r,S.ProjectionNode,s)}return b.jsxs(xc.Provider,{value:v,children:[m&&v.visualElement?b.jsx(m,{visualElement:v.visualElement,...p}):null,xP(i,c,LP(E,v.visualElement,h),E,y,e,s)]})}u.displayName=`motion.${typeof i=="string"?i:`create(${i.displayName??i.name??""})`}`;const d=M.forwardRef(u);return d[wP]=i,d}function IP({layoutId:i}){const e=M.useContext(gm).id;return e&&i!==void 0?e+"-"+i:i}function CP(i,e){M.useContext(gT).strict}function DP(i){const e=yT(),{drag:t,layout:n}=e;if(!t&&!n)return{};const r={...t,...n};return{MeasureLayout:t!=null&&t.isEnabled(i)||n!=null&&n.isEnabled(i)?r.MeasureLayout:void 0,ProjectionNode:r.ProjectionNode}}function kP(i,e){if(typeof Proxy>"u")return Rh;const t=new Map,n=(s,a)=>Rh(s,a,i,e),r=(s,a)=>n(s,a);return new Proxy(r,{get:(s,a)=>a==="create"?n:(t.has(a)||t.set(a,Rh(a,void 0,i,e)),t.get(a))})}const PP=(i,e)=>e.isSVG??Km(i)?new uk(e):new ik(e,{allowProjection:i!==M.Fragment});class _P extends Gr{constructor(e){super(e),e.animationState||(e.animationState=mk(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();yc(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:t}=this.node.prevProps||{};e!==t&&this.updateAnimationControlsSubscription()}unmount(){var e;this.node.animationState.reset(),(e=this.unmountControls)==null||e.call(this)}}let MP=0;class NP extends Gr{constructor(){super(...arguments),this.id=MP++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:t}=this.node.presenceContext,{isPresent:n}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===n)return;const r=this.node.animationState.setActive("exit",!e);t&&!e&&r.then(()=>{t(this.id)})}mount(){const{register:e,onExitComplete:t}=this.node.presenceContext||{};t&&t(this.id),e&&(this.unmount=e(this.id))}unmount(){}}const OP={animation:{Feature:_P},exit:{Feature:NP}};function Zo(i){return{point:{x:i.pageX,y:i.pageY}}}const FP=i=>e=>Bm(e)&&i(e,Zo(e));function Ao(i,e,t,n){return Oo(i,e,FP(t),n)}const wT=({current:i})=>i?i.ownerDocument.defaultView:null,kv=(i,e)=>Math.abs(i-e);function BP(i,e){const t=kv(i.x,e.x),n=kv(i.y,e.y);return Math.sqrt(t**2+n**2)}const Pv=new Set(["auto","scroll"]);class LT{constructor(e,t,{transformPagePoint:n,contextWindow:r=window,dragSnapToOrigin:s=!1,distanceThreshold:a=3,element:u}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.scrollPositions=new Map,this.removeScrollListeners=null,this.onElementScroll=y=>{this.handleScroll(y.target)},this.onWindowScroll=()=>{this.handleScroll(window)},this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const y=Ih(this.lastMoveEventInfo,this.history),v=this.startEvent!==null,E=BP(y.offset,{x:0,y:0})>=this.distanceThreshold;if(!v&&!E)return;const{point:S}=y,{timestamp:A}=Wt;this.history.push({...S,timestamp:A});const{onStart:L,onMove:R}=this.handlers;v||(L&&L(this.lastMoveEvent,y),this.startEvent=this.lastMoveEvent),R&&R(this.lastMoveEvent,y)},this.handlePointerMove=(y,v)=>{this.lastMoveEvent=y,this.lastMoveEventInfo=bh(v,this.transformPagePoint),ut.update(this.updatePoint,!0)},this.handlePointerUp=(y,v)=>{this.end();const{onEnd:E,onSessionEnd:S,resumeAnimation:A}=this.handlers;if((this.dragSnapToOrigin||!this.startEvent)&&A&&A(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const L=Ih(y.type==="pointercancel"?this.lastMoveEventInfo:bh(v,this.transformPagePoint),this.history);this.startEvent&&E&&E(y,L),S&&S(y,L)},!Bm(e))return;this.dragSnapToOrigin=s,this.handlers=t,this.transformPagePoint=n,this.distanceThreshold=a,this.contextWindow=r||window;const d=Zo(e),c=bh(d,this.transformPagePoint),{point:h}=c,{timestamp:m}=Wt;this.history=[{...h,timestamp:m}];const{onSessionStart:p}=t;p&&p(e,Ih(c,this.history)),this.removeListeners=qo(Ao(this.contextWindow,"pointermove",this.handlePointerMove),Ao(this.contextWindow,"pointerup",this.handlePointerUp),Ao(this.contextWindow,"pointercancel",this.handlePointerUp)),u&&this.startScrollTracking(u)}startScrollTracking(e){let t=e.parentElement;for(;t;){const n=getComputedStyle(t);(Pv.has(n.overflowX)||Pv.has(n.overflowY))&&this.scrollPositions.set(t,{x:t.scrollLeft,y:t.scrollTop}),t=t.parentElement}this.scrollPositions.set(window,{x:window.scrollX,y:window.scrollY}),window.addEventListener("scroll",this.onElementScroll,{capture:!0}),window.addEventListener("scroll",this.onWindowScroll),this.removeScrollListeners=()=>{window.removeEventListener("scroll",this.onElementScroll,{capture:!0}),window.removeEventListener("scroll",this.onWindowScroll)}}handleScroll(e){const t=this.scrollPositions.get(e);if(!t)return;const n=e===window,r=n?{x:window.scrollX,y:window.scrollY}:{x:e.scrollLeft,y:e.scrollTop},s={x:r.x-t.x,y:r.y-t.y};s.x===0&&s.y===0||(n?this.lastMoveEventInfo&&(this.lastMoveEventInfo.point.x+=s.x,this.lastMoveEventInfo.point.y+=s.y):this.history.length>0&&(this.history[0].x-=s.x,this.history[0].y-=s.y),this.scrollPositions.set(e,r),ut.update(this.updatePoint,!0))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),this.removeScrollListeners&&this.removeScrollListeners(),this.scrollPositions.clear(),Br(this.updatePoint)}}function bh(i,e){return e?{point:e(i.point)}:i}function _v(i,e){return{x:i.x-e.x,y:i.y-e.y}}function Ih({point:i},e){return{point:i,delta:_v(i,RT(e)),offset:_v(i,UP(e)),velocity:$P(e,.1)}}function UP(i){return i[0]}function RT(i){return i[i.length-1]}function $P(i,e){if(i.length<2)return{x:0,y:0};let t=i.length-1,n=null;const r=RT(i);for(;t>=0&&(n=i[t],!(r.timestamp-n.timestamp>pi(e)));)t--;if(!n)return{x:0,y:0};n===i[0]&&i.length>2&&r.timestamp-n.timestamp>pi(e)*2&&(n=i[1]);const s=Yn(r.timestamp-n.timestamp);if(s===0)return{x:0,y:0};const a={x:(r.x-n.x)/s,y:(r.y-n.y)/s};return a.x===1/0&&(a.x=0),a.y===1/0&&(a.y=0),a}function jP(i,{min:e,max:t},n){return e!==void 0&&i<e?i=n?vt(e,i,n.min):Math.max(i,e):t!==void 0&&i>t&&(i=n?vt(t,i,n.max):Math.min(i,t)),i}function Mv(i,e,t){return{min:e!==void 0?i.min+e:void 0,max:t!==void 0?i.max+t-(i.max-i.min):void 0}}function VP(i,{top:e,left:t,bottom:n,right:r}){return{x:Mv(i.x,t,r),y:Mv(i.y,e,n)}}function Nv(i,e){let t=e.min-i.min,n=e.max-i.max;return e.max-e.min<i.max-i.min&&([t,n]=[n,t]),{min:t,max:n}}function GP(i,e){return{x:Nv(i.x,e.x),y:Nv(i.y,e.y)}}function HP(i,e){let t=.5;const n=fn(i),r=fn(e);return r>n?t=Po(e.min,e.max-n,i.min):n>r&&(t=Po(i.min,i.max-r,e.min)),Oi(0,1,t)}function zP(i,e){const t={};return e.min!==void 0&&(t.min=e.min-i.min),e.max!==void 0&&(t.max=e.max-i.min),t}const Mf=.35;function KP(i=Mf){return i===!1?i=0:i===!0&&(i=Mf),{x:Ov(i,"left","right"),y:Ov(i,"top","bottom")}}function Ov(i,e,t){return{min:Fv(i,e),max:Fv(i,t)}}function Fv(i,e){return typeof i=="number"?i:i[e]||0}const WP=new WeakMap;class YP{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=Ot(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=e}start(e,{snapToCursor:t=!1,distanceThreshold:n}={}){const{presenceContext:r}=this.visualElement;if(r&&r.isPresent===!1)return;const s=m=>{t&&this.snapToCursor(Zo(m).point),this.stopAnimation()},a=(m,p)=>{const{drag:y,dragPropagation:v,onDragStart:E}=this.getProps();if(y&&!v&&(this.openDragLock&&this.openDragLock(),this.openDragLock=TD(y),!this.openDragLock))return;this.latestPointerEvent=m,this.latestPanInfo=p,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Ii(A=>{let L=this.getAxisMotionValue(A).get()||0;if(Mi.test(L)){const{projection:R}=this.visualElement;if(R&&R.layout){const D=R.layout.layoutBox[A];D&&(L=fn(D)*(parseFloat(L)/100))}}this.originPoint[A]=L}),E&&ut.update(()=>E(m,p),!1,!0),Lf(this.visualElement,"transform");const{animationState:S}=this.visualElement;S&&S.setActive("whileDrag",!0)},u=(m,p)=>{this.latestPointerEvent=m,this.latestPanInfo=p;const{dragPropagation:y,dragDirectionLock:v,onDirectionLock:E,onDrag:S}=this.getProps();if(!y&&!this.openDragLock)return;const{offset:A}=p;if(v&&this.currentDirection===null){this.currentDirection=XP(A),this.currentDirection!==null&&E&&E(this.currentDirection);return}this.updateAxis("x",p.point,A),this.updateAxis("y",p.point,A),this.visualElement.render(),S&&ut.update(()=>S(m,p),!1,!0)},d=(m,p)=>{this.latestPointerEvent=m,this.latestPanInfo=p,this.stop(m,p),this.latestPointerEvent=null,this.latestPanInfo=null},c=()=>{const{dragSnapToOrigin:m}=this.getProps();(m||this.constraints)&&this.startAnimation({x:0,y:0})},{dragSnapToOrigin:h}=this.getProps();this.panSession=new LT(e,{onSessionStart:s,onStart:a,onMove:u,onSessionEnd:d,resumeAnimation:c},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:h,distanceThreshold:n,contextWindow:wT(this.visualElement),element:this.visualElement.current})}stop(e,t){const n=e||this.latestPointerEvent,r=t||this.latestPanInfo,s=this.isDragging;if(this.cancel(),!s||!r||!n)return;const{velocity:a}=r;this.startAnimation(a);const{onDragEnd:u}=this.getProps();u&&ut.postRender(()=>u(n,r))}cancel(){this.isDragging=!1;const{projection:e,animationState:t}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.endPanSession();const{dragPropagation:n}=this.getProps();!n&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),t&&t.setActive("whileDrag",!1)}endPanSession(){this.panSession&&this.panSession.end(),this.panSession=void 0}updateAxis(e,t,n){const{drag:r}=this.getProps();if(!n||!fu(e,r,this.currentDirection))return;const s=this.getAxisMotionValue(e);let a=this.originPoint[e]+n[e];this.constraints&&this.constraints[e]&&(a=jP(a,this.constraints[e],this.elastic[e])),s.set(a)}resolveConstraints(){var s;const{dragConstraints:e,dragElastic:t}=this.getProps(),n=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(s=this.visualElement.projection)==null?void 0:s.layout,r=this.constraints;e&&ta(e)?this.constraints||(this.constraints=this.resolveRefConstraints()):e&&n?this.constraints=VP(n.layoutBox,e):this.constraints=!1,this.elastic=KP(t),r!==this.constraints&&!ta(e)&&n&&this.constraints&&!this.hasMutatedConstraints&&Ii(a=>{this.constraints!==!1&&this.getAxisMotionValue(a)&&(this.constraints[a]=zP(n.layoutBox[a],this.constraints[a]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:t}=this.getProps();if(!e||!ta(e))return!1;const n=e.current,{projection:r}=this.visualElement;if(!r||!r.layout)return!1;const s=QD(n,r.root,this.visualElement.getTransformPagePoint());let a=GP(r.layout.layoutBox,s);if(t){const u=t(YD(a));this.hasMutatedConstraints=!!u,u&&(a=WS(u))}return a}startAnimation(e){const{drag:t,dragMomentum:n,dragElastic:r,dragTransition:s,dragSnapToOrigin:a,onDragTransitionEnd:u}=this.getProps(),d=this.constraints||{},c=Ii(h=>{if(!fu(h,t,this.currentDirection))return;let m=d&&d[h]||{};a&&(m={min:0,max:0});const p=r?200:1e6,y=r?40:1e7,v={type:"inertia",velocity:n?e[h]:0,bounceStiffness:p,bounceDamping:y,timeConstant:750,restDelta:1,restSpeed:10,...s,...m};return this.startAxisValueAnimation(h,v)});return Promise.all(c).then(u)}startAxisValueAnimation(e,t){const n=this.getAxisMotionValue(e);return Lf(this.visualElement,e),n.start(_m(e,n,0,t,this.visualElement,!1))}stopAnimation(){Ii(e=>this.getAxisMotionValue(e).stop())}getAxisMotionValue(e){const t=`_drag${e.toUpperCase()}`,n=this.visualElement.getProps(),r=n[t];return r||this.visualElement.getValue(e,(n.initial?n.initial[e]:void 0)||0)}snapToCursor(e){Ii(t=>{const{drag:n}=this.getProps();if(!fu(t,n,this.currentDirection))return;const{projection:r}=this.visualElement,s=this.getAxisMotionValue(t);if(r&&r.layout){const{min:a,max:u}=r.layout.layoutBox[t],d=s.get()||0;s.set(e[t]-vt(a,u,.5)+d)}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:t}=this.getProps(),{projection:n}=this.visualElement;if(!ta(t)||!n||!this.constraints)return;this.stopAnimation();const r={x:0,y:0};Ii(a=>{const u=this.getAxisMotionValue(a);if(u&&this.constraints!==!1){const d=u.get();r[a]=HP({min:d,max:d},this.constraints[a])}});const{transformTemplate:s}=this.visualElement.getProps();this.visualElement.current.style.transform=s?s({},""):"none",n.root&&n.root.updateScroll(),n.updateLayout(),this.constraints=!1,this.resolveConstraints(),Ii(a=>{if(!fu(a,e,null))return;const u=this.getAxisMotionValue(a),{min:d,max:c}=this.constraints[a];u.set(vt(d,c,r[a]))}),this.visualElement.render()}addListeners(){if(!this.visualElement.current)return;WP.set(this.visualElement,this);const e=this.visualElement.current,t=Ao(e,"pointerdown",c=>{const{drag:h,dragListener:m=!0}=this.getProps(),p=c.target,y=p!==e&&ID(p);h&&m&&!y&&this.start(c)});let n;const r=()=>{const{dragConstraints:c}=this.getProps();ta(c)&&c.current&&(this.constraints=this.resolveRefConstraints(),n||(n=qP(e,c.current,()=>this.scalePositionWithinConstraints())))},{projection:s}=this.visualElement,a=s.addEventListener("measure",r);s&&!s.layout&&(s.root&&s.root.updateScroll(),s.updateLayout()),ut.read(r);const u=Oo(window,"resize",()=>this.scalePositionWithinConstraints()),d=s.addEventListener("didUpdate",(({delta:c,hasLayoutChanged:h})=>{this.isDragging&&h&&(Ii(m=>{const p=this.getAxisMotionValue(m);p&&(this.originPoint[m]+=c[m].translate,p.set(p.get()+c[m].translate))}),this.visualElement.render())}));return()=>{u(),t(),a(),d&&d(),n&&n()}}getProps(){const e=this.visualElement.getProps(),{drag:t=!1,dragDirectionLock:n=!1,dragPropagation:r=!1,dragConstraints:s=!1,dragElastic:a=Mf,dragMomentum:u=!0}=e;return{...e,drag:t,dragDirectionLock:n,dragPropagation:r,dragConstraints:s,dragElastic:a,dragMomentum:u}}}function Bv(i){let e=!0;return()=>{if(e){e=!1;return}i()}}function qP(i,e,t){const n=zy(i,Bv(t)),r=zy(e,Bv(t));return()=>{n(),r()}}function fu(i,e,t){return(e===!0||e===i)&&(t===null||t===i)}function XP(i,e=10){let t=null;return Math.abs(i.y)>e?t="y":Math.abs(i.x)>e&&(t="x"),t}class QP extends Gr{constructor(e){super(e),this.removeGroupControls=qn,this.removeListeners=qn,this.controls=new YP(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||qn}update(){const{dragControls:e}=this.node.getProps(),{dragControls:t}=this.node.prevProps||{};e!==t&&(this.removeGroupControls(),e&&(this.removeGroupControls=e.subscribe(this.controls)))}unmount(){this.removeGroupControls(),this.removeListeners(),this.controls.isDragging||this.controls.endPanSession()}}const Ch=i=>(e,t)=>{i&&ut.update(()=>i(e,t),!1,!0)};class ZP extends Gr{constructor(){super(...arguments),this.removePointerDownListener=qn}onPointerDown(e){this.session=new LT(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:wT(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:t,onPan:n,onPanEnd:r}=this.node.getProps();return{onSessionStart:Ch(e),onStart:Ch(t),onMove:Ch(n),onEnd:(s,a)=>{delete this.session,r&&ut.postRender(()=>r(s,a))}}}mount(){this.removePointerDownListener=Ao(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}let Dh=!1;class JP extends M.Component{componentDidMount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:n,layoutId:r}=this.props,{projection:s}=e;s&&(t.group&&t.group.add(s),n&&n.register&&r&&n.register(s),Dh&&s.root.didUpdate(),s.addEventListener("animationComplete",()=>{this.safeToRemove()}),s.setOptions({...s.options,layoutDependency:this.props.layoutDependency,onExitComplete:()=>this.safeToRemove()})),Bu.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:t,visualElement:n,drag:r,isPresent:s}=this.props,{projection:a}=n;return a&&(a.isPresent=s,e.layoutDependency!==t&&a.setOptions({...a.options,layoutDependency:t}),Dh=!0,r||e.layoutDependency!==t||t===void 0||e.isPresent!==s?a.willUpdate():this.safeToRemove(),e.isPresent!==s&&(s?a.promote():a.relegate()||ut.postRender(()=>{const u=a.getStack();(!u||!u.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),Fm.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:n}=this.props,{projection:r}=e;Dh=!0,r&&(r.scheduleCheckAfterUnmount(),t&&t.group&&t.group.remove(r),n&&n.deregister&&n.deregister(r))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function bT(i){const[e,t]=pT(),n=M.useContext(gm);return b.jsx(JP,{...i,layoutGroup:n,switchLayoutGroup:M.useContext(TT),isPresent:e,safeToRemove:t})}const e_={pan:{Feature:ZP},drag:{Feature:QP,ProjectionNode:mT,MeasureLayout:bT}};function Uv(i,e,t){const{props:n}=i;i.animationState&&n.whileHover&&i.animationState.setActive("whileHover",t==="Start");const r="onHover"+t,s=n[r];s&&ut.postRender(()=>s(e,Zo(e)))}class t_ extends Gr{mount(){const{current:e}=this.node;e&&(this.unmount=wD(e,(t,n)=>(Uv(this.node,n,"Start"),r=>Uv(this.node,r,"End"))))}unmount(){}}class n_ extends Gr{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=qo(Oo(this.node.current,"focus",()=>this.onFocus()),Oo(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function $v(i,e,t){const{props:n}=i;if(i.current instanceof HTMLButtonElement&&i.current.disabled)return;i.animationState&&n.whileTap&&i.animationState.setActive("whileTap",t==="Start");const r="onTap"+(t==="End"?"":t),s=n[r];s&&ut.postRender(()=>s(e,Zo(e)))}class i_ extends Gr{mount(){const{current:e}=this.node;if(!e)return;const{globalTapTarget:t,propagate:n}=this.node.props;this.unmount=DD(e,(r,s)=>($v(this.node,s,"Start"),(a,{success:u})=>$v(this.node,a,u?"End":"Cancel")),{useGlobalTarget:t,stopPropagation:(n==null?void 0:n.tap)===!1})}unmount(){}}const Nf=new WeakMap,kh=new WeakMap,r_=i=>{const e=Nf.get(i.target);e&&e(i)},s_=i=>{i.forEach(r_)};function a_({root:i,...e}){const t=i||document;kh.has(t)||kh.set(t,{});const n=kh.get(t),r=JSON.stringify(e);return n[r]||(n[r]=new IntersectionObserver(s_,{root:i,...e})),n[r]}function o_(i,e,t){const n=a_(e);return Nf.set(i,t),n.observe(i),()=>{Nf.delete(i),n.unobserve(i)}}const l_={some:0,all:1};class u_ extends Gr{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:t,margin:n,amount:r="some",once:s}=e,a={root:t?t.current:void 0,rootMargin:n,threshold:typeof r=="number"?r:l_[r]},u=d=>{const{isIntersecting:c}=d;if(this.isInView===c||(this.isInView=c,s&&!c&&this.hasEnteredView))return;c&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",c);const{onViewportEnter:h,onViewportLeave:m}=this.node.getProps(),p=c?h:m;p&&p(d)};return o_(this.node.current,a,u)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:t}=this.node;["amount","margin","root"].some(c_(e,t))&&this.startObserver()}unmount(){}}function c_({viewport:i={}},{viewport:e={}}={}){return t=>i[t]!==e[t]}const d_={inView:{Feature:u_},tap:{Feature:i_},focus:{Feature:n_},hover:{Feature:t_}},h_={layout:{ProjectionNode:mT,MeasureLayout:bT}},f_={...OP,...d_,...e_,...h_},Pt=kP(f_,PP);function m_({movie:i}){const[e,t]=M.useState(mi.isInWatchlist(i.id)),n=()=>{e?(mi.removeFromWatchlist(i.id),t(!1)):(mi.addToWatchlist(i.id),t(!0))};return b.jsxs("div",{className:"relative h-[70vh] min-h-[500px] w-full overflow-hidden",children:[b.jsxs("div",{className:"absolute inset-0",children:[b.jsx("img",{src:i.backdrop,alt:i.title,className:"w-full h-full object-cover"}),b.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-[#0a0a0a] via-[#0a0a0a]/60 to-transparent"}),b.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-[#0a0a0a] via-transparent to-transparent"})]}),b.jsx("div",{className:"relative h-full max-w-[1920px] mx-auto px-4 sm:px-6 lg:px-8 flex items-end pb-16",children:b.jsxs(Pt.div,{className:"max-w-2xl",initial:{opacity:0,y:40},animate:{opacity:1,y:0},transition:{duration:.8,delay:.2},children:[i.tags.length>0&&b.jsxs("div",{className:"flex gap-2 mb-4",children:[i.tags.includes("hot")&&b.jsx("span",{className:"px-3 py-1 bg-red-600 rounded-full text-xs font-semibold",children:" HOT"}),i.tags.includes("new")&&b.jsx("span",{className:"px-3 py-1 bg-blue-600 rounded-full text-xs font-semibold",children:" MI NHT"}),i.tags.includes("trending")&&b.jsx("span",{className:"px-3 py-1 bg-purple-600 rounded-full text-xs font-semibold",children:" TRENDING"})]}),b.jsx("h1",{className:"text-4xl sm:text-5xl md:text-6xl font-bold mb-4 leading-tight",children:i.title}),b.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-sm text-gray-300 mb-4",children:[b.jsxs("span",{className:"flex items-center gap-1",children:[b.jsx("span",{className:"text-yellow-500",children:""}),b.jsx("span",{className:"font-semibold",children:i.rating.toFixed(1)})]}),b.jsx("span",{children:""}),b.jsx("span",{children:i.releaseYear}),b.jsx("span",{children:""}),b.jsxs("span",{children:[i.duration," pht"]}),b.jsx("span",{children:""}),b.jsx("span",{children:i.type==="movie"?"Phim":"Series"})]}),b.jsx("div",{className:"flex flex-wrap gap-2 mb-6",children:i.genres.map(r=>b.jsx("span",{className:"px-3 py-1 bg-white/10 backdrop-blur-sm border border-white/20 rounded-full text-sm",children:r},r))}),b.jsx("p",{className:"text-base sm:text-lg text-gray-300 mb-8 line-clamp-3 max-w-xl",children:i.description}),b.jsxs("div",{className:"flex flex-wrap gap-3",children:[b.jsxs(kt,{to:`/watch/${i.id}`,className:"flex items-center gap-2 px-8 py-3 bg-red-600 hover:bg-red-700 rounded-lg font-semibold transition-colors",children:[b.jsx(Es,{className:"w-5 h-5 fill-current"}),"Xem ngay"]}),b.jsxs(kt,{to:`/movie/${i.id}`,className:"flex items-center gap-2 px-6 py-3 bg-white/20 hover:bg-white/30 backdrop-blur-sm border border-white/30 rounded-lg font-semibold transition-colors",children:[b.jsx(UE,{className:"w-5 h-5"}),"Chi tit"]}),b.jsx("button",{onClick:n,className:"flex items-center gap-2 px-6 py-3 bg-white/10 hover:bg-white/20 backdrop-blur-sm border border-white/20 rounded-lg font-semibold transition-colors",children:e?b.jsxs(b.Fragment,{children:[b.jsx(mm,{className:"w-5 h-5"})," thm"]}):b.jsxs(b.Fragment,{children:[b.jsx(pm,{className:"w-5 h-5"}),"Danh sch"]})})]})]})})]})}function Wm({movie:i}){const[e,t]=M.useState(mi.isInWatchlist(i.id)),n=r=>{r.preventDefault(),r.stopPropagation(),e?(mi.removeFromWatchlist(i.id),t(!1)):(mi.addToWatchlist(i.id),t(!0))};return b.jsx(kt,{to:`/movie/${i.id}`,children:b.jsxs(Pt.div,{className:"group relative aspect-[2/3] rounded-lg overflow-hidden bg-gray-900 cursor-pointer",whileHover:{scale:1.05},transition:{duration:.3,ease:"easeOut"},children:[b.jsx("img",{src:i.poster,alt:i.title,className:"w-full h-full object-cover"}),b.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black via-black/50 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"}),b.jsxs(Pt.div,{className:"absolute inset-0 p-4 flex flex-col justify-end opacity-0 group-hover:opacity-100 transition-opacity duration-300",initial:{y:20},whileHover:{y:0},children:[b.jsx("h3",{className:"text-lg font-semibold mb-1 line-clamp-2",children:i.title}),b.jsxs("div",{className:"flex items-center gap-3 text-sm text-gray-300 mb-3",children:[b.jsxs("div",{className:"flex items-center gap-1",children:[b.jsx($E,{className:"w-4 h-4 fill-yellow-500 text-yellow-500"}),b.jsx("span",{children:i.rating.toFixed(1)})]}),b.jsx("span",{children:""}),b.jsx("span",{children:i.releaseYear}),b.jsx("span",{children:""}),b.jsxs("span",{children:[i.duration,"p"]})]}),b.jsx("div",{className:"flex gap-2 mb-2",children:i.genres.slice(0,2).map(r=>b.jsx("span",{className:"px-2 py-0.5 bg-white/20 rounded text-xs",children:r},r))}),b.jsxs("div",{className:"flex gap-2",children:[b.jsxs(kt,{to:`/watch/${i.id}`,className:"flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-red-600 hover:bg-red-700 rounded-lg text-sm font-medium transition-colors",onClick:r=>r.stopPropagation(),children:[b.jsx(Es,{className:"w-4 h-4"}),"Xem"]}),b.jsx("button",{onClick:n,className:"p-2 bg-white/20 hover:bg-white/30 rounded-lg transition-colors",title:e?"Xa khi danh sch":"Thm vo danh sch",children:e?b.jsx(mm,{className:"w-4 h-4"}):b.jsx(pm,{className:"w-4 h-4"})})]})]}),i.tags.length>0&&b.jsxs("div",{className:"absolute top-2 left-2 flex gap-1",children:[i.tags.includes("hot")&&b.jsx("span",{className:"px-2 py-0.5 bg-red-600 rounded text-xs font-medium",children:"HOT"}),i.tags.includes("new")&&b.jsx("span",{className:"px-2 py-0.5 bg-blue-600 rounded text-xs font-medium",children:"MI"})]})]})})}function cs({title:i,movies:e}){const t=M.useRef(null),n=r=>{if(t.current){const s=t.current.clientWidth*.8,a=r==="left"?t.current.scrollLeft-s:t.current.scrollLeft+s;t.current.scrollTo({left:a,behavior:"smooth"})}};return e.length===0?null:b.jsxs("div",{className:"mb-8 group/row",children:[b.jsx("h2",{className:"text-2xl font-semibold mb-4 px-4 sm:px-6 lg:px-8",children:i}),b.jsxs("div",{className:"relative",children:[b.jsx("button",{onClick:()=>n("left"),className:"absolute left-0 top-0 bottom-0 z-10 w-12 bg-gradient-to-r from-black/80 to-transparent flex items-center justify-center opacity-0 group-hover/row:opacity-100 transition-opacity hover:from-black","aria-label":"Scroll left",children:b.jsx(Ob,{className:"w-8 h-8"})}),b.jsx("button",{onClick:()=>n("right"),className:"absolute right-0 top-0 bottom-0 z-10 w-12 bg-gradient-to-l from-black/80 to-transparent flex items-center justify-center opacity-0 group-hover/row:opacity-100 transition-opacity hover:from-black","aria-label":"Scroll right",children:b.jsx(Bb,{className:"w-8 h-8"})}),b.jsx("div",{ref:t,className:"flex gap-3 overflow-x-auto scrollbar-hide px-4 sm:px-6 lg:px-8 scroll-smooth",style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:e.map((r,s)=>b.jsx(Pt.div,{className:"flex-none w-[150px] sm:w-[180px] md:w-[200px]",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:s*.05,duration:.4},children:b.jsx(Wm,{movie:r})},r.id))})]})]})}const ir=[{id:"1",title:"Bng m Huyn B",originalTitle:"Mysterious Night",description:"Mt thm t ti ba phi i mt vi v n b n nht trong s nghip. Khi bng ti bao trm thnh ph, nhng b mt en ti dn c h l.",poster:"https://images.unsplash.com/photo-1710988486821-9af47f60d62b?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxjaW5lbWF0aWMlMjBtb3ZpZSUyMHBvc3RlciUyMGRhcmt8ZW58MXx8fHwxNzcxOTQ5MTQ3fDA&ixlib=rb-4.1.0&q=80&w=1080",backdrop:"https://images.unsplash.com/photo-1770150511131-e0a8089f35a7?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHx0aHJpbGxlciUyMHN1c3BlbnNlJTIwbXlzdGVyaW91c3xlbnwxfHx8fDE3NzE5ODczOTB8MA&ixlib=rb-4.1.0&q=80&w=1080",trailer:"https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8",videoUrl:"https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8",duration:128,releaseYear:2024,rating:8.5,genres:["Thriller","Mystery","Drama"],country:"Vit Nam",director:"Nguyn Vn A",cast:[{id:"a1",name:"Trn Minh Hong",character:"Thm t Hong",avatar:"https://images.unsplash.com/photo-1749003659562-a1beba85eee2?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxhc2lhbiUyMG1hbGUlMjBhY3RvciUyMHBvcnRyYWl0fGVufDF8fHx8MTc3MTk4NzM5MXww&ixlib=rb-4.1.0&q=80&w=1080"},{id:"a2",name:"L Thu H",character:"Lut s H",avatar:"https://images.unsplash.com/photo-1697510364485-e900c2fe7524?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxhc2lhbiUyMGZlbWFsZSUyMGFjdHJlc3MlMjBwb3J0cmFpdHxlbnwxfHx8fDE3NzE5ODczOTF8MA&ixlib=rb-4.1.0&q=80&w=1080"}],tags:["hot","trending","new"],type:"movie"},{id:"2",title:"Nhim V Bt Kh Thi",originalTitle:"Impossible Mission",description:"Mt i c nhim u t c giao nhim v ngn chn mt m mu khng b e da ha bnh th gii. Thi gian ang cn dn.",poster:"https://images.unsplash.com/photo-1642662495649-90bfdf89f2cf?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxhY3Rpb24lMjBtb3ZpZSUyMHNjZW5lJTIwZXhwbG9zaW9ufGVufDF8fHx8MTc3MTg5OTI3MHww&ixlib=rb-4.1.0&q=80&w=1080",backdrop:"https://images.unsplash.com/photo-1642662495649-90bfdf89f2cf?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxhY3Rpb24lMjBtb3ZpZSUyMHNjZW5lJTIwZXhwbG9zaW9ufGVufDF8fHx8MTc3MTg5OTI3MHww&ixlib=rb-4.1.0&q=80&w=1080",trailer:"https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8",videoUrl:"https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8",duration:145,releaseYear:2024,rating:9.2,genres:["Action","Thriller","Adventure"],country:"USA",director:"Michael Bay",cast:[{id:"a3",name:"Nguyn Thanh Long",character:"i trng Long",avatar:"https://images.unsplash.com/photo-1749003659562-a1beba85eee2?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxhc2lhbiUyMG1hbGUlMjBhY3RvciUyMHBvcnRyYWl0fGVufDF8fHx8MTc3MTk4NzM5MXww&ixlib=rb-4.1.0&q=80&w=1080"}],tags:["hot","trending"],type:"movie"},{id:"3",title:"Tnh Yu Hong Hn",originalTitle:"Sunset Romance",description:"Mt cu chuyn tnh lng mn gia hai ngi l gp nhau trong mt chuyn du lch nh mnh. Tnh yu n r di nh hong hn.",poster:"https://images.unsplash.com/photo-1658851866325-49fb8b7fbcb2?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxyb21hbnRpYyUyMGNvdXBsZSUyMHN1bnNldHxlbnwxfHx8fDE3NzE5ODM0Mjh8MA&ixlib=rb-4.1.0&q=80&w=1080",backdrop:"https://images.unsplash.com/photo-1658851866325-49fb8b7fbcb2?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxyb21hbnRpYyUyMGNvdXBsZSUyMHN1bnNldHxlbnwxfHx8fDE3NzE5ODM0Mjh8MA&ixlib=rb-4.1.0&q=80&w=1080",trailer:"https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8",videoUrl:"https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8",duration:112,releaseYear:2024,rating:7.8,genres:["Romance","Drama"],country:"Hn Quc",director:"Park Chan-wook",cast:[{id:"a2",name:"L Thu H",character:"H",avatar:"https://images.unsplash.com/photo-1697510364485-e900c2fe7524?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxhc2lhbiUyMGZlbWFsZSUyMGFjdHJlc3MlMjBwb3J0cmFpdHxlbnwxfHx8fDE3NzE5ODczOTF8MA&ixlib=rb-4.1.0&q=80&w=1080"},{id:"a1",name:"Trn Minh Hong",character:"Hong",avatar:"https://images.unsplash.com/photo-1749003659562-a1beba85eee2?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxhc2lhbiUyMG1hbGUlMjBhY3RvciUyMHBvcnRyYWl0fGVufDF8fHx8MTc3MTk4NzM5MXww&ixlib=rb-4.1.0&q=80&w=1080"}],tags:["new","recommended"],type:"movie"},{id:"4",title:"Khu Rng Kinh Hong",originalTitle:"The Haunted Forest",description:"Mt nhm thanh nin i cm tri trong rng su v pht hin ra nhng b n kinh hong n giu trong bng ti.",poster:"https://images.unsplash.com/photo-1723913961620-5d03606522f5?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxob3Jyb3IlMjBzY2FyeSUyMGRhcmslMjBmb3Jlc3R8ZW58MXx8fHwxNzcxOTg3Mzg5fDA&ixlib=rb-4.1.0&q=80&w=1080",backdrop:"https://images.unsplash.com/photo-1723913961620-5d03606522f5?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxob3Jyb3IlMjBzY2FyeSUyMGRhcmslMjBmb3Jlc3R8ZW58MXx8fHwxNzcxOTg3Mzg5fDA&ixlib=rb-4.1.0&q=80&w=1080",trailer:"https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8",videoUrl:"https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8",duration:95,releaseYear:2024,rating:7.2,genres:["Horror","Thriller"],country:"Nht Bn",director:"Takashi Shimizu",cast:[],tags:["new"],type:"movie"},{id:"5",title:"Thnh Ph Tng Lai",originalTitle:"Future City",description:"Nm 2099, nhn loi sng trong cc thnh ph cng ngh cao. Mt hacker tr pht hin b mt c th thay i vn mnh loi ngi.",poster:"https://images.unsplash.com/photo-1715614176939-f5c46ae99d04?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxzY2lmaSUyMGZ1dHVyaXN0aWMlMjBjaXR5JTIwbmVvbnxlbnwxfHx8fDE3NzE5ODczODl8MA&ixlib=rb-4.1.0&q=80&w=1080",backdrop:"https://images.unsplash.com/photo-1715614176939-f5c46ae99d04?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxzY2lmaSUyMGZ1dHVyaXN0aWMlMjBjaXR5JTIwbmVvbnxlbnwxfHx8fDE3NzE5ODczODl8MA&ixlib=rb-4.1.0&q=80&w=1080",trailer:"https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8",videoUrl:"https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8",duration:138,releaseYear:2024,rating:8.9,genres:["Sci-Fi","Action","Thriller"],country:"USA",director:"Denis Villeneuve",cast:[],tags:["hot","trending","recommended"],type:"movie"},{id:"6",title:"Hnh Trnh Vui Nhn",originalTitle:"Comedy Journey",description:"Ba ngi bn thn ln ng du lch xuyn quc gia v gp phi v s tnh hung hi hc, ng ngn.",poster:"https://images.unsplash.com/photo-1604674725989-52c312835516?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxjb21lZHklMjBsYXVnaGluZyUyMGhhcHB5JTIwcGVvcGxlfGVufDF8fHx8MTc3MTk4NzM5MHww&ixlib=rb-4.1.0&q=80&w=1080",backdrop:"https://images.unsplash.com/photo-1604674725989-52c312835516?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxjb21lZHklMjBsYXVnaGluZyUyMGhhcHB5JTIwcGVvcGxlfGVufDF8fHx8MTc3MTk4NzM5MHww&ixlib=rb-4.1.0&q=80&w=1080",trailer:"https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8",videoUrl:"https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8",duration:105,releaseYear:2024,rating:7.5,genres:["Comedy","Adventure"],country:"Vit Nam",director:"Trn Thnh",cast:[],tags:["recommended"],type:"movie"},{id:"7",title:"Ni au Gia nh",originalTitle:"Family Drama",description:"Mt gia nh phi i mt vi nhng th thch kh khn khi b mt v qu kh c h l. Tnh yu thng c  mnh  hn gn?",poster:"https://images.unsplash.com/photo-1631632286519-cb83e10e3d98?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxkcmFtYSUyMGludGVuc2UlMjBlbW90aW9uYWx8ZW58MXx8fHwxNzcxOTg3MzkwfDA&ixlib=rb-4.1.0&q=80&w=1080",backdrop:"https://images.unsplash.com/photo-1631632286519-cb83e10e3d98?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxkcmFtYSUyMGludGVuc2UlMjBlbW90aW9uYWx8ZW58MXx8fHwxNzcxOTg3MzkwfDA&ixlib=rb-4.1.0&q=80&w=1080",trailer:"https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8",videoUrl:"https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8",duration:125,releaseYear:2023,rating:8.3,genres:["Drama","Family"],country:"Vit Nam",director:"Nguyn Quang Dng",cast:[],tags:[],type:"movie"},{id:"8",title:"Hnh Trnh Vt Ni",originalTitle:"Mountain Quest",description:"Mt nhm leo ni chinh phc nh ni nguy him nht th gii. H phi i mt vi thin nhin khc nghit v th thch v tinh thn.",poster:"https://images.unsplash.com/photo-1673505413397-0cd0dc4f5854?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxhZHZlbnR1cmUlMjBtb3VudGFpbiUyMGxhbmRzY2FwZXxlbnwxfHx8fDE3NzE5NDM5NjN8MA&ixlib=rb-4.1.0&q=80&w=1080",backdrop:"https://images.unsplash.com/photo-1673505413397-0cd0dc4f5854?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxhZHZlbnR1cmUlMjBtb3VudGFpbiUyMGxhbmRzY2FwZXxlbnwxfHx8fDE3NzE5NDM5NjN8MA&ixlib=rb-4.1.0&q=80&w=1080",trailer:"https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8",videoUrl:"https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8",duration:118,releaseYear:2023,rating:7.9,genres:["Adventure","Documentary"],country:"Nepal",director:"Jimmy Chin",cast:[],tags:[],type:"movie"},{id:"9",title:"Vng Quc Php Thut",originalTitle:"Magic Kingdom",description:"Trong mt th gii y php thut, mt ph thy tr phi hc cch s dng sc mnh ca mnh  cu vng quc khi th lc en ti.",poster:"https://images.unsplash.com/photo-1763957047074-b47c2c76a320?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxmYW50YXN5JTIwbWFnaWNhbCUyMGZvcmVzdHxlbnwxfHx8fDE3NzE5NjU4MjR8MA&ixlib=rb-4.1.0&q=80&w=1080",backdrop:"https://images.unsplash.com/photo-1763957047074-b47c2c76a320?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxmYW50YXN5JTIwbWFnaWNhbCUyMGZvcmVzdHxlbnwxfHx8fDE3NzE5NjU4MjR8MA&ixlib=rb-4.1.0&q=80&w=1080",trailer:"https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8",videoUrl:"https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8",duration:142,releaseYear:2023,rating:8.6,genres:["Fantasy","Adventure","Action"],country:"UK",director:"Peter Jackson",cast:[],tags:["recommended"],type:"movie"},{id:"10",title:"Gia nh Hnh Phc",originalTitle:"Happy Family",description:"Mt series hi hc v cuc sng thng nht ca mt gia nh Vit Nam hin i vi  cc tnh hung d khc d ci.",poster:"https://images.unsplash.com/photo-1604674725989-52c312835516?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxjb21lZHklMjBsYXVnaGluZyUyMGhhcHB5JTIwcGVvcGxlfGVufDF8fHx8MTc3MTk4NzM5MHww&ixlib=rb-4.1.0&q=80&w=1080",backdrop:"https://images.unsplash.com/photo-1604674725989-52c312835516?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxjb21lZHklMjBsYXVnaGluZyUyMGhhcHB5JTIwcGVvcGxlfGVufDF8fHx8MTc3MTk4NzM5MHww&ixlib=rb-4.1.0&q=80&w=1080",trailer:"https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8",videoUrl:"https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8",duration:45,releaseYear:2024,rating:7.6,genres:["Comedy","Drama","Family"],country:"Vit Nam",director:"V Ngc ng",cast:[],tags:["hot","new"],type:"series",totalEpisodes:30,currentEpisode:15,seasons:[{seasonNumber:1,episodes:Array.from({length:30},(i,e)=>({episodeNumber:e+1,title:`Tp ${e+1}`,description:`Tp ${e+1} ca Gia nh Hnh Phc`,duration:45,thumbnail:"https://images.unsplash.com/photo-1604674725989-52c312835516?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxjb21lZHklMjBsYXVnaGluZyUyMGhhcHB5JTIwcGVvcGxlfGVufDF8fHx8MTc3MTk4NzM5MHww&ixlib=rb-4.1.0&q=80&w=1080",videoUrl:"https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8"}))}]}],nc=i=>ir.find(e=>e.id===i),fo=i=>ir.filter(e=>e.tags.includes(i)),Ph=i=>ir.filter(e=>e.genres.includes(i)),p_=()=>{const i=new Set;return ir.forEach(e=>{e.genres.forEach(t=>i.add(t))}),Array.from(i).sort()},g_=()=>{const i=new Set;return ir.forEach(e=>i.add(e.country)),Array.from(i).sort()},y_=()=>{const i=new Set;return ir.forEach(e=>i.add(e.releaseYear)),Array.from(i).sort((e,t)=>t-e)};function v_(){const i=fo("hot")[0]||ir[0],e=fo("hot"),t=fo("new"),n=fo("trending"),r=fo("recommended"),s=Ph("Action"),a=Ph("Romance"),u=Ph("Thriller");return b.jsxs("div",{children:[b.jsx(m_,{movie:i}),b.jsxs("div",{className:"py-8 space-y-8",children:[e.length>0&&b.jsx(cs,{title:" Phim Hot",movies:e}),t.length>0&&b.jsx(cs,{title:" Mi Nht",movies:t}),n.length>0&&b.jsx(cs,{title:" Trending",movies:n}),r.length>0&&b.jsx(cs,{title:"  Xut Cho Bn",movies:r}),s.length>0&&b.jsx(cs,{title:" Phim Hnh ng",movies:s}),a.length>0&&b.jsx(cs,{title:" Phim Tnh Cm",movies:a}),u.length>0&&b.jsx(cs,{title:" Phim Ly K",movies:u})]})]})}function x_(){const{id:i}=IE(),e=As(),t=i?nc(i):null,[n,r]=M.useState(t?mi.isInWatchlist(t.id):!1);if(!t)return b.jsx("div",{className:"min-h-screen flex items-center justify-center",children:b.jsxs("div",{className:"text-center",children:[b.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Khng tm thy phim"}),b.jsx(kt,{to:"/",className:"text-red-500 hover:underline",children:"V trang ch"})]})});const s=()=>{n?(mi.removeFromWatchlist(t.id),r(!1)):(mi.addToWatchlist(t.id),r(!0))};return b.jsxs("div",{className:"min-h-screen",children:[b.jsxs("div",{className:"relative h-[60vh] min-h-[400px] w-full overflow-hidden",children:[b.jsx("img",{src:t.backdrop,alt:t.title,className:"w-full h-full object-cover"}),b.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-[#0a0a0a] via-[#0a0a0a]/60 to-transparent"}),b.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-[#0a0a0a] via-transparent to-transparent"}),b.jsx("button",{onClick:()=>e(-1),className:"absolute top-4 left-4 sm:left-8 p-2 bg-black/50 hover:bg-black/70 backdrop-blur-sm rounded-full transition-colors",children:b.jsx(FE,{className:"w-6 h-6"})})]}),b.jsx("div",{className:"max-w-[1920px] mx-auto px-4 sm:px-6 lg:px-8 -mt-32 relative z-10",children:b.jsxs("div",{className:"flex flex-col lg:flex-row gap-8",children:[b.jsx(Pt.div,{className:"flex-none w-full sm:w-64 lg:w-80",initial:{opacity:0,y:40},animate:{opacity:1,y:0},transition:{duration:.6},children:b.jsx("img",{src:t.poster,alt:t.title,className:"w-full rounded-lg shadow-2xl"})}),b.jsxs(Pt.div,{className:"flex-1",initial:{opacity:0,y:40},animate:{opacity:1,y:0},transition:{duration:.6,delay:.2},children:[b.jsx("h1",{className:"text-4xl sm:text-5xl font-bold mb-2",children:t.title}),b.jsx("p",{className:"text-xl text-gray-400 mb-6",children:t.originalTitle}),b.jsxs("div",{className:"flex flex-wrap items-center gap-4 mb-6",children:[b.jsxs("div",{className:"flex items-center gap-2 text-yellow-500",children:[b.jsx($E,{className:"w-5 h-5 fill-current"}),b.jsx("span",{className:"text-xl font-semibold",children:t.rating.toFixed(1)}),b.jsx("span",{className:"text-gray-400",children:"/10"})]}),b.jsxs("div",{className:"flex items-center gap-2 text-gray-300",children:[b.jsx(kb,{className:"w-5 h-5"}),b.jsx("span",{children:t.releaseYear})]}),b.jsxs("div",{className:"flex items-center gap-2 text-gray-300",children:[b.jsx(uf,{className:"w-5 h-5"}),b.jsxs("span",{children:[t.duration," pht"]})]}),b.jsx("span",{className:"px-3 py-1 bg-red-600 rounded-full text-sm font-semibold",children:t.type==="movie"?"Phim":"Series"})]}),b.jsx("div",{className:"flex flex-wrap gap-2 mb-6",children:t.genres.map(a=>b.jsx("span",{className:"px-4 py-2 bg-white/10 border border-white/20 rounded-lg text-sm",children:a},a))}),b.jsxs("div",{className:"flex flex-wrap gap-3 mb-8",children:[b.jsxs(kt,{to:`/watch/${t.id}`,className:"flex items-center gap-2 px-8 py-3 bg-red-600 hover:bg-red-700 rounded-lg font-semibold transition-colors",children:[b.jsx(Es,{className:"w-5 h-5 fill-current"}),"Xem ngay"]}),b.jsx("button",{onClick:s,className:"flex items-center gap-2 px-6 py-3 bg-white/10 hover:bg-white/20 border border-white/20 rounded-lg font-semibold transition-colors",children:n?b.jsxs(b.Fragment,{children:[b.jsx(mm,{className:"w-5 h-5"})," thm"]}):b.jsxs(b.Fragment,{children:[b.jsx(pm,{className:"w-5 h-5"}),"Danh sch"]})})]}),b.jsxs("div",{className:"mb-8",children:[b.jsx("h2",{className:"text-2xl font-semibold mb-3",children:"Ni dung phim"}),b.jsx("p",{className:"text-gray-300 text-lg leading-relaxed",children:t.description})]}),b.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6 mb-8",children:[b.jsxs("div",{children:[b.jsx("h3",{className:"text-sm text-gray-400 mb-1",children:"o din"}),b.jsx("p",{className:"text-lg",children:t.director})]}),b.jsxs("div",{children:[b.jsx("h3",{className:"text-sm text-gray-400 mb-1",children:"Quc gia"}),b.jsx("p",{className:"text-lg",children:t.country})]})]}),t.cast.length>0&&b.jsxs("div",{children:[b.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"Din vin"}),b.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4",children:t.cast.map(a=>b.jsxs("div",{className:"text-center",children:[b.jsx("img",{src:a.avatar,alt:a.name,className:"w-full aspect-square object-cover rounded-lg mb-2"}),b.jsx("p",{className:"font-medium",children:a.name}),b.jsx("p",{className:"text-sm text-gray-400",children:a.character})]},a.id))})]}),t.type==="series"&&t.seasons&&b.jsxs("div",{className:"mt-8",children:[b.jsxs("h2",{className:"text-2xl font-semibold mb-4",children:["Tp phim (",t.totalEpisodes," tp)"]}),b.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-3",children:t.seasons[0].episodes.slice(0,10).map(a=>b.jsx(kt,{to:`/watch/${t.id}?ep=${a.episodeNumber}`,className:"aspect-video rounded-lg overflow-hidden bg-white/10 hover:bg-white/20 border border-white/20 hover:border-red-500 transition-all group",children:b.jsxs("div",{className:"relative w-full h-full flex items-center justify-center",children:[b.jsx("img",{src:a.thumbnail,alt:a.title,className:"absolute inset-0 w-full h-full object-cover opacity-40"}),b.jsxs("div",{className:"relative z-10 text-center",children:[b.jsx(Es,{className:"w-8 h-8 mx-auto mb-1 opacity-0 group-hover:opacity-100 transition-opacity"}),b.jsxs("p",{className:"font-semibold",children:["Tp ",a.episodeNumber]})]})]})},a.episodeNumber))})]})]})]})}),b.jsx("div",{className:"h-32"})]})}const ye=Number.isFinite||function(i){return typeof i=="number"&&isFinite(i)},E_=Number.isSafeInteger||function(i){return typeof i=="number"&&Math.abs(i)<=S_},S_=Number.MAX_SAFE_INTEGER||9007199254740991;let Ie=(function(i){return i.NETWORK_ERROR="networkError",i.MEDIA_ERROR="mediaError",i.KEY_SYSTEM_ERROR="keySystemError",i.MUX_ERROR="muxError",i.OTHER_ERROR="otherError",i})({}),Y=(function(i){return i.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",i.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",i.KEY_SYSTEM_NO_SESSION="keySystemNoSession",i.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",i.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",i.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",i.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",i.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",i.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",i.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",i.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",i.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",i.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",i.MANIFEST_LOAD_ERROR="manifestLoadError",i.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",i.MANIFEST_PARSING_ERROR="manifestParsingError",i.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",i.LEVEL_EMPTY_ERROR="levelEmptyError",i.LEVEL_LOAD_ERROR="levelLoadError",i.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",i.LEVEL_PARSING_ERROR="levelParsingError",i.LEVEL_SWITCH_ERROR="levelSwitchError",i.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",i.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",i.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",i.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",i.FRAG_LOAD_ERROR="fragLoadError",i.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",i.FRAG_DECRYPT_ERROR="fragDecryptError",i.FRAG_PARSING_ERROR="fragParsingError",i.FRAG_GAP="fragGap",i.REMUX_ALLOC_ERROR="remuxAllocError",i.KEY_LOAD_ERROR="keyLoadError",i.KEY_LOAD_TIMEOUT="keyLoadTimeOut",i.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",i.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",i.BUFFER_APPEND_ERROR="bufferAppendError",i.BUFFER_APPENDING_ERROR="bufferAppendingError",i.BUFFER_STALLED_ERROR="bufferStalledError",i.BUFFER_FULL_ERROR="bufferFullError",i.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",i.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",i.ASSET_LIST_LOAD_ERROR="assetListLoadError",i.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",i.ASSET_LIST_PARSING_ERROR="assetListParsingError",i.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",i.INTERNAL_EXCEPTION="internalException",i.INTERNAL_ABORTED="aborted",i.ATTACH_MEDIA_ERROR="attachMediaError",i.UNKNOWN="unknown",i})({}),w=(function(i){return i.MEDIA_ATTACHING="hlsMediaAttaching",i.MEDIA_ATTACHED="hlsMediaAttached",i.MEDIA_DETACHING="hlsMediaDetaching",i.MEDIA_DETACHED="hlsMediaDetached",i.MEDIA_ENDED="hlsMediaEnded",i.STALL_RESOLVED="hlsStallResolved",i.BUFFER_RESET="hlsBufferReset",i.BUFFER_CODECS="hlsBufferCodecs",i.BUFFER_CREATED="hlsBufferCreated",i.BUFFER_APPENDING="hlsBufferAppending",i.BUFFER_APPENDED="hlsBufferAppended",i.BUFFER_EOS="hlsBufferEos",i.BUFFERED_TO_END="hlsBufferedToEnd",i.BUFFER_FLUSHING="hlsBufferFlushing",i.BUFFER_FLUSHED="hlsBufferFlushed",i.MANIFEST_LOADING="hlsManifestLoading",i.MANIFEST_LOADED="hlsManifestLoaded",i.MANIFEST_PARSED="hlsManifestParsed",i.LEVEL_SWITCHING="hlsLevelSwitching",i.LEVEL_SWITCHED="hlsLevelSwitched",i.LEVEL_LOADING="hlsLevelLoading",i.LEVEL_LOADED="hlsLevelLoaded",i.LEVEL_UPDATED="hlsLevelUpdated",i.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",i.LEVELS_UPDATED="hlsLevelsUpdated",i.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",i.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",i.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",i.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",i.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",i.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",i.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",i.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",i.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",i.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",i.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",i.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",i.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",i.CUES_PARSED="hlsCuesParsed",i.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",i.INIT_PTS_FOUND="hlsInitPtsFound",i.FRAG_LOADING="hlsFragLoading",i.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",i.FRAG_LOADED="hlsFragLoaded",i.FRAG_DECRYPTED="hlsFragDecrypted",i.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",i.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",i.FRAG_PARSING_METADATA="hlsFragParsingMetadata",i.FRAG_PARSED="hlsFragParsed",i.FRAG_BUFFERED="hlsFragBuffered",i.FRAG_CHANGED="hlsFragChanged",i.FPS_DROP="hlsFpsDrop",i.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",i.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",i.ERROR="hlsError",i.DESTROYING="hlsDestroying",i.KEY_LOADING="hlsKeyLoading",i.KEY_LOADED="hlsKeyLoaded",i.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",i.BACK_BUFFER_REACHED="hlsBackBufferReached",i.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",i.ASSET_LIST_LOADING="hlsAssetListLoading",i.ASSET_LIST_LOADED="hlsAssetListLoaded",i.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",i.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",i.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",i.INTERSTITIAL_STARTED="hlsInterstitialStarted",i.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",i.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",i.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",i.INTERSTITIAL_ENDED="hlsInterstitialEnded",i.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",i.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",i.EVENT_CUE_ENTER="hlsEventCueEnter",i})({});var ze={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},xe={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};class qs{constructor(e,t=0,n=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=n}sample(e,t){const n=Math.pow(this.alpha_,e);this.estimate_=t*(1-n)+n*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class T_{constructor(e,t,n,r=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=n,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new qs(e),this.fast_=new qs(t),this.defaultTTFB_=r,this.ttfb_=new qs(e)}update(e,t){const{slow_:n,fast_:r,ttfb_:s}=this;n.halfLife!==e&&(this.slow_=new qs(e,n.getEstimate(),n.getTotalWeight())),r.halfLife!==t&&(this.fast_=new qs(t,r.getEstimate(),r.getTotalWeight())),s.halfLife!==e&&(this.ttfb_=new qs(e,s.getEstimate(),s.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);const n=8*t,r=e/1e3,s=n/r;this.fast_.sample(r,s),this.slow_.sample(r,s)}sampleTTFB(e){const t=e/1e3,n=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(n,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function A_(i,e,t){return(e=L_(e))in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function rt(){return rt=Object.assign?Object.assign.bind():function(i){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)({}).hasOwnProperty.call(t,n)&&(i[n]=t[n])}return i},rt.apply(null,arguments)}function jv(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(i);e&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(i,r).enumerable})),t.push.apply(t,n)}return t}function tt(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?jv(Object(t),!0).forEach(function(n){A_(i,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):jv(Object(t)).forEach(function(n){Object.defineProperty(i,n,Object.getOwnPropertyDescriptor(t,n))})}return i}function w_(i,e){if(typeof i!="object"||!i)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var n=t.call(i,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}function L_(i){var e=w_(i,"string");return typeof e=="symbol"?e:e+""}class Jn{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const n=`[${e}]:`;this.trace=kr,this.debug=t.debug.bind(null,n),this.log=t.log.bind(null,n),this.warn=t.warn.bind(null,n),this.info=t.info.bind(null,n),this.error=t.error.bind(null,n)}}const kr=function(){},R_={trace:kr,debug:kr,log:kr,warn:kr,info:kr,error:kr};function Of(){return rt({},R_)}function b_(i,e){const t=self.console[i];return t?t.bind(self.console,`${e?"["+e+"] ":""}[${i}] >`):kr}function Vv(i,e,t){return e[i]?e[i].bind(e):b_(i,t)}const Ff=Of();function I_(i,e,t){const n=Of();if(typeof console=="object"&&i===!0||typeof i=="object"){const r=["debug","log","info","warn","error"];r.forEach(s=>{n[s]=Vv(s,i,t)});try{n.log(`Debug logs enabled for "${e}" in hls.js version 1.6.15`)}catch{return Of()}r.forEach(s=>{Ff[s]=Vv(s,i)})}else rt(Ff,n);return n}const nt=Ff;function Ur(i=!0){return typeof self>"u"?void 0:(i||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function C_(i){return typeof self<"u"&&i===self.ManagedMediaSource}function IT(i,e){const t=Object.keys(i),n=Object.keys(e),r=t.length,s=n.length;return!r||!s||r===s&&!t.some(a=>n.indexOf(a)===-1)}function Bn(i,e=!1){if(typeof TextDecoder<"u"){const c=new TextDecoder("utf-8").decode(i);if(e){const h=c.indexOf("\0");return h!==-1?c.substring(0,h):c}return c.replace(/\0/g,"")}const t=i.length;let n,r,s,a="",u=0;for(;u<t;){if(n=i[u++],n===0&&e)return a;if(n===0||n===3)continue;switch(n>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:a+=String.fromCharCode(n);break;case 12:case 13:r=i[u++],a+=String.fromCharCode((n&31)<<6|r&63);break;case 14:r=i[u++],s=i[u++],a+=String.fromCharCode((n&15)<<12|(r&63)<<6|(s&63)<<0);break}}return a}function qt(i){let e="";for(let t=0;t<i.length;t++){let n=i[t].toString(16);n.length<2&&(n="0"+n),e+=n}return e}function CT(i){return Uint8Array.from(i.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}function D_(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var _h={exports:{}},Gv;function k_(){return Gv||(Gv=1,(function(i,e){(function(t){var n=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,r=/^(?=([^\/?#]*))\1([^]*)$/,s=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,u={buildAbsoluteURL:function(d,c,h){if(h=h||{},d=d.trim(),c=c.trim(),!c){if(!h.alwaysNormalize)return d;var m=u.parseURL(d);if(!m)throw new Error("Error trying to parse base URL.");return m.path=u.normalizePath(m.path),u.buildURLFromParts(m)}var p=u.parseURL(c);if(!p)throw new Error("Error trying to parse relative URL.");if(p.scheme)return h.alwaysNormalize?(p.path=u.normalizePath(p.path),u.buildURLFromParts(p)):c;var y=u.parseURL(d);if(!y)throw new Error("Error trying to parse base URL.");if(!y.netLoc&&y.path&&y.path[0]!=="/"){var v=r.exec(y.path);y.netLoc=v[1],y.path=v[2]}y.netLoc&&!y.path&&(y.path="/");var E={scheme:y.scheme,netLoc:p.netLoc,path:null,params:p.params,query:p.query,fragment:p.fragment};if(!p.netLoc&&(E.netLoc=y.netLoc,p.path[0]!=="/"))if(!p.path)E.path=y.path,p.params||(E.params=y.params,p.query||(E.query=y.query));else{var S=y.path,A=S.substring(0,S.lastIndexOf("/")+1)+p.path;E.path=u.normalizePath(A)}return E.path===null&&(E.path=h.alwaysNormalize?u.normalizePath(p.path):p.path),u.buildURLFromParts(E)},parseURL:function(d){var c=n.exec(d);return c?{scheme:c[1]||"",netLoc:c[2]||"",path:c[3]||"",params:c[4]||"",query:c[5]||"",fragment:c[6]||""}:null},normalizePath:function(d){for(d=d.split("").reverse().join("").replace(s,"");d.length!==(d=d.replace(a,"")).length;);return d.split("").reverse().join("")},buildURLFromParts:function(d){return d.scheme+d.netLoc+d.path+d.params+d.query+d.fragment}};i.exports=u})()})(_h)),_h.exports}var Ym=k_();class qm{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var at={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class DT{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof e=="string"&&(e={url:e}),this.base=e,__(this,"stats")}setByteRange(e,t){const n=e.split("@",2);let r;n.length===1?r=(t==null?void 0:t.byteRangeEndOffset)||0:r=parseInt(n[1]),this._byteRange=[r,parseInt(n[0])+r]}get baseurl(){return this.base.url}get byteRange(){return this._byteRange===null?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return this._streams===null&&(this._streams={[at.AUDIO]:null,[at.VIDEO]:null,[at.AUDIOVIDEO]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return this._stats!==null}get hasStreams(){return this._streams!==null}get stats(){return this._stats===null&&(this._stats=new qm),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Ym.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[at.AUDIO]=null,e[at.VIDEO]=null,e[at.AUDIOVIDEO]=null}}function Rt(i){return i.sn!=="initSegment"}class Mh extends DT{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange.length){const e=this.byteRange[0],t=this.byteRange[1];if(ye(e)&&ye(t))return t-e}return null}get bitrate(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){var e;const{levelkeys:t}=this;if(!t||t.NONE)return null;if(t.identity)this._decryptdata||(this._decryptdata=t.identity.getDecryptData(this.sn));else if(!((e=this._decryptdata)!=null&&e.keyId)){const n=Object.keys(t);if(n.length===1){const r=this._decryptdata=t[n[0]]||null;r&&(this._decryptdata=r.getDecryptData(this.sn,t))}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null)return null;const e=ye(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){var t;const n=Object.keys(this.levelkeys),r=n.length;if(r>1||r===1&&(t=this.levelkeys[n[0]])!=null&&t.encrypted)return!0}return!1}get programDateTime(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){if(!ye(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}get ref(){return Rt(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){const t=this.levelkeys;if(t){var n;const r=t[e];r&&!((n=this._decryptdata)!=null&&n.keyId)&&(this._decryptdata=r.getDecryptData(this.sn,t))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,n,r,s,a=!1){const{elementaryStreams:u}=this,d=u[e];if(!d){u[e]={startPTS:t,endPTS:n,startDTS:r,endDTS:s,partial:a};return}d.startPTS=Math.min(d.startPTS,t),d.endPTS=Math.max(d.endPTS,n),d.startDTS=Math.min(d.startDTS,r),d.endDTS=Math.max(d.endDTS,s)}}class P_ extends DT{constructor(e,t,n,r,s){super(n),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=r;const a=e.enumeratedString("BYTERANGE");a&&this.setByteRange(a,s),s&&(this.fragOffset=s.fragOffset+s.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function kT(i,e){const t=Object.getPrototypeOf(i);if(t){const n=Object.getOwnPropertyDescriptor(t,e);return n||kT(t,e)}}function __(i,e){const t=kT(i,e);t&&(t.enumerable=!0,Object.defineProperty(i,e,t))}const Hv=Math.pow(2,32)-1,M_=[].push,PT={video:1,audio:2,id3:3,text:4};function Ft(i){return String.fromCharCode.apply(null,i)}function _T(i,e){const t=i[e]<<8|i[e+1];return t<0?65536+t:t}function Fe(i,e){const t=MT(i,e);return t<0?4294967296+t:t}function zv(i,e){let t=Fe(i,e);return t*=Math.pow(2,32),t+=Fe(i,e+4),t}function MT(i,e){return i[e]<<24|i[e+1]<<16|i[e+2]<<8|i[e+3]}function N_(i){const e=i.byteLength;for(let t=0;t<e;){const n=Fe(i,t);if(n>8&&i[t+4]===109&&i[t+5]===111&&i[t+6]===111&&i[t+7]===102)return!0;t=n>1?t+n:e}return!1}function Ge(i,e){const t=[];if(!e.length)return t;const n=i.byteLength;for(let r=0;r<n;){const s=Fe(i,r),a=Ft(i.subarray(r+4,r+8)),u=s>1?r+s:n;if(a===e[0])if(e.length===1)t.push(i.subarray(r+8,u));else{const d=Ge(i.subarray(r+8,u),e.slice(1));d.length&&M_.apply(t,d)}r=u}return t}function O_(i){const e=[],t=i[0];let n=8;const r=Fe(i,n);n+=4;let s=0,a=0;t===0?(s=Fe(i,n),a=Fe(i,n+4),n+=8):(s=zv(i,n),a=zv(i,n+8),n+=16),n+=2;let u=i.length+a;const d=_T(i,n);n+=2;for(let c=0;c<d;c++){let h=n;const m=Fe(i,h);h+=4;const p=m&2147483647;if((m&2147483648)>>>31===1)return nt.warn("SIDX has hierarchical references (not supported)"),null;const v=Fe(i,h);h+=4,e.push({referenceSize:p,subsegmentDuration:v,info:{duration:v/r,start:u,end:u+p-1}}),u+=p,h+=4,n=h}return{earliestPresentationTime:s,timescale:r,version:t,referencesCount:d,references:e}}function NT(i){const e=[],t=Ge(i,["moov","trak"]);for(let r=0;r<t.length;r++){const s=t[r],a=Ge(s,["tkhd"])[0];if(a){let u=a[0];const d=Fe(a,u===0?12:20),c=Ge(s,["mdia","mdhd"])[0];if(c){u=c[0];const h=Fe(c,u===0?12:20),m=Ge(s,["mdia","hdlr"])[0];if(m){const p=Ft(m.subarray(8,12)),y={soun:at.AUDIO,vide:at.VIDEO}[p],v=Ge(s,["mdia","minf","stbl","stsd"])[0],E=F_(v);y?(e[d]={timescale:h,type:y,stsd:E},e[y]=tt({timescale:h,id:d},E)):e[d]={timescale:h,type:p,stsd:E}}}}}return Ge(i,["moov","mvex","trex"]).forEach(r=>{const s=Fe(r,4),a=e[s];a&&(a.default={duration:Fe(r,12),flags:Fe(r,20)})}),e}function F_(i){const e=i.subarray(8),t=e.subarray(86),n=Ft(e.subarray(4,8));let r=n,s;const a=n==="enca"||n==="encv";if(a){const c=Ge(e,[n])[0].subarray(n==="enca"?28:78);Ge(c,["sinf"]).forEach(m=>{const p=Ge(m,["schm"])[0];if(p){const y=Ft(p.subarray(4,8));if(y==="cbcs"||y==="cenc"){const v=Ge(m,["frma"])[0];v&&(r=Ft(v))}}})}const u=r;switch(r){case"avc1":case"avc2":case"avc3":case"avc4":{const d=Ge(t,["avcC"])[0];d&&d.length>3&&(r+="."+pu(d[1])+pu(d[2])+pu(d[3]),s=mu(u==="avc1"?"dva1":"dvav",t));break}case"mp4a":{const d=Ge(e,[n])[0],c=Ge(d.subarray(28),["esds"])[0];if(c&&c.length>7){let h=4;if(c[h++]!==3)break;h=Nh(c,h),h+=2;const m=c[h++];if(m&128&&(h+=2),m&64&&(h+=c[h++]),c[h++]!==4)break;h=Nh(c,h);const p=c[h++];if(p===64)r+="."+pu(p);else break;if(h+=12,c[h++]!==5)break;h=Nh(c,h);const y=c[h++];let v=(y&248)>>3;v===31&&(v+=1+((y&7)<<3)+((c[h]&224)>>5)),r+="."+v}break}case"hvc1":case"hev1":{const d=Ge(t,["hvcC"])[0];if(d&&d.length>12){const c=d[1],h=["","A","B","C"][c>>6],m=c&31,p=Fe(d,2),y=(c&32)>>5?"H":"L",v=d[12],E=d.subarray(6,12);r+="."+h+m,r+="."+B_(p).toString(16).toUpperCase(),r+="."+y+v;let S="";for(let A=E.length;A--;){const L=E[A];(L||S)&&(S="."+L.toString(16).toUpperCase()+S)}r+=S}s=mu(u=="hev1"?"dvhe":"dvh1",t);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{r=mu(r,t)||r;break}case"vp09":{const d=Ge(t,["vpcC"])[0];if(d&&d.length>6){const c=d[4],h=d[5],m=d[6]>>4&15;r+="."+Ci(c)+"."+Ci(h)+"."+Ci(m)}break}case"av01":{const d=Ge(t,["av1C"])[0];if(d&&d.length>2){const c=d[1]>>>5,h=d[1]&31,m=d[2]>>>7?"H":"M",p=(d[2]&64)>>6,y=(d[2]&32)>>5,v=c===2&&p?y?12:10:p?10:8,E=(d[2]&16)>>4,S=(d[2]&8)>>3,A=(d[2]&4)>>2,L=d[2]&3;r+="."+c+"."+Ci(h)+m+"."+Ci(v)+"."+E+"."+S+A+L+"."+Ci(1)+"."+Ci(1)+"."+Ci(1)+"."+0,s=mu("dav1",t)}break}}return{codec:r,encrypted:a,supplemental:s}}function mu(i,e){const t=Ge(e,["dvvC"]),n=t.length?t[0]:Ge(e,["dvcC"])[0];if(n){const r=n[2]>>1&127,s=n[2]<<5&32|n[3]>>3&31;return i+"."+Ci(r)+"."+Ci(s)}}function B_(i){let e=0;for(let t=0;t<32;t++)e|=(i>>t&1)<<31-t;return e>>>0}function Nh(i,e){const t=e+5;for(;i[e++]&128&&e<t;);return e}function pu(i){return("0"+i.toString(16).toUpperCase()).slice(-2)}function Ci(i){return(i<10?"0":"")+i}function U_(i,e){if(!i||!e)return;const t=e.keyId;t&&e.isCommonEncryption&&OT(i,(n,r)=>{const s=n.subarray(8,24);s.some(a=>a!==0)||(nt.log(`[eme] Patching keyId in 'enc${r?"a":"v"}>sinf>>tenc' box: ${qt(s)} -> ${qt(t)}`),n.set(t,8))})}function $_(i){const e=[];return OT(i,t=>e.push(t.subarray(8,24))),e}function OT(i,e){Ge(i,["moov","trak"]).forEach(n=>{const r=Ge(n,["mdia","minf","stbl","stsd"])[0];if(!r)return;const s=r.subarray(8);let a=Ge(s,["enca"]);const u=a.length>0;u||(a=Ge(s,["encv"])),a.forEach(d=>{const c=u?d.subarray(28):d.subarray(78);Ge(c,["sinf"]).forEach(m=>{const p=FT(m);p&&e(p,u)})})})}function FT(i){const e=Ge(i,["schm"])[0];if(e){const t=Ft(e.subarray(4,8));if(t==="cbcs"||t==="cenc"){const n=Ge(i,["schi","tenc"])[0];if(n)return n}}}function j_(i,e,t){const n={},r=Ge(i,["moof","traf"]);for(let s=0;s<r.length;s++){const a=r[s],u=Ge(a,["tfhd"])[0],d=Fe(u,4),c=e[d];if(!c)continue;n[d]||(n[d]={start:NaN,duration:0,sampleCount:0,timescale:c.timescale,type:c.type});const h=n[d],m=Ge(a,["tfdt"])[0];if(m){const R=m[0];let D=Fe(m,4);R===1&&(D===Hv?t.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(D*=Hv+1,D+=Fe(m,8))),ye(D)&&(!ye(h.start)||D<h.start)&&(h.start=D)}const p=c.default,y=Fe(u,0)|(p==null?void 0:p.flags);let v=(p==null?void 0:p.duration)||0;y&8&&(y&2?v=Fe(u,12):v=Fe(u,8));const E=Ge(a,["trun"]);let S=h.start||0,A=0,L=v;for(let R=0;R<E.length;R++){const D=E[R],k=Fe(D,4),U=h.sampleCount;h.sampleCount+=k;const C=D[3]&1,_=D[3]&4,F=D[2]&1,O=D[2]&2,W=D[2]&4,z=D[2]&8;let re=8,ae=k;for(C&&(re+=4),_&&k&&(!(D[re+1]&1)&&h.keyFrameIndex===void 0&&(h.keyFrameIndex=U),re+=4,F?(L=Fe(D,re),re+=4):L=v,O&&(re+=4),z&&(re+=4),S+=L,A+=L,ae--);ae--;)F?(L=Fe(D,re),re+=4):L=v,O&&(re+=4),W&&(D[re+1]&1||h.keyFrameIndex===void 0&&(h.keyFrameIndex=h.sampleCount-(ae+1),h.keyFrameStart=S),re+=4),z&&(re+=4),S+=L,A+=L;!A&&v&&(A+=v*k)}h.duration+=A}if(!Object.keys(n).some(s=>n[s].duration)){let s=1/0,a=0;const u=Ge(i,["sidx"]);for(let d=0;d<u.length;d++){const c=O_(u[d]);if(c!=null&&c.references){s=Math.min(s,c.earliestPresentationTime/c.timescale);const h=c.references.reduce((m,p)=>m+p.info.duration||0,0);a=Math.max(a,h+c.earliestPresentationTime/c.timescale)}}a&&ye(a)&&Object.keys(n).forEach(d=>{n[d].duration||(n[d].duration=a*n[d].timescale-n[d].start)})}return n}function V_(i){const e={valid:null,remainder:null},t=Ge(i,["moof"]);if(t.length<2)return e.remainder=i,e;const n=t[t.length-1];return e.valid=i.slice(0,n.byteOffset-8),e.remainder=i.slice(n.byteOffset-8),e}function Qn(i,e){const t=new Uint8Array(i.length+e.length);return t.set(i),t.set(e,i.length),t}function Kv(i,e){const t=[],n=e.samples,r=e.timescale,s=e.id;let a=!1;return Ge(n,["moof"]).map(d=>{const c=d.byteOffset-8;Ge(d,["traf"]).map(m=>{const p=Ge(m,["tfdt"]).map(y=>{const v=y[0];let E=Fe(y,4);return v===1&&(E*=Math.pow(2,32),E+=Fe(y,8)),E/r})[0];return p!==void 0&&(i=p),Ge(m,["tfhd"]).map(y=>{const v=Fe(y,4),E=Fe(y,0)&16777215,S=(E&1)!==0,A=(E&2)!==0,L=(E&8)!==0;let R=0;const D=(E&16)!==0;let k=0;const U=(E&32)!==0;let C=8;v===s&&(S&&(C+=8),A&&(C+=4),L&&(R=Fe(y,C),C+=4),D&&(k=Fe(y,C),C+=4),U&&(C+=4),e.type==="video"&&(a=Ec(e.codec)),Ge(m,["trun"]).map(_=>{const F=_[0],O=Fe(_,0)&16777215,W=(O&1)!==0;let z=0;const re=(O&4)!==0,ae=(O&256)!==0;let ce=0;const ne=(O&512)!==0;let ie=0;const G=(O&1024)!==0,ee=(O&2048)!==0;let J=0;const P=Fe(_,4);let j=8;W&&(z=Fe(_,j),j+=4),re&&(j+=4);let he=z+c;for(let ge=0;ge<P;ge++){if(ae?(ce=Fe(_,j),j+=4):ce=R,ne?(ie=Fe(_,j),j+=4):ie=k,G&&(j+=4),ee&&(F===0?J=Fe(_,j):J=MT(_,j),j+=4),e.type===at.VIDEO){let te=0;for(;te<ie;){const fe=Fe(n,he);if(he+=4,G_(a,n[he])){const Pe=n.subarray(he,he+fe);Xm(Pe,a?2:1,i+J/r,t)}he+=fe,te+=fe+4}}i+=ce/r}}))})})}),t}function Ec(i){if(!i)return!1;const e=i.substring(0,4);return e==="hvc1"||e==="hev1"||e==="dvh1"||e==="dvhe"}function G_(i,e){if(i){const t=e>>1&63;return t===39||t===40}else return(e&31)===6}function Xm(i,e,t,n){const r=BT(i);let s=0;s+=e;let a=0,u=0,d=0;for(;s<r.length;){a=0;do{if(s>=r.length)break;d=r[s++],a+=d}while(d===255);u=0;do{if(s>=r.length)break;d=r[s++],u+=d}while(d===255);const c=r.length-s;let h=s;if(u<c)s+=u;else if(u>c){nt.error(`Malformed SEI payload. ${u} is too small, only ${c} bytes left to parse.`);break}if(a===4){if(r[h++]===181){const p=_T(r,h);if(h+=2,p===49){const y=Fe(r,h);if(h+=4,y===1195456820){const v=r[h++];if(v===3){const E=r[h++],S=31&E,A=64&E,L=A?2+S*3:0,R=new Uint8Array(L);if(A){R[0]=E;for(let D=1;D<L;D++)R[D]=r[h++]}n.push({type:v,payloadType:a,pts:t,bytes:R})}}}}}else if(a===5&&u>16){const m=[];for(let v=0;v<16;v++){const E=r[h++].toString(16);m.push(E.length==1?"0"+E:E),(v===3||v===5||v===7||v===9)&&m.push("-")}const p=u-16,y=new Uint8Array(p);for(let v=0;v<p;v++)y[v]=r[h++];n.push({payloadType:a,pts:t,uuid:m.join(""),userData:Bn(y),userDataBytes:y})}}}function BT(i){const e=i.byteLength,t=[];let n=1;for(;n<e-2;)i[n]===0&&i[n+1]===0&&i[n+2]===3?(t.push(n+2),n+=2):n++;if(t.length===0)return i;const r=e-t.length,s=new Uint8Array(r);let a=0;for(n=0;n<r;a++,n++)a===t[0]&&(a++,t.shift()),s[n]=i[a];return s}function H_(i){const e=i[0];let t="",n="",r=0,s=0,a=0,u=0,d=0,c=0;if(e===0){for(;Ft(i.subarray(c,c+1))!=="\0";)t+=Ft(i.subarray(c,c+1)),c+=1;for(t+=Ft(i.subarray(c,c+1)),c+=1;Ft(i.subarray(c,c+1))!=="\0";)n+=Ft(i.subarray(c,c+1)),c+=1;n+=Ft(i.subarray(c,c+1)),c+=1,r=Fe(i,12),s=Fe(i,16),u=Fe(i,20),d=Fe(i,24),c=28}else if(e===1){c+=4,r=Fe(i,c),c+=4;const m=Fe(i,c);c+=4;const p=Fe(i,c);for(c+=4,a=2**32*m+p,E_(a)||(a=Number.MAX_SAFE_INTEGER,nt.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),u=Fe(i,c),c+=4,d=Fe(i,c),c+=4;Ft(i.subarray(c,c+1))!=="\0";)t+=Ft(i.subarray(c,c+1)),c+=1;for(t+=Ft(i.subarray(c,c+1)),c+=1;Ft(i.subarray(c,c+1))!=="\0";)n+=Ft(i.subarray(c,c+1)),c+=1;n+=Ft(i.subarray(c,c+1)),c+=1}const h=i.subarray(c,i.byteLength);return{schemeIdUri:t,value:n,timeScale:r,presentationTime:a,presentationTimeDelta:s,eventDuration:u,id:d,payload:h}}function z_(i,...e){const t=e.length;let n=8,r=t;for(;r--;)n+=e[r].byteLength;const s=new Uint8Array(n);for(s[0]=n>>24&255,s[1]=n>>16&255,s[2]=n>>8&255,s[3]=n&255,s.set(i,4),r=0,n=8;r<t;r++)s.set(e[r],n),n+=e[r].byteLength;return s}function K_(i,e,t){if(i.byteLength!==16)throw new RangeError("Invalid system id");let n,r;n=0,r=new Uint8Array;let s;n>0?(s=new Uint8Array(4),e.length>0&&new DataView(s.buffer).setUint32(0,e.length,!1)):s=new Uint8Array;const a=new Uint8Array(4);return t.byteLength>0&&new DataView(a.buffer).setUint32(0,t.byteLength,!1),z_([112,115,115,104],new Uint8Array([n,0,0,0]),i,s,r,a,t)}function W_(i){const e=[];if(i instanceof ArrayBuffer){const t=i.byteLength;let n=0;for(;n+32<t;){const r=new DataView(i,n),s=Y_(r);e.push(s),n+=s.size}}return e}function Y_(i){const e=i.getUint32(0),t=i.byteOffset,n=i.byteLength;if(n<e)return{offset:t,size:n};if(i.getUint32(4)!==1886614376)return{offset:t,size:e};const s=i.getUint32(8)>>>24;if(s!==0&&s!==1)return{offset:t,size:e};const a=i.buffer,u=qt(new Uint8Array(a,t+12,16));let d=null,c=null,h=0;if(s===0)h=28;else{const p=i.getUint32(28);if(!p||n<32+p*16)return{offset:t,size:e};d=[];for(let y=0;y<p;y++)d.push(new Uint8Array(a,t+32+y*16,16));h=32+p*16}if(!h)return{offset:t,size:e};const m=i.getUint32(h);return e-32<m?{offset:t,size:e}:(c=new Uint8Array(a,t+h+4,m),{version:s,systemId:u,kids:d,data:c,offset:t,size:e})}const UT=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),ya={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function Qm(i,e){const t=ya[e];return!!t&&!!t[i.slice(0,4)]}function Fo(i,e,t=!0){return!i.split(",").some(n=>!Zm(n,e,t))}function Zm(i,e,t=!0){var n;const r=Ur(t);return(n=r==null?void 0:r.isTypeSupported(Bo(i,e)))!=null?n:!1}function Bo(i,e){return`${e}/mp4;codecs=${i}`}function Wv(i){if(i){const e=i.substring(0,4);return ya.video[e]}return 2}function ic(i){const e=UT();return i.split(",").reduce((t,n)=>{const s=e&&Ec(n)?9:ya.video[n];return s?(s*2+t)/(t?3:2):(ya.audio[n]+t)/(t?2:1)},0)}const Oh={};function q_(i,e=!0){if(Oh[i])return Oh[i];const t={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[i];for(let r=0;r<t.length;r++){var n;if(Zm(t[r],"audio",e))return Oh[i]=t[r],t[r];if(t[r]==="mp3"&&(n=Ur(e))!=null&&n.isTypeSupported("audio/mpeg"))return""}return i}const X_=/flac|opus|mp4a\.40\.34/i;function rc(i,e=!0){return i.replace(X_,t=>q_(t.toLowerCase(),e))}function Q_(i,e){const t=[];if(i){const n=i.split(",");for(let r=0;r<n.length;r++)Qm(n[r],"video")||t.push(n[r])}return e&&t.push(e),t.join(",")}function Uu(i,e){if(i&&(i.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(i)!==-1)&&(Yv(i,"audio")||Yv(i,"video")))return i;if(e){const t=e.split(",");if(t.length>1){if(i){for(let n=t.length;n--;)if(t[n].substring(0,4)===i.substring(0,4))return t[n]}return t[0]}}return e||i}function Yv(i,e){return Qm(i,e)&&Zm(i,e)}function Z_(i){const e=i.split(",");for(let t=0;t<e.length;t++){const n=e[t].split(".");n.length>2&&n[0]==="avc1"&&(e[t]=`avc1.${parseInt(n[1]).toString(16)}${("000"+parseInt(n[2]).toString(16)).slice(-4)}`)}return e.join(",")}function J_(i){if(i.startsWith("av01.")){const e=i.split("."),t=["0","111","01","01","01","0"];for(let n=e.length;n>4&&n<10;n++)e[n]=t[n-4];return e.join(".")}return i}function qv(i){const e=Ur(i)||{isTypeSupported:()=>!1};return{mpeg:e.isTypeSupported("audio/mpeg"),mp3:e.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:e.isTypeSupported('audio/mp4; codecs="ac-3"')}}function Bf(i){return i.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const eM={supported:!0,powerEfficient:!0,smooth:!0},tM={supported:!1,smooth:!1,powerEfficient:!1},$T={supported:!0,configurations:[],decodingInfoResults:[eM]};function jT(i,e){return{supported:!1,configurations:e,decodingInfoResults:[tM],error:i}}function nM(i,e,t,n,r,s){const a=i.videoCodec,u=i.audioCodec?i.audioGroups:null,d=s==null?void 0:s.audioCodec,c=s==null?void 0:s.channels,h=c?parseInt(c):d?1/0:2;let m=null;if(u!=null&&u.length)try{u.length===1&&u[0]?m=e.groups[u[0]].channels:m=u.reduce((p,y)=>{if(y){const v=e.groups[y];if(!v)throw new Error(`Audio track group ${y} not found`);Object.keys(v.channels).forEach(E=>{p[E]=(p[E]||0)+v.channels[E]})}return p},{2:0})}catch{return!0}return a!==void 0&&(a.split(",").some(p=>Ec(p))||i.width>1920&&i.height>1088||i.height>1920&&i.width>1088||i.frameRate>Math.max(n,30)||i.videoRange!=="SDR"&&i.videoRange!==t||i.bitrate>Math.max(r,8e6))||!!m&&ye(h)&&Object.keys(m).some(p=>parseInt(p)>h)}function VT(i,e,t,n={}){const r=i.videoCodec;if(!r&&!i.audioCodec||!t)return Promise.resolve($T);const s=[],a=iM(i),u=a.length,d=rM(i,e,u>0),c=d.length;for(let h=u||1*c||1;h--;){const m={type:"media-source"};if(u&&(m.video=a[h%u]),c){m.audio=d[h%c];const p=m.audio.bitrate;m.video&&p&&(m.video.bitrate-=p)}s.push(m)}if(r){const h=navigator.userAgent;if(r.split(",").some(m=>Ec(m))&&UT())return Promise.resolve(jT(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (${h})`),s))}return Promise.all(s.map(h=>{const m=aM(h);return n[m]||(n[m]=t.decodingInfo(h))})).then(h=>({supported:!h.some(m=>!m.supported),configurations:s,decodingInfoResults:h})).catch(h=>({supported:!1,configurations:s,decodingInfoResults:[],error:h}))}function iM(i){var e;const t=(e=i.videoCodec)==null?void 0:e.split(","),n=GT(i),r=i.width||640,s=i.height||480,a=i.frameRate||30,u=i.videoRange.toLowerCase();return t?t.map(d=>{const c={contentType:Bo(J_(d),"video"),width:r,height:s,bitrate:n,framerate:a};return u!=="sdr"&&(c.transferFunction=u),c}):[]}function rM(i,e,t){var n;const r=(n=i.audioCodec)==null?void 0:n.split(","),s=GT(i);return r&&i.audioGroups?i.audioGroups.reduce((a,u)=>{var d;const c=u?(d=e.groups[u])==null?void 0:d.tracks:null;return c?c.reduce((h,m)=>{if(m.groupId===u){const p=parseFloat(m.channels||"");r.forEach(y=>{const v={contentType:Bo(y,"audio"),bitrate:t?sM(y,s):s};p&&(v.channels=""+p),h.push(v)})}return h},a):a},[]):[]}function sM(i,e){if(e<=1)return 1;let t=128e3;return i==="ec-3"?t=768e3:i==="ac-3"&&(t=64e4),Math.min(e/2,t)}function GT(i){return Math.ceil(Math.max(i.bitrate*.9,i.averageBitrate)/1e3)*1e3||1}function aM(i){let e="";const{audio:t,video:n}=i;if(n){const r=Bf(n.contentType);e+=`${r}_r${n.height}x${n.width}f${Math.ceil(n.framerate)}${n.transferFunction||"sd"}_${Math.ceil(n.bitrate/1e5)}`}if(t){const r=Bf(t.contentType);e+=`${n?"_":""}${r}_c${t.channels}`}return e}const Uf=["NONE","TYPE-0","TYPE-1",null];function oM(i){return Uf.indexOf(i)>-1}const sc=["SDR","PQ","HLG"];function lM(i){return!!i&&sc.indexOf(i)>-1}var $u={No:"",Yes:"YES",v2:"v2"};function Xv(i){const{canSkipUntil:e,canSkipDateRanges:t,age:n}=i,r=n<e/2;return e&&r?t?$u.v2:$u.Yes:$u.No}class Qv{constructor(e,t,n){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=n}addDirectives(e){const t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class Uo{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(n=>!!n).map(n=>n.substring(0,4)).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;const n=(t=e.supplemental)==null?void 0:t.videoCodec;n&&n!==e.videoCodec&&(this.codecSet+=`,${n.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return Zv(this._audioGroups,e)}hasSubtitleGroup(e){return Zv(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t){if(e==="audio"){let n=this._audioGroups;n||(n=this._audioGroups=[]),n.indexOf(t)===-1&&n.push(t)}else if(e==="text"){let n=this._subtitleGroups;n||(n=this._subtitleGroups=[]),n.indexOf(t)===-1&&n.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}}function Zv(i,e){return!e||!i?!1:i.indexOf(e)!==-1}function uM(){if(typeof matchMedia=="function"){const i=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(i.media!==e.media)return i.matches===!0}return!1}function cM(i,e){let t=!1,n=[];if(i&&(t=i!=="SDR",n=[i]),e){n=e.allowedVideoRanges||sc.slice(0);const r=n.join("")!=="SDR"&&!e.videoCodec;t=e.preferHDR!==void 0?e.preferHDR:r&&uM(),t||(n=["SDR"])}return{preferHDR:t,allowedVideoRanges:n}}const dM=i=>{const e=new WeakSet;return(t,n)=>{if(i&&(n=i(t,n)),typeof n=="object"&&n!==null){if(e.has(n))return;e.add(n)}return n}},ot=(i,e)=>JSON.stringify(i,dM(e));function hM(i,e,t,n,r){const s=Object.keys(i),a=n==null?void 0:n.channels,u=n==null?void 0:n.audioCodec,d=r==null?void 0:r.videoCodec,c=a&&parseInt(a)===2;let h=!1,m=!1,p=1/0,y=1/0,v=1/0,E=1/0,S=0,A=[];const{preferHDR:L,allowedVideoRanges:R}=cM(e,r);for(let _=s.length;_--;){const F=i[s[_]];h||(h=F.channels[2]>0),p=Math.min(p,F.minHeight),y=Math.min(y,F.minFramerate),v=Math.min(v,F.minBitrate),R.filter(W=>F.videoRanges[W]>0).length>0&&(m=!0)}p=ye(p)?p:0,y=ye(y)?y:0;const D=Math.max(1080,p),k=Math.max(30,y);v=ye(v)?v:t,t=Math.max(v,t),m||(e=void 0);const U=s.length>1;return{codecSet:s.reduce((_,F)=>{const O=i[F];if(F===_)return _;if(A=m?R.filter(W=>O.videoRanges[W]>0):[],U){if(O.minBitrate>t)return Ri(F,`min bitrate of ${O.minBitrate} > current estimate of ${t}`),_;if(!O.hasDefaultAudio)return Ri(F,"no renditions with default or auto-select sound found"),_;if(u&&F.indexOf(u.substring(0,4))%5!==0)return Ri(F,`audio codec preference "${u}" not found`),_;if(a&&!c){if(!O.channels[a])return Ri(F,`no renditions with ${a} channel sound found (channels options: ${Object.keys(O.channels)})`),_}else if((!u||c)&&h&&O.channels[2]===0)return Ri(F,"no renditions with stereo sound found"),_;if(O.minHeight>D)return Ri(F,`min resolution of ${O.minHeight} > maximum of ${D}`),_;if(O.minFramerate>k)return Ri(F,`min framerate of ${O.minFramerate} > maximum of ${k}`),_;if(!A.some(W=>O.videoRanges[W]>0))return Ri(F,`no variants with VIDEO-RANGE of ${ot(A)} found`),_;if(d&&F.indexOf(d.substring(0,4))%5!==0)return Ri(F,`video codec preference "${d}" not found`),_;if(O.maxScore<S)return Ri(F,`max score of ${O.maxScore} < selected max of ${S}`),_}return _&&(ic(F)>=ic(_)||O.fragmentError>i[_].fragmentError)?_:(E=O.minIndex,S=O.maxScore,F)},void 0),videoRanges:A,preferHDR:L,minFramerate:y,minBitrate:v,minIndex:E}}function Ri(i,e){nt.log(`[abr] start candidates with "${i}" ignored because ${e}`)}function HT(i){return i.reduce((e,t)=>{let n=e.groups[t.groupId];n||(n=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),n.tracks.push(t);const r=t.channels||"2";return n.channels[r]=(n.channels[r]||0)+1,n.hasDefault=n.hasDefault||t.default,n.hasAutoSelect=n.hasAutoSelect||t.autoselect,n.hasDefault&&(e.hasDefaultAudio=!0),n.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function fM(i,e,t,n){return i.slice(t,n+1).reduce((r,s,a)=>{if(!s.codecSet)return r;const u=s.audioGroups;let d=r[s.codecSet];d||(r[s.codecSet]=d={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:a,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!u,fragmentError:0}),d.minBitrate=Math.min(d.minBitrate,s.bitrate);const c=Math.min(s.height,s.width);return d.minHeight=Math.min(d.minHeight,c),d.minFramerate=Math.min(d.minFramerate,s.frameRate),d.minIndex=Math.min(d.minIndex,a),d.maxScore=Math.max(d.maxScore,s.score),d.fragmentError+=s.fragmentError,d.videoRanges[s.videoRange]=(d.videoRanges[s.videoRange]||0)+1,u&&u.forEach(h=>{if(!h)return;const m=e.groups[h];m&&(d.hasDefaultAudio=d.hasDefaultAudio||e.hasDefaultAudio?m.hasDefault:m.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(m.channels).forEach(p=>{d.channels[p]=(d.channels[p]||0)+m.channels[p]}))}),r},{})}function Jv(i){if(!i)return i;const{lang:e,assocLang:t,characteristics:n,channels:r,audioCodec:s}=i;return{lang:e,assocLang:t,characteristics:n,channels:r,audioCodec:s}}function ki(i,e,t){if("attrs"in i){const n=e.indexOf(i);if(n!==-1)return n}for(let n=0;n<e.length;n++){const r=e[n];if(xs(i,r,t))return n}return-1}function xs(i,e,t){const{groupId:n,name:r,lang:s,assocLang:a,default:u}=i,d=i.forced;return(n===void 0||e.groupId===n)&&(r===void 0||e.name===r)&&(s===void 0||mM(s,e.lang))&&(s===void 0||e.assocLang===a)&&(u===void 0||e.default===u)&&(d===void 0||e.forced===d)&&(!("characteristics"in i)||pM(i.characteristics||"",e.characteristics))&&(t===void 0||t(i,e))}function mM(i,e="--"){return i.length===e.length?i===e:i.startsWith(e)||e.startsWith(i)}function pM(i,e=""){const t=i.split(","),n=e.split(",");return t.length===n.length&&!t.some(r=>n.indexOf(r)===-1)}function ms(i,e){const{audioCodec:t,channels:n}=i;return(t===void 0||(e.audioCodec||"").substring(0,4)===t.substring(0,4))&&(n===void 0||n===(e.channels||"2"))}function gM(i,e,t,n,r){const s=e[n],u=e.reduce((p,y,v)=>{const E=y.uri;return(p[E]||(p[E]=[])).push(v),p},{})[s.uri];u.length>1&&(n=Math.max.apply(Math,u));const d=s.videoRange,c=s.frameRate,h=s.codecSet.substring(0,4),m=ex(e,n,p=>{if(p.videoRange!==d||p.frameRate!==c||p.codecSet.substring(0,4)!==h)return!1;const y=p.audioGroups,v=t.filter(E=>!y||y.indexOf(E.groupId)!==-1);return ki(i,v,r)>-1});return m>-1?m:ex(e,n,p=>{const y=p.audioGroups,v=t.filter(E=>!y||y.indexOf(E.groupId)!==-1);return ki(i,v,r)>-1})}function ex(i,e,t){for(let n=e;n>-1;n--)if(t(i[n]))return n;for(let n=e+1;n<i.length;n++)if(t(i[n]))return n;return-1}function ac(i,e){var t;return!!i&&i!==((t=e.loadLevelObj)==null?void 0:t.uri)}class yM extends Jn{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.supportedCache={},this.bwEstimator=void 0,this._abandonRulesCheck=t=>{var n;const{fragCurrent:r,partCurrent:s,hls:a}=this,{autoLevelEnabled:u,media:d}=a;if(!r||!d)return;const c=performance.now(),h=s?s.stats:r.stats,m=s?s.duration:r.duration,p=c-h.loading.start,y=a.minAutoLevel,v=r.level,E=this._nextAutoLevel;if(h.aborted||h.loaded&&h.loaded===h.total||v<=y){this.clearTimer(),this._nextAutoLevel=-1;return}if(!u)return;const S=E>-1&&E!==v,A=!!t||S;if(!A&&(d.paused||!d.playbackRate||!d.readyState))return;const L=a.mainForwardBufferInfo;if(!A&&L===null)return;const R=this.bwEstimator.getEstimateTTFB(),D=Math.abs(d.playbackRate);if(p<=Math.max(R,1e3*(m/(D*2))))return;const k=L?L.len/D:0,U=h.loading.first?h.loading.first-h.loading.start:-1,C=h.loaded&&U>-1,_=this.getBwEstimate(),F=a.levels,O=F[v],W=Math.max(h.loaded,Math.round(m*(r.bitrate||O.averageBitrate)/8));let z=C?p-U:p;z<1&&C&&(z=Math.min(p,h.loaded*8/_));const re=C?h.loaded*1e3/z:0,ae=R/1e3,ce=re?(W-h.loaded)/re:W*8/_+ae;if(ce<=k)return;const ne=re?re*8:_,ie=((n=(t==null?void 0:t.details)||this.hls.latestLevelDetails)==null?void 0:n.live)===!0,G=this.hls.config.abrBandWidthUpFactor;let ee=Number.POSITIVE_INFINITY,J;for(J=v-1;J>y;J--){const ge=F[J].maxBitrate,te=!F[J].details||ie;if(ee=this.getTimeToLoadFrag(ae,ne,m*ge,te),ee<Math.min(k,m+ae))break}if(ee>=ce||ee>m*10)return;C?this.bwEstimator.sample(p-Math.min(R,U),h.loaded):this.bwEstimator.sampleTTFB(p);const P=F[J].maxBitrate;this.getBwEstimate()*G>P&&this.resetEstimator(P);const j=this.findBestLevel(P,y,J,0,k,1,1);j>-1&&(J=j),this.warn(`Fragment ${r.sn}${s?" part "+s.index:""} of level ${v} is loading too slowly;
      Fragment duration: ${r.duration.toFixed(3)}
      Time to underbuffer: ${k.toFixed(3)} s
      Estimated load time for current fragment: ${ce.toFixed(3)} s
      Estimated load time for down switch fragment: ${ee.toFixed(3)} s
      TTFB estimate: ${U|0} ms
      Current BW estimate: ${ye(_)?_|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${J} @ ${P|0} bps`),a.nextLoadLevel=a.nextAutoLevel=J,this.clearTimer();const he=()=>{if(this.clearTimer(),this.fragCurrent===r&&this.hls.loadLevel===J&&J>0){const ge=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${J>0?"and switching down":""}
      Fragment duration: ${r.duration.toFixed(3)} s
      Time to underbuffer: ${ge.toFixed(3)} s`),r.abortRequests(),this.fragCurrent=this.partCurrent=null,J>y){let te=this.findBestLevel(this.hls.levels[y].bitrate,y,J,0,ge,1,1);te===-1&&(te=y),this.hls.nextLoadLevel=this.hls.nextAutoLevel=te,this.resetEstimator(this.hls.levels[te].bitrate)}}};S||ce>ee*2?he():this.timer=self.setInterval(he,ee*1e3),a.trigger(w.FRAG_LOAD_EMERGENCY_ABORTED,{frag:r,part:s,stats:h})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new T_(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(w.MANIFEST_LOADING,this.onManifestLoading,this),e.on(w.FRAG_LOADING,this.onFragLoading,this),e.on(w.FRAG_LOADED,this.onFragLoaded,this),e.on(w.FRAG_BUFFERED,this.onFragBuffered,this),e.on(w.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(w.LEVEL_LOADED,this.onLevelLoaded,this),e.on(w.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(w.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(w.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(w.MANIFEST_LOADING,this.onManifestLoading,this),e.off(w.FRAG_LOADING,this.onFragLoading,this),e.off(w.FRAG_LOADED,this.onFragLoaded,this),e.off(w.FRAG_BUFFERED,this.onFragBuffered,this),e.off(w.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(w.LEVEL_LOADED,this.onLevelLoaded,this),e.off(w.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(w.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(w.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const n=t.frag;if(!this.ignoreFragment(n)){if(!n.bitrateTest){var r;this.fragCurrent=n,this.partCurrent=(r=t.part)!=null?r:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case Y.BUFFER_ADD_CODEC_ERROR:case Y.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case Y.FRAG_LOAD_TIMEOUT:{const n=t.frag,{fragCurrent:r,partCurrent:s}=this;if(n&&r&&n.sn===r.sn&&n.level===r.level){const a=performance.now(),u=s?s.stats:n.stats,d=a-u.loading.start,c=u.loading.first?u.loading.first-u.loading.start:-1;if(u.loaded&&c>-1){const m=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(d-Math.min(m,c),u.loaded)}else this.bwEstimator.sampleTTFB(d)}break}}}getTimeToLoadFrag(e,t,n,r){const s=e+n/t,a=r?e+this.lastLevelLoadSec:0;return s+a}onLevelLoaded(e,t){const n=this.hls.config,{loading:r}=t.stats,s=r.end-r.first;ye(s)&&(this.lastLevelLoadSec=s/1e3),t.details.live?this.bwEstimator.update(n.abrEwmaSlowLive,n.abrEwmaFastLive):this.bwEstimator.update(n.abrEwmaSlowVoD,n.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,{frag:t,part:n}){const r=n?n.stats:t.stats;if(t.type===xe.MAIN&&this.bwEstimator.sampleTTFB(r.loading.first-r.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const s=n?n.duration:t.duration,a=this.hls.levels[t.level],u=(a.loaded?a.loaded.bytes:0)+r.loaded,d=(a.loaded?a.loaded.duration:0)+s;a.loaded={bytes:u,duration:d},a.realBitrate=Math.round(8*u/d)}if(t.bitrateTest){const s={stats:r,frag:t,part:n,id:t.type};this.onFragBuffered(w.FRAG_BUFFERED,s),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:n,part:r}=t,s=r!=null&&r.stats.loaded?r.stats:n.stats;if(s.aborted||this.ignoreFragment(n))return;const a=s.parsing.end-s.loading.start-Math.min(s.loading.first-s.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(a,s.loaded),s.bwEstimate=this.getBwEstimate(),n.bitrateTest?this.bitrateTestDelay=a/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==xe.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,n=this.getBwEstimate(),r=this.hls.config.maxStarvationDelay,s=this.findBestLevel(n,t,e,0,r,1,1);if(s>-1)return s;const a=this.hls.firstLevel,u=Math.min(Math.max(a,t),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${a} clamped to ${u}`),u}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,n=this.bwEstimator.canEstimate(),r=this.lastLoadedFragLevel>-1;if(e!==-1&&(!n||!r||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const s=n&&r?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){const a=this.hls.levels;if(a.length>Math.max(e,s)&&a[e].loadError<=a[s].loadError)return e}return this._nextAutoLevel=s,this.nextAutoLevelKey=this.getAutoLevelKey(),s}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:n}=this;if(n.levels.length<=1)return n.loadLevel;const{maxAutoLevel:r,config:s,minAutoLevel:a}=n,u=t?t.duration:e?e.duration:0,d=this.getBwEstimate(),c=this.getStarvationDelay();let h=s.abrBandWidthFactor,m=s.abrBandWidthUpFactor;if(c){const S=this.findBestLevel(d,a,r,c,0,h,m);if(S>=0)return this.rebufferNotice=-1,S}let p=u?Math.min(u,s.maxStarvationDelay):s.maxStarvationDelay;if(!c){const S=this.bitrateTestDelay;S&&(p=(u?Math.min(u,s.maxLoadingDelay):s.maxLoadingDelay)-S,this.info(`bitrate test took ${Math.round(1e3*S)}ms, set first fragment max fetchDuration to ${Math.round(1e3*p)} ms`),h=m=1)}const y=this.findBestLevel(d,a,r,c,p,h,m);if(this.rebufferNotice!==y&&(this.rebufferNotice=y,this.info(`${c?"rebuffering expected":"buffer is empty"}, optimal quality level ${y}`)),y>-1)return y;const v=n.levels[a],E=n.loadLevelObj;return E&&(v==null?void 0:v.bitrate)<E.bitrate?a:n.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const n=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,r=e.mainForwardBufferInfo;return(r?r.len:0)/n}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,n,r,s,a,u){var d;const c=r+s,h=this.lastLoadedFragLevel,m=h===-1?this.hls.firstLevel:h,{fragCurrent:p,partCurrent:y}=this,{levels:v,allAudioTracks:E,loadLevel:S,config:A}=this.hls;if(v.length===1)return 0;const L=v[m],R=!!((d=this.hls.latestLevelDetails)!=null&&d.live),D=S===-1||h===-1;let k,U="SDR",C=(L==null?void 0:L.frameRate)||0;const{audioPreference:_,videoPreference:F}=A,O=this.audioTracksByGroup||(this.audioTracksByGroup=HT(E));let W=-1;if(D){if(this.firstSelection!==-1)return this.firstSelection;const ne=this.codecTiers||(this.codecTiers=fM(v,O,t,n)),ie=hM(ne,U,e,_,F),{codecSet:G,videoRanges:ee,minFramerate:J,minBitrate:P,minIndex:j,preferHDR:he}=ie;W=j,k=G,U=he?ee[ee.length-1]:ee[0],C=J,e=Math.max(e,P),this.log(`picked start tier ${ot(ie)}`)}else k=L==null?void 0:L.codecSet,U=L==null?void 0:L.videoRange;const z=y?y.duration:p?p.duration:0,re=this.bwEstimator.getEstimateTTFB()/1e3,ae=[];for(let ne=n;ne>=t;ne--){var ce;const ie=v[ne],G=ne>m;if(!ie)continue;if(A.useMediaCapabilities&&!ie.supportedResult&&!ie.supportedPromise){const te=navigator.mediaCapabilities;typeof(te==null?void 0:te.decodingInfo)=="function"&&nM(ie,O,U,C,e,_)?(ie.supportedPromise=VT(ie,O,te,this.supportedCache),ie.supportedPromise.then(fe=>{if(!this.hls)return;ie.supportedResult=fe;const Pe=this.hls.levels,be=Pe.indexOf(ie);fe.error?this.warn(`MediaCapabilities decodingInfo error: "${fe.error}" for level ${be} ${ot(fe)}`):fe.supported?fe.decodingInfoResults.some(Ve=>Ve.smooth===!1||Ve.powerEfficient===!1)&&this.log(`MediaCapabilities decodingInfo for level ${be} not smooth or powerEfficient: ${ot(fe)}`):(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${be} ${ot(fe)}`),be>-1&&Pe.length>1&&(this.log(`Removing unsupported level ${be}`),this.hls.removeLevel(be),this.hls.loadLevel===-1&&(this.hls.nextLoadLevel=0)))}).catch(fe=>{this.warn(`Error handling MediaCapabilities decodingInfo: ${fe}`)})):ie.supportedResult=$T}if((k&&ie.codecSet!==k||U&&ie.videoRange!==U||G&&C>ie.frameRate||!G&&C>0&&C<ie.frameRate||(ce=ie.supportedResult)!=null&&(ce=ce.decodingInfoResults)!=null&&ce.some(te=>te.smooth===!1))&&(!D||ne!==W)){ae.push(ne);continue}const ee=ie.details,J=(y?ee==null?void 0:ee.partTarget:ee==null?void 0:ee.averagetargetduration)||z;let P;G?P=u*e:P=a*e;const j=z&&r>=z*2&&s===0?ie.averageBitrate:ie.maxBitrate,he=this.getTimeToLoadFrag(re,P,j*J,ee===void 0);if(P>=j&&(ne===h||ie.loadError===0&&ie.fragmentError===0)&&(he<=re||!ye(he)||R&&!this.bitrateTestDelay||he<c)){const te=this.forcedAutoLevel;return ne!==S&&(te===-1||te!==S)&&(ae.length&&this.trace(`Skipped level(s) ${ae.join(",")} of ${n} max with CODECS and VIDEO-RANGE:"${v[ae[0]].codecs}" ${v[ae[0]].videoRange}; not compatible with "${k}" ${U}`),this.info(`switch candidate:${m}->${ne} adjustedbw(${Math.round(P)})-bitrate=${Math.round(P-j)} ttfb:${re.toFixed(1)} avgDuration:${J.toFixed(1)} maxFetchDuration:${c.toFixed(1)} fetchDuration:${he.toFixed(1)} firstSelection:${D} codecSet:${ie.codecSet} videoRange:${ie.videoRange} hls.loadLevel:${S}`)),D&&(this.firstSelection=ne),ne}}return-1}set nextAutoLevel(e){const t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:n}=this.hls;return Math.min(Math.max(e,n),t)}}const zT={search:function(i,e){let t=0,n=i.length-1,r=null,s=null;for(;t<=n;){r=(t+n)/2|0,s=i[r];const a=e(s);if(a>0)t=r+1;else if(a<0)n=r-1;else return s}return null}};function vM(i,e,t){if(e===null||!Array.isArray(i)||!i.length||!ye(e))return null;const n=i[0].programDateTime;if(e<(n||0))return null;const r=i[i.length-1].endProgramDateTime;if(e>=(r||0))return null;for(let s=0;s<i.length;++s){const a=i[s];if(EM(e,t,a))return a}return null}function Ss(i,e,t=0,n=0,r=.005){let s=null;if(i){s=e[1+i.sn-e[0].sn]||null;const u=i.endDTS-t;u>0&&u<15e-7&&(t+=15e-7),s&&i.level!==s.level&&s.end<=i.end&&(s=e[2+i.sn-e[0].sn]||null)}else t===0&&e[0].start===0&&(s=e[0]);if(s&&((!i||i.level===s.level)&&tx(t,n,s)===0||xM(s,i,Math.min(r,n))))return s;const a=zT.search(e,tx.bind(null,t,n));return a&&(a!==i||!s)?a:s}function xM(i,e,t){if(e&&e.start===0&&e.level<i.level&&(e.endPTS||0)>0){const n=e.tagList.reduce((r,s)=>(s[0]==="INF"&&(r+=parseFloat(s[1])),r),t);return i.start<=n}return!1}function tx(i=0,e=0,t){if(t.start<=i&&t.start+t.duration>i)return 0;const n=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-n<=i?1:t.start-n>i&&t.start?-1:0}function EM(i,e,t){const n=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-n>i}function KT(i,e,t){if(i&&i.startCC<=e&&i.endCC>=e){let n=i.fragments;const{fragmentHint:r}=i;r&&(n=n.concat(r));let s;return zT.search(n,a=>a.cc<e?1:a.cc>e?-1:(s=a,a.end<=t?1:a.start>t?-1:0)),s||null}return null}function oc(i){switch(i.details){case Y.FRAG_LOAD_TIMEOUT:case Y.KEY_LOAD_TIMEOUT:case Y.LEVEL_LOAD_TIMEOUT:case Y.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function WT(i){return i.details.startsWith("key")}function YT(i){return WT(i)&&!!i.frag&&!i.frag.decryptdata}function nx(i,e){const t=oc(e);return i.default[`${t?"timeout":"error"}Retry`]}function Jm(i,e){const t=i.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*i.retryDelayMs,i.maxRetryDelayMs)}function ix(i){return tt(tt({},i),{errorRetry:null,timeoutRetry:null})}function lc(i,e,t,n){if(!i)return!1;const r=n==null?void 0:n.code,s=e<i.maxNumRetry&&(SM(r)||!!t);return i.shouldRetry?i.shouldRetry(i,e,t,n,s):s}function SM(i){return $f(i)||!!i&&(i<400||i>499)}function $f(i){return i===0&&navigator.onLine===!1}var Yt={DoNothing:0,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,RetryRequest:5},Mn={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,MoveAllAlternatesMatchingKey:4};class TM extends Jn{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(w.ERROR,this.onError,this),e.on(w.MANIFEST_LOADING,this.onManifestLoading,this),e.on(w.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(w.ERROR,this.onError,this),e.off(w.ERROR,this.onErrorOut,this),e.off(w.MANIFEST_LOADING,this.onManifestLoading,this),e.off(w.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return(e==null?void 0:e.type)===xe.MAIN?e.level:this.getVariantIndex()}getVariantIndex(){var e;const t=this.hls,n=t.currentLevel;return(e=t.loadLevelObj)!=null&&e.details||n===-1?t.loadLevel:n}variantHasKey(e,t){if(e){var n;if((n=e.details)!=null&&n.hasKey(t))return!0;const r=e.audioGroups;if(r)return this.hls.allAudioTracks.filter(a=>r.indexOf(a.groupId)>=0).some(a=>{var u;return(u=a.details)==null?void 0:u.hasKey(t)})}return!1}onManifestLoading(){this.playlistError=0}onLevelUpdated(){this.playlistError=0}onError(e,t){var n;if(t.fatal)return;const r=this.hls,s=t.context;switch(t.details){case Y.FRAG_LOAD_ERROR:case Y.FRAG_LOAD_TIMEOUT:case Y.KEY_LOAD_ERROR:case Y.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case Y.FRAG_PARSING_ERROR:if((n=t.frag)!=null&&n.gap){t.errorAction=ha();return}case Y.FRAG_GAP:case Y.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=Yt.SendAlternateToPenaltyBox;return}case Y.LEVEL_EMPTY_ERROR:case Y.LEVEL_PARSING_ERROR:{var a;const d=t.parent===xe.MAIN?t.level:r.loadLevel;t.details===Y.LEVEL_EMPTY_ERROR&&((a=t.context)!=null&&(a=a.levelDetails)!=null&&a.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,d):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,d))}return;case Y.LEVEL_LOAD_ERROR:case Y.LEVEL_LOAD_TIMEOUT:typeof(s==null?void 0:s.level)=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,s.level));return;case Y.AUDIO_TRACK_LOAD_ERROR:case Y.AUDIO_TRACK_LOAD_TIMEOUT:case Y.SUBTITLE_LOAD_ERROR:case Y.SUBTITLE_TRACK_LOAD_TIMEOUT:if(s){const d=r.loadLevelObj;if(d&&(s.type===ze.AUDIO_TRACK&&d.hasAudioGroup(s.groupId)||s.type===ze.SUBTITLE_TRACK&&d.hasSubtitleGroup(s.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,r.loadLevel),t.errorAction.action=Yt.SendAlternateToPenaltyBox,t.errorAction.flags=Mn.MoveAllAlternatesMatchingHost;return}}return;case Y.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:t.errorAction={action:Yt.SendAlternateToPenaltyBox,flags:Mn.MoveAllAlternatesMatchingHDCP};return;case Y.KEY_SYSTEM_SESSION_UPDATE_FAILED:case Y.KEY_SYSTEM_STATUS_INTERNAL_ERROR:case Y.KEY_SYSTEM_NO_SESSION:t.errorAction={action:Yt.SendAlternateToPenaltyBox,flags:Mn.MoveAllAlternatesMatchingKey};return;case Y.BUFFER_ADD_CODEC_ERROR:case Y.REMUX_ALLOC_ERROR:case Y.BUFFER_APPEND_ERROR:if(!t.errorAction){var u;t.errorAction=this.getLevelSwitchAction(t,(u=t.level)!=null?u:r.loadLevel)}return;case Y.INTERNAL_EXCEPTION:case Y.BUFFER_APPENDING_ERROR:case Y.BUFFER_FULL_ERROR:case Y.LEVEL_SWITCH_ERROR:case Y.BUFFER_STALLED_ERROR:case Y.BUFFER_SEEK_OVER_HOLE:case Y.BUFFER_NUDGE_ON_STALL:t.errorAction=ha();return}t.type===Ie.KEY_SYSTEM_ERROR&&(t.levelRetry=!1,t.errorAction=ha())}getPlaylistRetryOrSwitchAction(e,t){const n=this.hls,r=nx(n.config.playlistLoadPolicy,e),s=this.playlistError++;if(lc(r,s,oc(e),e.response))return{action:Yt.RetryRequest,flags:Mn.None,retryConfig:r,retryCount:s};const u=this.getLevelSwitchAction(e,t);return r&&(u.retryConfig=r,u.retryCount=s),u}getFragRetryOrSwitchAction(e){const t=this.hls,n=this.getVariantLevelIndex(e.frag),r=t.levels[n],{fragLoadPolicy:s,keyLoadPolicy:a}=t.config,u=nx(WT(e)?a:s,e),d=t.levels.reduce((h,m)=>h+m.fragmentError,0);if(r&&(e.details!==Y.FRAG_GAP&&r.fragmentError++,!YT(e)&&lc(u,d,oc(e),e.response)))return{action:Yt.RetryRequest,flags:Mn.None,retryConfig:u,retryCount:d};const c=this.getLevelSwitchAction(e,n);return u&&(c.retryConfig=u,c.retryCount=d),c}getLevelSwitchAction(e,t){const n=this.hls;t==null&&(t=n.loadLevel);const r=this.hls.levels[t];if(r){var s,a;const c=e.details;r.loadError++,c===Y.BUFFER_APPEND_ERROR&&r.fragmentError++;let h=-1;const{levels:m,loadLevel:p,minAutoLevel:y,maxAutoLevel:v}=n;!n.autoLevelEnabled&&!n.config.preserveManualLevelOnError&&(n.loadLevel=-1);const E=(s=e.frag)==null?void 0:s.type,A=(E===xe.AUDIO&&c===Y.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(c===Y.BUFFER_ADD_CODEC_ERROR||c===Y.BUFFER_APPEND_ERROR))&&m.some(({audioCodec:U})=>r.audioCodec!==U),R=e.sourceBufferName==="video"&&(c===Y.BUFFER_ADD_CODEC_ERROR||c===Y.BUFFER_APPEND_ERROR)&&m.some(({codecSet:U,audioCodec:C})=>r.codecSet!==U&&r.audioCodec===C),{type:D,groupId:k}=(a=e.context)!=null?a:{};for(let U=m.length;U--;){const C=(U+p)%m.length;if(C!==p&&C>=y&&C<=v&&m[C].loadError===0){var u,d;const _=m[C];if(c===Y.FRAG_GAP&&E===xe.MAIN&&e.frag){const F=m[C].details;if(F){const O=Ss(e.frag,F.fragments,e.frag.start);if(O!=null&&O.gap)continue}}else{if(D===ze.AUDIO_TRACK&&_.hasAudioGroup(k)||D===ze.SUBTITLE_TRACK&&_.hasSubtitleGroup(k))continue;if(E===xe.AUDIO&&(u=r.audioGroups)!=null&&u.some(F=>_.hasAudioGroup(F))||E===xe.SUBTITLE&&(d=r.subtitleGroups)!=null&&d.some(F=>_.hasSubtitleGroup(F))||A&&r.audioCodec===_.audioCodec||R&&r.codecSet===_.codecSet||!A&&r.codecSet!==_.codecSet)continue}h=C;break}}if(h>-1&&n.loadLevel!==h)return e.levelRetry=!0,this.playlistError=0,{action:Yt.SendAlternateToPenaltyBox,flags:Mn.None,nextAutoLevel:h}}return{action:Yt.SendAlternateToPenaltyBox,flags:Mn.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var n;switch((n=t.errorAction)==null?void 0:n.action){case Yt.DoNothing:break;case Yt.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==Y.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const t=this.hls,n=e.errorAction;if(!n)return;const{flags:r}=n,s=n.nextAutoLevel;switch(r){case Mn.None:this.switchLevel(e,s);break;case Mn.MoveAllAlternatesMatchingHDCP:{const d=this.getVariantLevelIndex(e.frag),c=t.levels[d],h=c==null?void 0:c.attrs["HDCP-LEVEL"];if(n.hdcpLevel=h,h==="NONE")this.warn("HDCP policy resticted output with HDCP-LEVEL=NONE");else if(h){t.maxHdcpLevel=Uf[Uf.indexOf(h)-1],n.resolved=!0,this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}}case Mn.MoveAllAlternatesMatchingKey:{const d=e.decryptdata;if(d){const c=this.hls.levels,h=c.length;for(let p=h;p--;)if(this.variantHasKey(c[p],d)){var a,u;this.log(`Banned key found in level ${p} (${c[p].bitrate}bps) or audio group "${(a=c[p].audioGroups)==null?void 0:a.join(",")}" (${(u=e.frag)==null?void 0:u.type} fragment) ${qt(d.keyId||[])}`),c[p].fragmentError++,c[p].loadError++,this.log(`Removing level ${p} with key error (${e.error})`),this.hls.removeLevel(p)}const m=e.frag;if(this.hls.levels.length<h)n.resolved=!0;else if(m&&m.type!==xe.MAIN){const p=m.decryptdata;p&&!d.matches(p)&&(n.resolved=!0)}}break}}n.resolved||this.switchLevel(e,s)}switchLevel(e,t){if(t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===Y.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&e.sourceBufferName!=="audiovideo")){const n=Bf(e.mimeType),r=this.hls.levels;for(let s=r.length;s--;)r[s][`${e.sourceBufferName}Codec`]===n&&(this.log(`Removing level ${s} for ${e.details} ("${n}" not supported)`),this.hls.removeLevel(s))}}}function ha(i){const e={action:Yt.DoNothing,flags:Mn.None};return i&&(e.resolved=!0),e}var Bt={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class AM{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e&&(e.on(w.MANIFEST_LOADING,this.onManifestLoading,this),e.on(w.BUFFER_APPENDED,this.onBufferAppended,this),e.on(w.FRAG_BUFFERED,this.onFragBuffered,this),e.on(w.FRAG_LOADED,this.onFragLoaded,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(w.MANIFEST_LOADING,this.onManifestLoading,this),e.off(w.BUFFER_APPENDED,this.onBufferAppended,this),e.off(w.FRAG_BUFFERED,this.onFragBuffered,this),e.off(w.FRAG_LOADED,this.onFragLoaded,this))}destroy(){this._unregisterListeners(),this.hls=this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const n=this.activePartLists[t];if(n)for(let r=n.length;r--;){const s=n[r];if(!s)break;if(s.start<=e&&e<=s.end&&s.loaded)return s}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,n){const{fragments:r}=this,s=Object.keys(r);for(let a=s.length;a--;){const u=r[s[a]];if((u==null?void 0:u.body.type)===t&&(!n||u.buffered)){const d=u.body;if(d.start<=e&&e<=d.end)return d}}return null}detectEvictedFragments(e,t,n,r,s){this.timeRanges&&(this.timeRanges[e]=t);const a=(r==null?void 0:r.fragment.sn)||-1;Object.keys(this.fragments).forEach(u=>{const d=this.fragments[u];if(!d||a>=d.body.sn)return;if(!d.buffered&&(!d.loaded||s)){d.body.type===n&&this.removeFragment(d.body);return}const c=d.range[e];if(c){if(c.time.length===0){this.removeFragment(d.body);return}c.time.some(h=>{const m=!this.isTimeBuffered(h.startPTS,h.endPTS,t);return m&&this.removeFragment(d.body),m})}})}detectPartialFragments(e){const t=this.timeRanges;if(!t||e.frag.sn==="initSegment")return;const n=e.frag,r=Xs(n),s=this.fragments[r];if(!s||s.buffered&&n.gap)return;const a=!n.relurl;Object.keys(t).forEach(u=>{const d=n.elementaryStreams[u];if(!d)return;const c=t[u],h=a||d.partial===!0;s.range[u]=this.getBufferedTimes(n,e.part,h,c)}),s.loaded=null,Object.keys(s.range).length?(this.bufferedEnd(s,n),gu(s)||this.removeParts(n.sn-1,n.type)):this.removeFragment(s.body)}bufferedEnd(e,t){e.buffered=!0,(e.body.endList=t.endList||e.body.endList)&&(this.endListFragments[e.body.type]=e)}removeParts(e,t){const n=this.activePartLists[t];n&&(this.activePartLists[t]=rx(n,r=>r.fragment.sn>=e))}fragBuffered(e,t){const n=Xs(e);let r=this.fragments[n];!r&&t&&(r=this.fragments[n]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),r&&(r.loaded=null,this.bufferedEnd(r,e))}getBufferedTimes(e,t,n,r){const s={time:[],partial:n},a=e.start,u=e.end,d=e.minEndPTS||u,c=e.maxStartPTS||a;for(let h=0;h<r.length;h++){const m=r.start(h)-this.bufferPadding,p=r.end(h)+this.bufferPadding;if(c>=m&&d<=p){s.time.push({startPTS:Math.max(a,r.start(h)),endPTS:Math.min(u,r.end(h))});break}else if(a<p&&u>m){const y=Math.max(a,r.start(h)),v=Math.min(u,r.end(h));v>y&&(s.partial=!0,s.time.push({startPTS:y,endPTS:v}))}else if(u<=m)break}return s}getPartialFragment(e){let t=null,n,r,s,a=0;const{bufferPadding:u,fragments:d}=this;return Object.keys(d).forEach(c=>{const h=d[c];h&&gu(h)&&(r=h.body.start-u,s=h.body.end+u,e>=r&&e<=s&&(n=Math.min(e-r,s-e),a<=n&&(t=h.body,a=n)))}),t}isEndListAppended(e){const t=this.endListFragments[e];return t!==void 0&&(t.buffered||gu(t))}getState(e){const t=Xs(e),n=this.fragments[t];return n?n.buffered?gu(n)?Bt.PARTIAL:Bt.OK:Bt.APPENDING:Bt.NOT_LOADED}isTimeBuffered(e,t,n){let r,s;for(let a=0;a<n.length;a++){if(r=n.start(a)-this.bufferPadding,s=n.end(a)+this.bufferPadding,e>=r&&t<=s)return!0;if(t<=r)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if(t.frag.sn==="initSegment"||t.frag.bitrateTest)return;const n=t.frag,r=t.part?null:t,s=Xs(n);this.fragments[s]={body:n,appendedPTS:null,loaded:r,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:n,part:r,timeRanges:s,type:a}=t;if(n.sn==="initSegment")return;const u=n.type;if(r){let c=this.activePartLists[u];c||(this.activePartLists[u]=c=[]),c.push(r)}this.timeRanges=s;const d=s[a];this.detectEvictedFragments(a,d,u,r)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=Xs(e);return!!this.fragments[t]}hasFragments(e){const{fragments:t}=this,n=Object.keys(t);if(!e)return n.length>0;for(let r=n.length;r--;){const s=t[n[r]];if((s==null?void 0:s.body.type)===e)return!0}return!1}hasParts(e){var t;return!!((t=this.activePartLists[e])!=null&&t.length)}removeFragmentsInRange(e,t,n,r,s){r&&!this.hasGaps||Object.keys(this.fragments).forEach(a=>{const u=this.fragments[a];if(!u)return;const d=u.body;d.type!==n||r&&!d.gap||d.start<t&&d.end>e&&(u.buffered||s)&&this.removeFragment(d)})}removeFragment(e){const t=Xs(e);e.clearElementaryStreamInfo();const n=this.activePartLists[e.type];if(n){const r=e.sn;this.activePartLists[e.type]=rx(n,s=>s.fragment.sn!==r)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const t=(e=this.hls)==null||(e=e.latestLevelDetails)==null?void 0:e.partList;t&&t.forEach(n=>n.clearElementaryStreamInfo())}}function gu(i){var e,t,n;return i.buffered&&!!(i.body.gap||(e=i.range.video)!=null&&e.partial||(t=i.range.audio)!=null&&t.partial||(n=i.range.audiovideo)!=null&&n.partial)}function Xs(i){return`${i.type}_${i.level}_${i.sn}`}function rx(i,e){return i.filter(t=>{const n=e(t);return n||t.clearElementaryStreamInfo(),n})}var $r={cbc:0,ctr:1};class wM{constructor(e,t,n){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=n}decrypt(e,t){switch(this.aesMode){case $r.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case $r.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}function LM(i){const e=i.byteLength,t=e&&new DataView(i.buffer).getUint8(e-1);return t?i.slice(0,e-t):i}class RM{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),n=new Uint32Array(4);for(let r=0;r<4;r++)n[r]=t.getUint32(r*4);return n}initTable(){const e=this.sBox,t=this.invSBox,n=this.subMix,r=n[0],s=n[1],a=n[2],u=n[3],d=this.invSubMix,c=d[0],h=d[1],m=d[2],p=d[3],y=new Uint32Array(256);let v=0,E=0,S=0;for(S=0;S<256;S++)S<128?y[S]=S<<1:y[S]=S<<1^283;for(S=0;S<256;S++){let A=E^E<<1^E<<2^E<<3^E<<4;A=A>>>8^A&255^99,e[v]=A,t[A]=v;const L=y[v],R=y[L],D=y[R];let k=y[A]*257^A*16843008;r[v]=k<<24|k>>>8,s[v]=k<<16|k>>>16,a[v]=k<<8|k>>>24,u[v]=k,k=D*16843009^R*65537^L*257^v*16843008,c[A]=k<<24|k>>>8,h[A]=k<<16|k>>>16,m[A]=k<<8|k>>>24,p[A]=k,v?(v=L^y[y[y[D^L]]],E^=y[y[E]]):v=E=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let n=!0,r=0;for(;r<t.length&&n;)n=t[r]===this.key[r],r++;if(n)return;this.key=t;const s=this.keySize=t.length;if(s!==4&&s!==6&&s!==8)throw new Error("Invalid aes key size="+s);const a=this.ksRows=(s+6+1)*4;let u,d;const c=this.keySchedule=new Uint32Array(a),h=this.invKeySchedule=new Uint32Array(a),m=this.sBox,p=this.rcon,y=this.invSubMix,v=y[0],E=y[1],S=y[2],A=y[3];let L,R;for(u=0;u<a;u++){if(u<s){L=c[u]=t[u];continue}R=L,u%s===0?(R=R<<8|R>>>24,R=m[R>>>24]<<24|m[R>>>16&255]<<16|m[R>>>8&255]<<8|m[R&255],R^=p[u/s|0]<<24):s>6&&u%s===4&&(R=m[R>>>24]<<24|m[R>>>16&255]<<16|m[R>>>8&255]<<8|m[R&255]),c[u]=L=(c[u-s]^R)>>>0}for(d=0;d<a;d++)u=a-d,d&3?R=c[u]:R=c[u-4],d<4||u<=4?h[d]=R:h[d]=v[m[R>>>24]]^E[m[R>>>16&255]]^S[m[R>>>8&255]]^A[m[R&255]],h[d]=h[d]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,n){const r=this.keySize+6,s=this.invKeySchedule,a=this.invSBox,u=this.invSubMix,d=u[0],c=u[1],h=u[2],m=u[3],p=this.uint8ArrayToUint32Array_(n);let y=p[0],v=p[1],E=p[2],S=p[3];const A=new Int32Array(e),L=new Int32Array(A.length);let R,D,k,U,C,_,F,O,W,z,re,ae,ce,ne;const ie=this.networkToHostOrderSwap;for(;t<A.length;){for(W=ie(A[t]),z=ie(A[t+1]),re=ie(A[t+2]),ae=ie(A[t+3]),C=W^s[0],_=ae^s[1],F=re^s[2],O=z^s[3],ce=4,ne=1;ne<r;ne++)R=d[C>>>24]^c[_>>16&255]^h[F>>8&255]^m[O&255]^s[ce],D=d[_>>>24]^c[F>>16&255]^h[O>>8&255]^m[C&255]^s[ce+1],k=d[F>>>24]^c[O>>16&255]^h[C>>8&255]^m[_&255]^s[ce+2],U=d[O>>>24]^c[C>>16&255]^h[_>>8&255]^m[F&255]^s[ce+3],C=R,_=D,F=k,O=U,ce=ce+4;R=a[C>>>24]<<24^a[_>>16&255]<<16^a[F>>8&255]<<8^a[O&255]^s[ce],D=a[_>>>24]<<24^a[F>>16&255]<<16^a[O>>8&255]<<8^a[C&255]^s[ce+1],k=a[F>>>24]<<24^a[O>>16&255]<<16^a[C>>8&255]<<8^a[_&255]^s[ce+2],U=a[O>>>24]<<24^a[C>>16&255]<<16^a[_>>8&255]<<8^a[F&255]^s[ce+3],L[t]=ie(R^y),L[t+1]=ie(U^v),L[t+2]=ie(k^E),L[t+3]=ie(D^S),y=W,v=z,E=re,S=ae,t=t+4}return L.buffer}}class bM{constructor(e,t,n){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=n}expandKey(){const e=IM(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}function IM(i){switch(i){case $r.cbc:return"AES-CBC";case $r.ctr:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${i}`)}}const CM=16;class ep{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const n=self.crypto;n&&(this.subtle=n.subtle||n.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const n=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?LM(n):n}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,n,r){return this.useSoftware?new Promise((s,a)=>{const u=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(u,t,n,r);const d=this.flush();d?s(d.buffer):a(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,n,r)}softwareDecrypt(e,t,n,r){const{currentIV:s,currentResult:a,remainderData:u}=this;if(r!==$r.cbc||t.byteLength!==16)return nt.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),u&&(e=Qn(u,e),this.remainderData=null);const d=this.getValidChunk(e);if(!d.length)return null;s&&(n=s);let c=this.softwareDecrypter;c||(c=this.softwareDecrypter=new RM),c.expandKey(t);const h=a;return this.currentResult=c.decrypt(d.buffer,0,n),this.currentIV=d.slice(-16).buffer,h||null}webCryptoDecrypt(e,t,n,r){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,n,r));this.key=t,this.fastAesKey=new bM(this.subtle,t,r)}return this.fastAesKey.expandKey().then(s=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new wM(this.subtle,new Uint8Array(n),r).decrypt(e.buffer,s)):Promise.reject(new Error("web crypto not initialized"))).catch(s=>(nt.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${s.name}: ${s.message}`),this.onWebCryptoError(e,t,n,r)))}onWebCryptoError(e,t,n,r){const s=this.enableSoftwareAES;if(s){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,n,r);const a=this.flush();if(a)return a.buffer}throw new Error("WebCrypto"+(s?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e;const n=e.length-e.length%CM;return n!==e.length&&(t=e.slice(0,n),this.remainderData=e.slice(n)),t}logOnce(e){this.logEnabled&&(nt.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const sx=Math.pow(2,17);class DM{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const n=e.url;if(!n)return Promise.reject(new er({type:Ie.NETWORK_ERROR,details:Y.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${n?"part list":"url"}`),networkDetails:null}));this.abort();const r=this.config,s=r.fLoader,a=r.loader;return new Promise((u,d)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(v=>v[0]==="GAP")){d(ox(e));return}else e.gap=!1;const c=this.loader=s?new s(r):new a(r),h=ax(e);e.loader=c;const m=ix(r.fragLoadPolicy.default),p={loadPolicy:m,timeout:m.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:sx};e.stats=c.stats;const y={onSuccess:(v,E,S,A)=>{this.resetLoader(e,c);let L=v.data;S.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(L.slice(0,16)),L=L.slice(16)),u({frag:e,part:null,payload:L,networkDetails:A})},onError:(v,E,S,A)=>{this.resetLoader(e,c),d(new er({type:Ie.NETWORK_ERROR,details:Y.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:tt({url:n,data:void 0},v),error:new Error(`HTTP Error ${v.code} ${v.text}`),networkDetails:S,stats:A}))},onAbort:(v,E,S)=>{this.resetLoader(e,c),d(new er({type:Ie.NETWORK_ERROR,details:Y.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:S,stats:v}))},onTimeout:(v,E,S)=>{this.resetLoader(e,c),d(new er({type:Ie.NETWORK_ERROR,details:Y.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${p.timeout}ms`),networkDetails:S,stats:v}))}};t&&(y.onProgress=(v,E,S,A)=>t({frag:e,part:null,payload:S,networkDetails:A})),c.load(h,p,y)})}loadPart(e,t,n){this.abort();const r=this.config,s=r.fLoader,a=r.loader;return new Promise((u,d)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){d(ox(e,t));return}const c=this.loader=s?new s(r):new a(r),h=ax(e,t);e.loader=c;const m=ix(r.fragLoadPolicy.default),p={loadPolicy:m,timeout:m.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:sx};t.stats=c.stats,c.load(h,p,{onSuccess:(y,v,E,S)=>{this.resetLoader(e,c),this.updateStatsFromPart(e,t);const A={frag:e,part:t,payload:y.data,networkDetails:S};n(A),u(A)},onError:(y,v,E,S)=>{this.resetLoader(e,c),d(new er({type:Ie.NETWORK_ERROR,details:Y.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:tt({url:h.url,data:void 0},y),error:new Error(`HTTP Error ${y.code} ${y.text}`),networkDetails:E,stats:S}))},onAbort:(y,v,E)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,c),d(new er({type:Ie.NETWORK_ERROR,details:Y.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:E,stats:y}))},onTimeout:(y,v,E)=>{this.resetLoader(e,c),d(new er({type:Ie.NETWORK_ERROR,details:Y.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${p.timeout}ms`),networkDetails:E,stats:y}))}})})}updateStatsFromPart(e,t){const n=e.stats,r=t.stats,s=r.total;if(n.loaded+=r.loaded,s){const d=Math.round(e.duration/t.duration),c=Math.min(Math.round(n.loaded/s),d),m=(d-c)*Math.round(n.loaded/c);n.total=n.loaded+m}else n.total=Math.max(n.loaded,n.total);const a=n.loading,u=r.loading;a.start?a.first+=u.first-u.start:(a.start=u.start,a.first=u.first),a.end=u.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function ax(i,e=null){const t=e||i,n={frag:i,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},r=t.byteRangeStartOffset,s=t.byteRangeEndOffset;if(ye(r)&&ye(s)){var a;let u=r,d=s;if(i.sn==="initSegment"&&kM((a=i.decryptdata)==null?void 0:a.method)){const c=s-r;c%16&&(d=s+(16-c%16)),r!==0&&(n.resetIV=!0,u=r-16)}n.rangeStart=u,n.rangeEnd=d}return n}function ox(i,e){const t=new Error(`GAP ${i.gap?"tag":"attribute"} found`),n={type:Ie.MEDIA_ERROR,details:Y.FRAG_GAP,fatal:!1,frag:i,error:t,networkDetails:null};return e&&(n.part=e),(e||i).stats.aborted=!0,new er(n)}function kM(i){return i==="AES-128"||i==="AES-256"}class er extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class qT extends Jn{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class tp{constructor(e,t,n,r=0,s=-1,a=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=yu(),this.buffering={audio:yu(),video:yu(),audiovideo:yu()},this.level=e,this.sn=t,this.id=n,this.size=r,this.part=s,this.partial=a}}function yu(){return{start:0,executeStart:0,executeEnd:0,end:0}}const lx={length:0,start:()=>0,end:()=>0};class Ue{static isBuffered(e,t){if(e){const n=Ue.getBuffered(e);for(let r=n.length;r--;)if(t>=n.start(r)&&t<=n.end(r))return!0}return!1}static bufferedRanges(e){if(e){const t=Ue.getBuffered(e);return Ue.timeRangesToArray(t)}return[]}static timeRangesToArray(e){const t=[];for(let n=0;n<e.length;n++)t.push({start:e.start(n),end:e.end(n)});return t}static bufferInfo(e,t,n){if(e){const r=Ue.bufferedRanges(e);if(r.length)return Ue.bufferedInfo(r,t,n)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,n){t=Math.max(0,t),e.length>1&&e.sort((h,m)=>h.start-m.start||m.end-h.end);let r=-1,s=[];if(n)for(let h=0;h<e.length;h++){t>=e[h].start&&t<=e[h].end&&(r=h);const m=s.length;if(m){const p=s[m-1].end;e[h].start-p<n?e[h].end>p&&(s[m-1].end=e[h].end):s.push(e[h])}else s.push(e[h])}else s=e;let a=0,u,d=t,c=t;for(let h=0;h<s.length;h++){const m=s[h].start,p=s[h].end;if(r===-1&&t>=m&&t<=p&&(r=h),t+n>=m&&t<p)d=m,c=p,a=c-t;else if(t+n<m){u=m;break}}return{len:a,start:d||0,end:c||0,nextStart:u,buffered:e,bufferedIndex:r}}static getBuffered(e){try{return e.buffered||lx}catch(t){return nt.log("failed to get media.buffered",t),lx}}}const XT=/\{\$([a-zA-Z0-9-_]+)\}/g;function ux(i){return XT.test(i)}function jf(i,e){if(i.variableList!==null||i.hasVariableRefs){const t=i.variableList;return e.replace(XT,n=>{const r=n.substring(2,n.length-1),s=t==null?void 0:t[r];return s===void 0?(i.playlistParsingError||(i.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${r}"`)),n):s})}return e}function cx(i,e,t){let n=i.variableList;n||(i.variableList=n={});let r,s;if("QUERYPARAM"in e){r=e.QUERYPARAM;try{const a=new self.URL(t).searchParams;if(a.has(r))s=a.get(r);else throw new Error(`"${r}" does not match any query parameter in URI: "${t}"`)}catch(a){i.playlistParsingError||(i.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${a.message}`))}}else r=e.NAME,s=e.VALUE;r in n?i.playlistParsingError||(i.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${r}"`)):n[r]=s||""}function PM(i,e,t){const n=e.IMPORT;if(t&&n in t){let r=i.variableList;r||(i.variableList=r={}),r[n]=t[n]}else i.playlistParsingError||(i.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${n}"`))}const _M=/^(\d+)x(\d+)$/,dx=/(.+?)=(".*?"|.*?)(?:,|$)/g;class gt{constructor(e,t){typeof e=="string"&&(e=gt.parseAttrList(e,t)),rt(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;const n=new Uint8Array(t.length/2);for(let r=0;r<t.length/2;r++)n[r]=parseInt(t.slice(r*2,r*2+2),16);return n}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const n=this[e];return n?parseFloat(n):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){const n=this[e];return(n?n.split(/[ ,]+/):[]).reduce((r,s)=>(r[s.toLowerCase()]=!0,r),t)}bool(e){return this[e]==="YES"}decimalResolution(e){const t=_M.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let n;const r={};for(dx.lastIndex=0;(n=dx.exec(e))!==null;){const a=n[1].trim();let u=n[2];const d=u.indexOf('"')===0&&u.lastIndexOf('"')===u.length-1;let c=!1;if(d)u=u.slice(1,-1);else switch(a){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":c=!0}if(t&&(d||c))u=jf(t,u);else if(!c&&!d)switch(a){case"CLOSED-CAPTIONS":if(u==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":nt.warn(`${e}: attribute ${a} is missing quotes`)}r[a]=u}return r}}const MM="com.apple.hls.interstitial";function NM(i){return i!=="ID"&&i!=="CLASS"&&i!=="CUE"&&i!=="START-DATE"&&i!=="DURATION"&&i!=="END-DATE"&&i!=="END-ON-NEXT"}function OM(i){return i==="SCTE35-OUT"||i==="SCTE35-IN"||i==="SCTE35-CMD"}class QT{constructor(e,t,n=0){var r;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=(t==null?void 0:t.tagAnchor)||null,this.tagOrder=(r=t==null?void 0:t.tagOrder)!=null?r:n,t){const s=t.attr;for(const a in s)if(Object.prototype.hasOwnProperty.call(e,a)&&e[a]!==s[a]){nt.warn(`DATERANGE tag attribute: "${a}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=a;break}e=rt(new gt({}),s,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const s=(t==null?void 0:t.endDate)||new Date(this.attr["END-DATE"]);ye(s.getTime())&&(this._endDate=s)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return e===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return e===null||e.programDateTime===null?(nt.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const t=this.duration;return t!==null?this._dateAtEnd=new Date(this._startDate.getTime()+t*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(ye(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return this.class===MM}get isValid(){return!!this.id&&!this._badValueForSameId&&ye(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}const FM=10;class BM{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const t=this.lastPartSn-e.lastPartSn,n=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!n||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||t===0&&n>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1}hasKey(e){return this.encryptedFragments.some(t=>{let n=t.decryptdata;return n||(t.setKeyFormat(e.keyFormat),n=t.decryptdata),!!n&&e.matches(n)})}get hasProgramDateTime(){return this.fragments.length?ye(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||FM}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){return this.fragments.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){return this.fragments.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const t=this.lastPartIndex;if(t!==-1){for(let n=e.length;n--;)if(e[n].index>t)return e[n].index;return t}}return 0}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function uc(i,e){return i.length===e.length?!i.some((t,n)=>t!==e[n]):!1}function hx(i,e){return!i&&!e?!0:!i||!e?!1:uc(i,e)}function fa(i){return i==="AES-128"||i==="AES-256"||i==="AES-256-CTR"}function np(i){switch(i){case"AES-128":case"AES-256":return $r.cbc;case"AES-256-CTR":return $r.ctr;default:throw new Error(`invalid full segment method ${i}`)}}function ip(i){return Uint8Array.from(atob(i),e=>e.charCodeAt(0))}function Vf(i){return Uint8Array.from(unescape(encodeURIComponent(i)),e=>e.charCodeAt(0))}function UM(i){const e=Vf(i).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function ZT(i){const e=function(n,r,s){const a=n[r];n[r]=n[s],n[s]=a};e(i,0,3),e(i,1,2),e(i,4,5),e(i,6,7)}function JT(i){const e=i.split(":");let t=null;if(e[0]==="data"&&e.length===2){const n=e[1].split(";"),r=n[n.length-1].split(",");if(r.length===2){const s=r[0]==="base64",a=r[1];s?(n.splice(-1,1),t=ip(a)):t=UM(a)}}return t}const cc=typeof self<"u"?self:void 0;var yt={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},Xt={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function ju(i){switch(i){case Xt.FAIRPLAY:return yt.FAIRPLAY;case Xt.PLAYREADY:return yt.PLAYREADY;case Xt.WIDEVINE:return yt.WIDEVINE;case Xt.CLEARKEY:return yt.CLEARKEY}}function Fh(i){switch(i){case yt.FAIRPLAY:return Xt.FAIRPLAY;case yt.PLAYREADY:return Xt.PLAYREADY;case yt.WIDEVINE:return Xt.WIDEVINE;case yt.CLEARKEY:return Xt.CLEARKEY}}function vo(i){const{drmSystems:e,widevineLicenseUrl:t}=i,n=e?[yt.FAIRPLAY,yt.WIDEVINE,yt.PLAYREADY,yt.CLEARKEY].filter(r=>!!e[r]):[];return!n[yt.WIDEVINE]&&t&&n.push(yt.WIDEVINE),n}const eA=(function(i){return cc!=null&&(i=cc.navigator)!=null&&i.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null})();function $M(i,e,t,n){let r;switch(i){case yt.FAIRPLAY:r=["cenc","sinf"];break;case yt.WIDEVINE:case yt.PLAYREADY:r=["cenc"];break;case yt.CLEARKEY:r=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${i}`)}return jM(r,e,t,n)}function jM(i,e,t,n){return[{initDataTypes:i,persistentState:n.persistentState||"optional",distinctiveIdentifier:n.distinctiveIdentifier||"optional",sessionTypes:n.sessionTypes||[n.sessionType||"temporary"],audioCapabilities:e.map(s=>({contentType:`audio/mp4; codecs=${s}`,robustness:n.audioRobustness||"",encryptionScheme:n.audioEncryptionScheme||null})),videoCapabilities:t.map(s=>({contentType:`video/mp4; codecs=${s}`,robustness:n.videoRobustness||"",encryptionScheme:n.videoEncryptionScheme||null}))}]}function VM(i){var e;return!!i&&(i.sessionType==="persistent-license"||!!((e=i.sessionTypes)!=null&&e.some(t=>t==="persistent-license")))}function tA(i){const e=new Uint16Array(i.buffer,i.byteOffset,i.byteLength/2),t=String.fromCharCode.apply(null,Array.from(e)),n=t.substring(t.indexOf("<"),t.length),a=new DOMParser().parseFromString(n,"text/xml").getElementsByTagName("KID")[0];if(a){const u=a.childNodes[0]?a.childNodes[0].nodeValue:a.getAttribute("VALUE");if(u){const d=ip(u).subarray(0,16);return ZT(d),d}}return null}let Qs={};class Fr{static clearKeyUriToKeyIdMap(){Qs={}}static setKeyIdForUri(e,t){Qs[e]=t}static addKeyIdForUri(e){const t=Object.keys(Qs).length%Number.MAX_SAFE_INTEGER,n=new Uint8Array(16);return new DataView(n.buffer,12,4).setUint32(0,t),Qs[e]=n,n}constructor(e,t,n,r=[1],s=null,a){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=n,this.keyFormatVersions=r,this.iv=s,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!fa(e),a!=null&&a.startsWith("0x")&&(this.keyId=new Uint8Array(CT(a)))}matches(e){return e.uri===this.uri&&e.method===this.method&&e.encrypted===this.encrypted&&e.keyFormat===this.keyFormat&&uc(e.keyFormatVersions,this.keyFormatVersions)&&hx(e.iv,this.iv)&&hx(e.keyId,this.keyId)}isSupported(){if(this.method){if(fa(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case Xt.FAIRPLAY:case Xt.WIDEVINE:case Xt.PLAYREADY:case Xt.CLEARKEY:return["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e,t){if(!this.encrypted||!this.uri)return null;if(fa(this.method)){let s=this.iv;return s||(typeof e!="number"&&(nt.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0),s=HM(e)),new Fr(this.method,this.uri,"identity",this.keyFormatVersions,s)}if(this.keyId){const s=Qs[this.uri];if(s&&!uc(this.keyId,s)&&Fr.setKeyIdForUri(this.uri,this.keyId),this.pssh)return this}const n=JT(this.uri);if(n)switch(this.keyFormat){case Xt.WIDEVINE:if(this.pssh=n,!this.keyId){const s=W_(n.buffer);if(s.length){var r;const a=s[0];this.keyId=(r=a.kids)!=null&&r.length?a.kids[0]:null}}this.keyId||(this.keyId=fx(t));break;case Xt.PLAYREADY:{const s=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=K_(s,null,n),this.keyId=tA(n);break}default:{let s=n.subarray(0,16);if(s.length!==16){const a=new Uint8Array(16);a.set(s,16-s.length),s=a}this.keyId=s;break}}if(!this.keyId||this.keyId.byteLength!==16){let s;s=GM(t),s||(s=fx(t),s||(s=Qs[this.uri])),s&&(this.keyId=s,Fr.setKeyIdForUri(this.uri,s))}return this}}function GM(i){const e=i==null?void 0:i[Xt.WIDEVINE];return e?e.keyId:null}function fx(i){const e=i==null?void 0:i[Xt.PLAYREADY];if(e){const t=JT(e.uri);if(t)return tA(t)}return null}function HM(i){const e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=i>>8*(15-t)&255;return e}const mx=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,px=/#EXT-X-MEDIA:(.*)/g,zM=/^#EXT(?:INF|-X-TARGETDURATION):/m,Bh=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),KM=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class Pi{static findGroup(e,t){for(let n=0;n<e.length;n++){const r=e[n];if(r.id===t)return r}}static resolve(e,t){return Ym.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return zM.test(e)}static parseMasterPlaylist(e,t){const n=ux(e),r={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:n},s=[];if(mx.lastIndex=0,!e.startsWith("#EXTM3U"))return r.playlistParsingError=new Error("no EXTM3U delimiter"),r;let a;for(;(a=mx.exec(e))!=null;)if(a[1]){var u;const c=new gt(a[1],r),h=jf(r,a[2]),m={attrs:c,bitrate:c.decimalInteger("BANDWIDTH")||c.decimalInteger("AVERAGE-BANDWIDTH"),name:c.NAME,url:Pi.resolve(h,t)},p=c.decimalResolution("RESOLUTION");p&&(m.width=p.width,m.height=p.height),vx(c.CODECS,m);const y=c["SUPPLEMENTAL-CODECS"];y&&(m.supplemental={},vx(y,m.supplemental)),(u=m.unknownCodecs)!=null&&u.length||s.push(m),r.levels.push(m)}else if(a[3]){const c=a[3],h=a[4];switch(c){case"SESSION-DATA":{const m=new gt(h,r),p=m["DATA-ID"];p&&(r.sessionData===null&&(r.sessionData={}),r.sessionData[p]=m);break}case"SESSION-KEY":{const m=gx(h,t,r);m.encrypted&&m.isSupported()?(r.sessionKeys===null&&(r.sessionKeys=[]),r.sessionKeys.push(m)):nt.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${h}"`);break}case"DEFINE":{{const m=new gt(h,r);cx(r,m,t)}break}case"CONTENT-STEERING":{const m=new gt(h,r);r.contentSteering={uri:Pi.resolve(m["SERVER-URI"],t),pathwayId:m["PATHWAY-ID"]||"."};break}case"START":{r.startTimeOffset=yx(h);break}}}const d=s.length>0&&s.length<r.levels.length;return r.levels=d?s:r.levels,r.levels.length===0&&(r.playlistParsingError=new Error("no levels found in manifest")),r}static parseMasterPlaylistMedia(e,t,n){let r;const s={},a=n.levels,u={AUDIO:a.map(c=>({id:c.attrs.AUDIO,audioCodec:c.audioCodec})),SUBTITLES:a.map(c=>({id:c.attrs.SUBTITLES,textCodec:c.textCodec})),"CLOSED-CAPTIONS":[]};let d=0;for(px.lastIndex=0;(r=px.exec(e))!==null;){const c=new gt(r[1],n),h=c.TYPE;if(h){const m=u[h],p=s[h]||[];s[h]=p;const y=c.LANGUAGE,v=c["ASSOC-LANGUAGE"],E=c.CHANNELS,S=c.CHARACTERISTICS,A=c["INSTREAM-ID"],L={attrs:c,bitrate:0,id:d++,groupId:c["GROUP-ID"]||"",name:c.NAME||y||"",type:h,default:c.bool("DEFAULT"),autoselect:c.bool("AUTOSELECT"),forced:c.bool("FORCED"),lang:y,url:c.URI?Pi.resolve(c.URI,t):""};if(v&&(L.assocLang=v),E&&(L.channels=E),S&&(L.characteristics=S),A&&(L.instreamId=A),m!=null&&m.length){const R=Pi.findGroup(m,L.groupId)||m[0];xx(L,R,"audioCodec"),xx(L,R,"textCodec")}p.push(L)}}return s}static parseLevelPlaylist(e,t,n,r,s,a){var u;const d={url:t},c=new BM(t),h=c.fragments,m=[];let p=null,y=0,v=0,E=0,S=0,A=0,L=null,R=new Mh(r,d),D,k,U,C=-1,_=!1,F=null,O;if(Bh.lastIndex=0,c.m3u8=e,c.hasVariableRefs=ux(e),((u=Bh.exec(e))==null?void 0:u[0])!=="#EXTM3U")return c.playlistParsingError=new Error("Missing format identifier #EXTM3U"),c;for(;(D=Bh.exec(e))!==null;){_&&(_=!1,R=new Mh(r,d),R.playlistOffset=E,R.setStart(E),R.sn=y,R.cc=S,A&&(R.bitrate=A),R.level=n,p&&(R.initSegment=p,p.rawProgramDateTime&&(R.rawProgramDateTime=p.rawProgramDateTime,p.rawProgramDateTime=null),F&&(R.setByteRange(F),F=null)));const ae=D[1];if(ae){R.duration=parseFloat(ae);const ce=(" "+D[2]).slice(1);R.title=ce||null,R.tagList.push(ce?["INF",ae,ce]:["INF",ae])}else if(D[3]){if(ye(R.duration)){R.playlistOffset=E,R.setStart(E),U&&Sx(R,U,c),R.sn=y,R.level=n,R.cc=S,h.push(R);const ce=(" "+D[3]).slice(1);R.relurl=jf(c,ce),Gf(R,L,m),L=R,E+=R.duration,y++,v=0,_=!0}}else{if(D=D[0].match(KM),!D){nt.warn("No matches on slow regex match for level playlist!");continue}for(k=1;k<D.length&&D[k]===void 0;k++);const ce=(" "+D[k]).slice(1),ne=(" "+D[k+1]).slice(1),ie=D[k+2]?(" "+D[k+2]).slice(1):null;switch(ce){case"BYTERANGE":L?R.setByteRange(ne,L):R.setByteRange(ne);break;case"PROGRAM-DATE-TIME":R.rawProgramDateTime=ne,R.tagList.push(["PROGRAM-DATE-TIME",ne]),C===-1&&(C=h.length);break;case"PLAYLIST-TYPE":c.type&&Qi(c,ce,D),c.type=ne.toUpperCase();break;case"MEDIA-SEQUENCE":c.startSN!==0?Qi(c,ce,D):h.length>0&&Tx(c,ce,D),y=c.startSN=parseInt(ne);break;case"SKIP":{c.skippedSegments&&Qi(c,ce,D);const G=new gt(ne,c),ee=G.decimalInteger("SKIPPED-SEGMENTS");if(ye(ee)){c.skippedSegments+=ee;for(let P=ee;P--;)h.push(null);y+=ee}const J=G.enumeratedString("RECENTLY-REMOVED-DATERANGES");J&&(c.recentlyRemovedDateranges=(c.recentlyRemovedDateranges||[]).concat(J.split("	")));break}case"TARGETDURATION":c.targetduration!==0&&Qi(c,ce,D),c.targetduration=Math.max(parseInt(ne),1);break;case"VERSION":c.version!==null&&Qi(c,ce,D),c.version=parseInt(ne);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":c.live||Qi(c,ce,D),c.live=!1;break;case"#":(ne||ie)&&R.tagList.push(ie?[ne,ie]:[ne]);break;case"DISCONTINUITY":S++,R.tagList.push(["DIS"]);break;case"GAP":R.gap=!0,R.tagList.push([ce]);break;case"BITRATE":R.tagList.push([ce,ne]),A=parseInt(ne)*1e3,ye(A)?R.bitrate=A:A=0;break;case"DATERANGE":{const G=new gt(ne,c),ee=new QT(G,c.dateRanges[G.ID],c.dateRangeTagCount);c.dateRangeTagCount++,ee.isValid||c.skippedSegments?c.dateRanges[ee.id]=ee:nt.warn(`Ignoring invalid DATERANGE tag: "${ne}"`),R.tagList.push(["EXT-X-DATERANGE",ne]);break}case"DEFINE":{{const G=new gt(ne,c);"IMPORT"in G?PM(c,G,a):cx(c,G,t)}break}case"DISCONTINUITY-SEQUENCE":c.startCC!==0?Qi(c,ce,D):h.length>0&&Tx(c,ce,D),c.startCC=S=parseInt(ne);break;case"KEY":{const G=gx(ne,t,c);if(G.isSupported()){if(G.method==="NONE"){U=void 0;break}U||(U={});const ee=U[G.keyFormat];ee!=null&&ee.matches(G)||(ee&&(U=rt({},U)),U[G.keyFormat]=G)}else nt.warn(`[Keys] Ignoring unsupported EXT-X-KEY tag: "${ne}"`);break}case"START":c.startTimeOffset=yx(ne);break;case"MAP":{const G=new gt(ne,c);if(R.duration){const ee=new Mh(r,d);Ex(ee,G,n,U),p=ee,R.initSegment=p,p.rawProgramDateTime&&!R.rawProgramDateTime&&(R.rawProgramDateTime=p.rawProgramDateTime)}else{const ee=R.byteRangeEndOffset;if(ee){const J=R.byteRangeStartOffset;F=`${ee-J}@${J}`}else F=null;Ex(R,G,n,U),p=R,_=!0}p.cc=S;break}case"SERVER-CONTROL":{O&&Qi(c,ce,D),O=new gt(ne),c.canBlockReload=O.bool("CAN-BLOCK-RELOAD"),c.canSkipUntil=O.optionalFloat("CAN-SKIP-UNTIL",0),c.canSkipDateRanges=c.canSkipUntil>0&&O.bool("CAN-SKIP-DATERANGES"),c.partHoldBack=O.optionalFloat("PART-HOLD-BACK",0),c.holdBack=O.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{c.partTarget&&Qi(c,ce,D);const G=new gt(ne);c.partTarget=G.decimalFloatingPoint("PART-TARGET");break}case"PART":{let G=c.partList;G||(G=c.partList=[]);const ee=v>0?G[G.length-1]:void 0,J=v++,P=new gt(ne,c),j=new P_(P,R,d,J,ee);G.push(j),R.duration+=j.duration;break}case"PRELOAD-HINT":{const G=new gt(ne,c);c.preloadHint=G;break}case"RENDITION-REPORT":{const G=new gt(ne,c);c.renditionReports=c.renditionReports||[],c.renditionReports.push(G);break}default:nt.warn(`line parsed but not handled: ${D}`);break}}}L&&!L.relurl?(h.pop(),E-=L.duration,c.partList&&(c.fragmentHint=L)):c.partList&&(Gf(R,L,m),R.cc=S,c.fragmentHint=R,U&&Sx(R,U,c)),c.targetduration||(c.playlistParsingError=new Error("Missing Target Duration"));const W=h.length,z=h[0],re=h[W-1];if(E+=c.skippedSegments*c.targetduration,E>0&&W&&re){c.averagetargetduration=E/W;const ae=re.sn;c.endSN=ae!=="initSegment"?ae:0,c.live||(re.endList=!0),C>0&&(YM(h,C),z&&m.unshift(z))}return c.fragmentHint&&(E+=c.fragmentHint.duration),c.totalduration=E,m.length&&c.dateRangeTagCount&&z&&nA(m,c),c.endCC=S,c}}function nA(i,e){let t=i.length;if(!t)if(e.hasProgramDateTime){const u=e.fragments[e.fragments.length-1];i.push(u),t++}else return;const n=i[t-1],r=e.live?1/0:e.totalduration,s=Object.keys(e.dateRanges);for(let u=s.length;u--;){const d=e.dateRanges[s[u]],c=d.startDate.getTime();d.tagAnchor=n.ref;for(let h=t;h--;){var a;if(((a=i[h])==null?void 0:a.sn)<e.startSN)break;const m=WM(e,c,i,h,r);if(m!==-1){d.tagAnchor=e.fragments[m].ref;break}}}}function WM(i,e,t,n,r){const s=t[n];if(s){const u=s.programDateTime;if(e>=u||n===0){var a;const d=(((a=t[n+1])==null?void 0:a.start)||r)-s.start;if(e<=u+d*1e3){const c=t[n].sn-i.startSN;if(c<0)return-1;const h=i.fragments;if(h.length>t.length){const p=(t[n+1]||h[h.length-1]).sn-i.startSN;for(let y=p;y>c;y--){const v=h[y].programDateTime;if(e>=v&&e<v+h[y].duration*1e3)return y}}return c}}}return-1}function gx(i,e,t){var n,r;const s=new gt(i,t),a=(n=s.METHOD)!=null?n:"",u=s.URI,d=s.hexadecimalInteger("IV"),c=s.KEYFORMATVERSIONS,h=(r=s.KEYFORMAT)!=null?r:"identity";u&&s.IV&&!d&&nt.error(`Invalid IV: ${s.IV}`);const m=u?Pi.resolve(u,e):"",p=(c||"1").split("/").map(Number).filter(Number.isFinite);return new Fr(a,m,h,p,d,s.KEYID)}function yx(i){const t=new gt(i).decimalFloatingPoint("TIME-OFFSET");return ye(t)?t:null}function vx(i,e){let t=(i||"").split(/[ ,]+/).filter(n=>n);["video","audio","text"].forEach(n=>{const r=t.filter(s=>Qm(s,n));r.length&&(e[`${n}Codec`]=r.map(s=>s.split("/")[0]).join(","),t=t.filter(s=>r.indexOf(s)===-1))}),e.unknownCodecs=t}function xx(i,e,t){const n=e[t];n&&(i[t]=n)}function YM(i,e){let t=i[e];for(let n=e;n--;){const r=i[n];if(!r)return;r.programDateTime=t.programDateTime-r.duration*1e3,t=r}}function Gf(i,e,t){i.rawProgramDateTime?t.push(i):e!=null&&e.programDateTime&&(i.programDateTime=e.endProgramDateTime)}function Ex(i,e,t,n){i.relurl=e.URI,e.BYTERANGE&&i.setByteRange(e.BYTERANGE),i.level=t,i.sn="initSegment",n&&(i.levelkeys=n),i.initSegment=null}function Sx(i,e,t){i.levelkeys=e;const{encryptedFragments:n}=t;(!n.length||n[n.length-1].levelkeys!==e)&&Object.keys(e).some(r=>e[r].isCommonEncryption)&&n.push(i)}function Qi(i,e,t){i.playlistParsingError=new Error(`#EXT-X-${e} must not appear more than once (${t[0]})`)}function Tx(i,e,t){i.playlistParsingError=new Error(`#EXT-X-${e} must appear before the first Media Segment (${t[0]})`)}function Uh(i,e){const t=e.startPTS;if(ye(t)){let n=0,r;e.sn>i.sn?(n=t-i.start,r=i):(n=i.start-t,r=e),r.duration!==n&&r.setDuration(n)}else e.sn>i.sn?i.cc===e.cc&&i.minEndPTS?e.setStart(i.start+(i.minEndPTS-i.start)):e.setStart(i.start+i.duration):e.setStart(Math.max(i.start-e.duration,0))}function iA(i,e,t,n,r,s,a){n-t<=0&&(a.warn("Fragment should have a positive duration",e),n=t+e.duration,s=r+e.duration);let d=t,c=n;const h=e.startPTS,m=e.endPTS;if(ye(h)){const A=Math.abs(h-t);i&&A>i.totalduration?a.warn(`media timestamps and playlist times differ by ${A}s for level ${e.level} ${i.url}`):ye(e.deltaPTS)?e.deltaPTS=Math.max(A,e.deltaPTS):e.deltaPTS=A,d=Math.max(t,h),t=Math.min(t,h),r=e.startDTS!==void 0?Math.min(r,e.startDTS):r,c=Math.min(n,m),n=Math.max(n,m),s=e.endDTS!==void 0?Math.max(s,e.endDTS):s}const p=t-e.start;e.start!==0&&e.setStart(t),e.setDuration(n-e.start),e.startPTS=t,e.maxStartPTS=d,e.startDTS=r,e.endPTS=n,e.minEndPTS=c,e.endDTS=s;const y=e.sn;if(!i||y<i.startSN||y>i.endSN)return 0;let v;const E=y-i.startSN,S=i.fragments;for(S[E]=e,v=E;v>0;v--)Uh(S[v],S[v-1]);for(v=E;v<S.length-1;v++)Uh(S[v],S[v+1]);return i.fragmentHint&&Uh(S[S.length-1],i.fragmentHint),i.PTSKnown=i.alignedSliding=!0,p}function qM(i,e,t){if(i===e)return;let n=null;const r=i.fragments;for(let h=r.length-1;h>=0;h--){const m=r[h].initSegment;if(m){n=m;break}}i.fragmentHint&&delete i.fragmentHint.endPTS;let s;ZM(i,e,(h,m,p,y)=>{if((!e.startCC||e.skippedSegments)&&m.cc!==h.cc){const v=h.cc-m.cc;for(let E=p;E<y.length;E++)y[E].cc+=v;e.endCC=y[y.length-1].cc}ye(h.startPTS)&&ye(h.endPTS)&&(m.setStart(m.startPTS=h.startPTS),m.startDTS=h.startDTS,m.maxStartPTS=h.maxStartPTS,m.endPTS=h.endPTS,m.endDTS=h.endDTS,m.minEndPTS=h.minEndPTS,m.setDuration(h.endPTS-h.startPTS),m.duration&&(s=m),e.PTSKnown=e.alignedSliding=!0),h.hasStreams&&(m.elementaryStreams=h.elementaryStreams),m.loader=h.loader,h.hasStats&&(m.stats=h.stats),h.initSegment&&(m.initSegment=h.initSegment,n=h.initSegment)});const a=e.fragments,u=e.fragmentHint?a.concat(e.fragmentHint):a;if(n&&u.forEach(h=>{var m;h&&(!h.initSegment||h.initSegment.relurl===((m=n)==null?void 0:m.relurl))&&(h.initSegment=n)}),e.skippedSegments){if(e.deltaUpdateFailed=a.some(h=>!h),e.deltaUpdateFailed){t.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let h=e.skippedSegments;h--;)a.shift();e.startSN=a[0].sn}else{e.canSkipDateRanges&&(e.dateRanges=XM(i.dateRanges,e,t));const h=i.fragments.filter(m=>m.rawProgramDateTime);if(i.hasProgramDateTime&&!e.hasProgramDateTime)for(let m=1;m<u.length;m++)u[m].programDateTime===null&&Gf(u[m],u[m-1],h);nA(h,e)}e.endCC=a[a.length-1].cc}if(!e.startCC){var d;const h=aA(i,e.startSN-1);e.startCC=(d=h==null?void 0:h.cc)!=null?d:a[0].cc}QM(i.partList,e.partList,(h,m)=>{m.elementaryStreams=h.elementaryStreams,m.stats=h.stats}),s?iA(e,s,s.startPTS,s.endPTS,s.startDTS,s.endDTS,t):rA(i,e),a.length&&(e.totalduration=e.edge-a[0].start),e.driftStartTime=i.driftStartTime,e.driftStart=i.driftStart;const c=e.advancedDateTime;if(e.advanced&&c){const h=e.edge;e.driftStart||(e.driftStartTime=c,e.driftStart=h),e.driftEndTime=c,e.driftEnd=h}else e.driftEndTime=i.driftEndTime,e.driftEnd=i.driftEnd,e.advancedDateTime=i.advancedDateTime;e.requestScheduled===-1&&(e.requestScheduled=i.requestScheduled)}function XM(i,e,t){const{dateRanges:n,recentlyRemovedDateranges:r}=e,s=rt({},i);r&&r.forEach(d=>{delete s[d]});const u=Object.keys(s).length;return u?(Object.keys(n).forEach(d=>{const c=s[d],h=new QT(n[d].attr,c);h.isValid?(s[d]=h,c||(h.tagOrder+=u)):t.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${ot(n[d].attr)}"`)}),s):n}function QM(i,e,t){if(i&&e){let n=0;for(let r=0,s=i.length;r<=s;r++){const a=i[r],u=e[r+n];a&&u&&a.index===u.index&&a.fragment.sn===u.fragment.sn?t(a,u):n--}}}function ZM(i,e,t){const n=e.skippedSegments,r=Math.max(i.startSN,e.startSN)-e.startSN,s=(i.fragmentHint?1:0)+(n?e.endSN:Math.min(i.endSN,e.endSN))-e.startSN,a=e.startSN-i.startSN,u=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,d=i.fragmentHint?i.fragments.concat(i.fragmentHint):i.fragments;for(let c=r;c<=s;c++){const h=d[a+c];let m=u[c];if(n&&!m&&h&&(m=e.fragments[c]=h),h&&m){t(h,m,c,u);const p=h.relurl,y=m.relurl;if(p&&JM(p,y)){e.playlistParsingError=Ax(`media sequence mismatch ${m.sn}:`,i,e,h,m);return}else if(h.cc!==m.cc){e.playlistParsingError=Ax(`discontinuity sequence mismatch (${h.cc}!=${m.cc})`,i,e,h,m);return}}}}function Ax(i,e,t,n,r){return new Error(`${i} ${r.url}
Playlist starting @${e.startSN}
${e.m3u8}

Playlist starting @${t.startSN}
${t.m3u8}`)}function rA(i,e,t=!0){const n=e.startSN+e.skippedSegments-i.startSN,r=i.fragments,s=n>=0;let a=0;if(s&&n<r.length)a=r[n].start;else if(s&&e.startSN===i.endSN+1)a=i.fragmentEnd;else if(s&&t)a=i.fragmentStart+n*e.levelTargetDuration;else if(!e.skippedSegments&&e.fragmentStart===0)a=i.fragmentStart;else return;Hf(e,a)}function Hf(i,e){if(e){const t=i.fragments;for(let n=i.skippedSegments;n<t.length;n++)t[n].addStart(e);i.fragmentHint&&i.fragmentHint.addStart(e)}}function sA(i,e=1/0){let t=1e3*i.targetduration;if(i.updated){const n=i.fragments;if(n.length&&t*4>e){const s=n[n.length-1].duration*1e3;s<t&&(t=s)}}else t/=2;return Math.round(t)}function aA(i,e,t){if(!i)return null;let n=i.fragments[e-i.startSN];return n||(n=i.fragmentHint,n&&n.sn===e)?n:e<i.startSN&&t&&t.sn===e?t:null}function wx(i,e,t){return i?oA(i.partList,e,t):null}function oA(i,e,t){if(i)for(let n=i.length;n--;){const r=i[n];if(r.index===t&&r.fragment.sn===e)return r}return null}function lA(i){i.forEach((e,t)=>{var n;(n=e.details)==null||n.fragments.forEach(r=>{r.level=t,r.initSegment&&(r.initSegment.level=t)})})}function JM(i,e){return i!==e&&e?Lx(i)!==Lx(e):!1}function Lx(i){return i.replace(/\?[^?]*$/,"")}function wo(i,e){for(let n=0,r=i.length;n<r;n++){var t;if(((t=i[n])==null?void 0:t.cc)===e)return i[n]}return null}function eN(i,e){return!!(i&&e.startCC<i.endCC&&e.endCC>i.startCC)}function Rx(i,e){const t=i.start+e;i.startPTS=t,i.setStart(t),i.endPTS=t+i.duration}function uA(i,e){const t=e.fragments;for(let n=0,r=t.length;n<r;n++)Rx(t[n],i);e.fragmentHint&&Rx(e.fragmentHint,i),e.alignedSliding=!0}function tN(i,e){i&&(cA(e,i),e.alignedSliding||dc(e,i),!e.alignedSliding&&!e.skippedSegments&&rA(i,e,!1))}function cA(i,e){if(!eN(e,i))return;const t=Math.min(e.endCC,i.endCC),n=wo(e.fragments,t),r=wo(i.fragments,t);if(!n||!r)return;nt.log(`Aligning playlist at start of dicontinuity sequence ${t}`);const s=n.start-r.start;uA(s,i)}function dc(i,e){if(!i.hasProgramDateTime||!e.hasProgramDateTime)return;const t=i.fragments,n=e.fragments;if(!t.length||!n.length)return;let r,s;const a=Math.min(e.endCC,i.endCC);e.startCC<a&&i.startCC<a&&(r=wo(n,a),s=wo(t,a)),(!r||!s)&&(r=n[Math.floor(n.length/2)],s=wo(t,r.cc)||t[Math.floor(t.length/2)]);const u=r.programDateTime,d=s.programDateTime;if(!u||!d)return;const c=(d-u)/1e3-(s.start-r.start);uA(c,i)}function mn(i,e,t){Ln(i,e,t),i.addEventListener(e,t)}function Ln(i,e,t){i.removeEventListener(e,t)}const nN={toString:function(i){let e="";const t=i.length;for(let n=0;n<t;n++)e+=`[${i.start(n).toFixed(3)}-${i.end(n).toFixed(3)}]`;return e}},se={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class rp extends qT{constructor(e,t,n,r,s){super(r,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=se.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:a,fragCurrent:u,media:d,mediaBuffer:c,state:h}=this,m=d?d.currentTime:0,p=Ue.bufferInfo(c||d,m,a.maxBufferHole),y=!p.len;if(this.log(`Media seeking to ${ye(m)?m.toFixed(3):m}, state: ${h}, ${y?"out of":"in"} buffer`),this.state===se.ENDED)this.resetLoadingState();else if(u){const v=a.maxFragLookUpTolerance,E=u.start-v,S=u.start+u.duration+v;if(y||S<p.start||E>p.end){const A=m>S;(m<E||A)&&(A&&u.loader&&(this.log(`Cancelling fragment load for seek (sn: ${u.sn})`),u.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(d){this.fragmentTracker.removeFragmentsInRange(m,1/0,this.playlistType,!0);const v=this.lastCurrentTime;if(m>v&&(this.lastCurrentTime=m),!this.loadingParts){const E=Math.max(p.end,m),S=this.shouldLoadParts(this.getLevelDetails(),E);S&&(this.log(`LL-Part loading ON after seeking to ${m.toFixed(2)} with buffer @${E.toFixed(2)}`),this.loadingParts=S)}}this.hls.hasEnoughToStart||(this.log(`Setting ${y?"startPosition":"nextLoadPosition"} to ${m} for seek without enough to start`),this.nextLoadPosition=m,y&&(this.startPosition=m)),y&&this.state===se.IDLE&&this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=s,this.hls=e,this.fragmentLoader=new DM(e.config),this.keyLoader=n,this.fragmentTracker=t,this.config=e.config,this.decrypter=new ep(e.config)}registerListeners(){const{hls:e}=this;e.on(w.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(w.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(w.MANIFEST_LOADING,this.onManifestLoading,this),e.on(w.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(w.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(w.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(w.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(w.MANIFEST_LOADING,this.onManifestLoading,this),e.off(w.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(w.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===se.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=se.STOPPED}get startPositionValue(){const{nextLoadPosition:e,startPosition:t}=this;return t===-1&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;const n=e.end||0,r=this.config.timelineOffset||0;if(n<=r)return!1;const s=e.buffered;this.config.maxBufferHole&&s&&s.length>1&&(e=Ue.bufferedInfo(s,e.start,0));const a=e.nextStart;if(a&&a>r&&a<t.edge||this.media.currentTime<e.start)return!1;const d=t.partList;if(d!=null&&d.length){const h=d[d.length-1];return Ue.isBuffered(this.media,h.start+h.duration/2)}const c=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(c)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null)return this.levelLastLoaded.details}get timelineOffset(){const e=this.config.timelineOffset;if(e){var t;return((t=this.getLevelDetails())==null?void 0:t.appliedTimelineOffset)||e}return 0}onMediaAttached(e,t){const n=this.media=this.mediaBuffer=t.media;mn(n,"seeking",this.onMediaSeeking),mn(n,"ended",this.onMediaEnded);const r=this.config;this.levels&&r.autoStartLoad&&this.state===se.STOPPED&&this.startLoad(r.startPosition)}onMediaDetaching(e,t){const n=!!t.transferMedia,r=this.media;if(r!==null){if(r.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),Ln(r,"seeking",this.onMediaSeeking),Ln(r,"ended",this.onMediaEnded),this.keyLoader&&!n&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,n){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=se.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,n){this.startFragRequested=!0,this._loadFragForPlayback(e,t,n)}_loadFragForPlayback(e,t,n){const r=s=>{const a=s.frag;if(this.fragContextChanged(a)){this.warn(`${a.type} sn: ${a.sn}${s.part?" part: "+s.part.index:""} of ${this.fragInfo(a,!1,s.part)}) was dropped during download.`),this.fragmentTracker.removeFragment(a);return}a.stats.chunkCount++,this._handleFragmentLoadProgress(s)};this._doFragLoad(e,t,n,r).then(s=>{if(!s)return;const a=this.state,u=s.frag;if(this.fragContextChanged(u)){(a===se.FRAG_LOADING||!this.fragCurrent&&a===se.PARSING)&&(this.fragmentTracker.removeFragment(u),this.state=se.IDLE);return}"payload"in s&&(this.log(`Loaded ${u.type} sn: ${u.sn} of ${this.playlistLabel()} ${u.level}`),this.hls.trigger(w.FRAG_LOADED,s)),this._handleFragmentLoadComplete(s)}).catch(s=>{this.state===se.STOPPED||this.state===se.ERROR||(this.warn(`Frag error: ${(s==null?void 0:s.message)||s}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:n}=this;if(n.getState(e)===Bt.APPENDING){const s=e.type,a=this.getFwdBufferInfo(this.mediaBuffer,s),u=Math.max(e.duration,a?a.len:this.config.maxBufferLength),d=this.backtrackFragment;((d?e.sn-d.sn:0)===1||this.reduceMaxBufferLength(u,e.duration))&&n.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?n.removeAllFragments():n.hasParts(e.type)&&(n.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),n.getState(e)===Bt.PARTIAL&&n.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const t=e.details;return(t==null?void 0:t.live)&&t.type!=="EVENT"&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t,n=null){if(!(e-t))return;const r={startOffset:e,endOffset:t,type:n};this.hls.trigger(w.BUFFER_FLUSHING,r)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(n=>{const r=n==null?void 0:n.frag;if(!r||this.fragContextChanged(r)||!this.levels)throw new Error("init load aborted");return n}).then(n=>{const{hls:r}=this,{frag:s,payload:a}=n,u=s.decryptdata;if(a&&a.byteLength>0&&u!=null&&u.key&&u.iv&&fa(u.method)){const d=self.performance.now();return this.decrypter.decrypt(new Uint8Array(a),u.key.buffer,u.iv.buffer,np(u.method)).catch(c=>{throw r.trigger(w.ERROR,{type:Ie.MEDIA_ERROR,details:Y.FRAG_DECRYPT_ERROR,fatal:!1,error:c,reason:c.message,frag:s}),c}).then(c=>{const h=self.performance.now();return r.trigger(w.FRAG_DECRYPTED,{frag:s,payload:c,stats:{tstart:d,tdecrypt:h}}),n.payload=c,this.completeInitSegmentLoad(n)})}return this.completeInitSegmentLoad(n)}).catch(n=>{this.state===se.STOPPED||this.state===se.ERROR||(this.warn(n),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const n=e.frag.stats;this.state!==se.STOPPED&&(this.state=se.IDLE),e.frag.data=new Uint8Array(e.payload),n.parsing.start=n.buffering.start=self.performance.now(),n.parsing.end=n.buffering.end=self.performance.now(),this.tick()}unhandledEncryptionError(e,t){var n,r;const s=e.tracks;if(s&&!t.encrypted&&((n=s.audio)!=null&&n.encrypted||(r=s.video)!=null&&r.encrypted)&&(!this.config.emeEnabled||!this.keyLoader.emeController)){const a=this.media,u=new Error(`Encrypted track with no key in ${this.fragInfo(t)} (media ${a?"attached mediaKeys: "+a.mediaKeys:"detached"})`);return this.warn(u.message),!a||a.mediaKeys?!1:(this.hls.trigger(w.ERROR,{type:Ie.KEY_SYSTEM_ERROR,details:Y.KEY_SYSTEM_NO_KEYS,fatal:!1,error:u,frag:t}),this.resetTransmuxer(),!0)}return!1}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){const n=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)} > buffer:${n?nN.toString(Ue.getBuffered(n)):"(detached)"})`),Rt(e)){var r;if(e.type!==xe.SUBTITLE){const a=e.elementaryStreams;if(!Object.keys(a).some(u=>!!a[u])){this.state=se.IDLE;return}}const s=(r=this.levels)==null?void 0:r[e.level];s!=null&&s.fragmentError&&(this.log(`Resetting level fragment error count of ${s.fragmentError} on frag buffered`),s.fragmentError=0)}this.state=se.IDLE}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:n,part:r,partsLoaded:s}=e,a=!s||s.length===0||s.some(d=>!d),u=new tp(n.level,n.sn,n.stats.chunkCount+1,0,r?r.index:-1,!a);t.flush(u)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,n=null,r){var s;this.fragCurrent=e;const a=t.details;if(!this.levels||!a)throw new Error(`frag load aborted, missing level${a?"":" detail"}s`);let u=null;if(e.encrypted&&!((s=e.decryptdata)!=null&&s.key)){if(this.log(`Loading key for ${e.sn} of [${a.startSN}-${a.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=se.KEY_LOADING,this.fragCurrent=e,u=this.keyLoader.load(e).then(p=>{if(!this.fragContextChanged(p.frag))return this.hls.trigger(w.KEY_LOADED,p),this.state===se.KEY_LOADING&&(this.state=se.IDLE),p}),this.hls.trigger(w.KEY_LOADING,{frag:e}),this.fragCurrent===null)return this.log("context changed in KEY_LOADING"),Promise.resolve(null)}else e.encrypted||(u=this.keyLoader.loadClear(e,a.encryptedFragments,this.startFragRequested),u&&this.log("[eme] blocking frag load until media-keys acquired"));const d=this.fragPrevious;if(Rt(e)&&(!d||e.sn!==d.sn)){const p=this.shouldLoadParts(t.details,e.end);p!==this.loadingParts&&(this.log(`LL-Part loading ${p?"ON":"OFF"} loading sn ${d==null?void 0:d.sn}->${e.sn}`),this.loadingParts=p)}if(n=Math.max(e.start,n||0),this.loadingParts&&Rt(e)){const p=a.partList;if(p&&r){n>a.fragmentEnd&&a.fragmentHint&&(e=a.fragmentHint);const y=this.getNextPart(p,e,n);if(y>-1){const v=p[y];e=this.fragCurrent=v.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${v.index} (${y}/${p.length-1}) of ${this.fragInfo(e,!1,v)}) cc: ${e.cc} [${a.startSN}-${a.endSN}], target: ${parseFloat(n.toFixed(3))}`),this.nextLoadPosition=v.start+v.duration,this.state=se.FRAG_LOADING;let E;return u?E=u.then(S=>!S||this.fragContextChanged(S.frag)?null:this.doFragPartsLoad(e,v,t,r)).catch(S=>this.handleFragLoadError(S)):E=this.doFragPartsLoad(e,v,t,r).catch(S=>this.handleFragLoadError(S)),this.hls.trigger(w.FRAG_LOADING,{frag:e,part:v,targetBufferTime:n}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):E}else if(!e.url||this.loadedEndOfParts(p,n))return Promise.resolve(null)}}if(Rt(e)&&this.loadingParts){var c;this.log(`LL-Part loading OFF after next part miss @${n.toFixed(2)} Check buffer at sn: ${e.sn} loaded parts: ${(c=a.partList)==null?void 0:c.filter(p=>p.loaded).map(p=>`[${p.start}-${p.end}]`)}`),this.loadingParts=!1}else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${"["+a.startSN+"-"+a.endSN+"]"}, target: ${parseFloat(n.toFixed(3))}`),ye(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=se.FRAG_LOADING;const h=this.config.progressive&&e.type!==xe.SUBTITLE;let m;return h&&u?m=u.then(p=>!p||this.fragContextChanged(p.frag)?null:this.fragmentLoader.load(e,r)).catch(p=>this.handleFragLoadError(p)):m=Promise.all([this.fragmentLoader.load(e,h?r:void 0),u]).then(([p])=>(!h&&r&&r(p),p)).catch(p=>this.handleFragLoadError(p)),this.hls.trigger(w.FRAG_LOADING,{frag:e,targetBufferTime:n}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):m}doFragPartsLoad(e,t,n,r){return new Promise((s,a)=>{var u;const d=[],c=(u=n.details)==null?void 0:u.partList,h=m=>{this.fragmentLoader.loadPart(e,m,r).then(p=>{d[m.index]=p;const y=p.part;this.hls.trigger(w.FRAG_LOADED,p);const v=wx(n.details,e.sn,m.index+1)||oA(c,e.sn,m.index+1);if(v)h(v);else return s({frag:e,part:y,partsLoaded:d})}).catch(a)};h(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;t.frag&&t.details===Y.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):t.frag&&t.type===Ie.KEY_SYSTEM_ERROR?(t.frag.abortRequests(),this.resetStartWhenNotLoaded(),this.resetFragmentLoading(t.frag)):this.hls.trigger(w.ERROR,t)}else this.hls.trigger(w.ERROR,{type:Ie.OTHER_ERROR,details:Y.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==se.PARSING){!this.fragCurrent&&this.state!==se.STOPPED&&this.state!==se.ERROR&&(this.state=se.IDLE);return}const{frag:n,part:r,level:s}=t,a=self.performance.now();n.stats.parsing.end=a,r&&(r.stats.parsing.end=a);const u=this.getLevelDetails(),c=u&&n.sn>u.endSN||this.shouldLoadParts(u,n.end);c!==this.loadingParts&&(this.log(`LL-Part loading ${c?"ON":"OFF"} after parsing segment ending @${n.end.toFixed(2)}`),this.loadingParts=c),this.updateLevelTiming(n,r,s,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e.partList){var n;const s=e.partList[0];if(s.fragment.type===xe.SUBTITLE)return!1;const a=s.end+(((n=e.fragmentHint)==null?void 0:n.duration)||0);if(t>=a){var r;if((this.hls.hasEnoughToStart?((r=this.media)==null?void 0:r.currentTime)||this.lastCurrentTime:this.getLoadPosition())>s.start-s.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:t,fragCurrent:n}=this,{level:r,sn:s,part:a}=e;if(!(t!=null&&t[r]))return this.warn(`Levels object was unset while buffering fragment ${s} of ${this.playlistLabel()} ${r}. The current chunk will not be buffered.`),null;const u=t[r],d=u.details,c=a>-1?wx(d,s,a):null,h=c?c.fragment:aA(d,s,n);return h?(n&&n!==h&&(h.stats=n.stats),{frag:h,part:c,level:u}):null}bufferFragmentData(e,t,n,r,s){if(this.state!==se.PARSING)return;const{data1:a,data2:u}=e;let d=a;if(u&&(d=Qn(a,u)),!d.length)return;const c=this.initPTS[t.cc],h=c?-c.baseTime/c.timescale:void 0,m={type:e.type,frag:t,part:n,chunkMeta:r,offset:h,parent:t.type,data:d};if(this.hls.trigger(w.BUFFER_APPENDING,m),e.dropped&&e.independent&&!n){if(s)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!Ue.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}const n=t.currentTime,r=Ue.bufferInfo(t,n,0),s=e.duration,a=Math.min(this.config.maxFragLookUpTolerance*2,s*.25),u=Math.max(Math.min(e.start-a,r.end-a),n+a);e.start-u>a&&this.flushMainBuffer(u,e.start)}getFwdBufferInfo(e,t){var n;const r=this.getLoadPosition();if(!ye(r))return null;const a=this.lastCurrentTime>r||(n=this.media)!=null&&n.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,r,t,a)}getFwdBufferInfoAtPos(e,t,n,r){const s=Ue.bufferInfo(e,t,r);if(s.len===0&&s.nextStart!==void 0){const a=this.fragmentTracker.getBufferedFrag(t,n);if(a&&(s.nextStart<=a.end||a.gap)){const u=Math.max(Math.min(s.nextStart,a.end)-t,r);return Ue.bufferInfo(e,t,u)}}return s}getMaxBufferLength(e){const{config:t}=this;let n;return e?n=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):n=t.maxBufferLength,Math.min(n,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const n=this.config,r=Math.max(Math.min(e-t,n.maxBufferLength),t),s=Math.max(e-t*3,n.maxMaxBufferLength/2,r);return s>=r?(n.maxMaxBufferLength=s,this.warn(`Reduce max buffer length to ${s}s`),!0):!1}getAppendedFrag(e,t=xe.MAIN){const n=this.fragmentTracker?this.fragmentTracker.getAppendedFrag(e,t):null;return n&&"fragment"in n?n.fragment:n}getNextFragment(e,t){const n=t.fragments,r=n.length;if(!r)return null;const{config:s}=this,a=n[0].start,u=s.lowLatencyMode&&!!t.partList;let d=null;if(t.live){const m=s.initialLiveManifestSize;if(r<m)return this.warn(`Not enough fragments to start playback (have: ${r}, need: ${m})`),null;if(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<a){var c;u&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),d=this.getInitialLiveFragment(t);const p=this.hls.startPosition,y=this.hls.liveSyncPosition,v=d?(p!==-1&&p>=a?p:y)||d.start:e;this.log(`Setting startPosition to ${v} to match start frag at live edge. mainStart: ${p} liveSyncPosition: ${y} frag.start: ${(c=d)==null?void 0:c.start}`),this.startPosition=this.nextLoadPosition=v}}else e<=a&&(d=n[0]);if(!d){const m=this.loadingParts?t.partEnd:t.fragmentEnd;d=this.getFragmentAtPosition(e,m,t)}let h=this.filterReplacedPrimary(d,t);if(!h&&d){const m=d.sn-t.startSN;h=this.filterReplacedPrimary(n[m+1]||null,t)}return this.mapToInitFragWhenRequired(h)}isLoopLoading(e,t){const n=this.fragmentTracker.getState(e);return(n===Bt.OK||n===Bt.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,n,r,s){let a=null;if(e.gap&&(a=this.getNextFragment(this.nextLoadPosition,t),a&&!a.gap&&n.nextStart)){const u=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,n.nextStart,r,0);if(u!==null&&n.len+u.len>=s){const d=a.sn;return this.loopSn!==d&&(this.log(`buffer full after gaps in "${r}" playlist starting at sn: ${d}`),this.loopSn=d),null}}return this.loopSn=void 0,a}get primaryPrefetch(){if(bx(this.config)){var e;if((e=this.hls.interstitialsManager)==null||(e=e.playingItem)==null?void 0:e.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(bx(this.config)&&e.type!==xe.SUBTITLE){const n=this.hls.interstitialsManager,r=n==null?void 0:n.bufferingItem;if(r){const a=r.event;if(a){if(a.appendInPlace||Math.abs(e.start-r.start)>1||r.start===0)return null}else if(e.end<=r.start&&(t==null?void 0:t.live)===!1||e.start>r.end&&r.nextEvent&&(r.nextEvent.appendInPlace||e.start-r.end>1))return null}const s=n==null?void 0:n.playerQueue;if(s)for(let a=s.length;a--;){const u=s[a].interstitial;if(u.appendInPlace&&e.start>=u.startTime&&e.end<=u.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!e.initSegment.data&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,n){let r=-1,s=!1,a=!0;for(let u=0,d=e.length;u<d;u++){const c=e[u];if(a=a&&!c.independent,r>-1&&n<c.start)break;const h=c.loaded;h?r=-1:(s||(c.independent||a)&&c.fragment===t)&&(c.fragment!==t&&this.warn(`Need buffer at ${n} but next unloaded part starts at ${c.start}`),r=u),s=h}return r}loadedEndOfParts(e,t){let n;for(let r=e.length;r--;){if(n=e[r],!n.loaded)return!1;if(t>n.start)return!0}return!1}getInitialLiveFragment(e){const t=e.fragments,n=this.fragPrevious;let r=null;if(n){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${n.programDateTime}`),r=vM(t,n.endProgramDateTime,this.config.maxFragLookUpTolerance)),!r){const s=n.sn+1;if(s>=e.startSN&&s<=e.endSN){const a=t[s-e.startSN];n.cc===a.cc&&(r=a,this.log(`Live playlist, switching playlist, load frag with next SN: ${r.sn}`))}r||(r=KT(e,n.cc,n.end),r&&this.log(`Live playlist, switching playlist, load frag with same CC: ${r.sn}`))}}else{const s=this.hls.liveSyncPosition;s!==null&&(r=this.getFragmentAtPosition(s,this.bitrateTest?e.fragmentEnd:e.edge,e))}return r}getFragmentAtPosition(e,t,n){const{config:r}=this;let{fragPrevious:s}=this,{fragments:a,endSN:u}=n;const{fragmentHint:d}=n,{maxFragLookUpTolerance:c}=r,h=n.partList,m=!!(this.loadingParts&&h!=null&&h.length&&d);m&&!this.bitrateTest&&h[h.length-1].fragment.sn===d.sn&&(a=a.concat(d),u=d.sn);let p;if(e<t){var y;const E=e<this.lastCurrentTime||e>t-c||(y=this.media)!=null&&y.paused||!this.startFragRequested?0:c;p=Ss(s,a,e,E)}else p=a[a.length-1];if(p){const v=p.sn-n.startSN,E=this.fragmentTracker.getState(p);if((E===Bt.OK||E===Bt.PARTIAL&&p.gap)&&(s=p),s&&p.sn===s.sn&&(!m||h[0].fragment.sn>p.sn||!n.live)&&p.level===s.level){const A=a[v+1];p.sn<u&&this.fragmentTracker.getState(A)!==Bt.OK?p=A:p=null}}return p}alignPlaylists(e,t,n){const r=e.fragments.length;if(!r)return this.warn("No fragments in live playlist"),0;const s=e.fragmentStart,a=!t,u=e.alignedSliding&&ye(s);if(a||!u&&!s){tN(n,e);const d=e.fragmentStart;return this.log(`Live playlist sliding: ${d.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} fragments: ${r}`),d}return s}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let n=this.startPosition;n<t&&(n=-1);const r=this.timelineOffset;if(n===-1){const s=this.startTimeOffset!==null,a=s?this.startTimeOffset:e.startTimeOffset;a!==null&&ye(a)?(n=t+a,a<0&&(n+=e.edge),n=Math.min(Math.max(t,n),t+e.totalduration),this.log(`Setting startPosition to ${n} for start time offset ${a} found in ${s?"multivariant":"media"} playlist`),this.startPosition=n):e.live?(n=this.hls.liveSyncPosition||t,this.log(`Setting startPosition to -1 to start at live edge ${n}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=n=0),this.lastCurrentTime=n+r}this.nextLoadPosition=n+r}getLoadPosition(){var e;const{media:t}=this;let n=0;return(e=this.hls)!=null&&e.hasEnoughToStart&&t?n=t.currentTime:this.nextLoadPosition>=0&&(n=this.nextLoadPosition),n}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&Rt(e)&&e.stats.aborted&&(this.log(`Fragment ${e.sn}${t?" part "+t.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==se.FRAG_LOADING_WAITING_RETRY)&&(this.state=se.IDLE)}onFragmentOrKeyLoadError(e,t){var n;if(t.chunkMeta&&!t.frag){const A=this.getCurrentContext(t.chunkMeta);A&&(t.frag=A.frag)}const r=t.frag;if(!r||r.type!==e||!this.levels)return;if(this.fragContextChanged(r)){var s;this.warn(`Frag load error must match current frag to retry ${r.url} > ${(s=this.fragCurrent)==null?void 0:s.url}`);return}const a=t.details===Y.FRAG_GAP;a&&this.fragmentTracker.fragBuffered(r,!0);const u=t.errorAction;if(!u){this.state=se.ERROR;return}const{action:d,flags:c,retryCount:h=0,retryConfig:m}=u,p=!!m,y=p&&d===Yt.RetryRequest,v=p&&!u.resolved&&c===Mn.MoveAllAlternatesMatchingHost,E=(n=this.hls.latestLevelDetails)==null?void 0:n.live;if(!y&&v&&Rt(r)&&!r.endList&&E&&!YT(t))this.resetFragmentErrors(e),this.treatAsGap(r),u.resolved=!0;else if((y||v)&&h<m.maxNumRetry){var S;const A=$f((S=t.response)==null?void 0:S.code),L=Jm(m,h);if(this.resetStartWhenNotLoaded(),this.retryDate=self.performance.now()+L,this.state=se.FRAG_LOADING_WAITING_RETRY,u.resolved=!0,A){this.log("Waiting for connection (offline)"),this.retryDate=1/0,t.reason="offline";return}this.warn(`Fragment ${r.sn} of ${e} ${r.level} errored with ${t.details}, retrying loading ${h+1}/${m.maxNumRetry} in ${L}ms`)}else if(m)if(this.resetFragmentErrors(e),h<m.maxNumRetry)!a&&d!==Yt.RemoveAlternatePermanently&&(u.resolved=!0);else{this.warn(`${t.details} reached or exceeded max retry (${h})`);return}else d===Yt.SendAlternateToPenaltyBox?this.state=se.WAITING_LEVEL:this.state=se.ERROR;this.tickImmediate()}checkRetryDate(){const e=self.performance.now(),t=this.retryDate,n=t===1/0;(!t||e>=t||n&&!$f(0))&&(n&&this.log("Connection restored (online)"),this.resetStartWhenNotLoaded(),this.state=se.IDLE)}reduceLengthAndFlushBuffer(e){if(this.state===se.PARSING||this.state===se.PARSED){const t=e.frag,n=e.parent,r=this.getFwdBufferInfo(this.mediaBuffer,n),s=r&&r.len>.5;s&&this.reduceMaxBufferLength(r.len,(t==null?void 0:t.duration)||10);const a=!s;return a&&this.warn(`Buffer full error while media.currentTime (${this.getLoadPosition()}) is not buffered, flush ${n} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),a}return!1}resetFragmentErrors(e){e===xe.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==se.STOPPED&&(this.state=se.IDLE)}afterBufferFlushed(e,t,n){if(!e)return;const r=Ue.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,r,n),this.state===se.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==se.STOPPED&&(this.state=se.IDLE)}resetStartWhenNotLoaded(){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const e=this.levelLastLoaded,t=e?e.details:null;t!=null&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.log(`Loading context changed while buffering sn ${e.sn} of ${this.playlistLabel()} ${e.level===-1?"<removed>":e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,n,r){const s=n.details;if(!s){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((d,c)=>{const h=e.elementaryStreams[c];if(h){const m=h.endPTS-h.startPTS;if(m<=0)return this.warn(`Could not parse fragment ${e.sn} ${c} duration reliably (${m})`),d||!1;const p=r?0:iA(s,e,h.startPTS,h.endPTS,h.startDTS,h.endDTS,this);return this.hls.trigger(w.LEVEL_PTS_UPDATED,{details:s,level:n,drift:p,type:c,frag:e,start:h.startPTS,end:h.endPTS}),!0}return d},!1)){var u;const d=((u=this.transmuxer)==null?void 0:u.error)===null;if((n.fragmentError===0||d&&(n.fragmentError<2||e.endList))&&this.treatAsGap(e,n),d){const c=new Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(c.message),this.hls.trigger(w.ERROR,{type:Ie.MEDIA_ERROR,details:Y.FRAG_PARSING_ERROR,fatal:!1,error:c,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${n.url}"`}),!this.hls)return;this.resetTransmuxer()}}this.state=se.PARSED,this.log(`Parsed ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)})`),this.hls.trigger(w.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===xe.MAIN?"level":"track"}fragInfo(e,t=!0,n){var r,s;return`${this.playlistLabel()} ${e.level} (${n?"part":"frag"}:[${((r=t&&!n?e.startPTS:(n||e).start)!=null?r:NaN).toFixed(3)}-${((s=t&&!n?e.endPTS:(n||e).end)!=null?s:NaN).toFixed(3)}]${n&&e.type==="main"?"INDEPENDENT="+(n.independent?"YES":"NO"):""}`}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;(e=this.transmuxer)==null||e.reset()}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function bx(i){return!!i.interstitialsController&&i.enableInterstitialPlayback!==!1}class dA{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let n;if(e.length)e.length===1?n=e[0]:n=iN(e,t);else return new Uint8Array(0);return this.reset(),n}reset(){this.chunks.length=0,this.dataLength=0}}function iN(i,e){const t=new Uint8Array(e);let n=0;for(let r=0;r<i.length;r++){const s=i[r];t.set(s,n),n+=s.length}return t}var $h={exports:{}},Ix;function rN(){return Ix||(Ix=1,(function(i){var e=Object.prototype.hasOwnProperty,t="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(t=!1));function r(d,c,h){this.fn=d,this.context=c,this.once=h||!1}function s(d,c,h,m,p){if(typeof h!="function")throw new TypeError("The listener must be a function");var y=new r(h,m||d,p),v=t?t+c:c;return d._events[v]?d._events[v].fn?d._events[v]=[d._events[v],y]:d._events[v].push(y):(d._events[v]=y,d._eventsCount++),d}function a(d,c){--d._eventsCount===0?d._events=new n:delete d._events[c]}function u(){this._events=new n,this._eventsCount=0}u.prototype.eventNames=function(){var c=[],h,m;if(this._eventsCount===0)return c;for(m in h=this._events)e.call(h,m)&&c.push(t?m.slice(1):m);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(h)):c},u.prototype.listeners=function(c){var h=t?t+c:c,m=this._events[h];if(!m)return[];if(m.fn)return[m.fn];for(var p=0,y=m.length,v=new Array(y);p<y;p++)v[p]=m[p].fn;return v},u.prototype.listenerCount=function(c){var h=t?t+c:c,m=this._events[h];return m?m.fn?1:m.length:0},u.prototype.emit=function(c,h,m,p,y,v){var E=t?t+c:c;if(!this._events[E])return!1;var S=this._events[E],A=arguments.length,L,R;if(S.fn){switch(S.once&&this.removeListener(c,S.fn,void 0,!0),A){case 1:return S.fn.call(S.context),!0;case 2:return S.fn.call(S.context,h),!0;case 3:return S.fn.call(S.context,h,m),!0;case 4:return S.fn.call(S.context,h,m,p),!0;case 5:return S.fn.call(S.context,h,m,p,y),!0;case 6:return S.fn.call(S.context,h,m,p,y,v),!0}for(R=1,L=new Array(A-1);R<A;R++)L[R-1]=arguments[R];S.fn.apply(S.context,L)}else{var D=S.length,k;for(R=0;R<D;R++)switch(S[R].once&&this.removeListener(c,S[R].fn,void 0,!0),A){case 1:S[R].fn.call(S[R].context);break;case 2:S[R].fn.call(S[R].context,h);break;case 3:S[R].fn.call(S[R].context,h,m);break;case 4:S[R].fn.call(S[R].context,h,m,p);break;default:if(!L)for(k=1,L=new Array(A-1);k<A;k++)L[k-1]=arguments[k];S[R].fn.apply(S[R].context,L)}}return!0},u.prototype.on=function(c,h,m){return s(this,c,h,m,!1)},u.prototype.once=function(c,h,m){return s(this,c,h,m,!0)},u.prototype.removeListener=function(c,h,m,p){var y=t?t+c:c;if(!this._events[y])return this;if(!h)return a(this,y),this;var v=this._events[y];if(v.fn)v.fn===h&&(!p||v.once)&&(!m||v.context===m)&&a(this,y);else{for(var E=0,S=[],A=v.length;E<A;E++)(v[E].fn!==h||p&&!v[E].once||m&&v[E].context!==m)&&S.push(v[E]);S.length?this._events[y]=S.length===1?S[0]:S:a(this,y)}return this},u.prototype.removeAllListeners=function(c){var h;return c?(h=t?t+c:c,this._events[h]&&a(this,h)):(this._events=new n,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=t,u.EventEmitter=u,i.exports=u})($h)),$h.exports}var sN=rN(),sp=D_(sN);const $o="1.6.15",va={};function aN(){return typeof __HLS_WORKER_BUNDLE__=="function"}function oN(){const i=va[$o];if(i)return i.clientCount++,i;const e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(e),r={worker:new self.Worker(t),objectURL:t,clientCount:1};return va[$o]=r,r}function lN(i){const e=va[i];if(e)return e.clientCount++,e;const t=new self.URL(i,self.location.href).href,r={worker:new self.Worker(t),scriptURL:t,clientCount:1};return va[i]=r,r}function uN(i){const e=va[i||$o];if(e&&e.clientCount--===1){const{worker:n,objectURL:r}=e;delete va[i||$o],r&&self.URL.revokeObjectURL(r),n.terminate()}}function hA(i,e){return e+10<=i.length&&i[e]===51&&i[e+1]===68&&i[e+2]===73&&i[e+3]<255&&i[e+4]<255&&i[e+6]<128&&i[e+7]<128&&i[e+8]<128&&i[e+9]<128}function ap(i,e){return e+10<=i.length&&i[e]===73&&i[e+1]===68&&i[e+2]===51&&i[e+3]<255&&i[e+4]<255&&i[e+6]<128&&i[e+7]<128&&i[e+8]<128&&i[e+9]<128}function Sc(i,e){let t=0;return t=(i[e]&127)<<21,t|=(i[e+1]&127)<<14,t|=(i[e+2]&127)<<7,t|=i[e+3]&127,t}function jo(i,e){const t=e;let n=0;for(;ap(i,e);){n+=10;const r=Sc(i,e+6);n+=r,hA(i,e+10)&&(n+=10),e+=n}if(n>0)return i.subarray(t,t+n)}function cN(i,e,t,n){const r=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],s=e[t+2],a=s>>2&15;if(a>12){const y=new Error(`invalid ADTS sampling index:${a}`);i.emit(w.ERROR,w.ERROR,{type:Ie.MEDIA_ERROR,details:Y.FRAG_PARSING_ERROR,fatal:!0,error:y,reason:y.message});return}const u=(s>>6&3)+1,d=e[t+3]>>6&3|(s&1)<<2,c="mp4a.40."+u,h=r[a];let m=a;(u===5||u===29)&&(m-=3);const p=[u<<3|(m&14)>>1,(m&1)<<7|d<<3];return nt.log(`manifest codec:${n}, parsed codec:${c}, channels:${d}, rate:${h} (ADTS object type:${u} sampling index:${a})`),{config:p,samplerate:h,channelCount:d,codec:c,parsedCodec:c,manifestCodec:n}}function fA(i,e){return i[e]===255&&(i[e+1]&246)===240}function mA(i,e){return i[e+1]&1?7:9}function op(i,e){return(i[e+3]&3)<<11|i[e+4]<<3|(i[e+5]&224)>>>5}function dN(i,e){return e+5<i.length}function hc(i,e){return e+1<i.length&&fA(i,e)}function hN(i,e){return dN(i,e)&&fA(i,e)&&op(i,e)<=i.length-e}function fN(i,e){if(hc(i,e)){const t=mA(i,e);if(e+t>=i.length)return!1;const n=op(i,e);if(n<=t)return!1;const r=e+n;return r===i.length||hc(i,r)}return!1}function pA(i,e,t,n,r){if(!i.samplerate){const s=cN(e,t,n,r);if(!s)return;rt(i,s)}}function gA(i){return 1024*9e4/i}function mN(i,e){const t=mA(i,e);if(e+t<=i.length){const n=op(i,e)-t;if(n>0)return{headerLength:t,frameLength:n}}}function yA(i,e,t,n,r){const s=gA(i.samplerate),a=n+r*s,u=mN(e,t);let d;if(u){const{frameLength:m,headerLength:p}=u,y=p+m,v=Math.max(0,t+y-e.length);v?(d=new Uint8Array(y-p),d.set(e.subarray(t+p,e.length),0)):d=e.subarray(t+p,t+y);const E={unit:d,pts:a};return v||i.samples.push(E),{sample:E,length:y,missing:v}}const c=e.length-t;return d=new Uint8Array(c),d.set(e.subarray(t,e.length),0),{sample:{unit:d,pts:a},length:c,missing:-1}}function pN(i,e){return ap(i,e)&&Sc(i,e+6)+10<=i.length-e}function gN(i){return i instanceof ArrayBuffer?i:i.byteOffset==0&&i.byteLength==i.buffer.byteLength?i.buffer:new Uint8Array(i).buffer}function jh(i,e=0,t=1/0){return yN(i,e,t,Uint8Array)}function yN(i,e,t,n){const r=vN(i);let s=1;"BYTES_PER_ELEMENT"in n&&(s=n.BYTES_PER_ELEMENT);const a=xN(i)?i.byteOffset:0,u=(a+i.byteLength)/s,d=(a+e)/s,c=Math.floor(Math.max(0,Math.min(d,u))),h=Math.floor(Math.min(c+Math.max(t,0),u));return new n(r,c,h-c)}function vN(i){return i instanceof ArrayBuffer?i:i.buffer}function xN(i){return i&&i.buffer instanceof ArrayBuffer&&i.byteLength!==void 0&&i.byteOffset!==void 0}function EN(i){const e={key:i.type,description:"",data:"",mimeType:null,pictureType:null},t=3;if(i.size<2)return;if(i.data[0]!==t){console.log("Ignore frame with unrecognized character encoding");return}const n=i.data.subarray(1).indexOf(0);if(n===-1)return;const r=Bn(jh(i.data,1,n)),s=i.data[2+n],a=i.data.subarray(3+n).indexOf(0);if(a===-1)return;const u=Bn(jh(i.data,3+n,a));let d;return r==="-->"?d=Bn(jh(i.data,4+n+a)):d=gN(i.data.subarray(4+n+a)),e.mimeType=r,e.pictureType=s,e.description=u,e.data=d,e}function SN(i){if(i.size<2)return;const e=Bn(i.data,!0),t=new Uint8Array(i.data.subarray(e.length+1));return{key:i.type,info:e,data:t.buffer}}function TN(i){if(i.size<2)return;if(i.type==="TXXX"){let t=1;const n=Bn(i.data.subarray(t),!0);t+=n.length+1;const r=Bn(i.data.subarray(t));return{key:i.type,info:n,data:r}}const e=Bn(i.data.subarray(1));return{key:i.type,info:"",data:e}}function AN(i){if(i.type==="WXXX"){if(i.size<2)return;let t=1;const n=Bn(i.data.subarray(t),!0);t+=n.length+1;const r=Bn(i.data.subarray(t));return{key:i.type,info:n,data:r}}const e=Bn(i.data);return{key:i.type,info:"",data:e}}function wN(i){return i.type==="PRIV"?SN(i):i.type[0]==="W"?AN(i):i.type==="APIC"?EN(i):TN(i)}function LN(i){const e=String.fromCharCode(i[0],i[1],i[2],i[3]),t=Sc(i,4),n=10;return{type:e,size:t,data:i.subarray(n,n+t)}}const vu=10,RN=10;function vA(i){let e=0;const t=[];for(;ap(i,e);){const n=Sc(i,e+6);i[e+5]>>6&1&&(e+=vu),e+=vu;const r=e+n;for(;e+RN<r;){const s=LN(i.subarray(e)),a=wN(s);a&&t.push(a),e+=s.size+vu}hA(i,e)&&(e+=vu)}return t}function xA(i){return i&&i.key==="PRIV"&&i.info==="com.apple.streaming.transportStreamTimestamp"}function bN(i){if(i.data.byteLength===8){const e=new Uint8Array(i.data),t=e[3]&1;let n=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return n/=45,t&&(n+=4772185884e-2),Math.round(n)}}function lp(i){const e=vA(i);for(let t=0;t<e.length;t++){const n=e[t];if(xA(n))return bN(n)}}let Fn=(function(i){return i.audioId3="org.id3",i.dateRange="com.apple.quicktime.HLS",i.emsg="https://aomedia.org/emsg/ID3",i.misbklv="urn:misb:KLV:bin:1910.1",i})({});function Di(i="",e=9e4){return{type:i,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class up{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,n,r){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,n){}demux(e,t){this.cachedData&&(e=Qn(this.cachedData,e),this.cachedData=null);let n=jo(e,0),r=n?n.length:0,s;const a=this._audioTrack,u=this._id3Track,d=n?lp(n):void 0,c=e.length;for((this.basePTS===null||this.frameIndex===0&&ye(d))&&(this.basePTS=IN(d,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),n&&n.length>0&&u.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:n,type:Fn.audioId3,duration:Number.POSITIVE_INFINITY});r<c;){if(this.canParse(e,r)){const h=this.appendFrame(a,e,r);h?(this.frameIndex++,this.lastPTS=h.sample.pts,r+=h.length,s=r):r=c}else pN(e,r)?(n=jo(e,r),u.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:n,type:Fn.audioId3,duration:Number.POSITIVE_INFINITY}),r+=n.length,s=r):r++;if(r===c&&s!==c){const h=e.slice(s);this.cachedData?this.cachedData=Qn(this.cachedData,h):this.cachedData=h}}return{audioTrack:a,videoTrack:Di(),id3Track:u,textTrack:Di()}}demuxSampleAes(e,t,n){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:Di(),id3Track:this._id3Track,textTrack:Di()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const IN=(i,e,t)=>{if(ye(i))return i*90;const n=t?t.baseTime*9e4/t.timescale:0;return e*9e4+n};let xu=null;const CN=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],DN=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],kN=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],PN=[0,1,1,4];function EA(i,e,t,n,r){if(t+24>e.length)return;const s=SA(e,t);if(s&&t+s.frameLength<=e.length){const a=s.samplesPerFrame*9e4/s.sampleRate,u=n+r*a,d={unit:e.subarray(t,t+s.frameLength),pts:u,dts:u};return i.config=[],i.channelCount=s.channelCount,i.samplerate=s.sampleRate,i.samples.push(d),{sample:d,length:s.frameLength,missing:0}}}function SA(i,e){const t=i[e+1]>>3&3,n=i[e+1]>>1&3,r=i[e+2]>>4&15,s=i[e+2]>>2&3;if(t!==1&&r!==0&&r!==15&&s!==3){const a=i[e+2]>>1&1,u=i[e+3]>>6,d=t===3?3-n:n===3?3:4,c=CN[d*14+r-1]*1e3,m=DN[(t===3?0:t===2?1:2)*3+s],p=u===3?1:2,y=kN[t][n],v=PN[n],E=y*8*v,S=Math.floor(y*c/m+a)*v;if(xu===null){const R=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);xu=R?parseInt(R[1]):0}return!!xu&&xu<=87&&n===2&&c>=224e3&&u===0&&(i[e+3]=i[e+3]|128),{sampleRate:m,channelCount:p,frameLength:S,samplesPerFrame:E}}}function cp(i,e){return i[e]===255&&(i[e+1]&224)===224&&(i[e+1]&6)!==0}function TA(i,e){return e+1<i.length&&cp(i,e)}function _N(i,e){return cp(i,e)&&4<=i.length-e}function AA(i,e){if(e+1<i.length&&cp(i,e)){const n=SA(i,e);let r=4;n!=null&&n.frameLength&&(r=n.frameLength);const s=e+r;return s===i.length||TA(i,s)}return!1}class MN extends up{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,n,r){super.resetInitSegment(e,t,n,r),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;const n=jo(e,0);let r=(n==null?void 0:n.length)||0;if(AA(e,r))return!1;for(let s=e.length;r<s;r++)if(fN(e,r))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return hN(e,t)}appendFrame(e,t,n){pA(e,this.observer,t,n,e.manifestCodec);const r=yA(e,t,n,this.basePTS,this.frameIndex);if(r&&r.missing===0)return r}}const wA=(i,e)=>{let t=0,n=5;e+=n;const r=new Uint32Array(1),s=new Uint32Array(1),a=new Uint8Array(1);for(;n>0;){a[0]=i[e];const u=Math.min(n,8),d=8-u;s[0]=4278190080>>>24+d<<d,r[0]=(a[0]&s[0])>>d,t=t?t<<u|r[0]:r[0],e+=1,n-=u}return t};class NN extends up{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,n,r){super.resetInitSegment(e,t,n,r),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,n){const r=LA(e,t,n,this.basePTS,this.frameIndex);if(r!==-1)return{sample:e.samples[e.samples.length-1],length:r,missing:0}}static probe(e){if(!e)return!1;const t=jo(e,0);if(!t)return!1;const n=t.length;return e[n]===11&&e[n+1]===119&&lp(t)!==void 0&&wA(e,n)<16}}function LA(i,e,t,n,r){if(t+8>e.length||e[t]!==11||e[t+1]!==119)return-1;const s=e[t+4]>>6;if(s>=3)return-1;const u=[48e3,44100,32e3][s],d=e[t+4]&63,h=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][d*3+s]*2;if(t+h>e.length)return-1;const m=e[t+6]>>5;let p=0;m===2?p+=2:(m&1&&m!==1&&(p+=2),m&4&&(p+=2));const y=(e[t+6]<<8|e[t+7])>>12-p&1,E=[2,1,2,3,3,4,4,5][m]+y,S=e[t+5]>>3,A=e[t+5]&7,L=new Uint8Array([s<<6|S<<1|A>>2,(A&3)<<6|m<<3|y<<2|d>>4,d<<4&224]),R=1536/u*9e4,D=n+r*R,k=e.subarray(t,t+h);return i.config=L,i.channelCount=E,i.samplerate=u,i.samples.push({unit:k,pts:D}),h}class ON extends up{resetInitSegment(e,t,n,r){super.resetInitSegment(e,t,n,r),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=jo(e,0);let n=(t==null?void 0:t.length)||0;if(t&&e[n]===11&&e[n+1]===119&&lp(t)!==void 0&&wA(e,n)<=16)return!1;for(let r=e.length;n<r;n++)if(AA(e,n))return nt.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return _N(e,t)}appendFrame(e,t,n){if(this.basePTS!==null)return EA(e,t,n,this.basePTS,this.frameIndex)}}const FN=/\/emsg[-/]ID3/i;class BN{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,n,r){const s=this.videoTrack=Di("video",1),a=this.audioTrack=Di("audio",1),u=this.txtTrack=Di("text",1);if(this.id3Track=Di("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const d=NT(e);if(d.video){const{id:c,timescale:h,codec:m,supplemental:p}=d.video;s.id=c,s.timescale=u.timescale=h,s.codec=m,s.supplemental=p}if(d.audio){const{id:c,timescale:h,codec:m}=d.audio;a.id=c,a.timescale=h,a.codec=m}u.id=PT.text,s.sampleDuration=0,s.duration=a.duration=r}resetContiguity(){this.remainderData=null}static probe(e){return N_(e)}demux(e,t){this.timeOffset=t;let n=e;const r=this.videoTrack,s=this.txtTrack;if(this.config.progressive){this.remainderData&&(n=Qn(this.remainderData,e));const u=V_(n);this.remainderData=u.remainder,r.samples=u.valid||new Uint8Array}else r.samples=n;const a=this.extractID3Track(r,t);return s.samples=Kv(t,r),{videoTrack:r,audioTrack:this.audioTrack,id3Track:a,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,n=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const r=this.extractID3Track(t,this.timeOffset);return n.samples=Kv(e,t),{videoTrack:t,audioTrack:Di(),id3Track:r,textTrack:Di()}}extractID3Track(e,t){const n=this.id3Track;if(e.samples.length){const r=Ge(e.samples,["emsg"]);r&&r.forEach(s=>{const a=H_(s);if(FN.test(a.schemeIdUri)){const u=Cx(a,t);let d=a.eventDuration===4294967295?Number.POSITIVE_INFINITY:a.eventDuration/a.timeScale;d<=.001&&(d=Number.POSITIVE_INFINITY);const c=a.payload;n.samples.push({data:c,len:c.byteLength,dts:u,pts:u,type:Fn.emsg,duration:d})}else if(this.config.enableEmsgKLVMetadata&&a.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const u=Cx(a,t);n.samples.push({data:a.payload,len:a.payload.byteLength,dts:u,pts:u,type:Fn.misbklv,duration:Number.POSITIVE_INFINITY})}})}return n}demuxSampleAes(e,t,n){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}}function Cx(i,e){return ye(i.presentationTime)?i.presentationTime/i.timeScale:e+i.presentationTimeDelta/i.timeScale}class UN{constructor(e,t,n){this.keyData=void 0,this.decrypter=void 0,this.keyData=n,this.decrypter=new ep(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,$r.cbc)}decryptAacSample(e,t,n){const r=e[t].unit;if(r.length<=16)return;const s=r.subarray(16,r.length-r.length%16),a=s.buffer.slice(s.byteOffset,s.byteOffset+s.length);this.decryptBuffer(a).then(u=>{const d=new Uint8Array(u);r.set(d,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,n)}).catch(n)}decryptAacSamples(e,t,n){for(;;t++){if(t>=e.length){n();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,n),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=Math.floor((e.length-48)/160)*16+16,n=new Int8Array(t);let r=0;for(let s=32;s<e.length-16;s+=160,r+=16)n.set(e.subarray(s,s+16),r);return n}getAvcDecryptedUnit(e,t){const n=new Uint8Array(t);let r=0;for(let s=32;s<e.length-16;s+=160,r+=16)e.set(n.subarray(r,r+16),s);return e}decryptAvcSample(e,t,n,r,s){const a=BT(s.data),u=this.getAvcEncryptedData(a);this.decryptBuffer(u.buffer).then(d=>{s.data=this.getAvcDecryptedUnit(a,d),this.decrypter.isSync()||this.decryptAvcSamples(e,t,n+1,r)}).catch(r)}decryptAvcSamples(e,t,n,r){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,n=0){if(t>=e.length){r();return}const s=e[t].units;for(;!(n>=s.length);n++){const a=s[n];if(!(a.data.length<=48||a.type!==1&&a.type!==5)&&(this.decryptAvcSample(e,t,n,r,a),!this.decrypter.isSync()))return}}}}class RA{constructor(){this.VideoSample=null}createVideoSample(e,t,n){return{key:e,frame:!1,pts:t,dts:n,units:[],length:0}}getLastNalUnit(e){var t;let n=this.VideoSample,r;if((!n||n.units.length===0)&&(n=e[e.length-1]),(t=n)!=null&&t.units){const s=n.units;r=s[s.length-1]}return r}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){const n=t.samples,r=n.length;if(r){const s=n[r-1];e.pts=s.pts,e.dts=s.dts}else{t.dropped++;return}}t.samples.push(e)}}parseNALu(e,t,n){const r=t.byteLength;let s=e.naluState||0;const a=s,u=[];let d=0,c,h,m,p=-1,y=0;for(s===-1&&(p=0,y=this.getNALuType(t,0),s=0,d=1);d<r;){if(c=t[d++],!s){s=c?0:1;continue}if(s===1){s=c?0:2;continue}if(!c)s=3;else if(c===1){if(h=d-s-1,p>=0){const v={data:t.subarray(p,h),type:y};u.push(v)}else{const v=this.getLastNalUnit(e.samples);v&&(a&&d<=4-a&&v.state&&(v.data=v.data.subarray(0,v.data.byteLength-a)),h>0&&(v.data=Qn(v.data,t.subarray(0,h)),v.state=0))}d<r?(m=this.getNALuType(t,d),p=d,y=m,s=0):s=-1}else s=0}if(p>=0&&s>=0){const v={data:t.subarray(p,r),type:y,state:s};u.push(v)}if(u.length===0){const v=this.getLastNalUnit(e.samples);v&&(v.data=Qn(v.data,t))}return e.naluState=s,u}}class Lo{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,n=e.byteLength-t,r=new Uint8Array(4),s=Math.min(4,t);if(s===0)throw new Error("no bytes available");r.set(e.subarray(n,n+s)),this.word=new DataView(r.buffer).getUint32(0),this.bitsAvailable=s*8,this.bytesAvailable-=s}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const n=this.word>>>32-t;if(e>32&&nt.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?n<<t|this.readBits(t):n}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if((this.word&2147483648>>>e)!==0)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class $N extends RA{parsePES(e,t,n,r){const s=this.parseNALu(e,n.data,r);let a=this.VideoSample,u,d=!1;n.data=null,a&&s.length&&!e.audFound&&(this.pushAccessUnit(a,e),a=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),s.forEach(c=>{var h,m;switch(c.type){case 1:{let E=!1;u=!0;const S=c.data;if(d&&S.length>4){const A=this.readSliceType(S);(A===2||A===4||A===7||A===9)&&(E=!0)}if(E){var p;(p=a)!=null&&p.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null)}a||(a=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),a.frame=!0,a.key=E;break}case 5:u=!0,(h=a)!=null&&h.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),a.key=!0,a.frame=!0;break;case 6:{u=!0,Xm(c.data,1,n.pts,t.samples);break}case 7:{var y,v;u=!0,d=!0;const E=c.data,S=this.readSPS(E);if(!e.sps||e.width!==S.width||e.height!==S.height||((y=e.pixelRatio)==null?void 0:y[0])!==S.pixelRatio[0]||((v=e.pixelRatio)==null?void 0:v[1])!==S.pixelRatio[1]){e.width=S.width,e.height=S.height,e.pixelRatio=S.pixelRatio,e.sps=[E];const A=E.subarray(1,4);let L="avc1.";for(let R=0;R<3;R++){let D=A[R].toString(16);D.length<2&&(D="0"+D),L+=D}e.codec=L}break}case 8:u=!0,e.pps=[c.data];break;case 9:u=!0,e.audFound=!0,(m=a)!=null&&m.frame&&(this.pushAccessUnit(a,e),a=null),a||(a=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts));break;case 12:u=!0;break;default:u=!1;break}a&&u&&a.units.push(c)}),r&&a&&(this.pushAccessUnit(a,e),this.VideoSample=null)}getNALuType(e,t){return e[t]&31}readSliceType(e){const t=new Lo(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let n=8,r=8,s;for(let a=0;a<e;a++)r!==0&&(s=t.readEG(),r=(n+s+256)%256),n=r===0?n:r}readSPS(e){const t=new Lo(e);let n=0,r=0,s=0,a=0,u,d,c;const h=t.readUByte.bind(t),m=t.readBits.bind(t),p=t.readUEG.bind(t),y=t.readBoolean.bind(t),v=t.skipBits.bind(t),E=t.skipEG.bind(t),S=t.skipUEG.bind(t),A=this.skipScalingList.bind(this);h();const L=h();if(m(5),v(3),h(),S(),L===100||L===110||L===122||L===244||L===44||L===83||L===86||L===118||L===128){const _=p();if(_===3&&v(1),S(),S(),v(1),y())for(d=_!==3?8:12,c=0;c<d;c++)y()&&(c<6?A(16,t):A(64,t))}S();const R=p();if(R===0)p();else if(R===1)for(v(1),E(),E(),u=p(),c=0;c<u;c++)E();S(),v(1);const D=p(),k=p(),U=m(1);U===0&&v(1),v(1),y()&&(n=p(),r=p(),s=p(),a=p());let C=[1,1];if(y()&&y())switch(h()){case 1:C=[1,1];break;case 2:C=[12,11];break;case 3:C=[10,11];break;case 4:C=[16,11];break;case 5:C=[40,33];break;case 6:C=[24,11];break;case 7:C=[20,11];break;case 8:C=[32,11];break;case 9:C=[80,33];break;case 10:C=[18,11];break;case 11:C=[15,11];break;case 12:C=[64,33];break;case 13:C=[160,99];break;case 14:C=[4,3];break;case 15:C=[3,2];break;case 16:C=[2,1];break;case 255:{C=[h()<<8|h(),h()<<8|h()];break}}return{width:Math.ceil((D+1)*16-n*2-r*2),height:(2-U)*(k+1)*16-(U?2:4)*(s+a),pixelRatio:C}}}class jN extends RA{constructor(...e){super(...e),this.initVPS=null}parsePES(e,t,n,r){const s=this.parseNALu(e,n.data,r);let a=this.VideoSample,u,d=!1;n.data=null,a&&s.length&&!e.audFound&&(this.pushAccessUnit(a,e),a=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),s.forEach(c=>{var h,m;switch(c.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:a||(a=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),a.frame=!0,u=!0;break;case 16:case 17:case 18:case 21:if(u=!0,d){var p;(p=a)!=null&&p.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null)}a||(a=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),a.key=!0,a.frame=!0;break;case 19:case 20:u=!0,(h=a)!=null&&h.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),a.key=!0,a.frame=!0;break;case 39:u=!0,Xm(c.data,2,n.pts,t.samples);break;case 32:u=!0,e.vps||(typeof e.params!="object"&&(e.params={}),e.params=rt(e.params,this.readVPS(c.data)),this.initVPS=c.data),e.vps=[c.data];break;case 33:if(u=!0,d=!0,e.vps!==void 0&&e.vps[0]!==this.initVPS&&e.sps!==void 0&&!this.matchSPS(e.sps[0],c.data)&&(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const y=this.readSPS(c.data);e.width=y.width,e.height=y.height,e.pixelRatio=y.pixelRatio,e.codec=y.codecString,e.sps=[],typeof e.params!="object"&&(e.params={});for(const v in y.params)e.params[v]=y.params[v]}this.pushParameterSet(e.sps,c.data,e.vps),a||(a=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),a.key=!0;break;case 34:if(u=!0,typeof e.params=="object"){if(!e.pps){e.pps=[];const y=this.readPPS(c.data);for(const v in y)e.params[v]=y[v]}this.pushParameterSet(e.pps,c.data,e.vps)}break;case 35:u=!0,e.audFound=!0,(m=a)!=null&&m.frame&&(this.pushAccessUnit(a,e),a=null),a||(a=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts));break;default:u=!1;break}a&&u&&a.units.push(c)}),r&&a&&(this.pushAccessUnit(a,e),this.VideoSample=null)}pushParameterSet(e,t,n){(n&&n[0]===this.initVPS||!n&&!e.length)&&e.push(t)}getNALuType(e,t){return(e[t]&126)>>>1}ebsp2rbsp(e){const t=new Uint8Array(e.byteLength);let n=0;for(let r=0;r<e.byteLength;r++)r>=2&&e[r]===3&&e[r-1]===0&&e[r-2]===0||(t[n]=e[r],n++);return new Uint8Array(t.buffer,0,n)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){const t=new Lo(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);const n=t.readBits(3),r=t.readBoolean();return{numTemporalLayers:n+1,temporalIdNested:r}}readSPS(e){const t=new Lo(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);const n=t.readBits(3);t.readBoolean();const r=t.readBits(2),s=t.readBoolean(),a=t.readBits(5),u=t.readUByte(),d=t.readUByte(),c=t.readUByte(),h=t.readUByte(),m=t.readUByte(),p=t.readUByte(),y=t.readUByte(),v=t.readUByte(),E=t.readUByte(),S=t.readUByte(),A=t.readUByte(),L=[],R=[];for(let $e=0;$e<n;$e++)L.push(t.readBoolean()),R.push(t.readBoolean());if(n>0)for(let $e=n;$e<8;$e++)t.readBits(2);for(let $e=0;$e<n;$e++)L[$e]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),R[$e]&&t.readUByte();t.readUEG();const D=t.readUEG();D==3&&t.skipBits(1);const k=t.readUEG(),U=t.readUEG(),C=t.readBoolean();let _=0,F=0,O=0,W=0;C&&(_+=t.readUEG(),F+=t.readUEG(),O+=t.readUEG(),W+=t.readUEG());const z=t.readUEG(),re=t.readUEG(),ae=t.readUEG(),ce=t.readBoolean();for(let $e=ce?0:n;$e<=n;$e++)t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.readBoolean()&&t.readBoolean())for(let xt=0;xt<4;xt++)for(let Ht=0;Ht<(xt===3?2:6);Ht++)if(!t.readBoolean())t.readUEG();else{const _t=Math.min(64,1<<4+(xt<<1));xt>1&&t.readEG();for(let an=0;an<_t;an++)t.readEG()}t.readBoolean(),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());const G=t.readUEG();let ee=0;for(let $e=0;$e<G;$e++){let xt=!1;if($e!==0&&(xt=t.readBoolean()),xt){$e===G&&t.readUEG(),t.readBoolean(),t.readUEG();let Ht=0;for(let gn=0;gn<=ee;gn++){const _t=t.readBoolean();let an=!1;_t||(an=t.readBoolean()),(_t||an)&&Ht++}ee=Ht}else{const Ht=t.readUEG(),gn=t.readUEG();ee=Ht+gn;for(let _t=0;_t<Ht;_t++)t.readUEG(),t.readBoolean();for(let _t=0;_t<gn;_t++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){const $e=t.readUEG();for(let xt=0;xt<$e;xt++){for(let Ht=0;Ht<ae+4;Ht++)t.readBits(1);t.readBits(1)}}let P=0,j=1,he=1,ge=!0,te=1,fe=0;t.readBoolean(),t.readBoolean();let Pe=!1;if(t.readBoolean()){if(t.readBoolean()){const Rn=t.readUByte(),Hr=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],on=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];Rn>0&&Rn<16?(j=Hr[Rn-1],he=on[Rn-1]):Rn===255&&(j=t.readBits(16),he=t.readBits(16))}if(t.readBoolean()&&t.readBoolean(),t.readBoolean()&&(t.readBits(3),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())),t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),Pe=t.readBoolean(),Pe&&(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG()),t.readBoolean()&&(te=t.readBits(32),fe=t.readBits(32),t.readBoolean()&&t.readUEG(),t.readBoolean())){const on=t.readBoolean(),ei=t.readBoolean();let ti=!1;(on||ei)&&(ti=t.readBoolean(),ti&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),ti&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let xi=0;xi<=n;xi++){ge=t.readBoolean();const Qt=ge||t.readBoolean();let ln=!1;Qt?t.readEG():ln=t.readBoolean();const ni=ln?1:t.readUEG()+1;if(on)for(let bn=0;bn<ni;bn++)t.readUEG(),t.readUEG(),ti&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(ei)for(let bn=0;bn<ni;bn++)t.readUEG(),t.readUEG(),ti&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),P=t.readUEG())}let Ve=k,Ze=U;if(C){let $e=1,xt=1;D===1?$e=xt=2:D==2&&($e=2),Ve=k-$e*F-$e*_,Ze=U-xt*W-xt*O}const pn=r?["A","B","C"][r]:"",At=u<<24|d<<16|c<<8|h;let sn=0;for(let $e=0;$e<32;$e++)sn=(sn|(At>>$e&1)<<31-$e)>>>0;let vi=sn.toString(16);return a===1&&vi==="2"&&(vi="6"),{codecString:`hvc1.${pn}${a}.${vi}.${s?"H":"L"}${A}.B0`,params:{general_tier_flag:s,general_profile_idc:a,general_profile_space:r,general_profile_compatibility_flags:[u,d,c,h],general_constraint_indicator_flags:[m,p,y,v,E,S],general_level_idc:A,bit_depth:z+8,bit_depth_luma_minus8:z,bit_depth_chroma_minus8:re,min_spatial_segmentation_idc:P,chroma_format_idc:D,frame_rate:{fixed:ge,fps:fe/te}},width:Ve,height:Ze,pixelRatio:[j,he]}}readPPS(e){const t=new Lo(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2),t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);const r=t.readBoolean(),s=t.readBoolean();let a=1;return s&&r?a=0:s?a=3:r&&(a=2),{parallelismType:a}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}const Gt=188;class Pr{constructor(e,t,n,r){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=n,this.logger=r,this.videoParser=null}static probe(e,t){const n=Pr.syncOffset(e);return n>0&&t.warn(`MPEG2-TS detected but first sync word found @ offset ${n}`),n!==-1}static syncOffset(e){const t=e.length;let n=Math.min(Gt*5,t-Gt)+1,r=0;for(;r<n;){let s=!1,a=-1,u=0;for(let d=r;d<t;d+=Gt)if(e[d]===71&&(t-d===Gt||e[d+Gt]===71)){if(u++,a===-1&&(a=d,a!==0&&(n=Math.min(a+Gt*99,e.length-Gt)+1)),s||(s=zf(e,d)===0),s&&u>1&&(a===0&&u>2||d+Gt>n))return a}else{if(u)return-1;break}r++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:PT[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,n,r){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=Pr.createTrack("video"),this._videoTrack.duration=r,this._audioTrack=Pr.createTrack("audio",r),this._id3Track=Pr.createTrack("id3"),this._txtTrack=Pr.createTrack("text"),this._audioTrack.segmentCodec="aac",this.videoParser=null,this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=n}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:n}=this;e&&(e.pesData=null),t&&(t.pesData=null),n&&(n.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,n=!1,r=!1){n||(this.sampleAes=null);let s;const a=this._videoTrack,u=this._audioTrack,d=this._id3Track,c=this._txtTrack;let h=a.pid,m=a.pesData,p=u.pid,y=d.pid,v=u.pesData,E=d.pesData,S=null,A=this.pmtParsed,L=this._pmtId,R=e.length;if(this.remainderData&&(e=Qn(this.remainderData,e),R=e.length,this.remainderData=null),R<Gt&&!r)return this.remainderData=e,{audioTrack:u,videoTrack:a,id3Track:d,textTrack:c};const D=Math.max(0,Pr.syncOffset(e));R-=(R-D)%Gt,R<e.byteLength&&!r&&(this.remainderData=new Uint8Array(e.buffer,R,e.buffer.byteLength-R));let k=0;for(let C=D;C<R;C+=Gt)if(e[C]===71){const _=!!(e[C+1]&64),F=zf(e,C),O=(e[C+3]&48)>>4;let W;if(O>1){if(W=C+5+e[C+4],W===C+Gt)continue}else W=C+4;switch(F){case h:_&&(m&&(s=Zs(m,this.logger))&&(this.readyVideoParser(a.segmentCodec),this.videoParser!==null&&this.videoParser.parsePES(a,c,s,!1)),m={data:[],size:0}),m&&(m.data.push(e.subarray(W,C+Gt)),m.size+=C+Gt-W);break;case p:if(_){if(v&&(s=Zs(v,this.logger)))switch(u.segmentCodec){case"aac":this.parseAACPES(u,s);break;case"mp3":this.parseMPEGPES(u,s);break;case"ac3":this.parseAC3PES(u,s);break}v={data:[],size:0}}v&&(v.data.push(e.subarray(W,C+Gt)),v.size+=C+Gt-W);break;case y:_&&(E&&(s=Zs(E,this.logger))&&this.parseID3PES(d,s),E={data:[],size:0}),E&&(E.data.push(e.subarray(W,C+Gt)),E.size+=C+Gt-W);break;case 0:_&&(W+=e[W]+1),L=this._pmtId=VN(e,W);break;case L:{_&&(W+=e[W]+1);const z=GN(e,W,this.typeSupported,n,this.observer,this.logger);h=z.videoPid,h>0&&(a.pid=h,a.segmentCodec=z.segmentVideoCodec),p=z.audioPid,p>0&&(u.pid=p,u.segmentCodec=z.segmentAudioCodec),y=z.id3Pid,y>0&&(d.pid=y),S!==null&&!A&&(this.logger.warn(`MPEG-TS PMT found at ${C} after unknown PID '${S}'. Backtracking to sync byte @${D} to parse all TS packets.`),S=null,C=D-188),A=this.pmtParsed=!0;break}case 17:case 8191:break;default:S=F;break}}else k++;k>0&&Kf(this.observer,new Error(`Found ${k} TS packet/s that do not start with 0x47`),void 0,this.logger),a.pesData=m,u.pesData=v,d.pesData=E;const U={audioTrack:u,videoTrack:a,id3Track:d,textTrack:c};return r&&this.extractRemainingSamples(U),U}flush(){const{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:n,id3Track:r,textTrack:s}=e,a=n.pesData,u=t.pesData,d=r.pesData;let c;if(a&&(c=Zs(a,this.logger))?(this.readyVideoParser(n.segmentCodec),this.videoParser!==null&&(this.videoParser.parsePES(n,s,c,!0),n.pesData=null)):n.pesData=a,u&&(c=Zs(u,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,c);break;case"mp3":this.parseMPEGPES(t,c);break;case"ac3":this.parseAC3PES(t,c);break}t.pesData=null}else u!=null&&u.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=u;d&&(c=Zs(d,this.logger))?(this.parseID3PES(r,c),r.pesData=null):r.pesData=d}demuxSampleAes(e,t,n){const r=this.demux(e,n,!0,!this.config.progressive),s=this.sampleAes=new UN(this.observer,this.config,t);return this.decrypt(r,s)}readyVideoParser(e){this.videoParser===null&&(e==="avc"?this.videoParser=new $N:e==="hevc"&&(this.videoParser=new jN))}decrypt(e,t){return new Promise(n=>{const{audioTrack:r,videoTrack:s}=e;r.samples&&r.segmentCodec==="aac"?t.decryptAacSamples(r.samples,0,()=>{s.samples?t.decryptAvcSamples(s.samples,0,0,()=>{n(e)}):n(e)}):s.samples&&t.decryptAvcSamples(s.samples,0,0,()=>{n(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let n=0;const r=this.aacOverFlow;let s=t.data;if(r){this.aacOverFlow=null;const m=r.missing,p=r.sample.unit.byteLength;if(m===-1)s=Qn(r.sample.unit,s);else{const y=p-m;r.sample.unit.set(s.subarray(0,m),y),e.samples.push(r.sample),n=r.missing}}let a,u;for(a=n,u=s.length;a<u-1&&!hc(s,a);a++);if(a!==n){let m;const p=a<u-1;if(p?m=`AAC PES did not start with ADTS header,offset:${a}`:m="No ADTS header found in AAC PES",Kf(this.observer,new Error(m),p,this.logger),!p)return}pA(e,this.observer,s,a,this.audioCodec);let d;if(t.pts!==void 0)d=t.pts;else if(r){const m=gA(e.samplerate);d=r.sample.pts+m}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let c=0,h;for(;a<u;)if(h=yA(e,s,a,d,c),a+=h.length,h.missing){this.aacOverFlow=h;break}else for(c++;a<u-1&&!hc(s,a);a++);}parseMPEGPES(e,t){const n=t.data,r=n.length;let s=0,a=0;const u=t.pts;if(u===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;a<r;)if(TA(n,a)){const d=EA(e,n,a,u,s);if(d)a+=d.length,s++;else break}else a++}parseAC3PES(e,t){{const n=t.data,r=t.pts;if(r===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const s=n.length;let a=0,u=0,d;for(;u<s&&(d=LA(e,n,u,r,a++))>0;)u+=d}}parseID3PES(e,t){if(t.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const n=rt({},t,{type:this._videoTrack?Fn.emsg:Fn.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(n)}}function zf(i,e){return((i[e+1]&31)<<8)+i[e+2]}function VN(i,e){return(i[e+10]&31)<<8|i[e+11]}function GN(i,e,t,n,r,s){const a={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},u=(i[e+1]&15)<<8|i[e+2],d=e+3+u-4,c=(i[e+10]&15)<<8|i[e+11];for(e+=12+c;e<d;){const h=zf(i,e),m=(i[e+3]&15)<<8|i[e+4];switch(i[e]){case 207:if(!n){Vh("ADTS AAC",s);break}case 15:a.audioPid===-1&&(a.audioPid=h);break;case 21:a.id3Pid===-1&&(a.id3Pid=h);break;case 219:if(!n){Vh("H.264",s);break}case 27:a.videoPid===-1&&(a.videoPid=h);break;case 3:case 4:!t.mpeg&&!t.mp3?s.log("MPEG audio found, not supported in this browser"):a.audioPid===-1&&(a.audioPid=h,a.segmentAudioCodec="mp3");break;case 193:if(!n){Vh("AC-3",s);break}case 129:t.ac3?a.audioPid===-1&&(a.audioPid=h,a.segmentAudioCodec="ac3"):s.log("AC-3 audio found, not supported in this browser");break;case 6:if(a.audioPid===-1&&m>0){let p=e+5,y=m;for(;y>2;){switch(i[p]){case 106:t.ac3!==!0?s.log("AC-3 audio found, not supported in this browser for now"):(a.audioPid=h,a.segmentAudioCodec="ac3");break}const E=i[p+1]+2;p+=E,y-=E}}break;case 194:case 135:return Kf(r,new Error("Unsupported EC-3 in M2TS found"),void 0,s),a;case 36:a.videoPid===-1&&(a.videoPid=h,a.segmentVideoCodec="hevc",s.log("HEVC in M2TS found"));break}e+=m+5}return a}function Kf(i,e,t,n){n.warn(`parsing error: ${e.message}`),i.emit(w.ERROR,w.ERROR,{type:Ie.MEDIA_ERROR,details:Y.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:e,reason:e.message})}function Vh(i,e){e.log(`${i} with AES-128-CBC encryption found in unencrypted stream`)}function Zs(i,e){let t=0,n,r,s,a,u;const d=i.data;if(!i||i.size===0)return null;for(;d[0].length<19&&d.length>1;)d[0]=Qn(d[0],d[1]),d.splice(1,1);if(n=d[0],(n[0]<<16)+(n[1]<<8)+n[2]===1){if(r=(n[4]<<8)+n[5],r&&r>i.size-6)return null;const h=n[7];h&192&&(a=(n[9]&14)*536870912+(n[10]&255)*4194304+(n[11]&254)*16384+(n[12]&255)*128+(n[13]&254)/2,h&64?(u=(n[14]&14)*536870912+(n[15]&255)*4194304+(n[16]&254)*16384+(n[17]&255)*128+(n[18]&254)/2,a-u>60*9e4&&(e.warn(`${Math.round((a-u)/9e4)}s delta between PTS and DTS, align them`),a=u)):u=a),s=n[8];let m=s+9;if(i.size<=m)return null;i.size-=m;const p=new Uint8Array(i.size);for(let y=0,v=d.length;y<v;y++){n=d[y];let E=n.byteLength;if(m)if(m>E){m-=E;continue}else n=n.subarray(m),E-=m,m=0;p.set(n,t),t+=E}return r&&(r-=s+3),{data:p,pts:a,dts:u,len:r}}return null}class HN{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const br=Math.pow(2,32)-1;class K{static init(){K.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in K.types)K.types.hasOwnProperty(e)&&(K.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),n=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);K.HDLR_TYPES={video:t,audio:n};const r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),s=new Uint8Array([0,0,0,0,0,0,0,0]);K.STTS=K.STSC=K.STCO=s,K.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),K.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),K.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),K.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const a=new Uint8Array([105,115,111,109]),u=new Uint8Array([97,118,99,49]),d=new Uint8Array([0,0,0,1]);K.FTYP=K.box(K.types.ftyp,a,d,a,u),K.DINF=K.box(K.types.dinf,K.box(K.types.dref,r))}static box(e,...t){let n=8,r=t.length;const s=r;for(;r--;)n+=t[r].byteLength;const a=new Uint8Array(n);for(a[0]=n>>24&255,a[1]=n>>16&255,a[2]=n>>8&255,a[3]=n&255,a.set(e,4),r=0,n=8;r<s;r++)a.set(t[r],n),n+=t[r].byteLength;return a}static hdlr(e){return K.box(K.types.hdlr,K.HDLR_TYPES[e])}static mdat(e){return K.box(K.types.mdat,e)}static mdhd(e,t){t*=e;const n=Math.floor(t/(br+1)),r=Math.floor(t%(br+1));return K.box(K.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,n>>24,n>>16&255,n>>8&255,n&255,r>>24,r>>16&255,r>>8&255,r&255,85,196,0,0]))}static mdia(e){return K.box(K.types.mdia,K.mdhd(e.timescale||0,e.duration||0),K.hdlr(e.type),K.minf(e))}static mfhd(e){return K.box(K.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?K.box(K.types.minf,K.box(K.types.smhd,K.SMHD),K.DINF,K.stbl(e)):K.box(K.types.minf,K.box(K.types.vmhd,K.VMHD),K.DINF,K.stbl(e))}static moof(e,t,n){return K.box(K.types.moof,K.mfhd(e),K.traf(n,t))}static moov(e){let t=e.length;const n=[];for(;t--;)n[t]=K.trak(e[t]);return K.box.apply(null,[K.types.moov,K.mvhd(e[0].timescale||0,e[0].duration||0)].concat(n).concat(K.mvex(e)))}static mvex(e){let t=e.length;const n=[];for(;t--;)n[t]=K.trex(e[t]);return K.box.apply(null,[K.types.mvex,...n])}static mvhd(e,t){t*=e;const n=Math.floor(t/(br+1)),r=Math.floor(t%(br+1)),s=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,n>>24,n>>16&255,n>>8&255,n&255,r>>24,r>>16&255,r>>8&255,r&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return K.box(K.types.mvhd,s)}static sdtp(e){const t=e.samples||[],n=new Uint8Array(4+t.length);let r,s;for(r=0;r<t.length;r++)s=t[r].flags,n[r+4]=s.dependsOn<<4|s.isDependedOn<<2|s.hasRedundancy;return K.box(K.types.sdtp,n)}static stbl(e){return K.box(K.types.stbl,K.stsd(e),K.box(K.types.stts,K.STTS),K.box(K.types.stsc,K.STSC),K.box(K.types.stsz,K.STSZ),K.box(K.types.stco,K.STCO))}static avc1(e){let t=[],n=[],r,s,a;for(r=0;r<e.sps.length;r++)s=e.sps[r],a=s.byteLength,t.push(a>>>8&255),t.push(a&255),t=t.concat(Array.prototype.slice.call(s));for(r=0;r<e.pps.length;r++)s=e.pps[r],a=s.byteLength,n.push(a>>>8&255),n.push(a&255),n=n.concat(Array.prototype.slice.call(s));const u=K.box(K.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|e.sps.length].concat(t).concat([e.pps.length]).concat(n))),d=e.width,c=e.height,h=e.pixelRatio[0],m=e.pixelRatio[1];return K.box(K.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,d>>8&255,d&255,c>>8&255,c&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),u,K.box(K.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),K.box(K.types.pasp,new Uint8Array([h>>24,h>>16&255,h>>8&255,h&255,m>>24,m>>16&255,m>>8&255,m&255])))}static esds(e){const t=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...t,6,1,2])}static audioStsd(e){const t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,t&255,0,0])}static mp4a(e){return K.box(K.types.mp4a,K.audioStsd(e),K.box(K.types.esds,K.esds(e)))}static mp3(e){return K.box(K.types[".mp3"],K.audioStsd(e))}static ac3(e){return K.box(K.types["ac-3"],K.audioStsd(e),K.box(K.types.dac3,e.config))}static stsd(e){const{segmentCodec:t}=e;if(e.type==="audio"){if(t==="aac")return K.box(K.types.stsd,K.STSD,K.mp4a(e));if(t==="ac3"&&e.config)return K.box(K.types.stsd,K.STSD,K.ac3(e));if(t==="mp3"&&e.codec==="mp3")return K.box(K.types.stsd,K.STSD,K.mp3(e))}else if(e.pps&&e.sps){if(t==="avc")return K.box(K.types.stsd,K.STSD,K.avc1(e));if(t==="hevc"&&e.vps)return K.box(K.types.stsd,K.STSD,K.hvc1(e))}else throw new Error("video track missing pps or sps");throw new Error(`unsupported ${e.type} segment codec (${t}/${e.codec})`)}static tkhd(e){const t=e.id,n=(e.duration||0)*(e.timescale||0),r=e.width||0,s=e.height||0,a=Math.floor(n/(br+1)),u=Math.floor(n%(br+1));return K.box(K.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,a>>24,a>>16&255,a>>8&255,a&255,u>>24,u>>16&255,u>>8&255,u&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>8&255,r&255,0,0,s>>8&255,s&255,0,0]))}static traf(e,t){const n=K.sdtp(e),r=e.id,s=Math.floor(t/(br+1)),a=Math.floor(t%(br+1));return K.box(K.types.traf,K.box(K.types.tfhd,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,r&255])),K.box(K.types.tfdt,new Uint8Array([1,0,0,0,s>>24,s>>16&255,s>>8&255,s&255,a>>24,a>>16&255,a>>8&255,a&255])),K.trun(e,n.length+16+20+8+16+8+8),n)}static trak(e){return e.duration=e.duration||4294967295,K.box(K.types.trak,K.tkhd(e),K.mdia(e))}static trex(e){const t=e.id;return K.box(K.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const n=e.samples||[],r=n.length,s=12+16*r,a=new Uint8Array(s);let u,d,c,h,m,p;for(t+=8+s,a.set([e.type==="video"?1:0,0,15,1,r>>>24&255,r>>>16&255,r>>>8&255,r&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0),u=0;u<r;u++)d=n[u],c=d.duration,h=d.size,m=d.flags,p=d.cts,a.set([c>>>24&255,c>>>16&255,c>>>8&255,c&255,h>>>24&255,h>>>16&255,h>>>8&255,h&255,m.isLeading<<2|m.dependsOn,m.isDependedOn<<6|m.hasRedundancy<<4|m.paddingValue<<1|m.isNonSync,m.degradPrio&61440,m.degradPrio&15,p>>>24&255,p>>>16&255,p>>>8&255,p&255],12+16*u);return K.box(K.types.trun,a)}static initSegment(e){K.types||K.init();const t=K.moov(e);return Qn(K.FTYP,t)}static hvc1(e){const t=e.params,n=[e.vps,e.sps,e.pps],r=4,s=new Uint8Array([1,t.general_profile_space<<6|(t.general_tier_flag?32:0)|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),r-1|t.temporal_id_nested<<2|t.num_temporal_layers<<3|(t.frame_rate.fixed?64:0),n.length]);let a=s.length;for(let v=0;v<n.length;v+=1){a+=3;for(let E=0;E<n[v].length;E+=1)a+=2+n[v][E].length}const u=new Uint8Array(a);u.set(s,0),a=s.length;const d=n.length-1;for(let v=0;v<n.length;v+=1){u.set(new Uint8Array([32+v|(v===d?128:0),0,n[v].length]),a),a+=3;for(let E=0;E<n[v].length;E+=1)u.set(new Uint8Array([n[v][E].length>>8,n[v][E].length&255]),a),a+=2,u.set(n[v][E],a),a+=n[v][E].length}const c=K.box(K.types.hvcC,u),h=e.width,m=e.height,p=e.pixelRatio[0],y=e.pixelRatio[1];return K.box(K.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,h>>8&255,h&255,m>>8&255,m&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),c,K.box(K.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),K.box(K.types.pasp,new Uint8Array([p>>24,p>>16&255,p>>8&255,p&255,y>>24,y>>16&255,y>>8&255,y&255])))}}K.types=void 0;K.HDLR_TYPES=void 0;K.STTS=void 0;K.STSC=void 0;K.STCO=void 0;K.STSZ=void 0;K.VMHD=void 0;K.SMHD=void 0;K.STSD=void 0;K.FTYP=void 0;K.DINF=void 0;const bA=9e4;function dp(i,e,t=1,n=!1){const r=i*e*t;return n?Math.round(r):r}function zN(i,e,t=1,n=!1){return dp(i,e,1/t,n)}function mo(i,e=!1){return dp(i,1e3,1/bA,e)}function KN(i,e=1){return dp(i,bA,1/e)}function Dx(i){const{baseTime:e,timescale:t,trackId:n}=i;return`${e/t} (${e}/${t}) trackId: ${n}`}const WN=10*1e3,YN=1024,qN=1152,XN=1536;let Js=null,Gh=null;function kx(i,e,t,n){return{duration:e,size:t,cts:n,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:i?2:1,isNonSync:i?0:1}}}class Vu extends Jn{constructor(e,t,n,r){if(super("mp4-remuxer",r),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextVideoTs=null,this.nextAudioTs=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=n,this.ISGenerated=!1,Js===null){const a=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Js=a?parseInt(a[1]):0}if(Gh===null){const s=navigator.userAgent.match(/Safari\/(\d+)/i);Gh=s?parseInt(s[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){const t=this._initPTS;(!t||!e||e.trackId!==t.trackId||e.baseTime!==t.baseTime||e.timescale!==t.timescale)&&this.log(`Reset initPTS: ${t&&Dx(t)} > ${e&&Dx(e)}`),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const n=e[0].pts,r=e.reduce((s,a)=>{let u=a.pts,d=u-s;return d<-4294967296&&(t=!0,u=Nn(u,n),d=u-s),d>0?s:u},n);return t&&this.debug("PTS rollover detected"),r}remux(e,t,n,r,s,a,u,d){let c,h,m,p,y,v,E=s,S=s;const A=e.pid>-1,L=t.pid>-1,R=t.samples.length,D=e.samples.length>0,k=u&&R>0||R>1;if((!A||D)&&(!L||k)||this.ISGenerated||u){if(this.ISGenerated){var C,_,F,O;const ae=this.videoTrackConfig;(ae&&(t.width!==ae.width||t.height!==ae.height||((C=t.pixelRatio)==null?void 0:C[0])!==((_=ae.pixelRatio)==null?void 0:_[0])||((F=t.pixelRatio)==null?void 0:F[1])!==((O=ae.pixelRatio)==null?void 0:O[1]))||!ae&&k||this.nextAudioTs===null&&D)&&this.resetInitSegment()}this.ISGenerated||(m=this.generateIS(e,t,s,a));const W=this.isVideoContiguous;let z=-1,re;if(k&&(z=QN(t.samples),!W&&this.config.forceKeyFrameOnDiscontinuity))if(v=!0,z>0){this.warn(`Dropped ${z} out of ${R} video samples due to a missing keyframe`);const ae=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(z),t.dropped+=z,S+=(t.samples[0].pts-ae)/t.inputTimeScale,re=S}else z===-1&&(this.warn(`No keyframe found out of ${R} video samples`),v=!1);if(this.ISGenerated){if(D&&k){const ae=this.getVideoStartPts(t.samples),ne=(Nn(e.samples[0].pts,ae)-ae)/t.inputTimeScale;E+=Math.max(0,ne),S+=Math.max(0,-ne)}if(D){if(e.samplerate||(this.warn("regenerate InitSegment as audio detected"),m=this.generateIS(e,t,s,a)),h=this.remuxAudio(e,E,this.isAudioContiguous,a,L||k||d===xe.AUDIO?S:void 0),k){const ae=h?h.endPTS-h.startPTS:0;t.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),m=this.generateIS(e,t,s,a)),c=this.remuxVideo(t,S,W,ae)}}else k&&(c=this.remuxVideo(t,S,W,0));c&&(c.firstKeyFrame=z,c.independent=z!==-1,c.firstKeyFramePTS=re)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(n.samples.length&&(y=IA(n,s,this._initPTS,this._initDTS)),r.samples.length&&(p=CA(r,s,this._initPTS))),{audio:h,video:c,initSegment:m,independent:v,text:p,id3:y}}computeInitPts(e,t,n,r){const s=Math.round(n*t);let a=Nn(e,s);if(a<s+t)for(this.log(`Adjusting PTS for rollover in timeline near ${(s-a)/t} ${r}`);a<s+t;)a+=8589934592;return a-s}generateIS(e,t,n,r){const s=e.samples,a=t.samples,u=this.typeSupported,d={},c=this._initPTS;let h=!c||r,m="audio/mp4",p,y,v,E=-1;if(h&&(p=y=1/0),e.config&&s.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":u.mpeg?(m="audio/mpeg",e.codec=""):u.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}d.audio={id:"audio",container:m,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&u.mpeg?new Uint8Array(0):K.initSegment([e]),metadata:{channelCount:e.channelCount}},h&&(E=e.id,v=e.inputTimeScale,!c||v!==c.timescale?p=y=this.computeInitPts(s[0].pts,v,n,"audio"):h=!1)}if(t.sps&&t.pps&&a.length){if(t.timescale=t.inputTimeScale,d.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:K.initSegment([t]),metadata:{width:t.width,height:t.height}},h)if(E=t.id,v=t.inputTimeScale,!c||v!==c.timescale){const S=this.getVideoStartPts(a),A=Nn(a[0].dts,S),L=this.computeInitPts(A,v,n,"video"),R=this.computeInitPts(S,v,n,"video");y=Math.min(y,L),p=Math.min(p,R)}else h=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(d).length)return this.ISGenerated=!0,h?(c&&this.warn(`Timestamps at playlist time: ${r?"":"~"}${n} ${p/v} != initPTS: ${c.baseTime/c.timescale} (${c.baseTime}/${c.timescale}) trackId: ${c.trackId}`),this.log(`Found initPTS at playlist time: ${n} offset: ${p/v} (${p}/${v}) trackId: ${E}`),this._initPTS={baseTime:p,timescale:v,trackId:E},this._initDTS={baseTime:y,timescale:v,trackId:E}):p=v=void 0,{tracks:d,initPTS:p,timescale:v,trackId:E}}remuxVideo(e,t,n,r){const s=e.inputTimeScale,a=e.samples,u=[],d=a.length,c=this._initPTS,h=c.baseTime*s/c.timescale;let m=this.nextVideoTs,p=8,y=this.videoSampleDuration,v,E,S=Number.POSITIVE_INFINITY,A=Number.NEGATIVE_INFINITY,L=!1;if(!n||m===null){const P=h+t*s,j=a[0].pts-Nn(a[0].dts,a[0].pts);Js&&m!==null&&Math.abs(P-j-(m+h))<15e3?n=!0:m=P-j-h}const R=m+h;for(let P=0;P<d;P++){const j=a[P];j.pts=Nn(j.pts,R),j.dts=Nn(j.dts,R),j.dts<a[P>0?P-1:P].dts&&(L=!0)}L&&a.sort(function(P,j){const he=P.dts-j.dts,ge=P.pts-j.pts;return he||ge}),v=a[0].dts,E=a[a.length-1].dts;const D=E-v,k=D?Math.round(D/(d-1)):y||e.inputTimeScale/30;if(n){const P=v-R,j=P>k,he=P<-1;if((j||he)&&(j?this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${mo(P,!0)} ms (${P}dts) hole between fragments detected at ${t.toFixed(3)}`):this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${mo(-P,!0)} ms (${P}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!he||R>=a[0].pts||Js)){v=R;const ge=a[0].pts-P;if(j)a[0].dts=v,a[0].pts=ge;else{let te=!0;for(let fe=0;fe<a.length&&!(a[fe].dts>ge&&te);fe++){const Pe=a[fe].pts;if(a[fe].dts-=P,a[fe].pts-=P,fe<a.length-1){const be=a[fe+1].pts,Ve=a[fe].pts,Ze=be<=Ve,pn=be<=Pe;te=Ze==pn}}}this.log(`Video: Initial PTS/DTS adjusted: ${mo(ge,!0)}/${mo(v,!0)}, delta: ${mo(P,!0)} ms`)}}v=Math.max(0,v);let U=0,C=0,_=v;for(let P=0;P<d;P++){const j=a[P],he=j.units,ge=he.length;let te=0;for(let fe=0;fe<ge;fe++)te+=he[fe].data.length;C+=te,U+=ge,j.length=te,j.dts<_?(j.dts=_,_+=k/4|0||1):_=j.dts,S=Math.min(j.pts,S),A=Math.max(j.pts,A)}E=a[d-1].dts;const F=C+4*U+8;let O;try{O=new Uint8Array(F)}catch(P){this.observer.emit(w.ERROR,w.ERROR,{type:Ie.MUX_ERROR,details:Y.REMUX_ALLOC_ERROR,fatal:!1,error:P,bytes:F,reason:`fail allocating video mdat ${F}`});return}const W=new DataView(O.buffer);W.setUint32(0,F),O.set(K.types.mdat,4);let z=!1,re=Number.POSITIVE_INFINITY,ae=Number.POSITIVE_INFINITY,ce=Number.NEGATIVE_INFINITY,ne=Number.NEGATIVE_INFINITY;for(let P=0;P<d;P++){const j=a[P],he=j.units;let ge=0;for(let Pe=0,be=he.length;Pe<be;Pe++){const Ve=he[Pe],Ze=Ve.data,pn=Ve.data.byteLength;W.setUint32(p,pn),p+=4,O.set(Ze,p),p+=pn,ge+=4+pn}let te;if(P<d-1)y=a[P+1].dts-j.dts,te=a[P+1].pts-j.pts;else{const Pe=this.config,be=P>0?j.dts-a[P-1].dts:k;if(te=P>0?j.pts-a[P-1].pts:k,Pe.stretchShortVideoTrack&&this.nextAudioTs!==null){const Ve=Math.floor(Pe.maxBufferHole*s),Ze=(r?S+r*s:this.nextAudioTs+h)-j.pts;Ze>Ve?(y=Ze-be,y<0?y=be:z=!0,this.log(`It is approximately ${Ze/90} ms to the next segment; using duration ${y/90} ms for the last video frame.`)):y=be}else y=be}const fe=Math.round(j.pts-j.dts);re=Math.min(re,y),ce=Math.max(ce,y),ae=Math.min(ae,te),ne=Math.max(ne,te),u.push(kx(j.key,y,ge,fe))}if(u.length){if(Js){if(Js<70){const P=u[0].flags;P.dependsOn=2,P.isNonSync=0}}else if(Gh&&ne-ae<ce-re&&k/ce<.025&&u[0].cts===0){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let P=v;for(let j=0,he=u.length;j<he;j++){const ge=P+u[j].duration,te=P+u[j].cts;if(j<he-1){const fe=ge+u[j+1].cts;u[j].duration=fe-te}else u[j].duration=j?u[j-1].duration:k;u[j].cts=0,P=ge}}}y=z||!y?k:y;const ie=E+y;this.nextVideoTs=m=ie-h,this.videoSampleDuration=y,this.isVideoContiguous=!0;const J={data1:K.moof(e.sequenceNumber++,v,rt(e,{samples:u})),data2:O,startPTS:(S-h)/s,endPTS:(A+y-h)/s,startDTS:(v-h)/s,endDTS:m/s,type:"video",hasAudio:!1,hasVideo:!0,nb:u.length,dropped:e.dropped};return e.samples=[],e.dropped=0,J}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return qN;case"ac3":return XN;default:return YN}}remuxAudio(e,t,n,r,s){const a=e.inputTimeScale,u=e.samplerate?e.samplerate:a,d=a/u,c=this.getSamplesPerFrame(e),h=c*d,m=this._initPTS,p=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,y=[],v=s!==void 0;let E=e.samples,S=p?0:8,A=this.nextAudioTs||-1;const L=m.baseTime*a/m.timescale,R=L+t*a;if(this.isAudioContiguous=n=n||E.length&&A>0&&(r&&Math.abs(R-(A+L))<9e3||Math.abs(Nn(E[0].pts,R)-(A+L))<20*h),E.forEach(function(ne){ne.pts=Nn(ne.pts,R)}),!n||A<0){const ne=E.length;if(E=E.filter(ie=>ie.pts>=0),ne!==E.length&&this.warn(`Removed ${E.length-ne} of ${ne} samples (initPTS ${L} / ${a})`),!E.length)return;s===0?A=0:r&&!v?A=Math.max(0,R-L):A=E[0].pts-L}if(e.segmentCodec==="aac"){const ne=this.config.maxAudioFramesDrift;for(let ie=0,G=A+L;ie<E.length;ie++){const ee=E[ie],J=ee.pts,P=J-G,j=Math.abs(1e3*P/a);if(P<=-ne*h&&v)ie===0&&(this.warn(`Audio frame @ ${(J/a).toFixed(3)}s overlaps marker by ${Math.round(1e3*P/a)} ms.`),this.nextAudioTs=A=J-L,G=J);else if(P>=ne*h&&j<WN&&v){let he=Math.round(P/h);for(G=J-he*h;G<0&&he&&h;)he--,G+=h;ie===0&&(this.nextAudioTs=A=G-L),this.warn(`Injecting ${he} audio frames @ ${((G-L)/a).toFixed(3)}s due to ${Math.round(1e3*P/a)} ms gap.`);for(let ge=0;ge<he;ge++){let te=HN.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);te||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),te=ee.unit.subarray()),E.splice(ie,0,{unit:te,pts:G}),G+=h,ie++}}ee.pts=G,G+=h}}let D=null,k=null,U,C=0,_=E.length;for(;_--;)C+=E[_].unit.byteLength;for(let ne=0,ie=E.length;ne<ie;ne++){const G=E[ne],ee=G.unit;let J=G.pts;if(k!==null){const j=y[ne-1];j.duration=Math.round((J-k)/d)}else if(n&&e.segmentCodec==="aac"&&(J=A+L),D=J,C>0){C+=S;try{U=new Uint8Array(C)}catch(j){this.observer.emit(w.ERROR,w.ERROR,{type:Ie.MUX_ERROR,details:Y.REMUX_ALLOC_ERROR,fatal:!1,error:j,bytes:C,reason:`fail allocating audio mdat ${C}`});return}p||(new DataView(U.buffer).setUint32(0,C),U.set(K.types.mdat,4))}else return;U.set(ee,S);const P=ee.byteLength;S+=P,y.push(kx(!0,c,P,0)),k=J}const F=y.length;if(!F)return;const O=y[y.length-1];A=k-L,this.nextAudioTs=A+d*O.duration;const W=p?new Uint8Array(0):K.moof(e.sequenceNumber++,D/d,rt({},e,{samples:y}));e.samples=[];const z=(D-L)/a,re=this.nextAudioTs/a,ce={data1:W,data2:U,startPTS:z,endPTS:re,startDTS:z,endDTS:re,type:"audio",hasAudio:!0,hasVideo:!1,nb:F};return this.isAudioContiguous=!0,ce}}function Nn(i,e){let t;if(e===null)return i;for(e<i?t=-8589934592:t=8589934592;Math.abs(i-e)>4294967296;)i+=t;return i}function QN(i){for(let e=0;e<i.length;e++)if(i[e].key)return e;return-1}function IA(i,e,t,n){const r=i.samples.length;if(!r)return;const s=i.inputTimeScale;for(let u=0;u<r;u++){const d=i.samples[u];d.pts=Nn(d.pts-t.baseTime*s/t.timescale,e*s)/s,d.dts=Nn(d.dts-n.baseTime*s/n.timescale,e*s)/s}const a=i.samples;return i.samples=[],{samples:a}}function CA(i,e,t){const n=i.samples.length;if(!n)return;const r=i.inputTimeScale;for(let a=0;a<n;a++){const u=i.samples[a];u.pts=Nn(u.pts-t.baseTime*r/t.timescale,e*r)/r}i.samples.sort((a,u)=>a.pts-u.pts);const s=i.samples;return i.samples=[],{samples:s}}class ZN extends Jn{constructor(e,t,n,r){super("passthrough-remuxer",r),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1}destroy(){}resetTimeStamp(e){this.lastEndTime=null;const t=this.initPTS;t&&e&&t.baseTime===e.baseTime&&t.timescale===e.timescale||(this.initPTS=e)}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(e,t,n,r){this.audioCodec=t,this.videoCodec=n,this.generateInitSegment(e,r),this.emitInitSegment=!0}generateInitSegment(e,t){let{audioCodec:n,videoCodec:r}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const{audio:s,video:a}=this.initData=NT(e);if(t)U_(e,t);else{const d=s||a;d!=null&&d.encrypted&&this.warn(`Init segment with encrypted track with has no key ("${d.codec}")!`)}s&&(n=Px(s,at.AUDIO,this)),a&&(r=Px(a,at.VIDEO,this));const u={};s&&a?u.audiovideo={container:"video/mp4",codec:n+","+r,supplemental:a.supplemental,encrypted:a.encrypted,initSegment:e,id:"main"}:s?u.audio={container:"audio/mp4",codec:n,encrypted:s.encrypted,initSegment:e,id:"audio"}:a?u.video={container:"video/mp4",codec:r,supplemental:a.supplemental,encrypted:a.encrypted,initSegment:e,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=u}remux(e,t,n,r,s,a){var u,d;let{initPTS:c,lastEndTime:h}=this;const m={audio:void 0,video:void 0,text:r,id3:n,initSegment:void 0};ye(h)||(h=this.lastEndTime=s||0);const p=t.samples;if(!p.length)return m;const y={initPTS:void 0,timescale:void 0,trackId:void 0};let v=this.initData;if((u=v)!=null&&u.length||(this.generateInitSegment(p),v=this.initData),!((d=v)!=null&&d.length))return this.warn("Failed to generate initSegment."),m;this.emitInitSegment&&(y.tracks=this.initTracks,this.emitInitSegment=!1);const E=j_(p,v,this),S=v.audio?E[v.audio.id]:null,A=v.video?E[v.video.id]:null,L=Eu(A,1/0),R=Eu(S,1/0),D=Eu(A,0,!0),k=Eu(S,0,!0);let U=s,C=0;const _=S&&(!A||!c&&R<L||c&&c.trackId===v.audio.id),F=_?S:A;if(F){const G=F.timescale,ee=F.start-s*G,J=_?v.audio.id:v.video.id;U=F.start/G,C=_?k-R:D-L,(a||!c)&&(JN(c,U,s,C)||G!==c.timescale)&&(c&&this.warn(`Timestamps at playlist time: ${a?"":"~"}${s} ${ee/G} != initPTS: ${c.baseTime/c.timescale} (${c.baseTime}/${c.timescale}) trackId: ${c.trackId}`),this.log(`Found initPTS at playlist time: ${s} offset: ${U-s} (${ee}/${G}) trackId: ${J}`),c=null,y.initPTS=ee,y.timescale=G,y.trackId=J)}else this.warn(`No audio or video samples found for initPTS at playlist time: ${s}`);c?(y.initPTS=c.baseTime,y.timescale=c.timescale,y.trackId=c.trackId):((!y.timescale||y.trackId===void 0||y.initPTS===void 0)&&(this.warn("Could not set initPTS"),y.initPTS=U,y.timescale=1,y.trackId=-1),this.initPTS=c={baseTime:y.initPTS,timescale:y.timescale,trackId:y.trackId});const O=U-c.baseTime/c.timescale,W=O+C;C>0?this.lastEndTime=W:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const z=!!v.audio,re=!!v.video;let ae="";z&&(ae+="audio"),re&&(ae+="video");const ce=(v.audio?v.audio.encrypted:!1)||(v.video?v.video.encrypted:!1),ne={data1:p,startPTS:O,startDTS:O,endPTS:W,endDTS:W,type:ae,hasAudio:z,hasVideo:re,nb:1,dropped:0,encrypted:ce};m.audio=z&&!re?ne:void 0,m.video=re?ne:void 0;const ie=A==null?void 0:A.sampleCount;if(ie){const G=A.keyFrameIndex,ee=G!==-1;ne.nb=ie,ne.dropped=G===0||this.isVideoContiguous?0:ee?G:ie,ne.independent=ee,ne.firstKeyFrame=G,ee&&A.keyFrameStart&&(ne.firstKeyFramePTS=(A.keyFrameStart-c.baseTime)/c.timescale),this.isVideoContiguous||(m.independent=ee),this.isVideoContiguous||(this.isVideoContiguous=ee),ne.dropped&&this.warn(`fmp4 does not start with IDR: firstIDR ${G}/${ie} dropped: ${ne.dropped} start: ${ne.firstKeyFramePTS||"NA"}`)}return m.initSegment=y,m.id3=IA(n,s,c,c),r.samples.length&&(m.text=CA(r,s,c)),m}}function Eu(i,e,t=!1){return(i==null?void 0:i.start)!==void 0?(i.start+(t?i.duration:0))/i.timescale:e}function JN(i,e,t,n){if(i===null)return!0;const r=Math.max(n,1),s=e-i.baseTime/i.timescale;return Math.abs(s-t)>r}function Px(i,e,t){const n=i.codec;return n&&n.length>4?n:e===at.AUDIO?n==="ec-3"||n==="ac-3"||n==="alac"?n:n==="fLaC"||n==="Opus"?rc(n,!1):(t.warn(`Unhandled audio codec "${n}" in mp4 MAP`),n||"mp4a"):(t.warn(`Unhandled video codec "${n}" in mp4 MAP`),n||"avc1")}let tr;try{tr=self.performance.now.bind(self.performance)}catch{tr=Date.now}const Gu=[{demux:BN,remux:ZN},{demux:Pr,remux:Vu},{demux:MN,remux:Vu},{demux:ON,remux:Vu}];Gu.splice(2,0,{demux:NN,remux:Vu});class _x{constructor(e,t,n,r,s,a){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=n,this.id=s,this.logger=a}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,n,r){const s=n.transmuxing;s.executeStart=tr();let a=new Uint8Array(e);const{currentTransmuxState:u,transmuxConfig:d}=this;r&&(this.currentTransmuxState=r);const{contiguous:c,discontinuity:h,trackSwitch:m,accurateTimeOffset:p,timeOffset:y,initSegmentChange:v}=r||u,{audioCodec:E,videoCodec:S,defaultInitPts:A,duration:L,initSegmentData:R}=d,D=eO(a,t);if(D&&fa(D.method)){const _=this.getDecrypter(),F=np(D.method);if(_.isSync()){let O=_.softwareDecrypt(a,D.key.buffer,D.iv.buffer,F);if(n.part>-1){const z=_.flush();O=z&&z.buffer}if(!O)return s.executeEnd=tr(),Hh(n);a=new Uint8Array(O)}else return this.asyncResult=!0,this.decryptionPromise=_.webCryptoDecrypt(a,D.key.buffer,D.iv.buffer,F).then(O=>{const W=this.push(O,null,n);return this.decryptionPromise=null,W}),this.decryptionPromise}const k=this.needsProbing(h,m);if(k){const _=this.configureTransmuxer(a);if(_)return this.logger.warn(`[transmuxer] ${_.message}`),this.observer.emit(w.ERROR,w.ERROR,{type:Ie.MEDIA_ERROR,details:Y.FRAG_PARSING_ERROR,fatal:!1,error:_,reason:_.message}),s.executeEnd=tr(),Hh(n)}(h||m||v||k)&&this.resetInitSegment(R,E,S,L,t),(h||v||k)&&this.resetInitialTimestamp(A),c||this.resetContiguity();const U=this.transmux(a,D,y,p,n);this.asyncResult=Vo(U);const C=this.currentTransmuxState;return C.contiguous=!0,C.discontinuity=!1,C.trackSwitch=!1,s.executeEnd=tr(),U}flush(e){const t=e.transmuxing;t.executeStart=tr();const{decrypter:n,currentTransmuxState:r,decryptionPromise:s}=this;if(s)return this.asyncResult=!0,s.then(()=>this.flush(e));const a=[],{timeOffset:u}=r;if(n){const m=n.flush();m&&a.push(this.push(m.buffer,null,e))}const{demuxer:d,remuxer:c}=this;if(!d||!c){t.executeEnd=tr();const m=[Hh(e)];return this.asyncResult?Promise.resolve(m):m}const h=d.flush(u);return Vo(h)?(this.asyncResult=!0,h.then(m=>(this.flushRemux(a,m,e),a))):(this.flushRemux(a,h,e),this.asyncResult?Promise.resolve(a):a)}flushRemux(e,t,n){const{audioTrack:r,videoTrack:s,id3Track:a,textTrack:u}=t,{accurateTimeOffset:d,timeOffset:c}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${n.sn}${n.part>-1?" part: "+n.part:""} of ${this.id===xe.MAIN?"level":"track"} ${n.level}`);const h=this.remuxer.remux(r,s,a,u,c,d,!0,this.id);e.push({remuxResult:h,chunkMeta:n}),n.transmuxing.executeEnd=tr()}resetInitialTimestamp(e){const{demuxer:t,remuxer:n}=this;!t||!n||(t.resetTimeStamp(e),n.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,n,r,s){const{demuxer:a,remuxer:u}=this;!a||!u||(a.resetInitSegment(e,t,n,r),u.resetInitSegment(e,t,n,s))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,n,r,s){let a;return t&&t.method==="SAMPLE-AES"?a=this.transmuxSampleAes(e,t,n,r,s):a=this.transmuxUnencrypted(e,n,r,s),a}transmuxUnencrypted(e,t,n,r){const{audioTrack:s,videoTrack:a,id3Track:u,textTrack:d}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(s,a,u,d,t,n,!1,this.id),chunkMeta:r}}transmuxSampleAes(e,t,n,r,s){return this.demuxer.demuxSampleAes(e,t,n).then(a=>({remuxResult:this.remuxer.remux(a.audioTrack,a.videoTrack,a.id3Track,a.textTrack,n,r,!1,this.id),chunkMeta:s}))}configureTransmuxer(e){const{config:t,observer:n,typeSupported:r}=this;let s;for(let m=0,p=Gu.length;m<p;m++){var a;if((a=Gu[m].demux)!=null&&a.probe(e,this.logger)){s=Gu[m];break}}if(!s)return new Error("Failed to find demuxer by probing fragment data");const u=this.demuxer,d=this.remuxer,c=s.remux,h=s.demux;(!d||!(d instanceof c))&&(this.remuxer=new c(n,t,r,this.logger)),(!u||!(u instanceof h))&&(this.demuxer=new h(n,t,r,this.logger),this.probe=h.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new ep(this.config)),e}}function eO(i,e){let t=null;return i.byteLength>0&&(e==null?void 0:e.key)!=null&&e.iv!==null&&e.method!=null&&(t=e),t}const Hh=i=>({remuxResult:{},chunkMeta:i});function Vo(i){return"then"in i&&i.then instanceof Function}class tO{constructor(e,t,n,r,s){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=n,this.duration=r,this.defaultInitPts=s||null}}class nO{constructor(e,t,n,r,s,a){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=n,this.trackSwitch=r,this.timeOffset=s,this.initSegmentChange=a}}let Mx=0;class DA{constructor(e,t,n,r){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=Mx++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=d=>{const c=d.data,h=this.hls;if(!(!h||!(c!=null&&c.event)||c.instanceNo!==this.instanceNo))switch(c.event){case"init":{var m;const p=(m=this.workerContext)==null?void 0:m.objectURL;p&&self.URL.revokeObjectURL(p);break}case"transmuxComplete":{this.handleTransmuxComplete(c.data);break}case"flush":{this.onFlush(c.data);break}case"workerLog":{h.logger[c.data.logType]&&h.logger[c.data.logType](c.data.message);break}default:{c.data=c.data||{},c.data.frag=this.frag,c.data.part=this.part,c.data.id=this.id,h.trigger(c.event,c.data);break}}},this.onWorkerError=d=>{if(!this.hls)return;const c=new Error(`${d.message}  (${d.filename}:${d.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(w.ERROR,{type:Ie.OTHER_ERROR,details:Y.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:c})};const s=e.config;this.hls=e,this.id=t,this.useWorker=!!s.enableWorker,this.onTransmuxComplete=n,this.onFlush=r;const a=(d,c)=>{c=c||{},c.frag=this.frag||void 0,d===w.ERROR&&(c=c,c.parent=this.id,c.part=this.part,this.error=c.error),this.hls.trigger(d,c)};this.observer=new sp,this.observer.on(w.FRAG_DECRYPTED,a),this.observer.on(w.ERROR,a);const u=qv(s.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){const d=this.hls.logger;if(s.workerPath||aN()){try{s.workerPath?(d.log(`loading Web Worker ${s.workerPath} for "${t}"`),this.workerContext=lN(s.workerPath)):(d.log(`injecting Web Worker for "${t}"`),this.workerContext=oN());const{worker:h}=this.workerContext;h.addEventListener("message",this.onWorkerMessage),h.addEventListener("error",this.onWorkerError),h.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:u,id:t,config:ot(s)})}catch(h){d.warn(`Error setting up "${t}" Web Worker, fallback to inline`,h),this.terminateWorker(),this.error=null,this.transmuxer=new _x(this.observer,u,s,"",t,e.logger)}return}}this.transmuxer=new _x(this.observer,u,s,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=Mx++;const t=this.hls.config,n=qv(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:n,id:this.id,config:ot(t)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),uN(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,n,r,s,a,u,d,c,h){var m,p;c.transmuxing.start=self.performance.now();const{instanceNo:y,transmuxer:v}=this,E=a?a.start:s.start,S=s.decryptdata,A=this.frag,L=!(A&&s.cc===A.cc),R=!(A&&c.level===A.level),D=A?c.sn-A.sn:-1,k=this.part?c.part-this.part.index:-1,U=D===0&&c.id>1&&c.id===(A==null?void 0:A.stats.chunkCount),C=!R&&(D===1||D===0&&(k===1||U&&k<=0)),_=self.performance.now();(R||D||s.stats.parsing.start===0)&&(s.stats.parsing.start=_),a&&(k||!C)&&(a.stats.parsing.start=_);const F=!(A&&((m=s.initSegment)==null?void 0:m.url)===((p=A.initSegment)==null?void 0:p.url)),O=new nO(L,C,d,R,E,F);if(!C||L||F){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${s.type} sn: ${c.sn}${c.part>-1?" part: "+c.part:""} ${this.id===xe.MAIN?"level":"track"}: ${c.level} id: ${c.id}
        discontinuity: ${L}
        trackSwitch: ${R}
        contiguous: ${C}
        accurateTimeOffset: ${d}
        timeOffset: ${E}
        initSegmentChange: ${F}`);const W=new tO(n,r,t,u,h);this.configureTransmuxer(W)}if(this.frag=s,this.part=a,this.workerContext)this.workerContext.worker.postMessage({instanceNo:y,cmd:"demux",data:e,decryptdata:S,chunkMeta:c,state:O},e instanceof ArrayBuffer?[e]:[]);else if(v){const W=v.push(e,S,c,O);Vo(W)?W.then(z=>{this.handleTransmuxComplete(z)}).catch(z=>{this.transmuxerError(z,c,"transmuxer-interface push error")}):this.handleTransmuxComplete(W)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:t,transmuxer:n}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(n){const r=n.flush(e);Vo(r)?r.then(s=>{this.handleFlushResult(s,e)}).catch(s=>{this.transmuxerError(s,e,"transmuxer-interface flush error")}):this.handleFlushResult(r,e)}}transmuxerError(e,t,n){this.hls&&(this.error=e,this.hls.trigger(w.ERROR,{type:Ie.MEDIA_ERROR,details:Y.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:n}))}handleFlushResult(e,t){e.forEach(n=>{this.handleTransmuxComplete(n)}),this.onFlush(t)}configureTransmuxer(e){const{instanceNo:t,transmuxer:n}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):n&&n.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}const Nx=100;class iO extends rp{constructor(e,t,n){super(e,t,n,"audio-stream-controller",xe.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(w.LEVEL_LOADED,this.onLevelLoaded,this),e.on(w.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(w.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(w.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(w.BUFFER_RESET,this.onBufferReset,this),e.on(w.BUFFER_CREATED,this.onBufferCreated,this),e.on(w.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(w.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(w.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(w.FRAG_LOADING,this.onFragLoading,this),e.on(w.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off(w.LEVEL_LOADED,this.onLevelLoaded,this),e.off(w.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(w.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(w.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(w.BUFFER_RESET,this.onBufferReset,this),e.off(w.BUFFER_CREATED,this.onBufferCreated,this),e.off(w.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(w.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(w.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(w.FRAG_LOADING,this.onFragLoading,this),e.off(w.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:t,id:n,initPTS:r,timescale:s,trackId:a}){if(n===xe.MAIN){const u=t.cc,d=this.fragCurrent;if(this.initPTS[u]={baseTime:r,timescale:s,trackId:a},this.log(`InitPTS for cc: ${u} found from main: ${r/s} (${r}/${s}) trackId: ${a}`),this.mainAnchor=t,this.state===se.WAITING_INIT_PTS){const c=this.waitingData;(!c&&!this.loadingParts||c&&c.frag.cc!==u)&&this.syncWithAnchor(t,c==null?void 0:c.frag)}else!this.hls.hasEnoughToStart&&d&&d.cc!==u?(d.abortRequests(),this.syncWithAnchor(t,d)):this.state===se.IDLE&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(e,t){var n;const r=((n=this.mainFragLoading)==null?void 0:n.frag)||null;if(t&&(r==null?void 0:r.cc)===t.cc)return;const s=(r||e).cc,a=this.getLevelDetails(),u=this.getLoadPosition(),d=KT(a,s,u);d&&(this.log(`Syncing with main frag at ${d.start} cc ${d.cc}`),this.startFragRequested=!1,this.nextLoadPosition=d.start,this.resetLoadingState(),this.state===se.IDLE&&this.doTickIdle())}startLoad(e,t){if(!this.levels){this.startPosition=e,this.state=se.STOPPED;return}const n=this.lastCurrentTime;this.stopLoad(),this.setInterval(Nx),n>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${n.toFixed(3)}`),e=n,this.state=se.IDLE):this.state=se.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case se.IDLE:this.doTickIdle();break;case se.WAITING_TRACK:{const{levels:e,trackId:t}=this,n=e==null?void 0:e[t],r=n==null?void 0:n.details;if(r&&!this.waitForLive(n)){if(this.waitForCdnTuneIn(r))break;this.state=se.WAITING_INIT_PTS}break}case se.FRAG_LOADING_WAITING_RETRY:{this.checkRetryDate();break}case se.WAITING_INIT_PTS:{const e=this.waitingData;if(e){const{frag:t,part:n,cache:r,complete:s}=e,a=this.mainAnchor;if(this.initPTS[t.cc]!==void 0){this.waitingData=null,this.state=se.FRAG_LOADING;const u=r.flush().buffer,d={frag:t,part:n,payload:u,networkDetails:null};this._handleFragmentLoadProgress(d),s&&super._handleFragmentLoadComplete(d)}else a&&a.cc!==e.frag.cc&&this.syncWithAnchor(a,e.frag)}else this.state=se.IDLE}}this.onTickEnd()}resetLoadingState(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:t,levels:n,media:r,trackId:s}=this,a=t.config;if(!this.buffering||!r&&!this.primaryPrefetch&&(this.startFragRequested||!a.startFragPrefetch)||!(n!=null&&n[s]))return;const u=n[s],d=u.details;if(!d||this.waitForLive(u)||this.waitForCdnTuneIn(d)){this.state=se.WAITING_TRACK,this.startFragRequested=!1;return}const c=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&c&&(this.bufferFlushed=!1,this.afterBufferFlushed(c,at.AUDIO,xe.AUDIO));const h=this.getFwdBufferInfo(c,xe.AUDIO);if(h===null)return;if(!this.switchingTrack&&this._streamEnded(h,d)){t.trigger(w.BUFFER_EOS,{type:"audio"}),this.state=se.ENDED;return}const m=h.len,p=t.maxBufferLength,y=d.fragments,v=y[0].start,E=this.getLoadPosition(),S=this.flushing?E:h.end;if(this.switchingTrack&&r){const R=E;d.PTSKnown&&R<v&&(h.end>v||h.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),r.currentTime=v+.05)}if(m>=p&&!this.switchingTrack&&S<y[y.length-1].start)return;let A=this.getNextFragment(S,d);if(A&&this.isLoopLoading(A,S)&&(A=this.getNextFragmentLoopLoading(A,d,h,xe.MAIN,p)),!A){this.bufferFlushed=!0;return}let L=((e=this.mainFragLoading)==null?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&L&&Rt(A)&&!A.endList&&(!d.live||!this.loadingParts&&S<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(L)===Bt.OK&&(this.mainFragLoading=L=null),L&&Rt(L))){if(A.start>L.end){const D=this.fragmentTracker.getFragAtPos(S,xe.MAIN);D&&D.end>L.end&&(L=D,this.mainFragLoading={frag:D,targetBufferTime:null})}if(A.start>L.end)return}this.loadFragment(A,u,S)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(n=>new Uo(n))}onAudioTrackSwitching(e,t){const n=!!t.url;this.trackId=t.id;const{fragCurrent:r}=this;r&&(r.abortRequests(),this.removeUnbufferedFrags(r.start)),this.resetLoadingState(),n?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==se.STOPPED&&(this.setInterval(Nx),this.state=se.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;const n=this.cachedTrackLoadedData;n&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(w.AUDIO_TRACK_LOADED,n))}onAudioTrackLoaded(e,t){var n;const{levels:r}=this,{details:s,id:a,groupId:u,track:d}=t;if(!r){this.warn(`Audio tracks reset while loading track ${a} "${d.name}" of "${u}"`);return}const c=this.mainDetails;if(!c||s.endCC>c.endCC||c.expired){this.cachedTrackLoadedData=t,this.state!==se.STOPPED&&(this.state=se.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log(`Audio track ${a} "${d.name}" of "${u}" loaded [${s.startSN},${s.endSN}]${s.lastPartSn?`[part-${s.lastPartSn}-${s.lastPartIndex}]`:""},duration:${s.totalduration}`);const h=r[a];let m=0;if(s.live||(n=h.details)!=null&&n.live){if(this.checkLiveUpdate(s),s.deltaUpdateFailed)return;if(h.details){var p;m=this.alignPlaylists(s,h.details,(p=this.levelLastLoaded)==null?void 0:p.details)}s.alignedSliding||(cA(s,c),s.alignedSliding||dc(s,c),m=s.fragmentStart)}h.details=s,this.levelLastLoaded=h,this.startFragRequested||this.setStartPosition(c,m),this.hls.trigger(w.AUDIO_TRACK_UPDATED,{details:s,id:a,groupId:t.groupId}),this.state===se.WAITING_TRACK&&!this.waitForCdnTuneIn(s)&&(this.state=se.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;const n=e.frag,{part:r,payload:s}=e,{config:a,trackId:u,levels:d}=this;if(!d){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${n.sn} of level ${n.level} will not be buffered`);return}const c=d[u];if(!c){this.warn("Audio track is undefined on fragment load progress");return}const h=c.details;if(!h){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(n.start);return}const m=a.defaultAudioCodec||c.audioCodec||"mp4a.40.2";let p=this.transmuxer;p||(p=this.transmuxer=new DA(this.hls,xe.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const y=this.initPTS[n.cc],v=(t=n.initSegment)==null?void 0:t.data;if(y!==void 0){const S=r?r.index:-1,A=S!==-1,L=new tp(n.level,n.sn,n.stats.chunkCount,s.byteLength,S,A);p.push(s,v,m,"",n,r,h.totalduration,!1,L,y)}else{this.log(`Unknown video PTS for cc ${n.cc}, waiting for video PTS before demuxing audio frag ${n.sn} of [${h.startSN} ,${h.endSN}],track ${u}`);const{cache:E}=this.waitingData=this.waitingData||{frag:n,part:r,cache:new dA,complete:!1};E.push(new Uint8Array(s)),this.state!==se.STOPPED&&(this.state=se.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;const n=t.tracks.audio;n&&(this.mediaBuffer=n.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===xe.MAIN&&Rt(t.frag)&&(this.mainFragLoading=t,this.state===se.IDLE&&this.tick())}onFragBuffered(e,t){const{frag:n,part:r}=t;if(n.type!==xe.AUDIO){!this.audioOnly&&n.type===xe.MAIN&&!n.elementaryStreams.video&&!n.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(n)){this.warn(`Fragment ${n.sn}${r?" p: "+r.index:""} of level ${n.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(Rt(n)){this.fragPrevious=n;const s=this.switchingTrack;s&&(this.bufferedTrack=s,this.switchingTrack=null,this.hls.trigger(w.AUDIO_TRACK_SWITCHED,tt({},s)))}this.fragBufferedComplete(n,r),this.media&&this.tick()}onError(e,t){var n;if(t.fatal){this.state=se.ERROR;return}switch(t.details){case Y.FRAG_GAP:case Y.FRAG_PARSING_ERROR:case Y.FRAG_DECRYPT_ERROR:case Y.FRAG_LOAD_ERROR:case Y.FRAG_LOAD_TIMEOUT:case Y.KEY_LOAD_ERROR:case Y.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(xe.AUDIO,t);break;case Y.AUDIO_TRACK_LOAD_ERROR:case Y.AUDIO_TRACK_LOAD_TIMEOUT:case Y.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===se.WAITING_TRACK&&((n=t.context)==null?void 0:n.type)===ze.AUDIO_TRACK&&(this.state=se.IDLE);break;case Y.BUFFER_ADD_CODEC_ERROR:case Y.BUFFER_APPEND_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)||this.resetLoadingState();break;case Y.BUFFER_FULL_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case Y.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushing(e,{type:t}){t!==at.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==at.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===se.ENDED&&(this.state=se.IDLE);const n=this.mediaBuffer||this.media;n&&(this.afterBufferFlushed(n,t,xe.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;const n="audio",{hls:r}=this,{remuxResult:s,chunkMeta:a}=e,u=this.getCurrentContext(a);if(!u){this.resetWhenMissingContext(a);return}const{frag:d,part:c,level:h}=u,{details:m}=h,{audio:p,text:y,id3:v,initSegment:E}=s;if(this.fragContextChanged(d)||!m){this.fragmentTracker.removeFragment(d);return}if(this.state=se.PARSING,this.switchingTrack&&p&&this.completeAudioSwitch(this.switchingTrack),E!=null&&E.tracks){const S=d.initSegment||d;if(this.unhandledEncryptionError(E,d))return;this._bufferInitSegment(h,E.tracks,S,a),r.trigger(w.FRAG_PARSING_INIT_SEGMENT,{frag:S,id:n,tracks:E.tracks})}if(p){const{startPTS:S,endPTS:A,startDTS:L,endDTS:R}=p;c&&(c.elementaryStreams[at.AUDIO]={startPTS:S,endPTS:A,startDTS:L,endDTS:R}),d.setElementaryStreamInfo(at.AUDIO,S,A,L,R),this.bufferFragmentData(p,d,c,a)}if(v!=null&&(t=v.samples)!=null&&t.length){const S=rt({id:n,frag:d,details:m},v);r.trigger(w.FRAG_PARSING_METADATA,S)}if(y){const S=rt({id:n,frag:d,details:m},y);r.trigger(w.FRAG_PARSING_USERDATA,S)}}_bufferInitSegment(e,t,n,r){if(this.state!==se.PARSING||(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio))return;const s=t.audio;s.id=xe.AUDIO;const a=e.audioCodec;this.log(`Init audio buffer, container:${s.container}, codecs[level/parsed]=[${a}/${s.codec}]`),a&&a.split(",").length===1&&(s.levelCodec=a),this.hls.trigger(w.BUFFER_CODECS,t);const u=s.initSegment;if(u!=null&&u.byteLength){const d={type:"audio",frag:n,part:null,chunkMeta:r,parent:n.type,data:u};this.hls.trigger(w.BUFFER_APPENDING,d)}this.tickImmediate()}loadFragment(e,t,n){const r=this.fragmentTracker.getState(e);if(this.switchingTrack||r===Bt.NOT_LOADED||r===Bt.PARTIAL){var s;if(!Rt(e))this._loadInitSegment(e,t);else if((s=t.details)!=null&&s.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=se.WAITING_INIT_PTS;const a=this.mainDetails;a&&a.fragmentStart!==t.details.fragmentStart&&dc(t.details,a)}else super.loadFragment(e,t,n)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:n,assocLang:r,characteristics:s,audioCodec:a,channels:u}=this.bufferedTrack;xs({name:t,lang:n,assocLang:r,characteristics:s,audioCodec:a,channels:u},e,ms)||(ac(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(w.AUDIO_TRACK_SWITCHED,tt({},e))}}class hp extends Jn{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,n){const r=t==null?void 0:t.renditionReports;if(r){let s=-1;for(let a=0;a<r.length;a++){const u=r[a];let d;try{d=new self.URL(u.URI,t.url).href}catch(c){this.warn(`Could not construct new URL for Rendition Report: ${c}`),d=u.URI||""}if(d===e){s=a;break}else d===e.substring(0,d.length)&&(s=a)}if(s!==-1){const a=r[s],u=parseInt(a["LAST-MSN"])||t.lastPartSn;let d=parseInt(a["LAST-PART"])||t.lastPartIndex;if(this.hls.config.lowLatencyMode){const h=Math.min(t.age-t.partTarget,t.targetduration);d>=0&&h>t.partTarget&&(d+=1)}const c=n&&Xv(n);return new Qv(u,d>=0?d:void 0,c)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(n){this.warn(`Could not construct new URL with HLS Delivery Directives: ${n}`)}return e}playlistLoaded(e,t,n){const{details:r,stats:s}=t,a=self.performance.now(),u=s.loading.first?Math.max(0,a-s.loading.first):0;r.advancedDateTime=Date.now()-u;const d=this.hls.config.timelineOffset;if(d!==r.appliedTimelineOffset){const h=Math.max(d||0,0);r.appliedTimelineOffset=h,r.fragments.forEach(m=>{m.setStart(m.playlistOffset+h)})}if(r.live||n!=null&&n.live){const h="levelInfo"in t?t.levelInfo:t.track;if(r.reloaded(n),n&&r.fragments.length>0){qM(n,r,this);const L=r.playlistParsingError;if(L){this.warn(L);const R=this.hls;if(!R.config.ignorePlaylistParsingErrors){var c;const{networkDetails:D}=t;R.trigger(w.ERROR,{type:Ie.NETWORK_ERROR,details:Y.LEVEL_PARSING_ERROR,fatal:!1,url:r.url,error:L,reason:L.message,level:t.level||void 0,parent:(c=r.fragments[0])==null?void 0:c.type,networkDetails:D,stats:s});return}r.playlistParsingError=null}}r.requestScheduled===-1&&(r.requestScheduled=s.loading.start);const m=this.hls.mainForwardBufferInfo,p=m?m.end-m.len:0,y=(r.edge-p)*1e3,v=sA(r,y);if(r.requestScheduled+v<a?r.requestScheduled=a:r.requestScheduled+=v,this.log(`live playlist ${e} ${r.advanced?"REFRESHED "+r.lastPartSn+"-"+r.lastPartIndex:r.updated?"UPDATED":"MISSED"}`),!this.canLoad||!r.live)return;let E,S,A;if(r.canBlockReload&&r.endSN&&r.advanced){const L=this.hls.config.lowLatencyMode,R=r.lastPartSn,D=r.endSN,k=r.lastPartIndex,U=k!==-1,C=R===D;U?C?(S=D+1,A=L?0:k):(S=R,A=L?k+1:r.maxPartIndex):S=D+1;const _=r.age,F=_+r.ageHeader;let O=Math.min(F-r.partTarget,r.targetduration*1.5);if(O>0){if(F>r.targetduration*3)this.log(`Playlist last advanced ${_.toFixed(2)}s ago. Omitting segment and part directives.`),S=void 0,A=void 0;else if(n!=null&&n.tuneInGoal&&F-r.partTarget>n.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${n.tuneInGoal} to: ${O} with playlist age: ${r.age}`),O=0;else{const W=Math.floor(O/r.targetduration);if(S+=W,A!==void 0){const z=Math.round(O%r.targetduration/r.partTarget);A+=z}this.log(`CDN Tune-in age: ${r.ageHeader}s last advanced ${_.toFixed(2)}s goal: ${O} skip sn ${W} to part ${A}`)}r.tuneInGoal=O}if(E=this.getDeliveryDirectives(r,t.deliveryDirectives,S,A),L||!C){r.requestScheduled=a,this.loadingPlaylist(h,E);return}}else(r.canBlockReload||r.canSkipUntil)&&(E=this.getDeliveryDirectives(r,t.deliveryDirectives,S,A));E&&S!==void 0&&r.canBlockReload&&(r.requestScheduled=s.loading.first+Math.max(v-u*2,v/2)),this.scheduleLoading(h,E,r)}else this.clearTimer()}scheduleLoading(e,t,n){const r=n||e.details;if(!r){this.loadingPlaylist(e,t);return}const s=self.performance.now(),a=r.requestScheduled;if(s>=a){this.loadingPlaylist(e,t);return}const u=a-s;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(u)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,t),u)}getDeliveryDirectives(e,t,n,r){let s=Xv(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(n=t.msn,r=t.part,s=$u.No),new Qv(n,r,s)}checkRetry(e){const t=e.details,n=oc(e),r=e.errorAction,{action:s,retryCount:a=0,retryConfig:u}=r||{},d=!!r&&!!u&&(s===Yt.RetryRequest||!r.resolved&&s===Yt.SendAlternateToPenaltyBox);if(d){var c;if(a>=u.maxNumRetry)return!1;if(n&&(c=e.context)!=null&&c.deliveryDirectives)this.warn(`Retrying playlist loading ${a+1}/${u.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const h=Jm(u,a);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),h),this.warn(`Retrying playlist loading ${a+1}/${u.maxNumRetry} after "${t}" in ${h}ms`)}e.levelRetry=!0,r.resolved=!0}return d}}function kA(i,e){if(i.length!==e.length)return!1;for(let t=0;t<i.length;t++)if(!Go(i[t].attrs,e[t].attrs))return!1;return!0}function Go(i,e,t){const n=i["STABLE-RENDITION-ID"];return n&&!t?n===e["STABLE-RENDITION-ID"]:!(t||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(r=>i[r]!==e[r])}function Wf(i,e){return e.label.toLowerCase()===i.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(i.lang||"").toLowerCase())}class rO extends hp{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(w.MANIFEST_LOADING,this.onManifestLoading,this),e.on(w.MANIFEST_PARSED,this.onManifestParsed,this),e.on(w.LEVEL_LOADING,this.onLevelLoading,this),e.on(w.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(w.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(w.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(w.MANIFEST_LOADING,this.onManifestLoading,this),e.off(w.MANIFEST_PARSED,this.onManifestParsed,this),e.off(w.LEVEL_LOADING,this.onLevelLoading,this),e.off(w.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(w.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(w.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:n,groupId:r,details:s}=t,a=this.tracksInGroup[n];if(!a||a.groupId!==r){this.warn(`Audio track with id:${n} and group:${r} not found in active group ${a==null?void 0:a.groupId}`);return}const u=a.details;a.details=t.details,this.log(`Audio track ${n} "${a.name}" lang:${a.lang} group:${r} loaded [${s.startSN}-${s.endSN}]`),n===this.trackId&&this.playlistLoaded(n,t,u)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const n=t.audioGroups||null,r=this.groupIds;let s=this.currentTrack;if(!n||(r==null?void 0:r.length)!==(n==null?void 0:n.length)||n!=null&&n.some(u=>(r==null?void 0:r.indexOf(u))===-1)){this.groupIds=n,this.trackId=-1,this.currentTrack=null;const u=this.tracks.filter(p=>!n||n.indexOf(p.groupId)!==-1);if(u.length)this.selectDefaultTrack&&!u.some(p=>p.default)&&(this.selectDefaultTrack=!1),u.forEach((p,y)=>{p.id=y});else if(!s&&!this.tracksInGroup.length)return;this.tracksInGroup=u;const d=this.hls.config.audioPreference;if(!s&&d){const p=ki(d,u,ms);if(p>-1)s=u[p];else{const y=ki(d,this.tracks);s=this.tracks[y]}}let c=this.findTrackId(s);c===-1&&s&&(c=this.findTrackId(null));const h={audioTracks:u};this.log(`Updating audio tracks, ${u.length} track(s) found in group(s): ${n==null?void 0:n.join(",")}`),this.hls.trigger(w.AUDIO_TRACKS_UPDATED,h);const m=this.trackId;if(c!==-1&&m===-1)this.setAudioTrack(c);else if(u.length&&m===-1){var a;const p=new Error(`No audio track selected for current audio group-ID(s): ${(a=this.groupIds)==null?void 0:a.join(",")} track count: ${u.length}`);this.warn(p.message),this.hls.trigger(w.ERROR,{type:Ie.MEDIA_ERROR,details:Y.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:p})}}}onError(e,t){t.fatal||!t.context||t.context.type===ze.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const n=this.allAudioTracks;if(this.selectDefaultTrack=!1,n.length){const r=this.currentTrack;if(r&&xs(e,r,ms))return r;const s=ki(e,this.tracksInGroup,ms);if(s>-1){const a=this.tracksInGroup[s];return this.setAudioTrack(s),a}else if(r){let a=t.loadLevel;a===-1&&(a=t.firstAutoLevel);const u=gM(e,t.levels,n,a,ms);if(u===-1)return null;t.nextLoadLevel=u}if(e.channels||e.audioCodec){const a=ki(e,n);if(a>-1)return n[a]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length){this.warn(`Invalid audio track id: ${e}`);return}this.selectDefaultTrack=!1;const n=this.currentTrack,r=t[e],s=r.details&&!r.details.live;if(e===this.trackId&&r===n&&s||(this.log(`Switching to audio-track ${e} "${r.name}" lang:${r.lang} group:${r.groupId} channels:${r.channels}`),this.trackId=e,this.currentTrack=r,this.hls.trigger(w.AUDIO_TRACK_SWITCHING,tt({},r)),s))return;const a=this.switchParams(r.url,n==null?void 0:n.details,r.details);this.loadPlaylist(a)}findTrackId(e){const t=this.tracksInGroup;for(let n=0;n<t.length;n++){const r=t[n];if(!(this.selectDefaultTrack&&!r.default)&&(!e||xs(e,r,ms)))return n}if(e){const{name:n,lang:r,assocLang:s,characteristics:a,audioCodec:u,channels:d}=e;for(let c=0;c<t.length;c++){const h=t[c];if(xs({name:n,lang:r,assocLang:s,characteristics:a,audioCodec:u,channels:d},h,ms))return c}for(let c=0;c<t.length;c++){const h=t[c];if(Go(e.attrs,h.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return c}for(let c=0;c<t.length;c++){const h=t[c];if(Go(e.attrs,h.attrs,["LANGUAGE"]))return c}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;this.shouldLoadPlaylist(t)&&ac(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const n=e.id,r=e.groupId,s=this.getUrlWithDirectives(e.url,t),a=e.details,u=a==null?void 0:a.age;this.log(`Loading audio-track ${n} "${e.name}" lang:${e.lang} group:${r}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${u&&a.live?" age "+u.toFixed(1)+(a.type&&" "+a.type||""):""} ${s}`),this.hls.trigger(w.AUDIO_TRACK_LOADING,{url:s,id:n,groupId:r,deliveryDirectives:t||null,track:e})}}class sO{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,n){if(this.queues===null||this.tracks===null)return;const r=this.queues[t];r.push(e),r.length===1&&!n&&this.executeNext(t)}appendBlocker(e){return new Promise(t=>{const n={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(n,e)})}prependBlocker(e){return new Promise(t=>{if(this.queues){const n={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(n)}})}removeBlockers(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var t;const n=(t=e[0])==null?void 0:t.label;(n==="async-blocker"||n==="async-blocker-prepend")&&(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(this.queues===null)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(this.queues===null||this.tracks===null)return;const t=this.queues[e];if(t.length){const r=t[0];try{r.execute()}catch(s){var n;if(r.onError(s),this.queues===null||this.tracks===null)return;const a=(n=this.tracks[e])==null?void 0:n.buffer;a!=null&&a.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues!==null&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return((t=this.queues)==null?void 0:t[e][0])||null}toString(){const{queues:e,tracks:t}=this;return e===null||t===null?"<destroyed>":`
${this.list("video")}
${this.list("audio")}
${this.list("audiovideo")}}`}list(e){var t,n;return(t=this.queues)!=null&&t[e]||(n=this.tracks)!=null&&n[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var t;const n=(t=this.tracks)==null?void 0:t[e],r=n==null?void 0:n.buffer;return r?`SourceBuffer${r.updating?" updating":""}${n.ended?" ended":""}${n.ending?" ending":""}`:"none"}listOps(e){var t;return((t=this.queues)==null?void 0:t[e].map(n=>n.label).join(", "))||""}}const Ox=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,PA="HlsJsTrackRemovedError";class aO extends Error{constructor(e){super(e),this.name=PA}}class oO extends Jn{constructor(e,t){super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=n=>{var r;this.hls&&((r=this.mediaSource)==null?void 0:r.readyState)==="open"&&this.hls.pauseBuffering()},this._onStartStreaming=n=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=n=>{const{media:r,mediaSource:s}=this;n&&this.log("Media source opened"),!(!r||!s)&&(s.removeEventListener("sourceopen",this._onMediaSourceOpen),r.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(w.MEDIA_ATTACHED,{media:r,mediaSource:s}),this.mediaSource!==null&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:n,_objectUrl:r}=this;n!==r&&this.error(`Media element src was set while attaching MediaSource (${r} > ${n})`)},this.hls=e,this.fragmentTracker=t,this.appendSource=C_(Ur(e.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(w.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(w.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(w.MANIFEST_LOADING,this.onManifestLoading,this),e.on(w.MANIFEST_PARSED,this.onManifestParsed,this),e.on(w.BUFFER_RESET,this.onBufferReset,this),e.on(w.BUFFER_APPENDING,this.onBufferAppending,this),e.on(w.BUFFER_CODECS,this.onBufferCodecs,this),e.on(w.BUFFER_EOS,this.onBufferEos,this),e.on(w.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(w.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(w.FRAG_PARSED,this.onFragParsed,this),e.on(w.FRAG_CHANGED,this.onFragChanged,this),e.on(w.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(w.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(w.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(w.MANIFEST_LOADING,this.onManifestLoading,this),e.off(w.MANIFEST_PARSED,this.onManifestParsed,this),e.off(w.BUFFER_RESET,this.onBufferReset,this),e.off(w.BUFFER_APPENDING,this.onBufferAppending,this),e.off(w.BUFFER_CODECS,this.onBufferCodecs,this),e.off(w.BUFFER_EOS,this.onBufferEos,this),e.off(w.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(w.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(w.FRAG_PARSED,this.onFragParsed,this),e.off(w.FRAG_CHANGED,this.onFragChanged,this),e.off(w.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:t}=this;if(!e)return null;const n={};if(this.operationQueue){const s=this.isUpdating();s||this.operationQueue.removeBlockers();const a=this.isQueued();(s||a)&&this.warn(`Transfering MediaSource with${a?" operations in queue":""}${s?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const r=this.transferData;return!this.sourceBufferCount&&r&&r.mediaSource===t?rt(n,r.tracks):this.sourceBuffers.forEach(s=>{const[a]=s;a&&(n[a]=rt({},this.tracks[a]),this.removeBuffer(a)),s[0]=s[1]=null}),{media:e,mediaSource:t,tracks:n}}initTracks(){const e={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=e,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var n;let r=2;(t.audio&&!t.video||!t.altAudio)&&(r=1),this.bufferCodecEventsTotal=r,this.log(`${r} bufferCodec event(s) expected.`),(n=this.transferData)!=null&&n.mediaSource&&this.sourceBufferCount&&r&&this.bufferCreated()}onMediaAttaching(e,t){const n=this.media=t.media;this.transferData=this.overrides=void 0;const r=Ur(this.appendSource);if(r){const s=!!t.mediaSource;(s||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);const a=this.mediaSource=t.mediaSource||new r;if(this.assignMediaSource(a),s)this._objectUrl=n.src,this.attachTransferred();else{const u=this._objectUrl=self.URL.createObjectURL(a);if(this.appendSource)try{n.removeAttribute("src");const d=self.ManagedMediaSource;n.disableRemotePlayback=n.disableRemotePlayback||d&&a instanceof d,Fx(n),lO(n,u),n.load()}catch{n.src=u}else n.src=u}n.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,n;this.log(`${((t=this.transferData)==null?void 0:t.mediaSource)===e?"transferred":"created"} media source: ${(n=e.constructor)==null?void 0:n.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,t=this.transferData;if(!t||!e)return;const n=this.tracks,r=t.tracks,s=r?Object.keys(r):null,a=s?s.length:0,u=()=>{Promise.resolve().then(()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()})};if(r&&s&&a){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})
required tracks: ${ot(n,(d,c)=>d==="initSegment"?void 0:c)};
transfer tracks: ${ot(r,(d,c)=>d==="initSegment"?void 0:c)}}`),!IT(r,n)){t.mediaSource=null,t.tracks=void 0;const d=e.currentTime,c=this.details,h=Math.max(d,(c==null?void 0:c.fragments[0].start)||0);if(h-d>1){this.log(`attachTransferred: waiting for playback to reach new tracks start time ${d} -> ${h}`);return}this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(r)}"->"${Object.keys(n)}") start time: ${h} currentTime: ${d}`),this.onMediaDetaching(w.MEDIA_DETACHING,{}),this.onMediaAttaching(w.MEDIA_ATTACHING,t),e.currentTime=h;return}this.transferData=void 0,s.forEach(d=>{const c=d,h=r[c];if(h){const m=h.buffer;if(m){const p=this.fragmentTracker,y=h.id;if(p.hasFragments(y)||p.hasParts(y)){const S=Ue.getBuffered(m);p.detectEvictedFragments(c,S,y,null,!0)}const v=zh(c),E=[c,m];this.sourceBuffers[v]=E,m.updating&&this.operationQueue&&this.operationQueue.prependBlocker(c),this.trackSourceBuffer(c,h)}}}),u(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),u()}get mediaSourceOpenOrEnded(){var e;const t=(e=this.mediaSource)==null?void 0:e.readyState;return t==="open"||t==="ended"}onMediaDetaching(e,t){const n=!!t.transferMedia;this.transferData=this.overrides=void 0;const{media:r,mediaSource:s,_objectUrl:a}=this;if(s){if(this.log(`media source ${n?"transferring":"detaching"}`),n)this.sourceBuffers.forEach(([u])=>{u&&this.removeBuffer(u)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const u=s.readyState==="open";try{const d=s.sourceBuffers;for(let c=d.length;c--;)u&&d[c].abort(),s.removeSourceBuffer(d[c]);u&&s.endOfStream()}catch(d){this.warn(`onMediaDetaching: ${d.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}s.removeEventListener("sourceopen",this._onMediaSourceOpen),s.removeEventListener("sourceended",this._onMediaSourceEnded),s.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(s.removeEventListener("startstreaming",this._onStartStreaming),s.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}r&&(r.removeEventListener("emptied",this._onMediaEmptied),n||(a&&self.URL.revokeObjectURL(a),this.mediaSrc===a?(r.removeAttribute("src"),this.appendSource&&Fx(r),r.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(w.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach(([e])=>{e&&this.resetBuffer(e)}),this.initTracks()}resetBuffer(e){var t;const n=(t=this.tracks[e])==null?void 0:t.buffer;if(this.removeBuffer(e),n)try{var r;(r=this.mediaSource)!=null&&r.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(n)}catch(s){this.warn(`onBufferReset ${e}`,s)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[zh(e)]=[null,null];const t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new sO(this.tracks)}onBufferCodecs(e,t){var n;const r=this.tracks,s=Object.keys(t);this.log(`BUFFER_CODECS: "${s}" (current SB count ${this.sourceBufferCount})`);const a="audiovideo"in t&&(r.audio||r.video)||r.audiovideo&&("audio"in t||"video"in t),u=!a&&this.sourceBufferCount&&this.media&&s.some(d=>!r[d]);if(a||u){this.warn(`Unsupported transition between "${Object.keys(r)}" and "${s}" SourceBuffers`);return}s.forEach(d=>{var c,h;const m=t[d],{id:p,codec:y,levelCodec:v,container:E,metadata:S,supplemental:A}=m;let L=r[d];const R=(c=this.transferData)==null||(c=c.tracks)==null?void 0:c[d],D=R!=null&&R.buffer?R:L,k=(D==null?void 0:D.pendingCodec)||(D==null?void 0:D.codec),U=D==null?void 0:D.levelCodec;L||(L=r[d]={buffer:void 0,listeners:[],codec:y,supplemental:A,container:E,levelCodec:v,metadata:S,id:p});const C=Uu(k,U),_=C==null?void 0:C.replace(Ox,"$1");let F=Uu(y,v);const O=(h=F)==null?void 0:h.replace(Ox,"$1");F&&C&&_!==O&&(d.slice(0,5)==="audio"&&(F=rc(F,this.appendSource)),this.log(`switching codec ${k} to ${F}`),F!==(L.pendingCodec||L.codec)&&(L.pendingCodec=F),L.container=E,this.appendChangeType(d,E,F))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&(this.bufferCodecEventsTotal>1&&!this.tracks.video&&!t.video&&((n=t.audio)==null?void 0:n.id)==="main"&&(this.log("Main audio-only"),this.bufferCodecEventsTotal=1),this.mediaSourceOpenOrEnded&&this.checkPendingTracks())}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,t)=>{const n=this.tracks[t];return e[t]={id:n.id,container:n.container,codec:n.codec,levelCodec:n.levelCodec},e},{})}appendChangeType(e,t,n){const r=`${t};codecs=${n}`,s={label:`change-type=${r}`,execute:()=>{const a=this.tracks[e];if(a){const u=a.buffer;u!=null&&u.changeType&&(this.log(`changing ${e} sourceBuffer type to ${r}`),u.changeType(r),a.codec=n,a.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:a=>{this.warn(`Failed to change ${e} SourceBuffer type`,a)}};this.append(s,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;const n=e.start,r=n+e.duration*.05;if(((t=this.fragmentTracker.getAppendedFrag(n,xe.MAIN))==null?void 0:t.gap)===!0)return;const a={label:"block-audio",execute:()=>{var u;const d=this.tracks.video;(this.lastVideoAppendEnd>r||d!=null&&d.buffer&&Ue.isBuffered(d.buffer,r)||((u=this.fragmentTracker.getAppendedFrag(r,xe.MAIN))==null?void 0:u.gap)===!0)&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:u=>{this.warn("Error executing block-audio operation",u)}};this.blockedAudioAppend={op:a,frag:e},this.append(a,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){const{tracks:n}=this,{data:r,type:s,parent:a,frag:u,part:d,chunkMeta:c,offset:h}=t,m=c.buffering[s],{sn:p,cc:y}=u,v=self.performance.now();m.start=v;const E=u.stats.buffering,S=d?d.stats.buffering:null;E.start===0&&(E.start=v),S&&S.start===0&&(S.start=v);const A=n.audio;let L=!1;s==="audio"&&(A==null?void 0:A.container)==="audio/mpeg"&&(L=!this.lastMpegAudioChunk||c.id===1||this.lastMpegAudioChunk.sn!==c.sn,this.lastMpegAudioChunk=c);const R=n.video,D=R==null?void 0:R.buffer;if(D&&p!=="initSegment"){const C=d||u,_=this.blockedAudioAppend;if(s==="audio"&&a!=="main"&&!this.blockedAudioAppend&&!(R.ending||R.ended)){const O=C.start+C.duration*.05,W=D.buffered,z=this.currentOp("video");!W.length&&!z?this.blockAudio(C):!z&&!Ue.isBuffered(D,O)&&this.lastVideoAppendEnd<O&&this.blockAudio(C)}else if(s==="video"){const F=C.end;if(_){const O=_.frag.start;(F>O||F<this.lastVideoAppendEnd||Ue.isBuffered(D,O))&&this.unblockAudio()}this.lastVideoAppendEnd=F}}const k=(d||u).start,U={label:`append-${s}`,execute:()=>{var C;m.executeStart=self.performance.now();const _=(C=this.tracks[s])==null?void 0:C.buffer;_&&(L?this.updateTimestampOffset(_,k,.1,s,p,y):h!==void 0&&ye(h)&&this.updateTimestampOffset(_,h,1e-6,s,p,y)),this.appendExecutor(r,s)},onStart:()=>{},onComplete:()=>{const C=self.performance.now();m.executeEnd=m.end=C,E.first===0&&(E.first=C),S&&S.first===0&&(S.first=C);const _={};this.sourceBuffers.forEach(([F,O])=>{F&&(_[F]=Ue.getBuffered(O))}),this.appendErrors[s]=0,s==="audio"||s==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(w.BUFFER_APPENDED,{type:s,frag:u,part:d,chunkMeta:c,parent:u.type,timeRanges:_})},onError:C=>{var _;const F={type:Ie.MEDIA_ERROR,parent:u.type,details:Y.BUFFER_APPEND_ERROR,sourceBufferName:s,frag:u,part:d,chunkMeta:c,error:C,err:C,fatal:!1},O=(_=this.media)==null?void 0:_.error;if(C.code===DOMException.QUOTA_EXCEEDED_ERR||C.name=="QuotaExceededError"||"quota"in C)F.details=Y.BUFFER_FULL_ERROR;else if(C.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!O)F.errorAction=ha(!0);else if(C.name===PA&&this.sourceBufferCount===0)F.errorAction=ha(!0);else{const W=++this.appendErrors[s];this.warn(`Failed ${W}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${s}" sourceBuffer (${O||"no media error"})`),(W>=this.hls.config.appendErrorMaxRetry||O)&&(F.fatal=!0)}this.hls.trigger(w.ERROR,F)}};this.log(`queuing "${s}" append sn: ${p}${d?" p: "+d.index:""} of ${u.type===xe.MAIN?"level":"track"} ${u.level} cc: ${y}`),this.append(U,s,this.isPending(this.tracks[s]))}getFlushOp(e,t,n){return this.log(`queuing "${e}" remove ${t}-${n}`),{label:"remove",execute:()=>{this.removeExecutor(e,t,n)},onStart:()=>{},onComplete:()=>{this.hls.trigger(w.BUFFER_FLUSHED,{type:e})},onError:r=>{this.warn(`Failed to remove ${t}-${n} from "${e}" SourceBuffer`,r)}}}onBufferFlushing(e,t){const{type:n,startOffset:r,endOffset:s}=t;n?this.append(this.getFlushOp(n,r,s),n):this.sourceBuffers.forEach(([a])=>{a&&this.append(this.getFlushOp(a,r,s),a)})}onFragParsed(e,t){const{frag:n,part:r}=t,s=[],a=r?r.elementaryStreams:n.elementaryStreams;a[at.AUDIOVIDEO]?s.push("audiovideo"):(a[at.AUDIO]&&s.push("audio"),a[at.VIDEO]&&s.push("video"));const u=()=>{const d=self.performance.now();n.stats.buffering.end=d,r&&(r.stats.buffering.end=d);const c=r?r.stats:n.stats;this.hls.trigger(w.FRAG_BUFFERED,{frag:n,part:r,stats:c,id:n.type})};s.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${n.type} level: ${n.level} sn: ${n.sn}`),this.blockBuffers(u,s).catch(d=>{this.warn(`Fragment buffered callback ${d}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{if(e){const t=this.tracks[e];if(t)return!t.ended||t.ending}return!1})}onBufferEos(e,t){var n;this.sourceBuffers.forEach(([a])=>{if(a){const u=this.tracks[a];(!t.type||t.type===a)&&(u.ending=!0,u.ended||(u.ended=!0,this.log(`${a} buffer reached EOS`)))}});const r=((n=this.overrides)==null?void 0:n.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(([a])=>{var u;return a&&!((u=this.tracks[a])!=null&&u.ended)})?r?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:a}=this;if(!a||a.readyState!=="open"){a&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${a.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),a.endOfStream(),this.hls.trigger(w.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(w.BUFFERED_TO_END,void 0)):t.type==="video"&&this.unblockAudio()}tracksEnded(){this.sourceBuffers.forEach(([e])=>{if(e!==null){const t=this.tracks[e];t&&(t.ending=!1)}})}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.updateDuration())}updateDuration(){this.blockUntilOpen(()=>{const e=this.getDurationAndRange();e&&this.updateMediaSource(e)})}onError(e,t){if(t.details===Y.BUFFER_APPEND_ERROR&&t.frag){var n;const r=(n=t.errorAction)==null?void 0:n.nextAutoLevel;ye(r)&&r!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:t,media:n}=this;if(!n||t===null||!this.sourceBufferCount)return;const r=e.config,s=n.currentTime,a=t.levelTargetDuration,u=t.live&&r.liveBackBufferLength!==null?r.liveBackBufferLength:r.backBufferLength;if(ye(u)&&u>=0){const c=Math.max(u,a),h=Math.floor(s/a)*a-c;this.flushBackBuffer(s,a,h)}const d=r.frontBufferFlushThreshold;if(ye(d)&&d>0){const c=Math.max(r.maxBufferLength,d),h=Math.max(c,a),m=Math.floor(s/a)*a+h;this.flushFrontBuffer(s,a,m)}}flushBackBuffer(e,t,n){this.sourceBuffers.forEach(([r,s])=>{if(s){const u=Ue.getBuffered(s);if(u.length>0&&n>u.start(0)){var a;this.hls.trigger(w.BACK_BUFFER_REACHED,{bufferEnd:n});const d=this.tracks[r];if((a=this.details)!=null&&a.live)this.hls.trigger(w.LIVE_BACK_BUFFER_REACHED,{bufferEnd:n});else if(d!=null&&d.ended){this.log(`Cannot flush ${r} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(w.BUFFER_FLUSHING,{startOffset:0,endOffset:n,type:r})}}})}flushFrontBuffer(e,t,n){this.sourceBuffers.forEach(([r,s])=>{if(s){const a=Ue.getBuffered(s),u=a.length;if(u<2)return;const d=a.start(u-1),c=a.end(u-1);if(n>d||e>=d&&e<=c)return;this.hls.trigger(w.BUFFER_FLUSHING,{startOffset:d,endOffset:1/0,type:r})}})}getDurationAndRange(){var e;const{details:t,mediaSource:n}=this;if(!t||!this.media||(n==null?void 0:n.readyState)!=="open")return null;const r=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&n.setLiveSeekableRange){const c=Math.max(0,t.fragmentStart),h=Math.max(c,r);return{duration:1/0,start:c,end:h}}return{duration:1/0}}const s=(e=this.overrides)==null?void 0:e.duration;if(s)return ye(s)?{duration:s}:null;const a=this.media.duration,u=ye(n.duration)?n.duration:0;return r>u&&r>a||!ye(a)?{duration:r}:null}updateMediaSource({duration:e,start:t,end:n}){const r=this.mediaSource;!this.media||!r||r.readyState!=="open"||(r.duration!==e&&(ye(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),r.duration=e),t!==void 0&&n!==void 0&&(this.log(`MediaSource duration is set to ${r.duration}. Setting seekable range to ${t}-${n}.`),r.setLiveSeekableRange(t,n)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:n}=this;if(this.log(`checkPendingTracks (pending: ${t} codec events expected: ${e}) ${ot(n)}`),this.tracksReady){var r;const s=(r=this.transferData)==null?void 0:r.tracks;s&&Object.keys(s).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach(([t,n])=>{if(t){const r=this.tracks[t];e[t]={buffer:n,container:r.container,codec:r.codec,supplemental:r.supplemental,levelCodec:r.levelCodec,id:r.id,metadata:r.metadata}}}),this.hls.trigger(w.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([t])=>{this.executeNext(t)})}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(w.ERROR,{type:Ie.MEDIA_ERROR,details:Y.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:t,mediaSource:n}=this;if(!n)throw new Error("createSourceBuffers called when mediaSource was null");for(const s in e){const a=s,u=e[a];if(this.isPending(u)){const d=this.getTrackCodec(u,a),c=`${u.container};codecs=${d}`;u.codec=d,this.log(`creating sourceBuffer(${c})${this.currentOp(a)?" Queued":""} ${ot(u)}`);try{const h=n.addSourceBuffer(c),m=zh(a),p=[a,h];t[m]=p,u.buffer=h}catch(h){var r;this.error(`error while trying to add sourceBuffer: ${h.message}`),this.shiftAndExecuteNext(a),(r=this.operationQueue)==null||r.removeBlockers(),delete this.tracks[a],this.hls.trigger(w.ERROR,{type:Ie.MEDIA_ERROR,details:Y.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:h,sourceBufferName:a,mimeType:c,parent:u.id});return}this.trackSourceBuffer(a,u)}}this.bufferCreated()}getTrackCodec(e,t){const n=e.supplemental;let r=e.codec;n&&(t==="video"||t==="audiovideo")&&Fo(n,"video")&&(r=Q_(r,n));const s=Uu(r,e.levelCodec);return s?t.slice(0,5)==="audio"?rc(s,this.appendSource):s:""}trackSourceBuffer(e,t){const n=t.buffer;if(!n)return;const r=this.getTrackCodec(t,e);this.tracks[e]={buffer:n,codec:r,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(s,a)=>{const u=a.removedRanges;u!=null&&u.length&&this.hls.trigger(w.BUFFER_FLUSHED,{type:s})})}get mediaSrc(){var e,t;const n=((e=this.media)==null||(t=e.querySelector)==null?void 0:t.call(e,"source"))||this.media;return n==null?void 0:n.src}onSBUpdateStart(e){const t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}const n=this.currentOp(e);n&&(n.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var n;const r=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(n=this.mediaSource)==null?void 0:n.readyState}`);this.error(`${r}`,t),this.hls.trigger(w.ERROR,{type:Ie.MEDIA_ERROR,details:Y.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:r,fatal:!1});const s=this.currentOp(e);s&&s.onError(r)}updateTimestampOffset(e,t,n,r,s,a){const u=t-e.timestampOffset;Math.abs(u)>=n&&(this.log(`Updating ${r} SourceBuffer timestampOffset to ${t} (sn: ${s} cc: ${a})`),e.timestampOffset=t)}removeExecutor(e,t,n){const{media:r,mediaSource:s}=this,a=this.tracks[e],u=a==null?void 0:a.buffer;if(!r||!s||!u){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),this.shiftAndExecuteNext(e);return}const d=ye(r.duration)?r.duration:1/0,c=ye(s.duration)?s.duration:1/0,h=Math.max(0,t),m=Math.min(n,d,c);m>h&&(!a.ending||a.ended)?(a.ended=!1,this.log(`Removing [${h},${m}] from the ${e} SourceBuffer`),u.remove(h,m)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){const n=this.tracks[t],r=n==null?void 0:n.buffer;if(!r)throw new aO(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);n.ending=!1,n.ended=!1,r.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(t=>{this.warn(`SourceBuffer blocked callback ${t}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(t){this.warn(`Callback run without blocking ${this.operationQueue} ${t}`)}}isUpdating(){return this.sourceBuffers.some(([e,t])=>e&&t.updating)}isQueued(){return this.sourceBuffers.some(([e])=>e&&!!this.currentOp(e))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,t=this.sourceBufferTypes){if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:n}=this,r=t.map(a=>this.appendBlocker(a));return t.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(r).then(a=>{n===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(t=>{var n;const r=(n=this.tracks[t])==null?void 0:n.buffer;!r||r.updating||this.shiftAndExecuteNext(t)})}append(e,t,n){this.operationQueue&&this.operationQueue.append(e,t,n)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,t)=>e+(this.isPending(this.tracks[t])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,[t])=>e+(t?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([e])=>e).filter(e=>!!e)}addBufferListener(e,t,n){const r=this.tracks[e];if(!r)return;const s=r.buffer;if(!s)return;const a=n.bind(this,e);r.listeners.push({event:t,listener:a}),s.addEventListener(t,a)}removeBufferListeners(e){const t=this.tracks[e];if(!t)return;const n=t.buffer;n&&(t.listeners.forEach(r=>{n.removeEventListener(r.event,r.listener)}),t.listeners.length=0)}}function Fx(i){const e=i.querySelectorAll("source");[].slice.call(e).forEach(t=>{i.removeChild(t)})}function lO(i,e){const t=self.document.createElement("source");t.type="video/mp4",t.src=e,i.appendChild(t)}function zh(i){return i==="audio"?1:0}class fp{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(w.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(w.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(w.MANIFEST_PARSED,this.onManifestParsed,this),e.on(w.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(w.BUFFER_CODECS,this.onBufferCodecs,this),e.on(w.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(w.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(w.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(w.MANIFEST_PARSED,this.onManifestParsed,this),e.off(w.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(w.BUFFER_CODECS,this.onBufferCodecs,this),e.off(w.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const n=this.hls.levels[t.droppedLevel];this.isLevelAllowed(n)&&this.restrictedLevels.push({bitrate:n.bitrate,height:n.height,width:n.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const n=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,n.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&ye(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const e=this.hls.levels;if(e.length){const t=this.hls,n=this.getMaxLevel(e.length-1);n!==this.autoLevelCapping&&t.logger.log(`Setting autoLevelCapping to ${n}: ${e[n].height}p@${e[n].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=n,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const n=t.filter((r,s)=>this.isLevelAllowed(r)&&s<=e);return this.clientRect=null,fp.getMaxLevelByMediaSize(n,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const n=e.getBoundingClientRect();t.width=n.width,t.height=n.height,!t.width&&!t.height&&(t.width=n.right-n.left||e.width||0,t.height=n.bottom-n.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(n=>e.bitrate===n.bitrate&&e.width===n.width&&e.height===n.height)}static getMaxLevelByMediaSize(e,t,n){if(!(e!=null&&e.length))return-1;const r=(u,d)=>d?u.width!==d.width||u.height!==d.height:!0;let s=e.length-1;const a=Math.max(t,n);for(let u=0;u<e.length;u+=1){const d=e[u];if((d.width>=a||d.height>=a)&&r(d,e[u+1])){s=u;break}}return s}}const uO={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},wn=uO,cO={HLS:"h"},dO=cO;class Fi{constructor(e,t){Array.isArray(e)&&(e=e.map(n=>n instanceof Fi?n:new Fi(n))),this.value=e,this.params=t}}const hO="Dict";function fO(i){return Array.isArray(i)?JSON.stringify(i):i instanceof Map?"Map{}":i instanceof Set?"Set{}":typeof i=="object"?JSON.stringify(i):String(i)}function mO(i,e,t,n){return new Error(`failed to ${i} "${fO(e)}" as ${t}`,{cause:n})}function Bi(i,e,t){return mO("serialize",i,e,t)}class _A{constructor(e){this.description=e}}const Bx="Bare Item",pO="Boolean";function gO(i){if(typeof i!="boolean")throw Bi(i,pO);return i?"?1":"?0"}function yO(i){return btoa(String.fromCharCode(...i))}const vO="Byte Sequence";function xO(i){if(ArrayBuffer.isView(i)===!1)throw Bi(i,vO);return`:${yO(i)}:`}const EO="Integer";function SO(i){return i<-999999999999999||999999999999999<i}function MA(i){if(SO(i))throw Bi(i,EO);return i.toString()}function TO(i){return`@${MA(i.getTime()/1e3)}`}function NA(i,e){if(i<0)return-NA(-i,e);const t=Math.pow(10,e);if(Math.abs(i*t%1-.5)<Number.EPSILON){const r=Math.floor(i*t);return(r%2===0?r:r+1)/t}else return Math.round(i*t)/t}const AO="Decimal";function wO(i){const e=NA(i,3);if(Math.floor(Math.abs(e)).toString().length>12)throw Bi(i,AO);const t=e.toString();return t.includes(".")?t:`${t}.0`}const LO="String",RO=/[\x00-\x1f\x7f]+/;function bO(i){if(RO.test(i))throw Bi(i,LO);return`"${i.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function IO(i){return i.description||i.toString().slice(7,-1)}const CO="Token";function Ux(i){const e=IO(i);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw Bi(e,CO);return e}function Yf(i){switch(typeof i){case"number":if(!ye(i))throw Bi(i,Bx);return Number.isInteger(i)?MA(i):wO(i);case"string":return bO(i);case"symbol":return Ux(i);case"boolean":return gO(i);case"object":if(i instanceof Date)return TO(i);if(i instanceof Uint8Array)return xO(i);if(i instanceof _A)return Ux(i);default:throw Bi(i,Bx)}}const DO="Key";function qf(i){if(/^[a-z*][a-z0-9\-_.*]*$/.test(i)===!1)throw Bi(i,DO);return i}function mp(i){return i==null?"":Object.entries(i).map(([e,t])=>t===!0?`;${qf(e)}`:`;${qf(e)}=${Yf(t)}`).join("")}function OA(i){return i instanceof Fi?`${Yf(i.value)}${mp(i.params)}`:Yf(i)}function kO(i){return`(${i.value.map(OA).join(" ")})${mp(i.params)}`}function PO(i,e={whitespace:!0}){if(typeof i!="object"||i==null)throw Bi(i,hO);const t=i instanceof Map?i.entries():Object.entries(i),n=e!=null&&e.whitespace?" ":"";return Array.from(t).map(([r,s])=>{s instanceof Fi||(s=new Fi(s));let a=qf(r);return s.value===!0?a+=mp(s.params):(a+="=",Array.isArray(s.value)?a+=kO(s):a+=OA(s)),a}).join(`,${n}`)}function FA(i,e){return PO(i,e)}const bi="CMCD-Object",St="CMCD-Request",ds="CMCD-Session",Ir="CMCD-Status",_O={br:bi,ab:bi,d:bi,ot:bi,tb:bi,tpb:bi,lb:bi,tab:bi,lab:bi,url:bi,pb:St,bl:St,tbl:St,dl:St,ltc:St,mtp:St,nor:St,nrr:St,rc:St,sn:St,sta:St,su:St,ttfb:St,ttfbb:St,ttlb:St,cmsdd:St,cmsds:St,smrt:St,df:St,cs:St,ts:St,cid:ds,pr:ds,sf:ds,sid:ds,st:ds,v:ds,msd:ds,bs:Ir,bsd:Ir,cdn:Ir,rtp:Ir,bg:Ir,pt:Ir,ec:Ir,e:Ir},MO={REQUEST:St};function NO(i){return Object.keys(i).reduce((e,t)=>{var n;return(n=i[t])===null||n===void 0||n.forEach(r=>e[r]=t),e},{})}function OO(i,e){const t={};if(!i)return t;const n=Object.keys(i),r=e?NO(e):{};return n.reduce((s,a)=>{var u;const d=_O[a]||r[a]||MO.REQUEST,c=(u=s[d])!==null&&u!==void 0?u:s[d]={};return c[a]=i[a],s},t)}function FO(i){return["ot","sf","st","e","sta"].includes(i)}function BO(i){return typeof i=="number"?ye(i):i!=null&&i!==""&&i!==!1}const BA="event";function UO(i,e){const t=new URL(i),n=new URL(e);if(t.origin!==n.origin)return i;const r=t.pathname.split("/").slice(1),s=n.pathname.split("/").slice(1,-1);for(;r[0]===s[0];)r.shift(),s.shift();for(;s.length;)s.shift(),r.unshift("..");return r.join("/")+t.search+t.hash}const Hu=i=>Math.round(i),Xf=(i,e)=>Array.isArray(i)?i.map(t=>Xf(t,e)):i instanceof Fi&&typeof i.value=="string"?new Fi(Xf(i.value,e),i.params):(e.baseUrl&&(i=UO(i,e.baseUrl)),e.version===1?encodeURIComponent(i):i),Su=i=>Hu(i/100)*100,$O=(i,e)=>{let t=i;return e.version>=2&&(i instanceof Fi&&typeof i.value=="string"?t=new Fi([i]):typeof i=="string"&&(t=[i])),Xf(t,e)},jO={br:Hu,d:Hu,bl:Su,dl:Su,mtp:Su,nor:$O,rtp:Su,tb:Hu},UA="request",$A="response",pp=["ab","bg","bl","br","bs","bsd","cdn","cid","cs","df","ec","lab","lb","ltc","msd","mtp","pb","pr","pt","sf","sid","sn","st","sta","tab","tb","tbl","tpb","ts","v"],VO=["e"],GO=/^[a-zA-Z0-9-.]+-[a-zA-Z0-9-.]+$/;function Tc(i){return GO.test(i)}function HO(i){return pp.includes(i)||VO.includes(i)||Tc(i)}const jA=["d","dl","nor","ot","rtp","su"];function zO(i){return pp.includes(i)||jA.includes(i)||Tc(i)}const KO=["cmsdd","cmsds","rc","smrt","ttfb","ttfbb","ttlb","url"];function WO(i){return pp.includes(i)||jA.includes(i)||KO.includes(i)||Tc(i)}const YO=["bl","br","bs","cid","d","dl","mtp","nor","nrr","ot","pr","rtp","sf","sid","st","su","tb","v"];function qO(i){return YO.includes(i)||Tc(i)}const XO={[$A]:WO,[BA]:HO,[UA]:zO};function VA(i,e={}){const t={};if(i==null||typeof i!="object")return t;const n=e.version||i.v||1,r=e.reportingMode||UA,s=n===1?qO:XO[r];let a=Object.keys(i).filter(s);const u=e.filter;typeof u=="function"&&(a=a.filter(u));const d=r===$A||r===BA;d&&!a.includes("ts")&&a.push("ts"),n>1&&!a.includes("v")&&a.push("v");const c=rt({},jO,e.formatters),h={version:n,reportingMode:r,baseUrl:e.baseUrl};return a.sort().forEach(m=>{let p=i[m];const y=c[m];if(typeof y=="function"&&(p=y(p,h)),m==="v"){if(n===1)return;p=n}m=="pr"&&p===1||(d&&m==="ts"&&!ye(p)&&(p=Date.now()),BO(p)&&(FO(m)&&typeof p=="string"&&(p=new _A(p)),t[m]=p))}),t}function QO(i,e={}){const t={};if(!i)return t;const n=VA(i,e),r=OO(n,e==null?void 0:e.customHeaderMap);return Object.entries(r).reduce((s,[a,u])=>{const d=FA(u,{whitespace:!1});return d&&(s[a]=d),s},t)}function ZO(i,e,t){return rt(i,QO(e,t))}const JO="CMCD";function eF(i,e={}){return i?FA(VA(i,e),{whitespace:!1}):""}function tF(i,e={}){if(!i)return"";const t=eF(i,e);return encodeURIComponent(t)}function nF(i,e={}){if(!i)return"";const t=tF(i,e);return`${JO}=${t}`}const $x=/CMCD=[^&#]+/;function iF(i,e,t){const n=nF(e,t);if(!n)return i;if($x.test(i))return i.replace($x,n);const r=i.includes("?")?"&":"?";return`${i}${r}${n}`}class rF{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=r=>{try{this.apply(r,{ot:wn.MANIFEST,su:!this.initialized})}catch(s){this.hls.logger.warn("Could not generate manifest CMCD data.",s)}},this.applyFragmentData=r=>{try{const{frag:s,part:a}=r,u=this.hls.levels[s.level],d=this.getObjectType(s),c={d:(a||s).duration*1e3,ot:d};(d===wn.VIDEO||d===wn.AUDIO||d==wn.MUXED)&&(c.br=u.bitrate/1e3,c.tb=this.getTopBandwidth(d)/1e3,c.bl=this.getBufferLength(d));const h=a?this.getNextPart(a):this.getNextFrag(s);h!=null&&h.url&&h.url!==s.url&&(c.nor=h.url),this.apply(r,c)}catch(s){this.hls.logger.warn("Could not generate segment CMCD data.",s)}},this.hls=e;const t=this.config=e.config,{cmcd:n}=t;n!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=n.sessionId||e.sessionId,this.cid=n.contentId,this.useHeaders=n.useHeaders===!0,this.includeKeys=n.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(w.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(w.MEDIA_DETACHED,this.onMediaDetached,this),e.on(w.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(w.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(w.MEDIA_DETACHED,this.onMediaDetached,this),e.off(w.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var n,r;this.audioBuffer=(n=t.tracks.audio)==null?void 0:n.buffer,this.videoBuffer=(r=t.tracks.video)==null?void 0:r.buffer}createData(){var e;return{v:1,sf:dO.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){rt(t,this.createData());const n=t.ot===wn.INIT||t.ot===wn.VIDEO||t.ot===wn.MUXED;this.starved&&n&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering);const{includeKeys:r}=this;r&&(t=Object.keys(t).reduce((a,u)=>(r.includes(u)&&(a[u]=t[u]),a),{}));const s={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),ZO(e.headers,t,s)):e.url=iF(e.url,t,s)}getNextFrag(e){var t;const n=(t=this.hls.levels[e.level])==null?void 0:t.details;if(n){const r=e.sn-n.startSN;return n.fragments[r+1]}}getNextPart(e){var t;const{index:n,fragment:r}=e,s=(t=this.hls.levels[r.level])==null||(t=t.details)==null?void 0:t.partList;if(s){const{sn:a}=r;for(let u=s.length-1;u>=0;u--){const d=s[u];if(d.index===n&&d.fragment.sn===a)return s[u+1]}}}getObjectType(e){const{type:t}=e;if(t==="subtitle")return wn.TIMED_TEXT;if(e.sn==="initSegment")return wn.INIT;if(t==="audio")return wn.AUDIO;if(t==="main")return this.hls.audioTracks.length?wn.VIDEO:wn.MUXED}getTopBandwidth(e){let t=0,n;const r=this.hls;if(e===wn.AUDIO)n=r.audioTracks;else{const s=r.maxAutoLevel,a=s>-1?s+1:r.levels.length;n=r.levels.slice(0,a)}return n.forEach(s=>{s.bitrate>t&&(t=s.bitrate)}),t>0?t:NaN}getBufferLength(e){const t=this.media,n=e===wn.AUDIO?this.audioBuffer:this.videoBuffer;return!n||!t?NaN:Ue.bufferInfo(n,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,n=e||this.config.loader;return class{constructor(s){this.loader=void 0,this.loader=new n(s)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(s,a,u){t(s),this.loader.load(s,a,u)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,n=e||this.config.loader;return class{constructor(s){this.loader=void 0,this.loader=new n(s)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(s,a,u){t(s),this.loader.load(s,a,u)}}}}const sF=3e5;class aF extends Jn{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(w.MANIFEST_LOADING,this.onManifestLoading,this),e.on(w.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(w.MANIFEST_PARSED,this.onManifestParsed,this),e.on(w.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(w.MANIFEST_LOADING,this.onManifestLoading,this),e.off(w.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(w.MANIFEST_PARSED,this.onManifestParsed,this),e.off(w.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,t)=>(e.indexOf(t.pathwayId)===-1&&e.push(t.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(n=>n!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:n}=t;n!==null&&(this.pathwayId=n.pathwayId,this.uri=n.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:n}=t;if((n==null?void 0:n.action)===Yt.SendAlternateToPenaltyBox&&n.flags===Mn.MoveAllAlternatesMatchingHost){const r=this.levels;let s=this._pathwayPriority,a=this.pathwayId;if(t.context){const{groupId:u,pathwayId:d,type:c}=t.context;u&&r?a=this.getPathwayForGroupId(u,c,a):d&&(a=d)}a in this.penalizedPathways||(this.penalizedPathways[a]=performance.now()),!s&&r&&(s=this.pathways()),s&&s.length>1&&(this.updatePathwayPriority(s),n.resolved=this.pathwayId!==a),t.details===Y.BUFFER_APPEND_ERROR&&!t.fatal?n.resolved=!0:n.resolved||this.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${a} levels: ${r&&r.length} priorities: ${ot(s)} penalized: ${ot(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){const n=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${n}"`),t=this.getLevelsForPathway(n),this.pathwayId=n}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this._pathwayPriority=e;let t;const n=this.penalizedPathways,r=performance.now();Object.keys(n).forEach(s=>{r-n[s]>sF&&delete n[s]});for(let s=0;s<e.length;s++){const a=e[s];if(a in n)continue;if(a===this.pathwayId)return;const u=this.hls.nextLoadLevel,d=this.hls.levels[u];if(t=this.getLevelsForPathway(a),t.length>0){this.log(`Setting Pathway to "${a}"`),this.pathwayId=a,lA(t),this.hls.trigger(w.LEVELS_UPDATED,{levels:t});const c=this.hls.levels[u];d&&c&&this.levels&&(c.attrs["STABLE-VARIANT-ID"]!==d.attrs["STABLE-VARIANT-ID"]&&c.bitrate!==d.bitrate&&this.log(`Unstable Pathways change from bitrate ${d.bitrate} to ${c.bitrate}`),this.hls.nextLoadLevel=u);break}}}getPathwayForGroupId(e,t,n){const r=this.getLevelsForPathway(n).concat(this.levels||[]);for(let s=0;s<r.length;s++)if(t===ze.AUDIO_TRACK&&r[s].hasAudioGroup(e)||t===ze.SUBTITLE_TRACK&&r[s].hasSubtitleGroup(e))return r[s].pathwayId;return n}clonePathways(e){const t=this.levels;if(!t)return;const n={},r={};e.forEach(s=>{const{ID:a,"BASE-ID":u,"URI-REPLACEMENT":d}=s;if(t.some(h=>h.pathwayId===a))return;const c=this.getLevelsForPathway(u).map(h=>{const m=new gt(h.attrs);m["PATHWAY-ID"]=a;const p=m.AUDIO&&`${m.AUDIO}_clone_${a}`,y=m.SUBTITLES&&`${m.SUBTITLES}_clone_${a}`;p&&(n[m.AUDIO]=p,m.AUDIO=p),y&&(r[m.SUBTITLES]=y,m.SUBTITLES=y);const v=GA(h.uri,m["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",d),E=new Uo({attrs:m,audioCodec:h.audioCodec,bitrate:h.bitrate,height:h.height,name:h.name,url:v,videoCodec:h.videoCodec,width:h.width});if(h.audioGroups)for(let S=1;S<h.audioGroups.length;S++)E.addGroupId("audio",`${h.audioGroups[S]}_clone_${a}`);if(h.subtitleGroups)for(let S=1;S<h.subtitleGroups.length;S++)E.addGroupId("text",`${h.subtitleGroups[S]}_clone_${a}`);return E});t.push(...c),jx(this.audioTracks,n,d,a),jx(this.subtitleTracks,r,d,a)})}loadSteeringManifest(e){const t=this.hls.config,n=t.loader;this.loader&&this.loader.destroy(),this.loader=new n(t);let r;try{r=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(r.protocol!=="data:"){const h=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;r.searchParams.set("_HLS_pathway",this.pathwayId),r.searchParams.set("_HLS_throughput",""+h)}const s={responseType:"json",url:r.href},a=t.steeringManifestLoadPolicy.default,u=a.errorRetry||a.timeoutRetry||{},d={loadPolicy:a,timeout:a.maxLoadTimeMs,maxRetry:u.maxNumRetry||0,retryDelay:u.retryDelayMs||0,maxRetryDelay:u.maxRetryDelayMs||0},c={onSuccess:(h,m,p,y)=>{this.log(`Loaded steering manifest: "${r}"`);const v=h.data;if((v==null?void 0:v.VERSION)!==1){this.log(`Steering VERSION ${v.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=v.TTL;const{"RELOAD-URI":E,"PATHWAY-CLONES":S,"PATHWAY-PRIORITY":A}=v;if(E)try{this.uri=new self.URL(E,r).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${E}`);return}this.scheduleRefresh(this.uri||p.url),S&&this.clonePathways(S);const L={steeringManifest:v,url:r.toString()};this.hls.trigger(w.STEERING_MANIFEST_LOADED,L),A&&this.updatePathwayPriority(A)},onError:(h,m,p,y)=>{if(this.log(`Error loading steering manifest: ${h.code} ${h.text} (${m.url})`),this.stopLoad(),h.code===410){this.enabled=!1,this.log(`Steering manifest ${m.url} no longer available`);return}let v=this.timeToLoad*1e3;if(h.code===429){const E=this.loader;if(typeof(E==null?void 0:E.getResponseHeader)=="function"){const S=E.getResponseHeader("Retry-After");S&&(v=parseFloat(S)*1e3)}this.log(`Steering manifest ${m.url} rate limited`);return}this.scheduleRefresh(this.uri||m.url,v)},onTimeout:(h,m,p)=>{this.log(`Timeout loading steering manifest (${m.url})`),this.scheduleRefresh(this.uri||m.url)}};this.log(`Requesting steering manifest: ${r}`),this.loader.load(s,d,c)}scheduleRefresh(e,t=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var n;const r=(n=this.hls)==null?void 0:n.media;if(r&&!r.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},t)}}function jx(i,e,t,n){i&&Object.keys(e).forEach(r=>{const s=i.filter(a=>a.groupId===r).map(a=>{const u=rt({},a);return u.details=void 0,u.attrs=new gt(u.attrs),u.url=u.attrs.URI=GA(a.url,a.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),u.groupId=u.attrs["GROUP-ID"]=e[r],u.attrs["PATHWAY-ID"]=n,u});i.push(...s)})}function GA(i,e,t,n){const{HOST:r,PARAMS:s,[t]:a}=n;let u;e&&(u=a==null?void 0:a[e],u&&(i=u));const d=new self.URL(i);return r&&!u&&(d.host=r),s&&Object.keys(s).sort().forEach(c=>{c&&d.searchParams.set(c,s[c])}),d.href}class ma extends Jn{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.mediaResolved=void 0,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=ma.CDMCleanupPromise?[ma.CDMCleanupPromise]:[],this.bannedKeyIds={},this.onMediaEncrypted=t=>{const{initDataType:n,initData:r}=t,s=`"${t.type}" event: init data type: "${n}"`;if(this.debug(s),r!==null){if(!this.keyFormatPromise){let a=Object.keys(this.keySystemAccessPromises);a.length||(a=vo(this.config));const u=a.map(Fh).filter(d=>!!d);this.keyFormatPromise=this.getKeyFormatPromise(u)}this.keyFormatPromise.then(a=>{const u=ju(a);if(n!=="sinf"||u!==yt.FAIRPLAY){this.log(`Ignoring "${t.type}" event with init data type: "${n}" for selected key-system ${u}`);return}let d;try{const y=Ft(new Uint8Array(r)),v=ip(JSON.parse(y).sinf),E=FT(v);if(!E)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");d=new Uint8Array(E.subarray(8,24))}catch(y){this.warn(`${s} Failed to parse sinf: ${y}`);return}const c=qt(d),{keyIdToKeySessionPromise:h,mediaKeySessions:m}=this;let p=h[c];for(let y=0;y<m.length;y++){const v=m[y],E=v.decryptdata;if(!E.keyId)continue;const S=qt(E.keyId);if(uc(d,E.keyId)||E.uri.replace(/-/g,"").indexOf(c)!==-1){if(p=h[S],!p)continue;if(E.pssh)break;delete h[S],E.pssh=new Uint8Array(r),E.keyId=d,p=h[c]=p.then(()=>this.generateRequestWithPreferredKeySession(v,n,r,"encrypted-event-key-match")),p.catch(A=>this.handleError(A));break}}p||this.handleError(new Error(`Key ID ${c} not encountered in playlist. Key-system sessions ${m.length}.`))}).catch(a=>this.handleError(a))}},this.onWaitingForKey=t=>{this.log(`"${t.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(w.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(w.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(w.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(w.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(w.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(w.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(w.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(w.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(w.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(w.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:n}=this.config,r=t==null?void 0:t[e];if(r)return r.licenseUrl;if(e===yt.WIDEVINE&&n)return n}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(t===void 0)throw new Error(`no license server URL configured for key-system "${e}"`);return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,n=t==null?void 0:t[e];if(n)return n.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,n=(a,u,d)=>!!a&&d.indexOf(a)===u,r=t.map(a=>a.audioCodec).filter(n),s=t.map(a=>a.videoCodec).filter(n);return r.length+s.length===0&&s.push("avc1.42e01e"),new Promise((a,u)=>{const d=c=>{const h=c.shift();this.getMediaKeysPromise(h,r,s).then(m=>a({keySystem:h,mediaKeys:m})).catch(m=>{c.length?d(c):m instanceof _n?u(m):u(new _n({type:Ie.KEY_SYSTEM_ERROR,details:Y.KEY_SYSTEM_NO_ACCESS,error:m,fatal:!0},m.message))})};d(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:n}=this.config;if(typeof n!="function"){let r=`Configured requestMediaKeySystemAccess is not a function ${n}`;return eA===null&&self.location.protocol==="http:"&&(r=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(r))}return n(e,t)}getMediaKeysPromise(e,t,n){var r;const s=$M(e,t,n,this.config.drmSystemOptions||{});let a=this.keySystemAccessPromises[e],u=(r=a)==null?void 0:r.keySystemAccess;if(!u){this.log(`Requesting encrypted media "${e}" key-system access with config: ${ot(s)}`),u=this.requestMediaKeySystemAccess(e,s);const d=a=this.keySystemAccessPromises[e]={keySystemAccess:u};return u.catch(c=>{this.log(`Failed to obtain access to key-system "${e}": ${c}`)}),u.then(c=>{this.log(`Access for key-system "${c.keySystem}" obtained`);const h=this.fetchServerCertificate(e);this.log(`Create media-keys for "${e}"`);const m=d.mediaKeys=c.createMediaKeys().then(p=>(this.log(`Media-keys created for "${e}"`),d.hasMediaKeys=!0,h.then(y=>y?this.setMediaKeysServerCertificate(p,e,y):p)));return m.catch(p=>{this.error(`Failed to create media-keys for "${e}"}: ${p}`)}),m})}return u.then(()=>a.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:n}){this.log(`Creating key-system session "${t}" keyId: ${qt(e.keyId||[])} keyUri: ${e.uri}`);const r=n.createSession(),s={decryptdata:e,keySystem:t,mediaKeys:n,mediaKeysSession:r,keyStatus:"status-pending"};return this.mediaKeySessions.push(s),s}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const n=this.createMediaKeySessionContext(e),r=Tu(t),s="cenc";this.keyIdToKeySessionPromise[r]=this.generateRequestWithPreferredKeySession(n,s,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}updateKeySession(e,t){const n=e.mediaKeysSession;return this.log(`Updating key-session "${n.sessionId}" for keyId ${qt(e.decryptdata.keyId||[])}
      } (data length: ${t.byteLength})`),n.update(t)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(e=>({keySystem:e,hasMediaKeys:this.keySystemAccessPromises[e].hasMediaKeys})).filter(({hasMediaKeys:e})=>!!e).map(({keySystem:e})=>Fh(e)).filter(e=>!!e)}getKeySystemAccess(e){return this.getKeySystemSelectionPromise(e).then(({keySystem:t,mediaKeys:n})=>this.attemptSetMediaKeys(t,n))}selectKeySystem(e){return new Promise((t,n)=>{this.getKeySystemSelectionPromise(e).then(({keySystem:r})=>{const s=Fh(r);s?t(s):n(new Error(`Unable to find format for key-system "${r}"`))}).catch(n)})}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){const t=vo(this.config),n=e.map(ju).filter(r=>!!r&&t.indexOf(r)!==-1);return this.selectKeySystem(n)}getKeyStatus(e){const{mediaKeySessions:t}=this;for(let n=0;n<t.length;n++){const r=oF(e,t[n]);if(r)return r}}loadKey(e){const t=e.keyInfo.decryptdata,n=Tu(t),r=this.bannedKeyIds[n];if(r||this.getKeyStatus(t)==="internal-error"){const u=Vx(r||"internal-error",t);return this.handleError(u,e.frag),Promise.reject(u)}const s=`(keyId: ${n} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${s}`);const a=this.keyIdToKeySessionPromise[n];if(!a){const u=this.getKeySystemForKeyPromise(t).then(({keySystem:d,mediaKeys:c})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${s}`),this.attemptSetMediaKeys(d,c).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:d,mediaKeys:c,decryptdata:t}))))).then(d=>{const c="cenc",h=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(d,c,h,"playlist-key")});return u.catch(d=>this.handleError(d,e.frag)),this.keyIdToKeySessionPromise[n]=u,u}return a.catch(u=>{if(u instanceof _n){const d=tt({},u.data);this.getKeyStatus(t)==="internal-error"&&(d.decryptdata=t);const c=new _n(d,u.message);this.handleError(c,e.frag)}}),a}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e,t){if(this.hls)if(e instanceof _n){t&&(e.data.frag=t);const n=e.data.decryptdata;this.error(`${e.message}${n?` (${qt(n.keyId||[])})`:""}`),this.hls.trigger(w.ERROR,e.data)}else this.error(e.message),this.hls.trigger(w.ERROR,{type:Ie.KEY_SYSTEM_ERROR,details:Y.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0})}getKeySystemForKeyPromise(e){const t=Tu(e),n=this.keyIdToKeySessionPromise[t];if(!n){const r=ju(e.keyFormat),s=r?[r]:vo(this.config);return this.attemptKeySystemAccess(s)}return n}getKeySystemSelectionPromise(e){if(e.length||(e=vo(this.config)),e.length===0)throw new _n({type:Ie.KEY_SYSTEM_ERROR,details:Y.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${ot({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){if(this.mediaResolved=void 0,this.mediaKeys===t)return Promise.resolve();const n=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const r=Promise.all(n).then(()=>this.media?this.media.setMediaKeys(t):new Promise((s,a)=>{this.mediaResolved=()=>{if(this.mediaResolved=void 0,!this.media)return a(new Error("Attempted to set mediaKeys without media element attached"));this.mediaKeys=t,this.media.setMediaKeys(t).then(s).catch(a)}}));return this.mediaKeys=t,this.setMediaKeysQueue.push(r),r.then(()=>{this.log(`Media-keys set for "${e}"`),n.push(r),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(s=>n.indexOf(s)===-1)})}generateRequestWithPreferredKeySession(e,t,n,r){var s;const a=(s=this.config.drmSystems)==null||(s=s[e.keySystem])==null?void 0:s.generateRequest;if(a)try{const v=a.call(this.hls,t,n,e);if(!v)throw new Error("Invalid response from configured generateRequest filter");t=v.initDataType,n=v.initData?v.initData:null,e.decryptdata.pssh=n?new Uint8Array(n):null}catch(v){if(this.warn(v.message),this.hls&&this.hls.config.debug)throw v}if(n===null)return this.log(`Skipping key-session request for "${r}" (no initData)`),Promise.resolve(e);const u=Tu(e.decryptdata),d=e.decryptdata.uri;this.log(`Generating key-session request for "${r}" keyId: ${u} URI: ${d} (init data type: ${t} length: ${n.byteLength})`);const c=new sp,h=e._onmessage=v=>{const E=e.mediaKeysSession;if(!E){c.emit("error",new Error("invalid state"));return}const{messageType:S,message:A}=v;this.log(`"${S}" message event for session "${E.sessionId}" message size: ${A.byteLength}`),S==="license-request"||S==="license-renewal"?this.renewLicense(e,A).catch(L=>{c.eventNames().length?c.emit("error",L):this.handleError(L)}):S==="license-release"?e.keySystem===yt.FAIRPLAY&&this.updateKeySession(e,Vf("acknowledged")).then(()=>this.removeSession(e)).catch(L=>this.handleError(L)):this.warn(`unhandled media key message type "${S}"`)},m=(v,E)=>{E.keyStatus=v;let S;v.startsWith("usable")?c.emit("resolved"):v==="internal-error"||v==="output-restricted"||v==="output-downscaled"?S=Vx(v,E.decryptdata):v==="expired"?S=new Error(`key expired (keyId: ${u})`):v==="released"?S=new Error("key released"):v==="status-pending"||this.warn(`unhandled key status change "${v}" (keyId: ${u})`),S&&(c.eventNames().length?c.emit("error",S):this.handleError(S))},p=e._onkeystatuseschange=v=>{if(!e.mediaKeysSession){c.emit("error",new Error("invalid state"));return}const S=this.getKeyStatuses(e);if(!Object.keys(S).some(D=>S[D]!=="status-pending"))return;if(S[u]==="expired"){this.log(`Expired key ${ot(S)} in key-session "${e.mediaKeysSession.sessionId}"`),this.renewKeySession(e);return}let L=S[u];if(L)m(L,e);else{var R;e.keyStatusTimeouts||(e.keyStatusTimeouts={}),(R=e.keyStatusTimeouts)[u]||(R[u]=self.setTimeout(()=>{if(!e.mediaKeysSession||!this.mediaKeys)return;const k=this.getKeyStatus(e.decryptdata);if(k&&k!=="status-pending")return this.log(`No status for keyId ${u} in key-session "${e.mediaKeysSession.sessionId}". Using session key-status ${k} from other session.`),m(k,e);this.log(`key status for ${u} in key-session "${e.mediaKeysSession.sessionId}" timed out after 1000ms`),L="internal-error",m(L,e)},1e3)),this.log(`No status for keyId ${u} (${ot(S)}).`)}};mn(e.mediaKeysSession,"message",h),mn(e.mediaKeysSession,"keystatuseschange",p);const y=new Promise((v,E)=>{c.on("error",E),c.on("resolved",v)});return e.mediaKeysSession.generateRequest(t,n).then(()=>{this.log(`Request generated for key-session "${e.mediaKeysSession.sessionId}" keyId: ${u} URI: ${d}`)}).catch(v=>{throw new _n({type:Ie.KEY_SYSTEM_ERROR,details:Y.KEY_SYSTEM_NO_SESSION,error:v,decryptdata:e.decryptdata,fatal:!1},`Error generating key-session request: ${v}`)}).then(()=>y).catch(v=>(c.removeAllListeners(),this.removeSession(e).then(()=>{throw v}))).then(()=>(c.removeAllListeners(),e))}getKeyStatuses(e){const t={};return e.mediaKeysSession.keyStatuses.forEach((n,r)=>{if(typeof r=="string"&&typeof n=="object"){const u=r;r=n,n=u}const s="buffer"in r?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):new Uint8Array(r);if(e.keySystem===yt.PLAYREADY&&s.length===16){const u=qt(s);t[u]=n,ZT(s)}const a=qt(s);n==="internal-error"&&(this.bannedKeyIds[a]=n),this.log(`key status change "${n}" for keyStatuses keyId: ${a} key-session "${e.mediaKeysSession.sessionId}"`),t[a]=n}),t}fetchServerCertificate(e){const t=this.config,n=t.loader,r=new n(t),s=this.getServerCertificateUrl(e);return s?(this.log(`Fetching server certificate for "${e}"`),new Promise((a,u)=>{const d={responseType:"arraybuffer",url:s},c=t.certLoadPolicy.default,h={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},m={onSuccess:(p,y,v,E)=>{a(p.data)},onError:(p,y,v,E)=>{u(new _n({type:Ie.KEY_SYSTEM_ERROR,details:Y.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:v,response:tt({url:d.url,data:void 0},p)},`"${e}" certificate request failed (${s}). Status: ${p.code} (${p.text})`))},onTimeout:(p,y,v)=>{u(new _n({type:Ie.KEY_SYSTEM_ERROR,details:Y.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:v,response:{url:d.url,data:void 0}},`"${e}" certificate request timed out (${s})`))},onAbort:(p,y,v)=>{u(new Error("aborted"))}};r.load(d,h,m)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,n){return new Promise((r,s)=>{e.setServerCertificate(n).then(a=>{this.log(`setServerCertificate ${a?"success":"not supported by CDM"} (${n.byteLength}) on "${t}"`),r(e)}).catch(a=>{s(new _n({type:Ie.KEY_SYSTEM_ERROR,details:Y.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:a,fatal:!0},a.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(n=>this.updateKeySession(e,new Uint8Array(n)).catch(r=>{throw new _n({type:Ie.KEY_SYSTEM_ERROR,details:Y.KEY_SYSTEM_SESSION_UPDATE_FAILED,decryptdata:e.decryptdata,error:r,fatal:!1},r.message)}))}unpackPlayReadyKeyMessage(e,t){const n=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!n.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const r=new DOMParser().parseFromString(n,"application/xml"),s=r.querySelectorAll("HttpHeader");if(s.length>0){let h;for(let m=0,p=s.length;m<p;m++){var a,u;h=s[m];const y=(a=h.querySelector("name"))==null?void 0:a.textContent,v=(u=h.querySelector("value"))==null?void 0:u.textContent;y&&v&&e.setRequestHeader(y,v)}}const d=r.querySelector("Challenge"),c=d==null?void 0:d.textContent;if(!c)throw new Error("Cannot find <Challenge> in key message");return Vf(atob(c))}setupLicenseXHR(e,t,n,r){const s=this.config.licenseXhrSetup;return s?Promise.resolve().then(()=>{if(!n.decryptdata)throw new Error("Key removed");return s.call(this.hls,e,t,n,r)}).catch(a=>{if(!n.decryptdata)throw a;return e.open("POST",t,!0),s.call(this.hls,e,t,n,r)}).then(a=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:a||r})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:r}))}requestLicense(e,t){const n=this.config.keyLoadPolicy.default;return new Promise((r,s)=>{const a=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${a}`);const u=new XMLHttpRequest;u.responseType="arraybuffer",u.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return s(new Error("invalid state"));if(u.readyState===4)if(u.status===200){this._requestLicenseFailureCount=0;let d=u.response;this.log(`License received ${d instanceof ArrayBuffer?d.byteLength:d}`);const c=this.config.licenseResponseCallback;if(c)try{d=c.call(this.hls,u,a,e)}catch(h){this.error(h)}r(d)}else{const d=n.errorRetry,c=d?d.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>c||u.status>=400&&u.status<500)s(new _n({type:Ie.KEY_SYSTEM_ERROR,details:Y.KEY_SYSTEM_LICENSE_REQUEST_FAILED,decryptdata:e.decryptdata,fatal:!0,networkDetails:u,response:{url:a,data:void 0,code:u.status,text:u.statusText}},`License Request XHR failed (${a}). Status: ${u.status} (${u.statusText})`));else{const h=c-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${h} attempts left`),this.requestLicense(e,t).then(r,s)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=u,this.setupLicenseXHR(u,a,e,t).then(({xhr:d,licenseChallenge:c})=>{e.keySystem==yt.PLAYREADY&&(c=this.unpackPlayReadyKeyMessage(d,c)),d.send(c)}).catch(s)})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const n=t.media;this.media=n,mn(n,"encrypted",this.onMediaEncrypted),mn(n,"waitingforkey",this.onWaitingForKey);const r=this.mediaResolved;r?r():this.mediaKeys=n.mediaKeys}onMediaDetached(){const e=this.media;e&&(Ln(e,"encrypted",this.onMediaEncrypted),Ln(e,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var e;this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},this.bannedKeyIds={};const t=this.mediaResolved;if(t&&t(),!this.mediaKeys&&!this.mediaKeySessions.length)return;const n=this.media,r=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,Fr.clearKeyUriToKeyIdMap();const s=r.length;ma.CDMCleanupPromise=Promise.all(r.map(a=>this.removeSession(a)).concat((n==null||(e=n.setMediaKeys(null))==null?void 0:e.catch(a=>{this.log(`Could not clear media keys: ${a}`),this.hls&&this.hls.trigger(w.ERROR,{type:Ie.OTHER_ERROR,details:Y.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${a}`)})}))||Promise.resolve())).catch(a=>{this.log(`Could not close sessions and clear media keys: ${a}`),this.hls&&this.hls.trigger(w.ERROR,{type:Ie.OTHER_ERROR,details:Y.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${a}`)})}).then(()=>{s&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this._clear()}onManifestLoaded(e,{sessionKeys:t}){if(!(!t||!this.config.emeEnabled)&&!this.keyFormatPromise){const n=t.reduce((r,s)=>(r.indexOf(s.keyFormat)===-1&&r.push(s.keyFormat),r),[]);this.log(`Selecting key-system from session-keys ${n.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(n)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:n,decryptdata:r}=e;if(t){this.log(`Remove licenses and keys and close session "${t.sessionId}" keyId: ${qt((r==null?void 0:r.keyId)||[])}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),n&&n.readyState!==XMLHttpRequest.DONE&&n.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const s=this.mediaKeySessions.indexOf(e);s>-1&&this.mediaKeySessions.splice(s,1);const{keyStatusTimeouts:a}=e;a&&Object.keys(a).forEach(c=>self.clearTimeout(a[c]));const{drmSystemOptions:u}=this.config;return(VM(u)?new Promise((c,h)=>{self.setTimeout(()=>h(new Error("MediaKeySession.remove() timeout")),8e3),t.remove().then(c).catch(h)}):Promise.resolve()).catch(c=>{this.log(`Could not remove session: ${c}`),this.hls&&this.hls.trigger(w.ERROR,{type:Ie.OTHER_ERROR,details:Y.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${c}`)})}).then(()=>t.close()).catch(c=>{this.log(`Could not close session: ${c}`),this.hls&&this.hls.trigger(w.ERROR,{type:Ie.OTHER_ERROR,details:Y.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${c}`)})})}return Promise.resolve()}}ma.CDMCleanupPromise=void 0;function Tu(i){if(!i)throw new Error("Could not read keyId of undefined decryptdata");if(i.keyId===null)throw new Error("keyId is null");return qt(i.keyId)}function oF(i,e){if(i.keyId&&e.mediaKeysSession.keyStatuses.has(i.keyId))return e.mediaKeysSession.keyStatuses.get(i.keyId);if(i.matches(e.decryptdata))return e.keyStatus}class _n extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}function Vx(i,e){const t=i==="output-restricted",n=t?Y.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:Y.KEY_SYSTEM_STATUS_INTERNAL_ERROR;return new _n({type:Ie.KEY_SYSTEM_ERROR,details:n,fatal:!1,decryptdata:e},t?"HDCP level output restricted":`key status changed to "${i}"`)}class lF{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(w.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(w.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(w.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(w.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const n=this.hls.config;if(n.capLevelOnFPSDrop){const r=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=r,r&&typeof r.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),n.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,n){const r=performance.now();if(t){if(this.lastTime){const s=r-this.lastTime,a=n-this.lastDroppedFrames,u=t-this.lastDecodedFrames,d=1e3*a/s,c=this.hls;if(c.trigger(w.FPS_DROP,{currentDropped:a,currentDecoded:u,totalDroppedFrames:n}),d>0&&a>c.config.fpsDroppedMonitoringThreshold*u){let h=c.currentLevel;c.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+h),h>0&&(c.autoLevelCapping===-1||c.autoLevelCapping>=h)&&(h=h-1,c.trigger(w.FPS_DROP_LEVEL_CAPPING,{level:h,droppedLevel:c.currentLevel}),c.autoLevelCapping=h,this.streamController.nextLevelSwitch())}}this.lastTime=r,this.lastDroppedFrames=n,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}function HA(i,e){let t;try{t=new Event("addtrack")}catch{t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=i,e.dispatchEvent(t)}function zA(i,e){const t=i.mode;if(t==="disabled"&&(i.mode="hidden"),i.cues&&!i.cues.getCueById(e.id))try{if(i.addCue(e),!i.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(n){nt.debug(`[texttrack-utils]: ${n}`);try{const r=new self.TextTrackCue(e.startTime,e.endTime,e.text);r.id=e.id,i.addCue(r)}catch(r){nt.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${r}`)}}t==="disabled"&&(i.mode=t)}function ua(i,e){const t=i.mode;if(t==="disabled"&&(i.mode="hidden"),i.cues)for(let n=i.cues.length;n--;)e&&i.cues[n].removeEventListener("enter",e),i.removeCue(i.cues[n]);t==="disabled"&&(i.mode=t)}function Qf(i,e,t,n){const r=i.mode;if(r==="disabled"&&(i.mode="hidden"),i.cues&&i.cues.length>0){const s=cF(i.cues,e,t);for(let a=0;a<s.length;a++)(!n||n(s[a]))&&i.removeCue(s[a])}r==="disabled"&&(i.mode=r)}function uF(i,e){if(e<=i[0].startTime)return 0;const t=i.length-1;if(e>i[t].endTime)return-1;let n=0,r=t,s;for(;n<=r;)if(s=Math.floor((r+n)/2),e<i[s].startTime)r=s-1;else if(e>i[s].startTime&&n<t)n=s+1;else return s;return i[n].startTime-e<e-i[r].startTime?n:r}function cF(i,e,t){const n=[],r=uF(i,e);if(r>-1)for(let s=r,a=i.length;s<a;s++){const u=i[s];if(u.startTime>=e&&u.endTime<=t)n.push(u);else if(u.startTime>t)return n}return n}function zu(i){const e=[];for(let t=0;t<i.length;t++){const n=i[t];(n.kind==="subtitles"||n.kind==="captions")&&n.label&&e.push(i[t])}return e}class dF extends hp{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null;const n=zu(this.media.textTracks);for(let s=0;s<n.length;s++)if(n[s].mode==="hidden")t=n[s];else if(n[s].mode==="showing"){t=n[s];break}const r=this.findTrackForTextTrack(t);this.subtitleTrack!==r&&this.setSubtitleTrack(r)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(w.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(w.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(w.MANIFEST_LOADING,this.onManifestLoading,this),e.on(w.MANIFEST_PARSED,this.onManifestParsed,this),e.on(w.LEVEL_LOADING,this.onLevelLoading,this),e.on(w.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(w.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(w.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(w.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(w.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(w.MANIFEST_LOADING,this.onManifestLoading,this),e.off(w.MANIFEST_PARSED,this.onManifestParsed,this),e.off(w.LEVEL_LOADING,this.onLevelLoading,this),e.off(w.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(w.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(w.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){const n=this.media;if(!n)return;const r=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||n.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,r)return;zu(n.textTracks).forEach(a=>{ua(a)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:n,groupId:r,details:s}=t,a=this.tracksInGroup[n];if(!a||a.groupId!==r){this.warn(`Subtitle track with id:${n} and group:${r} not found in active group ${a==null?void 0:a.groupId}`);return}const u=a.details;a.details=t.details,this.log(`Subtitle track ${n} "${a.name}" lang:${a.lang} group:${r} loaded [${s.startSN}-${s.endSN}]`),n===this.trackId&&this.playlistLoaded(n,t,u)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const n=t.subtitleGroups||null,r=this.groupIds;let s=this.currentTrack;if(!n||(r==null?void 0:r.length)!==(n==null?void 0:n.length)||n!=null&&n.some(a=>(r==null?void 0:r.indexOf(a))===-1)){this.groupIds=n,this.trackId=-1,this.currentTrack=null;const a=this.tracks.filter(h=>!n||n.indexOf(h.groupId)!==-1);if(a.length)this.selectDefaultTrack&&!a.some(h=>h.default)&&(this.selectDefaultTrack=!1),a.forEach((h,m)=>{h.id=m});else if(!s&&!this.tracksInGroup.length)return;this.tracksInGroup=a;const u=this.hls.config.subtitlePreference;if(!s&&u){this.selectDefaultTrack=!1;const h=ki(u,a);if(h>-1)s=a[h];else{const m=ki(u,this.tracks);s=this.tracks[m]}}let d=this.findTrackId(s);d===-1&&s&&(d=this.findTrackId(null));const c={subtitleTracks:a};this.log(`Updating subtitle tracks, ${a.length} track(s) found in "${n==null?void 0:n.join(",")}" group-id`),this.hls.trigger(w.SUBTITLE_TRACKS_UPDATED,c),d!==-1&&this.trackId===-1&&this.setSubtitleTrack(d)}}findTrackId(e){const t=this.tracksInGroup,n=this.selectDefaultTrack;for(let r=0;r<t.length;r++){const s=t[r];if(!(n&&!s.default||!n&&!e)&&(!e||xs(s,e)))return r}if(e){for(let r=0;r<t.length;r++){const s=t[r];if(Go(e.attrs,s.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return r}for(let r=0;r<t.length;r++){const s=t[r];if(Go(e.attrs,s.attrs,["LANGUAGE"]))return r}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let n=0;n<t.length;n++){const r=t[n];if(Wf(r,e))return n}}return-1}onError(e,t){t.fatal||!t.context||t.context.type===ze.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(e.id===-1)return this.setSubtitleTrack(-1),null;const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const n=this.currentTrack;if(n&&xs(e,n))return n;const r=ki(e,this.tracksInGroup);if(r>-1){const s=this.tracksInGroup[r];return this.setSubtitleTrack(r),s}else{if(n)return null;{const s=ki(e,t);if(s>-1)return t[s]}}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const n=e.id,r=e.groupId,s=this.getUrlWithDirectives(e.url,t),a=e.details,u=a==null?void 0:a.age;this.log(`Loading subtitle ${n} "${e.name}" lang:${e.lang} group:${r}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${u&&a.live?" age "+u.toFixed(1)+(a.type&&" "+a.type||""):""} ${s}`),this.hls.trigger(w.SUBTITLE_TRACK_LOADING,{url:s,id:n,groupId:r,deliveryDirectives:t||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=zu(e.textTracks),n=this.currentTrack;let r;if(n&&(r=t.filter(s=>Wf(n,s))[0],r||this.warn(`Unable to find subtitle TextTrack with name "${n.name}" and language "${n.lang}"`)),[].slice.call(t).forEach(s=>{s.mode!=="disabled"&&s!==r&&(s.mode="disabled")}),r){const s=this.subtitleDisplay?"showing":"hidden";r.mode!==s&&(r.mode=s)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!ye(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.selectDefaultTrack=!1;const n=this.currentTrack,r=t[e]||null;if(this.trackId=e,this.currentTrack=r,this.toggleTrackModes(),!r){this.hls.trigger(w.SUBTITLE_TRACK_SWITCH,{id:e});return}const s=!!r.details&&!r.details.live;if(e===this.trackId&&r===n&&s)return;this.log(`Switching to subtitle-track ${e}`+(r?` "${r.name}" lang:${r.lang} group:${r.groupId}`:""));const{id:a,groupId:u="",name:d,type:c,url:h}=r;this.hls.trigger(w.SUBTITLE_TRACK_SWITCH,{id:a,groupId:u,name:d,type:c,url:h});const m=this.switchParams(r.url,n==null?void 0:n.details,r.details);this.loadPlaylist(m)}}function hF(){try{return crypto.randomUUID()}catch{try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch{let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,r=>{const s=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(r=="x"?s:s&3|8).toString(16)})}}}function Ro(i){let e=5381,t=i.length;for(;t;)e=e*33^i.charCodeAt(--t);return(e>>>0).toString()}const pa=.025;let fc=(function(i){return i[i.Point=0]="Point",i[i.Range=1]="Range",i})({});function fF(i,e,t){return`${i.identifier}-${t+1}-${Ro(e)}`}class mF{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,(e=this.assetListLoader)==null||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){var t;if(e>0&&e>=this.assetList.length)return!0;const n=this.playoutLimit;return e<=0||isNaN(n)?!1:n===0?!0:(((t=this.assetList[e])==null?void 0:t.startOffset)||0)>n}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const t=this.dateRange.tagAnchor;if(t)return Kh(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(this.startTime===0||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const t=this.dateRange.startTime,n=Kh(t,e);return t-n<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,t=ye(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const t=this.resumeAnchor;if(t)return Kh(e,t)}return e}get appendInPlace(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<pa))}set appendInPlace(e){if(this.appendInPlaceStarted){this.resetOnResume=!e;return}this.appendInPlaceDisabled=!e}get timelineStart(){return this._timelineStart!==null?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let t;return this._duration!==null?t=this._duration:this.dateRange.duration?t=this.dateRange.duration:t=this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?fc.Range:fc.Point}get supplementsPrimary(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}get contentMayVary(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||this.assetListResponse!==null}toString(){return pF(this)}}function Kh(i,e){return i-e.start<e.duration/2&&!(Math.abs(i-(e.start+e.duration))<pa)?e.start:e.start+e.duration}function KA(i,e,t){const n=new self.URL(i,t);return n.protocol!=="data:"&&n.searchParams.set("_HLS_primary_id",e),n}function Wh(i,e){for(;(t=i.assetList[++e])!=null&&t.error;)var t;return e}function pF(i){return`["${i.identifier}" ${i.cue.pre?"<pre>":i.cue.post?"<post>":""}${i.timelineStart.toFixed(2)}-${i.resumeTime.toFixed(2)}]`}function na(i){const e=i.timelineStart,t=i.duration||0;return`["${i.identifier}" ${e.toFixed(2)}-${(e+t).toFixed(2)}]`}class gF{constructor(e,t,n,r){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls&&this.hls.trigger(w.PLAYOUT_LIMIT_REACHED,{})};const s=this.hls=new e(t);this.interstitial=n,this.assetItem=r;const a=()=>{this.hasDetails=!0};s.once(w.LEVEL_LOADED,a),s.once(w.AUDIO_TRACK_LOADED,a),s.once(w.SUBTITLE_TRACK_LOADED,a),s.on(w.MEDIA_ATTACHING,(u,{media:d})=>{this.removeMediaListeners(),this.mediaAttached=d,this.interstitial.playoutLimit&&(d.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&s.on(w.BUFFER_APPENDED,()=>{const h=this.bufferedEnd;this.reachedPlayout(h)&&(this._bufferedEosTime=h,s.trigger(w.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){return this.interstitial.appendInPlace}loadSource(){const e=this.hls;if(e)if(e.url)e.levels.length&&!e.started&&e.startLoad(-1,!0);else{let t=this.assetItem.uri;try{t=KA(t,e.config.primarySessionId||"").href}catch{}e.loadSource(t)}}bufferedInPlaceToEnd(e){var t;if(!this.appendInPlace)return!1;if((t=this.hls)!=null&&t.bufferedToEnd)return!0;if(!e)return!1;const n=Math.min(this._bufferedEosTime||1/0,this.duration),r=this.timelineOffset,s=Ue.bufferInfo(e,r,0);return this.getAssetTime(s.end)>=n-.02}reachedPlayout(e){const n=this.interstitial.playoutLimit;return this.startOffset+e>=n}get destroyed(){var e;return!((e=this.hls)!=null&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return((e=this.hls)==null?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const t=Ue.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;if(!e)return 0;const t=this.interstitial.playoutLimit;if(t){const n=t-this.startOffset;if(n>0&&n<e)return n}return e}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return((e=this.hls)==null?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const t=this.timelineOffset;if(e!==t){const n=e-t;if(Math.abs(n)>1/9e4&&this.hls){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const t=this.timelineOffset,n=this.duration;return Math.min(Math.max(0,e-t),n)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){if(this.mediaAttached){var e;(e=this.hls)!=null&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}destroy(){this.removeMediaListeners(),this.hls&&this.hls.destroy(),this.hls=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){var t;this.loadSource(),(t=this.hls)==null||t.attachMedia(e)}detachMedia(){var e;this.removeMediaListeners(),this.mediaAttached=null,(e=this.hls)==null||e.detachMedia()}resumeBuffering(){var e;(e=this.hls)==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.hls)==null||e.pauseBuffering()}transferMedia(){var e;return this.bufferSnapShot(),((e=this.hls)==null?void 0:e.transferMedia())||null}resetDetails(){const e=this.hls;if(e&&this.hasDetails){e.stopLoad();const t=n=>delete n.details;e.levels.forEach(t),e.allAudioTracks.forEach(t),e.allSubtitleTracks.forEach(t),this.hasDetails=!1}}on(e,t,n){var r;(r=this.hls)==null||r.on(e,t)}once(e,t,n){var r;(r=this.hls)==null||r.once(e,t)}off(e,t,n){var r;(r=this.hls)==null||r.off(e,t)}toString(){var e;return`HlsAssetPlayer: ${na(this.assetItem)} ${(e=this.hls)==null?void 0:e.sessionId} ${this.appendInPlace?"append-in-place":""}`}}const Gx=.033;class yF extends Jn{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce((n,r)=>e<=r.startOffset&&t>r.startOffset?(delete r.error,n+1):n,0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let n=-1;e.nextEvent?n=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(n=this.findEventIndex(e.previousEvent.identifier)+1);const r=this.items;if(r)for(r[n]||(t===void 0&&(t=e.start),n=this.findItemIndexAtTime(t));n>=0&&(s=r[n])!=null&&s.event;){var s;n--}return n}findItemIndexAtTime(e,t){const n=this.items;if(n)for(let r=0;r<n.length;r++){let s=n[r];if(t&&t!=="primary"&&(s=s[t]),e===s.start||e>s.start&&e<s.end)return r}return-1}findJumpRestrictedIndex(e,t){const n=this.items;if(n)for(let r=e;r<=t&&n[r];r++){const s=n[r].event;if(s!=null&&s.restrictions.jump&&!s.appendInPlace)return r}return-1}findEventIndex(e){const t=this.items;if(t)for(let r=t.length;r--;){var n;if(((n=t[r].event)==null?void 0:n.identifier)===e)return r}return-1}findAssetIndex(e,t){const n=e.assetList,r=n.length;if(r>1)for(let s=0;s<r;s++){const a=n[s];if(!a.error){const u=a.timelineStart;if(t===u||t>u&&(t<u+(a.duration||0)||s===r-1))return s}}return 0}get assetIdAtEnd(){var e;const t=(e=this.items)==null||(e=e[this.length-1])==null?void 0:e.event;if(t){const n=t.assetList,r=n[n.length-1];if(r)return r.identifier}return null}parseInterstitialDateRanges(e,t){const n=e.main.details,{dateRanges:r}=n,s=this.events,a=this.parseDateRanges(r,{url:n.url},t),u=Object.keys(r),d=s?s.filter(c=>!u.includes(c.identifier)):[];a.length&&a.sort((c,h)=>{const m=c.cue.pre,p=c.cue.post,y=h.cue.pre,v=h.cue.post;if(m&&!y)return-1;if(y&&!m||p&&!v)return 1;if(v&&!p)return-1;if(!m&&!y&&!p&&!v){const E=c.startTime,S=h.startTime;if(E!==S)return E-S}return c.dateRange.tagOrder-h.dateRange.tagOrder}),this.events=a,d.forEach(c=>{this.removeEvent(c)}),this.updateSchedule(e,d)}updateSchedule(e,t=[],n=!1){const r=this.events||[];if(r.length||t.length||this.length<2){const s=this.items,a=this.parseSchedule(r,e);(n||t.length||(s==null?void 0:s.length)!==a.length||a.some((d,c)=>Math.abs(d.playout.start-s[c].playout.start)>.005||Math.abs(d.playout.end-s[c].playout.end)>.005))&&(this.items=a,this.onScheduleUpdate(t,s))}}parseDateRanges(e,t,n){const r=[],s=Object.keys(e);for(let a=0;a<s.length;a++){const u=s[a],d=e[u];if(d.isInterstitial){let c=this.eventMap[u];c?c.setDateRange(d):(c=new mF(d,t),this.eventMap[u]=c,n===!1&&(c.appendInPlace=n)),r.push(c)}}return r}parseSchedule(e,t){const n=[],r=t.main.details,s=r.live?1/0:r.edge;let a=0;if(e=e.filter(d=>!d.error&&!(d.cue.once&&d.hasPlayed)),e.length){this.resolveOffsets(e,t);let d=0,c=0;if(e.forEach((h,m)=>{const p=h.cue.pre,y=h.cue.post,v=e[m-1]||null,E=h.appendInPlace,S=y?s:h.startOffset,A=h.duration,L=h.timelineOccupancy===fc.Range?A:0,R=h.resumptionOffset,D=(v==null?void 0:v.startTime)===S,k=S+h.cumulativeDuration;let U=E?k+A:S+R;if(p||!y&&S<=0){const _=c;c+=L,h.timelineStart=k;const F=a;a+=A,n.push({event:h,start:k,end:U,playout:{start:F,end:a},integrated:{start:_,end:c}})}else if(S<=s){if(!D){const O=S-d;if(O>Gx){const W=d,z=c;c+=O;const re=a;a+=O;const ae={previousEvent:e[m-1]||null,nextEvent:h,start:W,end:W+O,playout:{start:re,end:a},integrated:{start:z,end:c}};n.push(ae)}else O>0&&v&&(v.cumulativeDuration+=O,n[n.length-1].end=S)}y&&(U=k),h.timelineStart=k;const _=c;c+=L;const F=a;a+=A,n.push({event:h,start:k,end:U,playout:{start:F,end:a},integrated:{start:_,end:c}})}else return;const C=h.resumeTime;y||C>s?d=s:d=C}),d<s){var u;const h=d,m=c,p=s-d;c+=p;const y=a;a+=p,n.push({previousEvent:((u=n[n.length-1])==null?void 0:u.event)||null,nextEvent:null,start:d,end:h+p,playout:{start:y,end:a},integrated:{start:m,end:c}})}this.setDurations(s,a,c)}else n.push({previousEvent:null,nextEvent:null,start:0,end:s,playout:{start:0,end:s},integrated:{start:0,end:s}}),this.setDurations(s,s,s);return n}setDurations(e,t,n){this.durations={primary:e,playout:t,integrated:n}}resolveOffsets(e,t){const n=t.main.details,r=n.live?1/0:n.edge;let s=0,a=-1;e.forEach((u,d)=>{const c=u.cue.pre,h=u.cue.post,m=c?0:h?r:u.startTime;this.updateAssetDurations(u),a===m?u.cumulativeDuration=s:(s=0,a=m),!h&&u.snapOptions.in&&(u.resumeAnchor=Ss(null,n.fragments,u.startOffset+u.resumptionOffset,0,0)||void 0),u.appendInPlace&&!u.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(u,t)||(u.appendInPlace=!1)),!u.appendInPlace&&d+1<e.length&&e[d+1].startTime-e[d].resumeTime<Gx&&(e[d+1].appendInPlace=!1,e[d+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${u}`));const y=ye(u.resumeOffset)?u.resumeOffset:u.duration;s+=y})}primaryCanResumeInPlaceAt(e,t){const n=e.resumeTime,r=e.startTime+e.resumptionOffset;return Math.abs(n-r)>pa?(this.log(`"${e.identifier}" resumption ${n} not aligned with estimated timeline end ${r}`),!1):!Object.keys(t).some(a=>{const u=t[a].details,d=u.edge;if(n>=d)return this.log(`"${e.identifier}" resumption ${n} past ${a} playlist end ${d}`),!1;const c=Ss(null,u.fragments,n);if(!c)return this.log(`"${e.identifier}" resumption ${n} does not align with any fragments in ${a} playlist (${u.fragStart}-${u.fragmentEnd})`),!0;const h=a==="audio"?.175:0;return Math.abs(c.start-n)<pa+h||Math.abs(c.end-n)<pa+h?!1:(this.log(`"${e.identifier}" resumption ${n} not aligned with ${a} fragment bounds (${c.start}-${c.end} sn: ${c.sn} cc: ${c.cc})`),!0)})}updateAssetDurations(e){if(!e.assetListLoaded)return;const t=e.timelineStart;let n=0,r=!1,s=!1;for(let a=0;a<e.assetList.length;a++){const u=e.assetList[a],d=t+n;u.startOffset=n,u.timelineStart=d,r||(r=u.duration===null),s||(s=!!u.error);const c=u.error?0:u.duration||0;n+=c}r&&!s?e.duration=Math.max(n,e.duration):e.duration=n}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function ci(i){return`[${i.event?'"'+i.event.identifier+'"':"primary"}: ${i.start.toFixed(2)}-${i.end.toFixed(2)}]`}class vF{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){const n=e.assetListUrl;let r;try{r=KA(n,this.hls.sessionId,e.baseUrl)}catch(p){const y=this.assignAssetListError(e,Y.ASSET_LIST_LOAD_ERROR,p,n);this.hls.trigger(w.ERROR,y);return}t&&r.protocol!=="data:"&&r.searchParams.set("_HLS_start_offset",""+t);const s=this.hls.config,a=s.loader,u=new a(s),d={responseType:"json",url:r.href},c=s.interstitialAssetListLoadPolicy.default,h={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},m={onSuccess:(p,y,v,E)=>{const S=p.data,A=S==null?void 0:S.ASSETS;if(!Array.isArray(A)){const L=this.assignAssetListError(e,Y.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),v.url,y,E);this.hls.trigger(w.ERROR,L);return}e.assetListResponse=S,this.hls.trigger(w.ASSET_LIST_LOADED,{event:e,assetListResponse:S,networkDetails:E})},onError:(p,y,v,E)=>{const S=this.assignAssetListError(e,Y.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${p.code} ${p.text} (${y.url})`),y.url,E,v);this.hls.trigger(w.ERROR,S)},onTimeout:(p,y,v)=>{const E=this.assignAssetListError(e,Y.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${y.url})`),y.url,p,v);this.hls.trigger(w.ERROR,E)}};return u.load(d,h,m),this.hls.trigger(w.ASSET_LIST_LOADING,{event:e}),u}assignAssetListError(e,t,n,r,s,a){return e.error=n,{type:Ie.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:r,error:n,networkDetails:a,stats:s}}}function Hx(i){var e;i==null||(e=i.play())==null||e.catch(()=>{})}function Au(i,e){return`[${i}] Advancing timeline position to ${e}`}class xF extends Jn{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const n=this.currentTime;if(n===void 0||this.playbackDisabled||!this.schedule)return;const r=n-this.timelinePos;if(Math.abs(r)<1/7056e5)return;const a=r<=-.01;this.timelinePos=n,this.bufferedPos=n;const u=this.playingItem;if(!u){this.checkBuffer();return}if(a&&this.schedule.resetErrorsInRange(n,n-r)&&this.updateSchedule(!0),this.checkBuffer(),a&&n<u.start||n>=u.end){var d;const y=this.findItemIndex(u);let v=this.schedule.findItemIndexAtTime(n);if(v===-1&&(v=y+(a?-1:1),this.log(`seeked ${a?"back ":""}to position not covered by schedule ${n} (resolving from ${y} to ${v})`)),!this.isInterstitial(u)&&(d=this.media)!=null&&d.paused&&(this.shouldPlay=!1),!a&&v>y){const E=this.schedule.findJumpRestrictedIndex(y+1,v);if(E>y){this.setSchedulePosition(E);return}}this.setSchedulePosition(v);return}const c=this.playingAsset;if(!c){if(this.playingLastItem&&this.isInterstitial(u)){const y=u.event.assetList[0];y&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(n,y))}return}const h=c.timelineStart,m=c.duration||0;if(a&&n<h||n>=h+m){var p;(p=u.event)!=null&&p.appendInPlace&&(this.clearAssetPlayers(u.event,u),this.flushFrontBuffer(n)),this.setScheduleToAssetAtTime(n,c)}},this.onTimeupdate=()=>{const n=this.currentTime;if(n===void 0||this.playbackDisabled)return;if(n>this.timelinePos)this.timelinePos=n,n>this.bufferedPos&&this.checkBuffer();else return;const r=this.playingItem;if(!r||this.playingLastItem)return;if(n>=r.end){this.timelinePos=r.end;const u=this.findItemIndex(r);this.setSchedulePosition(u+1)}const s=this.playingAsset;if(!s)return;const a=s.timelineStart+(s.duration||0);n>=a&&this.setScheduleToAssetAtTime(n,s)},this.onScheduleUpdate=(n,r)=>{const s=this.schedule;if(!s)return;const a=this.playingItem,u=s.events||[],d=s.items||[],c=s.durations,h=n.map(E=>E.identifier),m=!!(u.length||h.length);(m||r)&&this.log(`INTERSTITIALS_UPDATED (${u.length}): ${u}
Schedule: ${d.map(E=>ci(E))} pos: ${this.timelinePos}`),h.length&&this.log(`Removed events ${h}`);let p=null,y=null;a&&(p=this.updateItem(a,this.timelinePos),this.itemsMatch(a,p)?this.playingItem=p:this.waitingItem=this.endedItem=null),this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const v=this.bufferingItem;if(v&&(y=this.updateItem(v,this.bufferedPos),this.itemsMatch(v,y)?this.bufferingItem=y:v.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(v.event,null))),n.forEach(E=>{E.assetList.forEach(S=>{this.clearAssetPlayer(S.identifier,null)})}),this.playerQueue.forEach(E=>{if(E.interstitial.appendInPlace){const S=E.assetItem.timelineStart,A=E.timelineOffset-S;if(A)try{E.timelineOffset=S}catch(L){Math.abs(A)>pa&&this.warn(`${L} ("${E.assetId}" ${E.timelineOffset}->${S})`)}}}),m||r){if(this.hls.trigger(w.INTERSTITIALS_UPDATED,{events:u.slice(0),schedule:d.slice(0),durations:c,removedIds:h}),this.isInterstitial(a)&&h.includes(a.event.identifier)){this.warn(`Interstitial "${a.event.identifier}" removed while playing`),this.primaryFallback(a.event);return}a&&this.trimInPlace(p,a),v&&y!==p&&this.trimInPlace(y,v),this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new vF(e),this.schedule=new yF(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e&&(e.on(w.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(w.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(w.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(w.MANIFEST_LOADING,this.onManifestLoading,this),e.on(w.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(w.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(w.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(w.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(w.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(w.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(w.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(w.BUFFER_APPENDED,this.onBufferAppended,this),e.on(w.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(w.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(w.MEDIA_ENDED,this.onMediaEnded,this),e.on(w.ERROR,this.onError,this),e.on(w.DESTROYING,this.onDestroying,this))}unregisterListeners(){const e=this.hls;e&&(e.off(w.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(w.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(w.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(w.MANIFEST_LOADING,this.onManifestLoading,this),e.off(w.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(w.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(w.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(w.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(w.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(w.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(w.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(w.BUFFER_CODECS,this.onBufferCodecs,this),e.off(w.BUFFER_APPENDED,this.onBufferAppended,this),e.off(w.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(w.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(w.MEDIA_ENDED,this.onMediaEnded,this),e.off(w.ERROR,this.onError,this),e.off(w.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;(e=this.getBufferingPlayer())==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.getBufferingPlayer())==null||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.schedule=this.manager=null,this.hls=this.HlsPlayerClass=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){Ln(e,"play",this.onPlay),Ln(e,"pause",this.onPause),Ln(e,"seeking",this.onSeeking),Ln(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){const n=this.media=t.media;mn(n,"seeking",this.onSeeking),mn(n,"timeupdate",this.onTimeupdate),mn(n,"play",this.onPlay),mn(n,"pause",this.onPause)}onMediaAttached(e,t){const n=this.effectivePlayingItem,r=this.detachedData;if(this.detachedData=null,n===null)this.checkStart();else if(!r){this.clearScheduleState();const s=this.findItemIndex(n);this.setSchedulePosition(s)}}clearScheduleState(){this.log("clear schedule state"),this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){const n=!!t.transferMedia,r=this.media;if(this.media=null,!n&&(r&&this.removeMediaListeners(r),this.detachedData)){const s=this.getBufferingPlayer();s&&(this.log(`Removing schedule state for detachedData and ${s}`),this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,s.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.hls)return null;if(this.manager)return this.manager;const e=this,t=()=>e.bufferingItem||e.waitingItem,n=m=>m&&e.getAssetPlayer(m.identifier),r=(m,p,y,v,E)=>{if(m){let S=m[p].start;const A=m.event;if(A){if(p==="playout"||A.timelineOccupancy!==fc.Point){const L=n(y);(L==null?void 0:L.interstitial)===A&&(S+=L.assetItem.startOffset+L[E])}}else{const L=v==="bufferedPos"?a():e[v];S+=L-m.start}return S}return 0},s=(m,p)=>{var y;if(m!==0&&p!=="primary"&&(y=e.schedule)!=null&&y.length){var v;const E=e.schedule.findItemIndexAtTime(m),S=(v=e.schedule.items)==null?void 0:v[E];if(S){const A=S[p].start-S.start;return m+A}}return m},a=()=>{const m=e.bufferedPos;return m===Number.MAX_VALUE?u("primary"):Math.max(m,0)},u=m=>{var p,y;return(p=e.primaryDetails)!=null&&p.live?e.primaryDetails.edge:((y=e.schedule)==null?void 0:y.durations[m])||0},d=(m,p)=>{var y,v;const E=e.effectivePlayingItem;if(E!=null&&(y=E.event)!=null&&y.restrictions.skip||!e.schedule)return;e.log(`seek to ${m} "${p}"`);const S=e.effectivePlayingItem,A=e.schedule.findItemIndexAtTime(m,p),L=(v=e.schedule.items)==null?void 0:v[A],R=e.getBufferingPlayer(),D=R==null?void 0:R.interstitial,k=D==null?void 0:D.appendInPlace,U=S&&e.itemsMatch(S,L);if(S&&(k||U)){const C=n(e.playingAsset),_=(C==null?void 0:C.media)||e.primaryMedia;if(_){const F=p==="primary"?_.currentTime:r(S,p,e.playingAsset,"timelinePos","currentTime"),O=m-F,W=(k?F:_.currentTime)+O;if(W>=0&&(!C||k||W<=C.duration)){_.currentTime=W;return}}}if(L){let C=m;if(p!=="primary"){const F=L[p].start,O=m-F;C=L.start+O}const _=!e.isInterstitial(L);if((!e.isInterstitial(S)||S.event.appendInPlace)&&(_||L.event.appendInPlace)){const F=e.media||(k?R==null?void 0:R.media:null);F&&(F.currentTime=C)}else if(S){const F=e.findItemIndex(S);if(A>F){const W=e.schedule.findJumpRestrictedIndex(F+1,A);if(W>F){e.setSchedulePosition(W);return}}let O=0;if(_)e.timelinePos=C,e.checkBuffer();else{const W=L.event.assetList,z=m-(L[p]||L).start;for(let re=W.length;re--;){const ae=W[re];if(ae.duration&&z>=ae.startOffset&&z<ae.startOffset+ae.duration){O=re;break}}}e.setSchedulePosition(A,O)}}},c=()=>{const m=e.effectivePlayingItem;if(e.isInterstitial(m))return m;const p=t();return e.isInterstitial(p)?p:null},h={get bufferedEnd(){const m=t(),p=e.bufferingItem;if(p&&p===m){var y;return r(p,"playout",e.bufferingAsset,"bufferedPos","bufferedEnd")-p.playout.start||((y=e.bufferingAsset)==null?void 0:y.startOffset)||0}return 0},get currentTime(){const m=c(),p=e.effectivePlayingItem;return p&&p===m?r(p,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-p.playout.start:0},set currentTime(m){const p=c(),y=e.effectivePlayingItem;y&&y===p&&d(m+y.playout.start,"playout")},get duration(){const m=c();return m?m.playout.end-m.playout.start:0},get assetPlayers(){var m;const p=(m=c())==null?void 0:m.event.assetList;return p?p.map(y=>e.getAssetPlayer(y.identifier)):[]},get playingIndex(){var m;const p=(m=c())==null?void 0:m.event;return p&&e.effectivePlayingAsset?p.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return c()}};return this.manager={get events(){var m;return((m=e.schedule)==null||(m=m.events)==null?void 0:m.slice(0))||[]},get schedule(){var m;return((m=e.schedule)==null||(m=m.items)==null?void 0:m.slice(0))||[]},get interstitialPlayer(){return c()?h:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){const m=t();return e.findItemIndex(m)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const m=e.effectivePlayingItem;return e.findItemIndex(m)},primary:{get bufferedEnd(){return a()},get currentTime(){const m=e.timelinePos;return m>0?m:0},set currentTime(m){d(m,"primary")},get duration(){return u("primary")},get seekableStart(){var m;return((m=e.primaryDetails)==null?void 0:m.fragmentStart)||0}},integrated:{get bufferedEnd(){return r(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return r(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(m){d(m,"integrated")},get duration(){return u("integrated")},get seekableStart(){var m;return s(((m=e.primaryDetails)==null?void 0:m.fragmentStart)||0,"integrated")}},skip:()=>{const m=e.effectivePlayingItem,p=m==null?void 0:m.event;if(p&&!p.restrictions.skip){const y=e.findItemIndex(m);if(p.appendInPlace){const v=m.playout.start+m.event.duration;d(v+.001,"playout")}else e.advanceAfterAssetEnded(p,y,1/0)}}}}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const t=this.playingItem,n=(e=this.schedule)==null?void 0:e.items;return!this.playbackStarted||!t||!n?!1:this.findItemIndex(t)===n.length-1}get playbackStarted(){return this.effectivePlayingItem!==null}get currentTime(){var e,t;if(this.mediaSelection===null)return;const n=this.waitingItem||this.playingItem;if(this.isInterstitial(n)&&!n.event.appendInPlace)return;let r=this.media;!r&&(e=this.bufferingItem)!=null&&(e=e.event)!=null&&e.appendInPlace&&(r=this.primaryMedia);const s=(t=r)==null?void 0:t.currentTime;if(!(s===void 0||!ye(s)))return s}get primaryMedia(){var e;return this.media||((e=this.detachedData)==null?void 0:e.media)||null}isInterstitial(e){return!!(e!=null&&e.event)}retreiveMediaSource(e,t){const n=this.getAssetPlayer(e);n&&this.transferMediaFromPlayer(n,t)}transferMediaFromPlayer(e,t){const n=e.interstitial.appendInPlace,r=e.media;if(n&&r===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&r){this.detachedData={media:r};return}const s=e.transferMedia();this.log(`transfer MediaSource from ${e} ${ot(s)}`),this.detachedData=s}else t&&r&&(this.shouldPlay||(this.shouldPlay=!r.paused))}transferMediaTo(e,t){var n,r;if(e.media===t)return;let s=null;const a=this.hls,u=e!==a,d=u&&e.interstitial.appendInPlace,c=(n=this.detachedData)==null?void 0:n.mediaSource;let h;if(a.media)d&&(s=a.transferMedia(),this.detachedData=s),h="Primary";else if(c){const v=this.getBufferingPlayer();v?(s=v.transferMedia(),h=`${v}`):h="detached MediaSource"}else h="detached media";if(!s){if(c)s=this.detachedData,this.log(`using detachedData: MediaSource ${ot(s)}`);else if(!this.detachedData||a.media===t){const v=this.playerQueue;v.length>1&&v.forEach(E=>{if(u&&E.interstitial.appendInPlace!==d){const S=E.interstitial;this.clearInterstitial(E.interstitial,null),S.appendInPlace=!1,S.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${S}`)}}),this.hls.detachMedia(),this.detachedData={media:t}}}const m=s&&"mediaSource"in s&&((r=s.mediaSource)==null?void 0:r.readyState)!=="closed",p=m&&s?s:t;this.log(`${m?"transfering MediaSource":"attaching media"} to ${u?e:"Primary"} from ${h} (media.currentTime: ${t.currentTime})`);const y=this.schedule;if(p===s&&y){const v=u&&e.assetId===y.assetIdAtEnd;p.overrides={duration:y.duration,endOfStream:!u||v,cueRemoval:!u}}e.attachMedia(p)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,t=e==null?void 0:e.events;if(!t||this.playbackDisabled||!this.media)return;this.bufferedPos===-1&&(this.bufferedPos=0);const n=this.timelinePos,r=this.effectivePlayingItem;if(n===-1){const s=this.hls.startPosition;if(this.log(Au("checkStart",s)),this.timelinePos=s,t.length&&t[0].cue.pre){const a=e.findEventIndex(t[0].identifier);this.setSchedulePosition(a)}else if(s>=0||!this.primaryLive){const a=this.timelinePos=s>0?s:0,u=e.findItemIndexAtTime(a);this.setSchedulePosition(u)}}else if(r&&!this.playingItem){const s=e.findItemIndex(r);this.setSchedulePosition(s)}}advanceAssetBuffering(e,t){const n=e.event,r=n.findAssetIndex(t),s=Wh(n,r);if(!n.isAssetPastPlayoutLimit(s))this.bufferedToEvent(e,s);else if(this.schedule){var a;const u=(a=this.schedule.items)==null?void 0:a[this.findItemIndex(e)+1];u&&this.bufferedToItem(u)}}advanceAfterAssetEnded(e,t,n){const r=Wh(e,n);if(e.isAssetPastPlayoutLimit(r)){if(this.schedule){const s=this.schedule.items;if(s){const a=t+1,u=s.length;if(a>=u){this.setSchedulePosition(-1);return}const d=e.resumeTime;this.timelinePos<d&&(this.log(Au("advanceAfterAssetEnded",d)),this.timelinePos=d,e.appendInPlace&&this.advanceInPlace(d),this.checkBuffer(this.bufferedPos<d)),this.setSchedulePosition(a)}}}else{if(e.appendInPlace){const s=e.assetList[r];s&&this.advanceInPlace(s.timelineStart)}this.setSchedulePosition(t,r)}}setScheduleToAssetAtTime(e,t){const n=this.schedule;if(!n)return;const r=t.parentIdentifier,s=n.getEvent(r);if(s){const a=n.findEventIndex(r),u=n.findAssetIndex(s,e);this.advanceAfterAssetEnded(s,a,u-1)}}setSchedulePosition(e,t){var n;const r=(n=this.schedule)==null?void 0:n.items;if(!r||this.playbackDisabled)return;const s=e>=0?r[e]:null;this.log(`setSchedulePosition ${e}, ${t} (${s&&ci(s)}) pos: ${this.timelinePos}`);const a=this.waitingItem||this.playingItem,u=this.playingLastItem;if(this.isInterstitial(a)){const h=a.event,m=this.playingAsset,p=m==null?void 0:m.identifier,y=p?this.getAssetPlayer(p):null;if(y&&p&&(!this.eventItemsMatch(a,s)||t!==void 0&&p!==h.assetList[t].identifier)){var d;const v=h.findAssetIndex(m);if(this.log(`INTERSTITIAL_ASSET_ENDED ${v+1}/${h.assetList.length} ${na(m)}`),this.endedAsset=m,this.playingAsset=null,this.hls.trigger(w.INTERSTITIAL_ASSET_ENDED,{asset:m,assetListIndex:v,event:h,schedule:r.slice(0),scheduleIndex:e,player:y}),a!==this.playingItem){this.itemsMatch(a,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(h,this.findItemIndex(this.playingItem),v);return}this.retreiveMediaSource(p,s),y.media&&!((d=this.detachedData)!=null&&d.mediaSource)&&y.detachMedia()}if(!this.eventItemsMatch(a,s)&&(this.endedItem=a,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${h} ${ci(a)}`),h.hasPlayed=!0,this.hls.trigger(w.INTERSTITIAL_ENDED,{event:h,schedule:r.slice(0),scheduleIndex:e}),h.cue.once)){var c;this.updateSchedule();const v=(c=this.schedule)==null?void 0:c.items;if(s&&v){const E=this.findItemIndex(s);this.advanceSchedule(E,v,t,a,u)}return}}this.advanceSchedule(e,r,t,a,u)}advanceSchedule(e,t,n,r,s){const a=this.schedule;if(!a)return;const u=t[e]||null,d=this.primaryMedia,c=this.playerQueue;if(c.length&&c.forEach(h=>{const m=h.interstitial,p=a.findEventIndex(m.identifier);(p<e||p>e+1)&&this.clearInterstitial(m,u)}),this.isInterstitial(u)){this.timelinePos=Math.min(Math.max(this.timelinePos,u.start),u.end);const h=u.event;if(n===void 0){n=a.findAssetIndex(h,this.timelinePos);const v=Wh(h,n-1);if(h.isAssetPastPlayoutLimit(v)||h.appendInPlace&&this.timelinePos===u.end){this.advanceAfterAssetEnded(h,e,n);return}n=v}const m=this.waitingItem;this.assetsBuffered(u,d)||this.setBufferingItem(u);let p=this.preloadAssets(h,n);if(this.eventItemsMatch(u,m||r)||(this.waitingItem=u,this.log(`INTERSTITIAL_STARTED ${ci(u)} ${h.appendInPlace?"append in place":""}`),this.hls.trigger(w.INTERSTITIAL_STARTED,{event:h,schedule:t.slice(0),scheduleIndex:e})),!h.assetListLoaded){this.log(`Waiting for ASSET-LIST to complete loading ${h}`);return}if(h.assetListLoader&&(h.assetListLoader.destroy(),h.assetListLoader=void 0),!d){this.log(`Waiting for attachMedia to start Interstitial ${h}`);return}this.waitingItem=this.endedItem=null,this.playingItem=u;const y=h.assetList[n];if(!y){this.advanceAfterAssetEnded(h,e,n||0);return}if(p||(p=this.getAssetPlayer(y.identifier)),p===null||p.destroyed){const v=h.assetList.length;this.warn(`asset ${n+1}/${v} player destroyed ${h}`),p=this.createAssetPlayer(h,y,n),p.loadSource()}if(!this.eventItemsMatch(u,this.bufferingItem)&&h.appendInPlace&&this.isAssetBuffered(y))return;this.startAssetPlayer(p,n,t,e,d),this.shouldPlay&&Hx(p.media)}else u?(this.resumePrimary(u,e,r),this.shouldPlay&&Hx(this.hls.media)):s&&this.isInterstitial(r)&&(this.endedItem=null,this.playingItem=r,r.event.appendInPlace||this.attachPrimary(a.durations.primary,null))}get playbackDisabled(){return this.hls.config.enableInterstitialPlayback===!1}get primaryDetails(){var e;return(e=this.mediaSelection)==null?void 0:e.main.details}get primaryLive(){var e;return!!((e=this.primaryDetails)!=null&&e.live)}resumePrimary(e,t,n){var r,s;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${ci(e)}`),!((r=this.detachedData)!=null&&r.mediaSource)){let u=this.timelinePos;(u<e.start||u>=e.end)&&(u=this.getPrimaryResumption(e,t),this.log(Au("resumePrimary",u)),this.timelinePos=u),this.attachPrimary(u,e)}if(!n)return;const a=(s=this.schedule)==null?void 0:s.items;a&&(this.log(`INTERSTITIALS_PRIMARY_RESUMED ${ci(e)}`),this.hls.trigger(w.INTERSTITIALS_PRIMARY_RESUMED,{schedule:a.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){const n=e.start;if(this.primaryLive){const r=this.primaryDetails;if(t===0)return this.hls.startPosition;if(r&&(n<r.fragmentStart||n>r.edge))return this.hls.liveSyncPosition||-1}return n}isAssetBuffered(e){const t=this.getAssetPlayer(e.identifier);return t!=null&&t.hls?t.hls.bufferedToEnd:Ue.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,n){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const r=this.primaryMedia;if(!r)return;const s=this.hls;s.media?this.checkBuffer():(this.transferMediaTo(s,r),n&&this.startLoadingPrimaryAt(e,n)),n||(this.log(Au("attachPrimary",e)),this.timelinePos=e,this.startLoadingPrimaryAt(e,n))}startLoadingPrimaryAt(e,t){var n;const r=this.hls;!r.loadingEnabled||!r.media||Math.abs((((n=r.mainForwardBufferInfo)==null?void 0:n.start)||r.media.currentTime)-e)>.5?r.startLoad(e,t):r.bufferingEnabled||r.resumeBuffering()}onManifestLoading(){var e;this.stopLoad(),(e=this.schedule)==null||e.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(w.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(w.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(t.level===-1||!this.schedule)return;const n=this.hls.levels[t.level];if(!n.details)return;const r=tt(tt({},this.mediaSelection||this.altSelection),{},{main:n});this.mediaSelection=r,this.schedule.parseInterstitialDateRanges(r,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){const n=this.hls.audioTracks[t.id],r=this.mediaSelection;if(!r){this.altSelection=tt(tt({},this.altSelection),{},{audio:n});return}const s=tt(tt({},r),{},{audio:n});this.mediaSelection=s}onSubtitleTrackUpdated(e,t){const n=this.hls.subtitleTracks[t.id],r=this.mediaSelection;if(!r){this.altSelection=tt(tt({},this.altSelection),{},{subtitles:n});return}const s=tt(tt({},r),{},{subtitles:n});this.mediaSelection=s}onAudioTrackSwitching(e,t){const n=Jv(t);this.playerQueue.forEach(({hls:r})=>r&&(r.setAudioOption(t)||r.setAudioOption(n)))}onSubtitleTrackSwitch(e,t){const n=Jv(t);this.playerQueue.forEach(({hls:r})=>r&&(r.setSubtitleOption(t)||t.id!==-1&&r.setSubtitleOption(n)))}onBufferCodecs(e,t){const n=t.tracks;n&&(this.requiredTracks=n)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){const n=this.playingItem;if(n&&!this.itemsMatch(n,this.bufferingItem)&&!this.isInterstitial(n)){const r=this.timelinePos;this.bufferedPos=r,this.checkBuffer()}}onBufferedToEnd(e){if(!this.schedule)return;const t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let r=0;r<t.length;r++){const s=t[r];if(s.cue.post){var n;const a=this.schedule.findEventIndex(s.identifier),u=(n=this.schedule.items)==null?void 0:n[a];this.isInterstitial(u)&&this.eventItemsMatch(u,this.bufferingItem)&&this.bufferedToItem(u,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const t=this.playingItem;if(!this.playingLastItem&&t){const n=this.findItemIndex(t);this.setSchedulePosition(n+1)}else this.shouldPlay=!1}updateItem(e,t){var n;const r=(n=this.schedule)==null?void 0:n.items;if(e&&r){const s=this.findItemIndex(e,t);return r[s]||null}return null}trimInPlace(e,t){if(this.isInterstitial(e)&&e.event.appendInPlace&&t.end-e.end>.25){e.event.assetList.forEach((s,a)=>{e.event.isAssetPastPlayoutLimit(a)&&this.clearAssetPlayer(s.identifier,null)});const n=e.end+.25,r=Ue.bufferInfo(this.primaryMedia,n,0);(r.end>n||(r.nextStart||0)>n)&&(this.log(`trim buffered interstitial ${ci(e)} (was ${ci(t)})`),this.attachPrimary(n,null,!0),this.flushFrontBuffer(n))}}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var n;return!!t&&(e===t||e.event.identifier===((n=t.event)==null?void 0:n.identifier))}findItemIndex(e,t){return e&&this.schedule?this.schedule.findItemIndex(e,t):-1}updateSchedule(e=!1){var t;const n=this.mediaSelection;n&&((t=this.schedule)==null||t.updateSchedule(n,[],e))}checkBuffer(e){var t;const n=(t=this.schedule)==null?void 0:t.items;if(!n)return;const r=Ue.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=r.len<1),this.updateBufferedPos(r.end,n,e)}updateBufferedPos(e,t,n){const r=this.schedule,s=this.bufferingItem;if(this.bufferedPos>e||!r)return;if(t.length===1&&this.itemsMatch(t[0],s)){this.bufferedPos=e;return}const a=this.playingItem,u=this.findItemIndex(a);let d=r.findItemIndexAtTime(e);if(this.bufferedPos<e){var c;const h=this.findItemIndex(s),m=Math.min(h+1,t.length-1),p=t[m];if((d===-1&&s&&e>=s.end||(c=p.event)!=null&&c.appendInPlace&&e+.01>=p.start)&&(d=m),this.isInterstitial(s)){const y=s.event;if(m-u>1&&y.appendInPlace===!1||y.assetList.length===0&&y.assetListLoader)return}if(this.bufferedPos=e,d>h&&d>u)this.bufferedToItem(p);else{const y=this.primaryDetails;this.primaryLive&&y&&e>y.edge-y.targetduration&&p.start<y.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(p)&&this.preloadAssets(p.event,0)}}else n&&a&&!this.itemsMatch(a,s)&&(d===u?this.bufferedToItem(a):d===u+1&&this.bufferedToItem(t[d]))}assetsBuffered(e,t){return e.event.assetList.length===0?!1:!e.event.assetList.some(r=>{const s=this.getAssetPlayer(r.identifier);return!(s!=null&&s.bufferedInPlaceToEnd(t))})}setBufferingItem(e){const t=this.bufferingItem,n=this.schedule;if(!this.itemsMatch(e,t)&&n){const{items:r,events:s}=n;if(!r||!s)return t;const a=this.isInterstitial(e),u=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));const d=u?u.remaining:t?t.end-this.timelinePos:0;if(this.log(`INTERSTITIALS_BUFFERED_TO_BOUNDARY ${ci(e)}`+(t?` (${d.toFixed(2)} remaining)`:"")),!this.playbackDisabled)if(a){const c=n.findAssetIndex(e.event,this.bufferedPos);e.event.assetList.forEach((h,m)=>{const p=this.getAssetPlayer(h.identifier);p&&(m===c&&p.loadSource(),p.resumeBuffering())})}else this.hls.resumeBuffering(),this.playerQueue.forEach(c=>c.pauseBuffering());this.hls.trigger(w.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:s.slice(0),schedule:r.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}else this.bufferingItem!==e&&(this.bufferingItem=e);return t}bufferedToItem(e,t=0){const n=this.setBufferingItem(e);if(!this.playbackDisabled){if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(n!==null){this.bufferingAsset=null;const r=this.detachedData;r?r.mediaSource?this.attachPrimary(e.start,e,!0):this.preloadPrimary(e):this.preloadPrimary(e)}}}preloadPrimary(e){const t=this.findItemIndex(e),n=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(n)}bufferedToEvent(e,t){const n=e.event,r=n.assetList.length===0&&!n.assetListLoader,s=n.cue.once;if(r||!s){const a=this.preloadAssets(n,t);if(a!=null&&a.interstitial.appendInPlace){const u=this.primaryMedia;u&&this.bufferAssetPlayer(a,u)}}}preloadAssets(e,t){const n=e.assetUrl,r=e.assetList.length,s=r===0&&!e.assetListLoader,a=e.cue.once;if(s){const d=e.timelineStart;if(e.appendInPlace){var u;const p=this.playingItem;!this.isInterstitial(p)&&(p==null||(u=p.nextEvent)==null?void 0:u.identifier)===e.identifier&&this.flushFrontBuffer(d+.25)}let c,h=0;if(!this.playingItem&&this.primaryLive&&(h=this.hls.startPosition,h===-1&&(h=this.hls.liveSyncPosition||0)),h&&!(e.cue.pre||e.cue.post)){const p=h-d;p>0&&(c=Math.round(p*1e3)/1e3)}if(this.log(`Load interstitial asset ${t+1}/${n?1:r} ${e}${c?` live-start: ${h} start-offset: ${c}`:""}`),n)return this.createAsset(e,0,0,d,e.duration,n);const m=this.assetListLoader.loadAssetList(e,c);m&&(e.assetListLoader=m)}else if(!a&&r){for(let c=t;c<r;c++){const h=e.assetList[c],m=this.getAssetPlayerQueueIndex(h.identifier);(m===-1||this.playerQueue[m].destroyed)&&!h.error&&this.createAssetPlayer(e,h,c)}const d=e.assetList[t];if(d){const c=this.getAssetPlayer(d.identifier);return c&&c.loadSource(),c}}return null}flushFrontBuffer(e){const t=this.requiredTracks;if(!t)return;this.log(`Removing front buffer starting at ${e}`),Object.keys(t).forEach(r=>{this.hls.trigger(w.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:r})})}getAssetPlayerQueueIndex(e){const t=this.playerQueue;for(let n=0;n<t.length;n++)if(e===t[n].assetId)return n;return-1}getAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:t}=this;if(t){for(let n=0;n<e.length;n++)if(e[n].media===t)return e[n]}return null}createAsset(e,t,n,r,s,a){const u={parentIdentifier:e.identifier,identifier:fF(e,a,t),duration:s,startOffset:n,timelineStart:r,uri:a};return this.createAssetPlayer(e,u,t)}createAssetPlayer(e,t,n){const r=this.hls,s=r.userConfig;let a=s.videoPreference;const u=r.loadLevelObj||r.levels[r.currentLevel];(a||u)&&(a=rt({},a),u.videoCodec&&(a.videoCodec=u.videoCodec),u.videoRange&&(a.allowedVideoRanges=[u.videoRange]));const d=r.audioTracks[r.audioTrack],c=r.subtitleTracks[r.subtitleTrack];let h=0;if(this.primaryLive||e.appendInPlace){const D=this.timelinePos-t.timelineStart;if(D>1){const k=t.duration;k&&D<k&&(h=D)}}const m=t.identifier,p=tt(tt({},s),{},{maxMaxBufferLength:Math.min(180,r.config.maxMaxBufferLength),autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:r.sessionId,assetPlayerId:m,abrEwmaDefaultEstimate:r.bandwidthEstimate,interstitialsController:void 0,startPosition:h,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:a,audioPreference:d||s.audioPreference,subtitlePreference:c||s.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(p.timelineOffset=t.timelineStart));const y=p.cmcd;y!=null&&y.sessionId&&y.contentId&&(p.cmcd=rt({},y,{contentId:Ro(t.uri)})),this.getAssetPlayer(m)&&this.warn(`Duplicate date range identifier ${e} and asset ${m}`);const v=new gF(this.HlsPlayerClass,p,e,t);this.playerQueue.push(v),e.assetList[n]=t;let E=!0;const S=D=>{if(D.live){var k;const _=new Error(`Interstitials MUST be VOD assets ${e}`),F={fatal:!0,type:Ie.OTHER_ERROR,details:Y.INTERSTITIAL_ASSET_ITEM_ERROR,error:_},O=((k=this.schedule)==null?void 0:k.findEventIndex(e.identifier))||-1;this.handleAssetItemError(F,e,O,n,_.message);return}const U=D.edge-D.fragmentStart,C=t.duration;(E||C===null||U>C)&&(E=!1,this.log(`Interstitial asset "${m}" duration change ${C} > ${U}`),t.duration=U,this.updateSchedule())};v.on(w.LEVEL_UPDATED,(D,{details:k})=>S(k)),v.on(w.LEVEL_PTS_UPDATED,(D,{details:k})=>S(k)),v.on(w.EVENT_CUE_ENTER,()=>this.onInterstitialCueEnter());const A=(D,k)=>{const U=this.getAssetPlayer(m);if(U&&k.tracks){U.off(w.BUFFER_CODECS,A),U.tracks=k.tracks;const C=this.primaryMedia;this.bufferingAsset===U.assetItem&&C&&!U.media&&this.bufferAssetPlayer(U,C)}};v.on(w.BUFFER_CODECS,A);const L=()=>{var D;const k=this.getAssetPlayer(m);if(this.log(`buffered to end of asset ${k}`),!k||!this.schedule)return;const U=this.schedule.findEventIndex(e.identifier),C=(D=this.schedule.items)==null?void 0:D[U];this.isInterstitial(C)&&this.advanceAssetBuffering(C,t)};v.on(w.BUFFERED_TO_END,L);const R=D=>()=>{if(!this.getAssetPlayer(m)||!this.schedule)return;this.shouldPlay=!0;const U=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,U,D)};return v.once(w.MEDIA_ENDED,R(n)),v.once(w.PLAYOUT_LIMIT_REACHED,R(1/0)),v.on(w.ERROR,(D,k)=>{if(!this.schedule)return;const U=this.getAssetPlayer(m);if(k.details===Y.BUFFER_STALLED_ERROR){if(U!=null&&U.appendInPlace){this.handleInPlaceStall(e);return}this.onTimeupdate(),this.checkBuffer(!0);return}this.handleAssetItemError(k,e,this.schedule.findEventIndex(e.identifier),n,`Asset player error ${k.error} ${e}`)}),v.on(w.DESTROYING,()=>{if(!this.getAssetPlayer(m)||!this.schedule)return;const k=new Error(`Asset player destroyed unexpectedly ${m}`),U={fatal:!0,type:Ie.OTHER_ERROR,details:Y.INTERSTITIAL_ASSET_ITEM_ERROR,error:k};this.handleAssetItemError(U,e,this.schedule.findEventIndex(e.identifier),n,k.message)}),this.log(`INTERSTITIAL_ASSET_PLAYER_CREATED ${na(t)}`),this.hls.trigger(w.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:n,event:e,player:v}),v}clearInterstitial(e,t){this.clearAssetPlayers(e,t),e.reset()}clearAssetPlayers(e,t){e.assetList.forEach(n=>{this.clearAssetPlayer(n.identifier,t)})}resetAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);if(t!==-1){this.log(`reset asset player "${e}" after error`);const n=this.playerQueue[t];this.transferMediaFromPlayer(n,null),n.resetDetails()}}clearAssetPlayer(e,t){const n=this.getAssetPlayerQueueIndex(e);if(n!==-1){const r=this.playerQueue[n];this.log(`clear ${r} toSegment: ${t&&ci(t)}`),this.transferMediaFromPlayer(r,t),this.playerQueue.splice(n,1),r.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,n,r,s){const{interstitial:a,assetItem:u,assetId:d}=e,c=a.assetList.length,h=this.playingAsset;this.endedAsset=null,this.playingAsset=u,(!h||h.identifier!==d)&&(h&&(this.clearAssetPlayer(h.identifier,n[r]),delete h.error),this.log(`INTERSTITIAL_ASSET_STARTED ${t+1}/${c} ${na(u)}`),this.hls.trigger(w.INTERSTITIAL_ASSET_STARTED,{asset:u,assetListIndex:t,event:a,schedule:n.slice(0),scheduleIndex:r,player:e})),this.bufferAssetPlayer(e,s)}bufferAssetPlayer(e,t){var n,r;if(!this.schedule)return;const{interstitial:s,assetItem:a}=e,u=this.schedule.findEventIndex(s.identifier),d=(n=this.schedule.items)==null?void 0:n[u];if(!d)return;e.loadSource(),this.setBufferingItem(d),this.bufferingAsset=a;const c=this.getBufferingPlayer();if(c===e)return;const h=s.appendInPlace;if(h&&(c==null?void 0:c.interstitial.appendInPlace)===!1)return;const m=(c==null?void 0:c.tracks)||((r=this.detachedData)==null?void 0:r.tracks)||this.requiredTracks;if(h&&a!==this.playingAsset){if(!e.tracks){this.log(`Waiting for track info before buffering ${e}`);return}if(m&&!IT(m,e.tracks)){const p=new Error(`Asset ${na(a)} SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(m)}')`),y={fatal:!0,type:Ie.OTHER_ERROR,details:Y.INTERSTITIAL_ASSET_ITEM_ERROR,error:p},v=s.findAssetIndex(a);this.handleAssetItemError(y,s,u,v,p.message);return}}this.transferMediaTo(e,t)}handleInPlaceStall(e){const t=this.schedule,n=this.primaryMedia;if(!t||!n)return;const r=n.currentTime,s=t.findAssetIndex(e,r),a=e.assetList[s];if(a){const u=this.getAssetPlayer(a.identifier);if(u){const d=u.currentTime||r-a.timelineStart,c=u.duration-d;if(this.warn(`Stalled at ${d} of ${d+c} in ${u} ${e} (media.currentTime: ${r})`),d&&(c/n.playbackRate<.5||u.bufferedInPlaceToEnd(n))&&u.hls){const h=t.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,h,s)}}}}advanceInPlace(e){const t=this.primaryMedia;t&&t.currentTime<e&&(t.currentTime=e)}handleAssetItemError(e,t,n,r,s){if(e.details===Y.BUFFER_STALLED_ERROR)return;const a=t.assetList[r]||null;if(this.warn(`INTERSTITIAL_ASSET_ERROR ${a&&na(a)} ${e.error}`),!this.schedule)return;const u=(a==null?void 0:a.identifier)||"",d=this.getAssetPlayerQueueIndex(u),c=this.playerQueue[d]||null,h=this.schedule.items,m=rt({},e,{fatal:!1,errorAction:ha(!0),asset:a,assetListIndex:r,event:t,schedule:h,scheduleIndex:n,player:c});if(this.hls.trigger(w.INTERSTITIAL_ASSET_ERROR,m),!e.fatal)return;const p=this.playingAsset,y=this.bufferingAsset,v=new Error(s);if(a&&(this.clearAssetPlayer(u,null),a.error=v),!t.assetList.some(E=>!E.error))t.error=v;else for(let E=r;E<t.assetList.length;E++)this.resetAssetPlayer(t.assetList[E].identifier);this.updateSchedule(!0),t.error?this.primaryFallback(t):p&&p.identifier===u?this.advanceAfterAssetEnded(t,n,r):y&&y.identifier===u&&this.isInterstitial(this.bufferingItem)&&this.advanceAssetBuffering(this.bufferingItem,y)}primaryFallback(e){const t=e.timelineStart,n=this.effectivePlayingItem;let r=this.timelinePos;if(n){this.log(`Fallback to primary from event "${e.identifier}" start: ${t} pos: ${r} playing: ${ci(n)} error: ${e.error}`),r===-1&&(r=this.hls.startPosition);const a=this.updateItem(n,r);this.itemsMatch(n,a)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t))}else if(r===-1){this.checkStart();return}if(!this.schedule)return;const s=this.schedule.findItemIndexAtTime(r);this.setSchedulePosition(s)}onAssetListLoaded(e,t){var n,r;const s=t.event,a=s.identifier,u=t.assetListResponse.ASSETS;if(!((n=this.schedule)!=null&&n.hasEvent(a)))return;const d=s.timelineStart,c=s.duration;let h=0;u.forEach((E,S)=>{const A=parseFloat(E.DURATION);this.createAsset(s,S,h,d+h,A,E.URI),h+=A}),s.duration=h,this.log(`Loaded asset-list with duration: ${h} (was: ${c}) ${s}`);const m=this.waitingItem,p=(m==null?void 0:m.event.identifier)===a;this.updateSchedule();const y=(r=this.bufferingItem)==null?void 0:r.event;if(p){var v;const E=this.schedule.findEventIndex(a),S=(v=this.schedule.items)==null?void 0:v[E];if(S){if(!this.playingItem&&this.timelinePos>S.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==E){s.error=new Error(`Interstitial ${u.length?"no longer within playback range":"asset-list is empty"} ${this.timelinePos} ${s}`),this.log(s.error.message),this.updateSchedule(!0),this.primaryFallback(s);return}this.setBufferingItem(S)}this.setSchedulePosition(E)}else if((y==null?void 0:y.identifier)===a){const E=s.assetList[0];if(E){const S=this.getAssetPlayer(E.identifier);if(y.appendInPlace){const A=this.primaryMedia;S&&A&&this.bufferAssetPlayer(S,A)}else S&&S.loadSource()}}}onError(e,t){if(this.schedule)switch(t.details){case Y.ASSET_LIST_PARSING_ERROR:case Y.ASSET_LIST_LOAD_ERROR:case Y.ASSET_LIST_LOAD_TIMEOUT:{const n=t.interstitial;n&&(this.updateSchedule(!0),this.primaryFallback(n));break}case Y.BUFFER_STALLED_ERROR:{const n=this.endedItem||this.waitingItem||this.playingItem;if(this.isInterstitial(n)&&n.event.appendInPlace){this.handleInPlaceStall(n.event);return}this.log(`Primary player stall @${this.timelinePos} bufferedPos: ${this.bufferedPos}`),this.onTimeupdate(),this.checkBuffer(!0);break}}}}const zx=500;class EF extends rp{constructor(e,t,n){super(e,t,n,"subtitle-stream-controller",xe.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(w.LEVEL_LOADED,this.onLevelLoaded,this),e.on(w.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(w.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(w.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(w.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(w.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(w.LEVEL_LOADED,this.onLevelLoaded,this),e.off(w.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(w.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(w.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(w.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(w.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=se.IDLE,this.setInterval(zx),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:n,success:r}=t;if(this.fragContextChanged(n)||(Rt(n)&&(this.fragPrevious=n),this.state=se.IDLE),!r)return;const s=this.tracksBuffered[this.currentTrackId];if(!s)return;let a;const u=n.start;for(let c=0;c<s.length;c++)if(u>=s[c].start&&u<=s[c].end){a=s[c];break}const d=n.start+n.duration;a?a.end=d:(a={start:u,end:d},s.push(a)),this.fragmentTracker.fragBuffered(n),this.fragBufferedComplete(n,null),this.media&&this.tick()}onBufferFlushing(e,t){const{startOffset:n,endOffset:r}=t;if(n===0&&r!==Number.POSITIVE_INFINITY){const s=r-1;if(s<=0)return;t.endOffsetSubtitles=Math.max(0,s),this.tracksBuffered.forEach(a=>{for(let u=0;u<a.length;){if(a[u].end<=s){a.shift();continue}else if(a[u].start<s)a[u].start=s;else break;u++}}),this.fragmentTracker.removeFragmentsInRange(n,s,xe.SUBTITLE)}}onError(e,t){const n=t.frag;(n==null?void 0:n.type)===xe.SUBTITLE&&(t.details===Y.FRAG_GAP&&this.fragmentTracker.fragBuffered(n,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==se.STOPPED&&(this.state=se.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(this.levels&&kA(this.levels,t)){this.levels=t.map(n=>new Uo(n));return}this.tracksBuffered=[],this.levels=t.map(n=>{const r=new Uo(n);return this.tracksBuffered[r.id]=[],r}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,xe.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var n;if(this.currentTrackId=t.id,!((n=this.levels)!=null&&n.length)||this.currentTrackId===-1){this.clearInterval();return}const r=this.levels[this.currentTrackId];r!=null&&r.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,r&&this.state!==se.STOPPED&&this.setInterval(zx)}onSubtitleTrackLoaded(e,t){var n;const{currentTrackId:r,levels:s}=this,{details:a,id:u}=t;if(!s){this.warn(`Subtitle tracks were reset while loading level ${u}`);return}const d=s[u];if(u>=s.length||!d)return;this.log(`Subtitle track ${u} loaded [${a.startSN},${a.endSN}]${a.lastPartSn?`[part-${a.lastPartSn}-${a.lastPartIndex}]`:""},duration:${a.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let c=0;if(a.live||(n=d.details)!=null&&n.live){if(a.deltaUpdateFailed)return;const m=this.mainDetails;if(!m){this.startFragRequested=!1;return}const p=m.fragments[0];if(!d.details)a.hasProgramDateTime&&m.hasProgramDateTime?(dc(a,m),c=a.fragmentStart):p&&(c=p.start,Hf(a,c));else{var h;c=this.alignPlaylists(a,d.details,(h=this.levelLastLoaded)==null?void 0:h.details),c===0&&p&&(c=p.start,Hf(a,c))}m&&!this.startFragRequested&&this.setStartPosition(m,c)}d.details=a,this.levelLastLoaded=d,u===r&&(this.hls.trigger(w.SUBTITLE_TRACK_UPDATED,{details:a,id:u,groupId:t.groupId}),this.tick(),a.live&&!this.fragCurrent&&this.media&&this.state===se.IDLE&&(Ss(null,a.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),d.details=void 0)))}_handleFragmentLoadComplete(e){const{frag:t,payload:n}=e,r=t.decryptdata,s=this.hls;if(!this.fragContextChanged(t)&&n&&n.byteLength>0&&r!=null&&r.key&&r.iv&&fa(r.method)){const a=performance.now();this.decrypter.decrypt(new Uint8Array(n),r.key.buffer,r.iv.buffer,np(r.method)).catch(u=>{throw s.trigger(w.ERROR,{type:Ie.MEDIA_ERROR,details:Y.FRAG_DECRYPT_ERROR,fatal:!1,error:u,reason:u.message,frag:t}),u}).then(u=>{const d=performance.now();s.trigger(w.FRAG_DECRYPTED,{frag:t,payload:u,stats:{tstart:a,tdecrypt:d}})}).catch(u=>{this.warn(`${u.name}: ${u.message}`),this.state=se.IDLE})}}doTick(){if(!this.media){this.state=se.IDLE;return}if(this.state===se.IDLE){const{currentTrackId:e,levels:t}=this,n=t==null?void 0:t[e];if(!n||!t.length||!n.details||this.waitForLive(n))return;const{config:r}=this,s=this.getLoadPosition(),a=Ue.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],s,r.maxBufferHole),{end:u,len:d}=a,c=n.details,h=this.hls.maxBufferLength+c.levelTargetDuration;if(d>h)return;const m=c.fragments,p=m.length,y=c.edge;let v=null;const E=this.fragPrevious;if(u<y){const L=r.maxFragLookUpTolerance,R=u>y-L?0:L;v=Ss(E,m,Math.max(m[0].start,u),R),!v&&E&&E.start<m[0].start&&(v=m[0])}else v=m[p-1];if(v=this.filterReplacedPrimary(v,n.details),!v)return;const S=v.sn-c.startSN,A=m[S-1];if(A&&A.cc===v.cc&&this.fragmentTracker.getState(A)===Bt.NOT_LOADED&&(v=A),this.fragmentTracker.getState(v)===Bt.NOT_LOADED){const L=this.mapToInitFragWhenRequired(v);L&&this.loadFragment(L,n,u)}}}loadFragment(e,t,n){Rt(e)?super.loadFragment(e,t,n):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new SF(this.tracksBuffered[this.currentTrackId]||[])}}class SF{constructor(e){this.buffered=void 0;const t=(n,r,s)=>{if(r=r>>>0,r>s-1)throw new DOMException(`Failed to execute '${n}' on 'TimeRanges': The index provided (${r}) is greater than the maximum bound (${s})`);return e[r][n]};this.buffered={get length(){return e.length},end(n){return t("end",n,e.length)},start(n){return t("start",n,e.length)}}}}const TF={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},WA=i=>String.fromCharCode(TF[i]||i),hi=15,Zi=100,AF={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},wF={17:2,18:4,21:6,22:8,23:10,19:13,20:15},LF={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},RF={25:2,26:4,29:6,30:8,31:10,27:13,28:15},bF=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class IF{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const n=typeof t=="function"?t():t;nt.log(`${this.time} [${e}] ${n}`)}}}const hs=function(e){const t=[];for(let n=0;n<e.length;n++)t.push(e[n].toString(16));return t};class YA{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let n=0;n<t.length;n++){const r=t[n];e.hasOwnProperty(r)&&(this[r]=e[r])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class CF{constructor(){this.uchar=" ",this.penState=new YA}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class DF{constructor(e){this.chars=[],this.pos=0,this.currPenState=new YA,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<Zi;t++)this.chars.push(new CF);this.logger=e}equals(e){for(let t=0;t<Zi;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<Zi;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<Zi;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>Zi&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=Zi)}moveCursor(e){const t=this.pos+e;if(e>1)for(let n=this.pos+1;n<t+1;n++)this.chars[n].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=WA(e);if(this.pos>=Zi){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<Zi;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let n=0;n<Zi;n++){const r=this.chars[n].uchar;r!==" "&&(t=!1),e.push(r)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class Yh{constructor(e){this.rows=[],this.currRow=hi-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<hi;t++)this.rows.push(new DF(e));this.logger=e}reset(){for(let e=0;e<hi;e++)this.rows[e].clear();this.currRow=hi-1}equals(e){let t=!0;for(let n=0;n<hi;n++)if(!this.rows[n].equals(e.rows[n])){t=!1;break}return t}copy(e){for(let t=0;t<hi;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<hi;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+ot(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let u=0;u<hi;u++)this.rows[u].clear();const s=this.currRow+1-this.nrRollUpRows,a=this.lastOutputScreen;if(a){const u=a.rows[s].cueStartTime,d=this.logger.time;if(u!==null&&d!==null&&u<d)for(let c=0;c<this.nrRollUpRows;c++)this.rows[t-this.nrRollUpRows+c+1].copy(a.rows[s+c])}}this.currRow=t;const n=this.rows[this.currRow];if(e.indent!==null){const s=e.indent,a=Math.max(s-1,0);n.setCursor(e.indent),e.color=n.chars[a].penState.foreground}const r={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(r)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+ot(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let n="",r=-1;for(let s=0;s<hi;s++){const a=this.rows[s].getTextString();a&&(r=s+1,e?t.push("Row "+r+": '"+a+"'"):t.push(a.trim()))}return t.length>0&&(e?n="["+t.join(" | ")+"]":n=t.join(`
`)),n}getTextAndFormat(){return this.rows}}class Kx{constructor(e,t,n){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new Yh(n),this.nonDisplayedMemory=new Yh(n),this.lastOutputScreen=new Yh(n),this.currRollUpRow=this.displayedMemory.rows[hi-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=n}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[hi-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let n=0;n<e.length;n++)this.writeScreen.insertChar(e[n]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const n=Math.floor(e/2)-16,r=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=r[n]}this.logger.log(2,"MIDROW: "+ot(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class Wx{constructor(e,t,n){this.channels=void 0,this.currentChannel=0,this.cmdHistory=PF(),this.logger=void 0;const r=this.logger=new IF;this.channels=[null,new Kx(e,t,r),new Kx(e+1,n,r)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let n=0;n<t.length;n+=2){const r=t[n]&127,s=t[n+1]&127;let a=!1,u=null;if(r===0&&s===0)continue;this.logger.log(3,()=>"["+hs([t[n],t[n+1]])+"] -> ("+hs([r,s])+")");const d=this.cmdHistory;if(r>=16&&r<=31){if(kF(r,s,d)){wu(null,null,d),this.logger.log(3,()=>"Repeated command ("+hs([r,s])+") is dropped");continue}wu(r,s,this.cmdHistory),a=this.parseCmd(r,s),a||(a=this.parseMidrow(r,s)),a||(a=this.parsePAC(r,s)),a||(a=this.parseBackgroundAttributes(r,s))}else wu(null,null,d);if(!a&&(u=this.parseChars(r,s),u)){const h=this.currentChannel;h&&h>0?this.channels[h].insertChars(u):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!a&&!u&&this.logger.log(2,()=>"Couldn't parse cleaned data "+hs([r,s])+" orig: "+hs([t[n],t[n+1]]))}}parseCmd(e,t){const n=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,r=(e===23||e===31)&&t>=33&&t<=35;if(!(n||r))return!1;const s=e===20||e===21||e===23?1:2,a=this.channels[s];return e===20||e===21||e===28||e===29?t===32?a.ccRCL():t===33?a.ccBS():t===34?a.ccAOF():t===35?a.ccAON():t===36?a.ccDER():t===37?a.ccRU(2):t===38?a.ccRU(3):t===39?a.ccRU(4):t===40?a.ccFON():t===41?a.ccRDC():t===42?a.ccTR():t===43?a.ccRTD():t===44?a.ccEDM():t===45?a.ccCR():t===46?a.ccENM():t===47&&a.ccEOC():a.ccTO(t-32),this.currentChannel=s,!0}parseMidrow(e,t){let n=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?n=1:n=2,n!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const r=this.channels[n];return r?(r.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+hs([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let n;const r=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,s=(e===16||e===24)&&t>=64&&t<=95;if(!(r||s))return!1;const a=e<=23?1:2;t>=64&&t<=95?n=a===1?AF[e]:LF[e]:n=a===1?wF[e]:RF[e];const u=this.channels[a];return u?(u.setPAC(this.interpretPAC(n,t)),this.currentChannel=a,!0):!1}interpretPAC(e,t){let n;const r={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?n=t-96:n=t-64,r.underline=(n&1)===1,n<=13?r.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(n/2)]:n<=15?(r.italics=!0,r.color="white"):r.indent=Math.floor((n-16)/2)*4,r}parseChars(e,t){let n,r=null,s=null;if(e>=25?(n=2,s=e-8):(n=1,s=e),s>=17&&s<=19){let a;s===17?a=t+80:s===18?a=t+112:a=t+144,this.logger.log(2,()=>"Special char '"+WA(a)+"' in channel "+n),r=[a]}else e>=32&&e<=127&&(r=t===0?[e]:[e,t]);return r&&this.logger.log(3,()=>"Char codes =  "+hs(r).join(",")),r}parseBackgroundAttributes(e,t){const n=(e===16||e===24)&&t>=32&&t<=47,r=(e===23||e===31)&&t>=45&&t<=47;if(!(n||r))return!1;let s;const a={};e===16||e===24?(s=Math.floor((t-32)/2),a.background=bF[s],t%2===1&&(a.background=a.background+"_semi")):t===45?a.background="transparent":(a.foreground="black",t===47&&(a.underline=!0));const u=e<=23?1:2;return this.channels[u].setBkgData(a),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}wu(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const n=this.channels[t];n&&n.cueSplitAtTime(e)}}}function wu(i,e,t){t.a=i,t.b=e}function kF(i,e,t){return t.a===i&&t.b===e}function PF(){return{a:null,b:null}}var gp=(function(){if(cc!=null&&cc.VTTCue)return self.VTTCue;const i=["","lr","rl"],e=["start","middle","end","left","right"];function t(u,d){if(typeof d!="string"||!Array.isArray(u))return!1;const c=d.toLowerCase();return~u.indexOf(c)?c:!1}function n(u){return t(i,u)}function r(u){return t(e,u)}function s(u,...d){let c=1;for(;c<arguments.length;c++){const h=arguments[c];for(const m in h)u[m]=h[m]}return u}function a(u,d,c){const h=this,m={enumerable:!0};h.hasBeenReset=!1;let p="",y=!1,v=u,E=d,S=c,A=null,L="",R=!0,D="auto",k="start",U=50,C="middle",_=50,F="middle";Object.defineProperty(h,"id",s({},m,{get:function(){return p},set:function(O){p=""+O}})),Object.defineProperty(h,"pauseOnExit",s({},m,{get:function(){return y},set:function(O){y=!!O}})),Object.defineProperty(h,"startTime",s({},m,{get:function(){return v},set:function(O){if(typeof O!="number")throw new TypeError("Start time must be set to a number.");v=O,this.hasBeenReset=!0}})),Object.defineProperty(h,"endTime",s({},m,{get:function(){return E},set:function(O){if(typeof O!="number")throw new TypeError("End time must be set to a number.");E=O,this.hasBeenReset=!0}})),Object.defineProperty(h,"text",s({},m,{get:function(){return S},set:function(O){S=""+O,this.hasBeenReset=!0}})),Object.defineProperty(h,"region",s({},m,{get:function(){return A},set:function(O){A=O,this.hasBeenReset=!0}})),Object.defineProperty(h,"vertical",s({},m,{get:function(){return L},set:function(O){const W=n(O);if(W===!1)throw new SyntaxError("An invalid or illegal string was specified.");L=W,this.hasBeenReset=!0}})),Object.defineProperty(h,"snapToLines",s({},m,{get:function(){return R},set:function(O){R=!!O,this.hasBeenReset=!0}})),Object.defineProperty(h,"line",s({},m,{get:function(){return D},set:function(O){if(typeof O!="number"&&O!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");D=O,this.hasBeenReset=!0}})),Object.defineProperty(h,"lineAlign",s({},m,{get:function(){return k},set:function(O){const W=r(O);if(!W)throw new SyntaxError("An invalid or illegal string was specified.");k=W,this.hasBeenReset=!0}})),Object.defineProperty(h,"position",s({},m,{get:function(){return U},set:function(O){if(O<0||O>100)throw new Error("Position must be between 0 and 100.");U=O,this.hasBeenReset=!0}})),Object.defineProperty(h,"positionAlign",s({},m,{get:function(){return C},set:function(O){const W=r(O);if(!W)throw new SyntaxError("An invalid or illegal string was specified.");C=W,this.hasBeenReset=!0}})),Object.defineProperty(h,"size",s({},m,{get:function(){return _},set:function(O){if(O<0||O>100)throw new Error("Size must be between 0 and 100.");_=O,this.hasBeenReset=!0}})),Object.defineProperty(h,"align",s({},m,{get:function(){return F},set:function(O){const W=r(O);if(!W)throw new SyntaxError("An invalid or illegal string was specified.");F=W,this.hasBeenReset=!0}})),h.displayState=void 0}return a.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},a})();class _F{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function qA(i){function e(n,r,s,a){return(n|0)*3600+(r|0)*60+(s|0)+parseFloat(a||0)}const t=i.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}class MF{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,n){return n?this.has(e)?this.values[e]:t[n]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,n){for(let r=0;r<n.length;++r)if(t===n[r]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const n=parseFloat(t);if(n>=0&&n<=100)return this.set(e,n),!0}return!1}}function XA(i,e,t,n){const r=n?i.split(n):[i];for(const s in r){if(typeof r[s]!="string")continue;const a=r[s].split(t);if(a.length!==2)continue;const u=a[0],d=a[1];e(u,d)}}const Zf=new gp(0,0,""),Lu=Zf.align==="middle"?"middle":"center";function NF(i,e,t){const n=i;function r(){const u=qA(i);if(u===null)throw new Error("Malformed timestamp: "+n);return i=i.replace(/^[^\sa-zA-Z-]+/,""),u}function s(u,d){const c=new MF;XA(u,function(p,y){let v;switch(p){case"region":for(let E=t.length-1;E>=0;E--)if(t[E].id===y){c.set(p,t[E].region);break}break;case"vertical":c.alt(p,y,["rl","lr"]);break;case"line":v=y.split(","),c.integer(p,v[0]),c.percent(p,v[0])&&c.set("snapToLines",!1),c.alt(p,v[0],["auto"]),v.length===2&&c.alt("lineAlign",v[1],["start",Lu,"end"]);break;case"position":v=y.split(","),c.percent(p,v[0]),v.length===2&&c.alt("positionAlign",v[1],["start",Lu,"end","line-left","line-right","auto"]);break;case"size":c.percent(p,y);break;case"align":c.alt(p,y,["start",Lu,"end","left","right"]);break}},/:/,/\s/),d.region=c.get("region",null),d.vertical=c.get("vertical","");let h=c.get("line","auto");h==="auto"&&Zf.line===-1&&(h=-1),d.line=h,d.lineAlign=c.get("lineAlign","start"),d.snapToLines=c.get("snapToLines",!0),d.size=c.get("size",100),d.align=c.get("align",Lu);let m=c.get("position","auto");m==="auto"&&Zf.position===50&&(m=d.align==="start"||d.align==="left"?0:d.align==="end"||d.align==="right"?100:50),d.position=m}function a(){i=i.replace(/^\s+/,"")}if(a(),e.startTime=r(),a(),i.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+n);i=i.slice(3),a(),e.endTime=r(),a(),s(i,e)}function QA(i){return i.replace(/<br(?: \/)?>/gi,`
`)}class OF{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new _F,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function n(){let s=t.buffer,a=0;for(s=QA(s);a<s.length&&s[a]!=="\r"&&s[a]!==`
`;)++a;const u=s.slice(0,a);return s[a]==="\r"&&++a,s[a]===`
`&&++a,t.buffer=s.slice(a),u}function r(s){XA(s,function(a,u){},/:/)}try{let s="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;s=n();const u=s.match(/^()?WEBVTT([ \t].*)?$/);if(!(u!=null&&u[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let a=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(a?a=!1:s=n(),t.state){case"HEADER":/:/.test(s)?r(s):s||(t.state="ID");continue;case"NOTE":s||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(s)){t.state="NOTE";break}if(!s)continue;if(t.cue=new gp(0,0,""),t.state="CUE",s.indexOf("-->")===-1){t.cue.id=s;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{NF(s,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const u=s.indexOf("-->")!==-1;if(!s||u&&(a=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=s}continue;case"BADCUE":s||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const FF=/\r\n|\n\r|\n|\r/g,qh=function(e,t,n=0){return e.slice(n,n+t.length)===t},BF=function(e){let t=parseInt(e.slice(-3));const n=parseInt(e.slice(-6,-4)),r=parseInt(e.slice(-9,-7)),s=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!ye(t)||!ye(n)||!ye(r)||!ye(s))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*n,t+=60*1e3*r,t+=3600*1e3*s,t};function yp(i,e,t){return Ro(i.toString())+Ro(e.toString())+Ro(t)}const UF=function(e,t,n){let r=e[t],s=e[r.prevCC];if(!s||!s.new&&r.new){e.ccOffset=e.presentationOffset=r.start,r.new=!1;return}for(;(a=s)!=null&&a.new;){var a;e.ccOffset+=r.start-s.start,r.new=!1,r=s,s=e[r.prevCC]}e.presentationOffset=n};function $F(i,e,t,n,r,s,a){const u=new OF,d=Bn(new Uint8Array(i)).trim().replace(FF,`
`).split(`
`),c=[],h=e?KN(e.baseTime,e.timescale):0;let m="00:00.000",p=0,y=0,v,E=!0;u.oncue=function(S){const A=t[n];let L=t.ccOffset;const R=(p-h)/9e4;if(A!=null&&A.new&&(y!==void 0?L=t.ccOffset=A.start:UF(t,n,R)),R){if(!e){v=new Error("Missing initPTS for VTT MPEGTS");return}L=R-t.presentationOffset}const D=S.endTime-S.startTime,k=Nn((S.startTime+L-y)*9e4,r*9e4)/9e4;S.startTime=Math.max(k,0),S.endTime=Math.max(k+D,0);const U=S.text.trim();S.text=decodeURIComponent(encodeURIComponent(U)),S.id||(S.id=yp(S.startTime,S.endTime,U)),S.endTime>0&&c.push(S)},u.onparsingerror=function(S){v=S},u.onflush=function(){if(v){a(v);return}s(c)},d.forEach(S=>{if(E)if(qh(S,"X-TIMESTAMP-MAP=")){E=!1,S.slice(16).split(",").forEach(A=>{qh(A,"LOCAL:")?m=A.slice(6):qh(A,"MPEGTS:")&&(p=parseInt(A.slice(7)))});try{y=BF(m)/1e3}catch(A){v=A}return}else S===""&&(E=!1);u.parse(S+`
`)}),u.flush()}const Xh="stpp.ttml.im1t",ZA=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,JA=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,jF={left:"start",center:"center",right:"end",start:"start",end:"end"};function Yx(i,e,t,n){const r=Ge(new Uint8Array(i),["mdat"]);if(r.length===0){n(new Error("Could not parse IMSC1 mdat"));return}const s=r.map(u=>Bn(u)),a=zN(e.baseTime,1,e.timescale);try{s.forEach(u=>t(VF(u,a)))}catch(u){n(u)}}function VF(i,e){const r=new DOMParser().parseFromString(i,"text/xml").getElementsByTagName("tt")[0];if(!r)throw new Error("Invalid ttml");const s={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},a=Object.keys(s).reduce((m,p)=>(m[p]=r.getAttribute(`ttp:${p}`)||s[p],m),{}),u=r.getAttribute("xml:space")!=="preserve",d=qx(Qh(r,"styling","style")),c=qx(Qh(r,"layout","region")),h=Qh(r,"body","[begin]");return[].map.call(h,m=>{const p=e1(m,u);if(!p||!m.hasAttribute("begin"))return null;const y=Jh(m.getAttribute("begin"),a),v=Jh(m.getAttribute("dur"),a);let E=Jh(m.getAttribute("end"),a);if(y===null)throw Xx(m);if(E===null){if(v===null)throw Xx(m);E=y+v}const S=new gp(y-e,E-e,p);S.id=yp(S.startTime,S.endTime,S.text);const A=c[m.getAttribute("region")],L=d[m.getAttribute("style")],R=GF(A,L,d),{textAlign:D}=R;if(D){const k=jF[D];k&&(S.lineAlign=k),S.align=D}return rt(S,R),S}).filter(m=>m!==null)}function Qh(i,e,t){const n=i.getElementsByTagName(e)[0];return n?[].slice.call(n.querySelectorAll(t)):[]}function qx(i){return i.reduce((e,t)=>{const n=t.getAttribute("xml:id");return n&&(e[n]=t),e},{})}function e1(i,e){return[].slice.call(i.childNodes).reduce((t,n,r)=>{var s;return n.nodeName==="br"&&r?t+`
`:(s=n.childNodes)!=null&&s.length?e1(n,e):e?t+n.textContent.trim().replace(/\s+/g," "):t+n.textContent},"")}function GF(i,e,t){const n="http://www.w3.org/ns/ttml#styling";let r=null;const s=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],a=i!=null&&i.hasAttribute("style")?i.getAttribute("style"):null;return a&&t.hasOwnProperty(a)&&(r=t[a]),s.reduce((u,d)=>{const c=Zh(e,n,d)||Zh(i,n,d)||Zh(r,n,d);return c&&(u[d]=c),u},{})}function Zh(i,e,t){return i&&i.hasAttributeNS(e,t)?i.getAttributeNS(e,t):null}function Xx(i){return new Error(`Could not parse ttml timestamp ${i}`)}function Jh(i,e){if(!i)return null;let t=qA(i);return t===null&&(ZA.test(i)?t=HF(i,e):JA.test(i)&&(t=zF(i,e))),t}function HF(i,e){const t=ZA.exec(i),n=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+n/e.frameRate}function zF(i,e){const t=JA.exec(i),n=Number(t[1]);switch(t[2]){case"h":return n*3600;case"m":return n*60;case"ms":return n*1e3;case"f":return n/e.frameRate;case"t":return n/e.tickRate}return n}class Ru{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,n){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=n,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}class KF{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=Zx(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(w.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(w.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(w.MANIFEST_LOADING,this.onManifestLoading,this),e.on(w.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(w.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(w.FRAG_LOADING,this.onFragLoading,this),e.on(w.FRAG_LOADED,this.onFragLoaded,this),e.on(w.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(w.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(w.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(w.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(w.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(w.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(w.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(w.MANIFEST_LOADING,this.onManifestLoading,this),e.off(w.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(w.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(w.FRAG_LOADING,this.onFragLoading,this),e.off(w.FRAG_LOADED,this.onFragLoaded,this),e.off(w.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(w.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(w.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(w.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(w.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new Ru(this,"textTrack1"),t=new Ru(this,"textTrack2"),n=new Ru(this,"textTrack3"),r=new Ru(this,"textTrack4");this.cea608Parser1=new Wx(1,e,t),this.cea608Parser2=new Wx(3,n,r)}addCues(e,t,n,r,s){let a=!1;for(let u=s.length;u--;){const d=s[u],c=WF(d[0],d[1],t,n);if(c>=0&&(d[0]=Math.min(d[0],t),d[1]=Math.max(d[1],n),a=!0,c/(n-t)>.5))return}if(a||s.push([t,n]),this.config.renderTextTracksNatively){const u=this.captionsTracks[e];this.Cues.newCue(u,t,n,r)}else{const u=this.Cues.newCue(null,t,n,r);this.hls.trigger(w.CUES_PARSED,{type:"captions",cues:u,track:e})}}onInitPtsFound(e,{frag:t,id:n,initPTS:r,timescale:s,trackId:a}){const{unparsedVttFrags:u}=this;n===xe.MAIN&&(this.initPTS[t.cc]={baseTime:r,timescale:s,trackId:a}),u.length&&(this.unparsedVttFrags=[],u.forEach(d=>{this.initPTS[d.frag.cc]?this.onFragLoaded(w.FRAG_LOADED,d):this.hls.trigger(w.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:d.frag,error:new Error("Subtitle discontinuity domain does not match main")})}))}getExistingTrack(e,t){const{media:n}=this;if(n)for(let r=0;r<n.textTracks.length;r++){const s=n.textTracks[r];if(Qx(s,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return s}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:n,media:r}=this,{label:s,languageCode:a}=t[e],u=this.getExistingTrack(s,a);if(u)n[e]=u,ua(n[e]),HA(n[e],r);else{const d=this.createTextTrack("captions",s,a);d&&(d[e]=!0,n[e]=d)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const n=t.label,r={_id:e,label:n,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=r,this.hls.trigger(w.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[r]})}createTextTrack(e,t,n){const r=this.media;if(r)return r.addTextTrack(e,t,n)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){const n=!!t.transferMedia;if(this.media=null,n)return;const{captionsTracks:r}=this;Object.keys(r).forEach(s=>{ua(r[s]),delete r[s]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=Zx(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let n=0;n<t.length;n++)ua(t[n])}onSubtitleTracksUpdated(e,t){const n=t.subtitleTracks||[],r=n.some(s=>s.textCodec===Xh);if(this.config.enableWebVTT||r&&this.config.enableIMSC1){if(kA(this.tracks,n)){this.tracks=n;return}if(this.textTracks=[],this.tracks=n,this.config.renderTextTracksNatively){const a=this.media,u=a?zu(a.textTracks):null;if(this.tracks.forEach((d,c)=>{let h;if(u){let m=null;for(let p=0;p<u.length;p++)if(u[p]&&Qx(u[p],d)){m=u[p],u[p]=null;break}m&&(h=m)}if(h)ua(h);else{const m=t1(d);h=this.createTextTrack(m,d.name,d.lang),h&&(h.mode="disabled")}h&&this.textTracks.push(h)}),u!=null&&u.length){const d=u.filter(c=>c!==null).map(c=>c.label);d.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${d.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const a=this.tracks.map(u=>({label:u.name,kind:u.type.toLowerCase(),default:u.default,subtitleTrack:u}));this.hls.trigger(w.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:a})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(n=>{const r=/(?:CC|SERVICE)([1-4])/.exec(n.instreamId);if(!r)return;const s=`textTrack${r[1]}`,a=this.captionsProperties[s];a&&(a.label=n.name,n.lang&&(a.languageCode=n.lang),a.media=n)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return t==null?void 0:t.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===xe.MAIN){var n,r;const{cea608Parser1:s,cea608Parser2:a,lastSn:u}=this,{cc:d,sn:c}=t.frag,h=(n=(r=t.part)==null?void 0:r.index)!=null?n:-1;s&&a&&(c!==u+1||c===u&&h!==this.lastPartIndex+1||d!==this.lastCc)&&(s.reset(),a.reset()),this.lastCc=d,this.lastSn=c,this.lastPartIndex=h}}onFragLoaded(e,t){const{frag:n,payload:r}=t;if(n.type===xe.SUBTITLE)if(r.byteLength){const s=n.decryptdata,a="stats"in t;if(s==null||!s.encrypted||a){const u=this.tracks[n.level],d=this.vttCCs;d[n.cc]||(d[n.cc]={start:n.start,prevCC:this.prevCC,new:!0},this.prevCC=n.cc),u&&u.textCodec===Xh?this._parseIMSC1(n,r):this._parseVTTs(t)}}else this.hls.trigger(w.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const n=this.hls;Yx(t,this.initPTS[e.cc],r=>{this._appendCues(r,e.level),n.trigger(w.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},r=>{n.logger.log(`Failed to parse IMSC1: ${r}`),n.trigger(w.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:r})})}_parseVTTs(e){var t;const{frag:n,payload:r}=e,{initPTS:s,unparsedVttFrags:a}=this,u=s.length-1;if(!s[n.cc]&&u===-1){a.push(e);return}const d=this.hls,c=(t=n.initSegment)!=null&&t.data?Qn(n.initSegment.data,new Uint8Array(r)).buffer:r;$F(c,this.initPTS[n.cc],this.vttCCs,n.cc,n.start,h=>{this._appendCues(h,n.level),d.trigger(w.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:n})},h=>{const m=h.message==="Missing initPTS for VTT MPEGTS";m?a.push(e):this._fallbackToIMSC1(n,r),d.logger.log(`Failed to parse VTT cue: ${h}`),!(m&&u>n.cc)&&d.trigger(w.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:h})})}_fallbackToIMSC1(e,t){const n=this.tracks[e.level];n.textCodec||Yx(t,this.initPTS[e.cc],()=>{n.textCodec=Xh,this._parseIMSC1(e,t)},()=>{n.textCodec="wvtt"})}_appendCues(e,t){const n=this.hls;if(this.config.renderTextTracksNatively){const r=this.textTracks[t];if(!r||r.mode==="disabled")return;e.forEach(s=>zA(r,s))}else{const r=this.tracks[t];if(!r)return;const s=r.default?"default":"subtitles"+t;n.trigger(w.CUES_PARSED,{type:"subtitles",cues:e,track:s})}}onFragDecrypted(e,t){const{frag:n}=t;n.type===xe.SUBTITLE&&this.onFragLoaded(w.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:n,samples:r}=t;if(!(n.type===xe.MAIN&&this.closedCaptionsForLevel(n)==="NONE"))for(let s=0;s<r.length;s++){const a=r[s].bytes;if(a){this.cea608Parser1||this.initCea608Parsers();const u=this.extractCea608Data(a);this.cea608Parser1.addData(r[s].pts,u[0]),this.cea608Parser2.addData(r[s].pts,u[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:n,endOffsetSubtitles:r,type:s}){const{media:a}=this;if(!(!a||a.currentTime<n)){if(!s||s==="video"){const{captionsTracks:u}=this;Object.keys(u).forEach(d=>Qf(u[d],t,n))}if(this.config.renderTextTracksNatively&&t===0&&r!==void 0){const{textTracks:u}=this;Object.keys(u).forEach(d=>Qf(u[d],t,r))}}}extractCea608Data(e){const t=[[],[]],n=e[0]&31;let r=2;for(let s=0;s<n;s++){const a=e[r++],u=127&e[r++],d=127&e[r++];if(u===0&&d===0)continue;if((4&a)!==0){const h=3&a;(h===0||h===1)&&(t[h].push(u),t[h].push(d))}}return t}}function t1(i){return i.characteristics&&/transcribes-spoken-dialog/gi.test(i.characteristics)&&/describes-music-and-sound/gi.test(i.characteristics)?"captions":"subtitles"}function Qx(i,e){return!!i&&i.kind===t1(e)&&Wf(e,i)}function WF(i,e,t,n){return Math.min(e,n)-Math.max(i,t)}function Zx(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}const YF=/\s/,qF={newCue(i,e,t,n){const r=[];let s,a,u,d,c;const h=self.VTTCue||self.TextTrackCue;for(let p=0;p<n.rows.length;p++)if(s=n.rows[p],u=!0,d=0,c="",!s.isEmpty()){var m;for(let E=0;E<s.chars.length;E++)YF.test(s.chars[E].uchar)&&u?d++:(c+=s.chars[E].uchar,u=!1);s.cueStartTime=e,e===t&&(t+=1e-4),d>=16?d--:d++;const y=QA(c.trim()),v=yp(e,t,y);i!=null&&(m=i.cues)!=null&&m.getCueById(v)||(a=new h(e,t,y),a.id=v,a.line=p+1,a.align="left",a.position=10+Math.min(80,Math.floor(d*8/32)*10),r.push(a))}return i&&r.length&&(r.sort((p,y)=>p.line==="auto"||y.line==="auto"?0:p.line>8&&y.line>8?y.line-p.line:p.line-y.line),r.forEach(p=>zA(i,p))),r}};function XF(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const QF=/(\d+)-(\d+)\/(\d+)/;class Jx{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||t2,this.controller=new self.AbortController,this.stats=new qm}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,n){const r=this.stats;if(r.loading.start)throw new Error("Loader can only be used once.");r.loading.start=self.performance.now();const s=ZF(e,this.controller.signal),a=e.responseType==="arraybuffer",u=a?"byteLength":"length",{maxTimeToFirstByteMs:d,maxLoadTimeMs:c}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=n,this.request=this.fetchSetup(e,s),self.clearTimeout(this.requestTimeout),t.timeout=d&&ye(d)?d:c,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(r,e,this.response))},t.timeout),(Vo(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(m=>{var p;this.response=this.loader=m;const y=Math.max(self.performance.now(),r.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=c,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(r,e,this.response))},c-(y-r.loading.start)),!m.ok){const{status:E,statusText:S}=m;throw new n2(S||"fetch, bad network response",E,m)}r.loading.first=y,r.total=e2(m.headers)||r.total;const v=(p=this.callbacks)==null?void 0:p.onProgress;return v&&ye(t.highWaterMark)?this.loadProgressively(m,r,e,t.highWaterMark,v):a?m.arrayBuffer():e.responseType==="json"?m.json():m.text()}).then(m=>{var p,y;const v=this.response;if(!v)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),r.loading.end=Math.max(self.performance.now(),r.loading.first);const E=m[u];E&&(r.loaded=r.total=E);const S={url:v.url,data:m,code:v.status},A=(p=this.callbacks)==null?void 0:p.onProgress;A&&!ye(t.highWaterMark)&&A(r,e,m,v),(y=this.callbacks)==null||y.onSuccess(S,r,e,v)}).catch(m=>{var p;if(self.clearTimeout(this.requestTimeout),r.aborted)return;const y=m&&m.code||0,v=m?m.message:null;(p=this.callbacks)==null||p.onError({code:y,text:v},e,m?m.details:null,r)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,n,r=0,s){const a=new dA,u=e.body.getReader(),d=()=>u.read().then(c=>{if(c.done)return a.dataLength&&s(t,n,a.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const h=c.value,m=h.length;return t.loaded+=m,m<r||a.dataLength?(a.push(h),a.dataLength>=r&&s(t,n,a.flush().buffer,e)):s(t,n,h.buffer,e),d()}).catch(()=>Promise.reject());return d()}}function ZF(i,e){const t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(rt({},i.headers))};return i.rangeEnd&&t.headers.set("Range","bytes="+i.rangeStart+"-"+String(i.rangeEnd-1)),t}function JF(i){const e=QF.exec(i);if(e)return parseInt(e[2])-parseInt(e[1])+1}function e2(i){const e=i.get("Content-Range");if(e){const n=JF(e);if(ye(n))return n}const t=i.get("Content-Length");if(t)return parseInt(t)}function t2(i,e){return new self.Request(i.url,e)}class n2 extends Error{constructor(e,t,n){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=n}}const i2=/^age:\s*[\d.]+\s*$/im;class n1{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new qm,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,n){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=n,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const n=this.loader=new self.XMLHttpRequest,r=this.stats;r.loading.first=0,r.loaded=0,r.aborted=!1;const s=this.xhrSetup;s?Promise.resolve().then(()=>{if(!(this.loader!==n||this.stats.aborted))return s(n,t.url)}).catch(a=>{if(!(this.loader!==n||this.stats.aborted))return n.open("GET",t.url,!0),s(n,t.url)}).then(()=>{this.loader!==n||this.stats.aborted||this.openAndSendXhr(n,t,e)}).catch(a=>{var u;(u=this.callbacks)==null||u.onError({code:n.status,text:a.message},t,n,r)}):this.openAndSendXhr(n,t,e)}openAndSendXhr(e,t,n){e.readyState||e.open("GET",t.url,!0);const r=t.headers,{maxTimeToFirstByteMs:s,maxLoadTimeMs:a}=n.loadPolicy;if(r)for(const u in r)e.setRequestHeader(u,r[u]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),n.timeout=s&&ye(s)?s:a,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),n.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:n}=this;if(!e||!t)return;const r=t.readyState,s=this.config;if(!n.aborted&&r>=2&&(n.loading.first===0&&(n.loading.first=Math.max(self.performance.now(),n.loading.start),s.timeout!==s.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),s.timeout=s.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),s.loadPolicy.maxLoadTimeMs-(n.loading.first-n.loading.start)))),r===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const c=t.status,h=t.responseType==="text"?t.responseText:null;if(c>=200&&c<300){const v=h??t.response;if(v!=null){var a,u;n.loading.end=Math.max(self.performance.now(),n.loading.first);const E=t.responseType==="arraybuffer"?v.byteLength:v.length;n.loaded=n.total=E,n.bwEstimate=n.total*8e3/(n.loading.end-n.loading.first);const S=(a=this.callbacks)==null?void 0:a.onProgress;S&&S(n,e,v,t);const A={url:t.responseURL,data:v,code:c};(u=this.callbacks)==null||u.onSuccess(A,n,e,t);return}}const m=s.loadPolicy.errorRetry,p=n.retry,y={url:e.url,data:void 0,code:c};if(lc(m,p,!1,y))this.retry(m);else{var d;nt.error(`${c} while loading ${e.url}`),(d=this.callbacks)==null||d.onError({code:c,text:t.statusText},e,t,n)}}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry,t=this.stats.retry;if(lc(e,t,!0))this.retry(e);else{var n;nt.warn(`timeout while loading ${(n=this.context)==null?void 0:n.url}`);const r=this.callbacks;r&&(this.abortInternal(),r.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:n}=this;this.retryDelay=Jm(e,n.retry),n.retry++,nt.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t==null?void 0:t.url}, retrying ${n.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&i2.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const r2={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},s2=tt(tt({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:n1,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:yM,bufferController:oO,capLevelController:fp,errorController:TM,fpsController:lF,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:eA,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:r2},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},a2()),{},{subtitleStreamController:EF,subtitleTrackController:dF,timelineController:KF,audioStreamController:iO,audioTrackController:rO,emeController:ma,cmcdController:rF,contentSteeringController:aF,interstitialsController:xF});function a2(){return{cueHandler:qF,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function o2(i,e,t){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const n=Jf(i),r=["manifest","level","frag"],s=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return r.forEach(a=>{const u=`${a==="level"?"playlist":a}LoadPolicy`,d=e[u]===void 0,c=[];s.forEach(h=>{const m=`${a}Loading${h}`,p=e[m];if(p!==void 0&&d){c.push(m);const y=n[u].default;switch(e[u]={default:y},h){case"TimeOut":y.maxLoadTimeMs=p,y.maxTimeToFirstByteMs=p;break;case"MaxRetry":y.errorRetry.maxNumRetry=p,y.timeoutRetry.maxNumRetry=p;break;case"RetryDelay":y.errorRetry.retryDelayMs=p,y.timeoutRetry.retryDelayMs=p;break;case"MaxRetryTimeout":y.errorRetry.maxRetryDelayMs=p,y.timeoutRetry.maxRetryDelayMs=p;break}}}),c.length&&t.warn(`hls.js config: "${c.join('", "')}" setting(s) are deprecated, use "${u}": ${ot(e[u])}`)}),tt(tt({},n),e)}function Jf(i){return i&&typeof i=="object"?Array.isArray(i)?i.map(Jf):Object.keys(i).reduce((e,t)=>(e[t]=Jf(i[t]),e),{}):i}function l2(i,e){const t=i.loader;t!==Jx&&t!==n1?(e.log("[config]: Custom loader detected, cannot enable progressive streaming"),i.progressive=!1):XF()&&(i.loader=Jx,i.progressive=!0,i.enableSoftwareAES=!0,e.log("[config]: Progressive streaming enabled, using FetchLoader"))}const Ku=2,u2=.1,c2=.05,d2=100;class h2 extends qT{constructor(e,t){super("gap-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var n;(n=this.media)!=null&&n.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{if(this.hls){var n;this.ended=((n=this.media)==null?void 0:n.currentTime)||1,this.hls.trigger(w.MEDIA_ENDED,{stalled:!1})}},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(w.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(w.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(w.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(w.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(w.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(w.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(d2),this.mediaSource=t.mediaSource;const n=this.media=t.media;mn(n,"playing",this.onMediaPlaying),mn(n,"waiting",this.onMediaWaiting),mn(n,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();const{media:n}=this;n&&(Ln(n,"playing",this.onMediaPlaying),Ln(n,"waiting",this.onMediaWaiting),Ln(n,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(!((e=this.media)!=null&&e.readyState)||!this.hasBuffered)return;const t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var n,r;const s=(n=this.hls)==null?void 0:n.config;if(!s)return;const a=this.media;if(!a)return;const{seeking:u}=a,d=this.seeking&&!u,c=!this.seeking&&u,h=a.paused&&!u||a.ended||a.playbackRate===0;if(this.seeking=u,e!==t){t&&(this.ended=0),this.moved=!0,u||(this.nudgeRetry=0,s.nudgeOnVideoHole&&!h&&e>t&&this.nudgeOnVideoHole(e,t)),this.waiting===0&&this.stallResolved(e);return}if(c||d){d&&this.stallResolved(e);return}if(h){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&a.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(w.MEDIA_ENDED,{stalled:!1}));return}if(!Ue.getBuffered(a).length){this.nudgeRetry=0;return}const m=Ue.bufferInfo(a,e,0),p=m.nextStart||0,y=this.fragmentTracker;if(u&&y&&this.hls){const U=eE(this.hls.inFlightFragments,e),C=m.len>Ku,_=!p||U||p-e>Ku&&!y.getPartialFragment(e);if(C||_)return;this.moved=!1}const v=(r=this.hls)==null?void 0:r.latestLevelDetails;if(!this.moved&&this.stalled!==null&&y){if(!(m.len>0)&&!p)return;const C=Math.max(p,m.start||0)-e,F=!!(v!=null&&v.live)?v.targetduration*2:Ku,O=bu(e,y);if(C>0&&(C<=F||O)){a.paused||this._trySkipBufferHole(O);return}}const E=s.detectStallWithCurrentTimeMs,S=self.performance.now(),A=this.waiting;let L=this.stalled;if(L===null)if(A>0&&S-A<E)L=this.stalled=A;else{this.stalled=S;return}const R=S-L;if(!u&&(R>=E||A)&&this.hls){var D;if(((D=this.mediaSource)==null?void 0:D.readyState)==="ended"&&!(v!=null&&v.live)&&Math.abs(e-((v==null?void 0:v.edge)||0))<1){if(this.ended)return;this.ended=e||1,this.hls.trigger(w.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(m),!this.media||!this.hls)return}const k=Ue.bufferInfo(a,e,s.maxBufferHole);this._tryFixBufferStall(k,R,e)}stallResolved(e){const t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){const n=self.performance.now()-t;this.log(`playback not stuck anymore @${e}, after ${Math.round(n)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(w.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var n;const r=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(n=this.buffered.audio)!=null&&n.length&&r&&r.length>1&&e>r.end(0)){const s=Ue.bufferedInfo(Ue.timeRangesToArray(this.buffered.audio),e,0);if(s.len>1&&t>=s.start){const a=Ue.timeRangesToArray(r),u=Ue.bufferedInfo(a,t,0).bufferedIndex;if(u>-1&&u<a.length-1){const d=Ue.bufferedInfo(a,e,0).bufferedIndex,c=a[u].end,h=a[u+1].start;if((d===-1||d>u)&&h-c<1&&e-c<2){const m=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${c} -> ${h} buffered index: ${d}`);this.warn(m.message),this.media.currentTime+=1e-6;let p=bu(e,this.fragmentTracker);p&&"fragment"in p?p=p.fragment:p||(p=void 0);const y=Ue.bufferInfo(this.media,e,0);this.hls.trigger(w.ERROR,{type:Ie.MEDIA_ERROR,details:Y.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:m,reason:m.message,frag:p,buffer:y.len,bufferInfo:y})}}}}}_tryFixBufferStall(e,t,n){var r,s;const{fragmentTracker:a,media:u}=this,d=(r=this.hls)==null?void 0:r.config;if(!u||!a||!d)return;const c=(s=this.hls)==null?void 0:s.latestLevelDetails,h=bu(n,a);if((h||c!=null&&c.live&&n<c.fragmentStart)&&(this._trySkipBufferHole(h)||!this.media))return;const m=e.buffered,p=this.adjacentTraversal(e,n);(m&&m.length>1&&e.len>d.maxBufferHole||e.nextStart&&(e.nextStart-n<d.maxBufferHole||p))&&(t>d.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}adjacentTraversal(e,t){const n=this.fragmentTracker,r=e.nextStart;if(n&&r){const s=n.getFragAtPos(t,xe.MAIN),a=n.getFragAtPos(r,xe.MAIN);if(s&&a)return a.sn-s.sn<2}return!1}_reportStall(e){const{hls:t,media:n,stallReported:r,stalled:s}=this;if(!r&&s!==null&&n&&t){this.stallReported=!0;const a=new Error(`Playback stalling at @${n.currentTime} due to low buffer (${ot(e)})`);this.warn(a.message),t.trigger(w.ERROR,{type:Ie.MEDIA_ERROR,details:Y.BUFFER_STALLED_ERROR,fatal:!1,error:a,buffer:e.len,bufferInfo:e,stalled:{start:s}})}}_trySkipBufferHole(e){var t;const{fragmentTracker:n,media:r}=this,s=(t=this.hls)==null?void 0:t.config;if(!r||!n||!s)return 0;const a=r.currentTime,u=Ue.bufferInfo(r,a,0),d=a<u.start?u.start:u.nextStart;if(d&&this.hls){const h=u.len<=s.maxBufferHole,m=u.len>0&&u.len<1&&r.readyState<3,p=d-a;if(p>0&&(h||m)){if(p>s.maxBufferHole){let v=!1;if(a===0){const E=n.getAppendedFrag(0,xe.MAIN);E&&d<E.end&&(v=!0)}if(!v&&e){var c;if(!((c=this.hls.loadLevelObj)!=null&&c.details)||eE(this.hls.inFlightFragments,d))return 0;let S=!1,A=e.end;for(;A<d;){const L=bu(A,n);if(L)A+=L.duration;else{S=!0;break}}if(S)return 0}}const y=Math.max(d+c2,a+u2);if(this.warn(`skipping hole, adjusting currentTime from ${a} to ${y}`),this.moved=!0,r.currentTime=y,!(e!=null&&e.gap)){const v=new Error(`fragment loaded with buffer holes, seeking from ${a} to ${y}`),E={type:Ie.MEDIA_ERROR,details:Y.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:v,reason:v.message,buffer:u.len,bufferInfo:u};e&&("fragment"in e?E.part=e:E.frag=e),this.hls.trigger(w.ERROR,E)}return y}}return 0}_tryNudgeBuffer(e){const{hls:t,media:n,nudgeRetry:r}=this,s=t==null?void 0:t.config;if(!n||!s)return 0;const a=n.currentTime;if(this.nudgeRetry++,r<s.nudgeMaxRetry){const u=a+(r+1)*s.nudgeOffset,d=new Error(`Nudging 'currentTime' from ${a} to ${u}`);this.warn(d.message),n.currentTime=u,t.trigger(w.ERROR,{type:Ie.MEDIA_ERROR,details:Y.BUFFER_NUDGE_ON_STALL,error:d,fatal:!1,buffer:e.len,bufferInfo:e})}else{const u=new Error(`Playhead still not moving while enough data buffered @${a} after ${s.nudgeMaxRetry} nudges`);this.error(u.message),t.trigger(w.ERROR,{type:Ie.MEDIA_ERROR,details:Y.BUFFER_STALLED_ERROR,error:u,fatal:!0,buffer:e.len,bufferInfo:e})}}}function eE(i,e){const t=tE(i.main);if(t&&t.start<=e)return t;const n=tE(i.audio);return n&&n.start<=e?n:null}function tE(i){if(!i)return null;switch(i.state){case se.IDLE:case se.STOPPED:case se.ENDED:case se.ERROR:return null}return i.frag}function bu(i,e){return e.getAppendedFrag(i,xe.MAIN)||e.getPartialFragment(i)}const f2=.25;function em(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function ef(i,e,t,n,r){let s=new i(e,t,"");try{s.value=n,r&&(s.type=r)}catch{s=new i(e,t,ot(r?tt({type:r},n):n))}return s}const Iu=(()=>{const i=em();try{i&&new i(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class m2{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.assetCue=void 0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(w.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e&&(e.on(w.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(w.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(w.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(w.MANIFEST_LOADING,this.onManifestLoading,this),e.on(w.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(w.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(w.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(w.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(w.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(w.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(w.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(w.MANIFEST_LOADING,this.onManifestLoading,this),e.off(w.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(w.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(w.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(w.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}onMediaAttaching(e,t){var n;this.media=t.media,((n=t.overrides)==null?void 0:n.cueRemoval)===!1&&(this.removeCues=!1)}onMediaAttached(){var e;const t=(e=this.hls)==null?void 0:e.latestLevelDetails;t&&this.updateDateRangeCues(t)}onMediaDetaching(e,t){this.media=null,!t.transferMedia&&(this.id3Track&&(this.removeCues&&ua(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const n=e[t];if(n.kind==="metadata"&&n.label==="id3")return HA(n,this.media),n}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media||!this.hls)return;const{enableEmsgMetadataCues:n,enableID3MetadataCues:r}=this.hls.config;if(!n&&!r)return;const{samples:s}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const a=em();if(a)for(let u=0;u<s.length;u++){const d=s[u].type;if(d===Fn.emsg&&!n||!r)continue;const c=vA(s[u].data),h=s[u].pts;let m=h+s[u].duration;m>Iu&&(m=Iu),m-h<=0&&(m=h+f2);for(let y=0;y<c.length;y++){const v=c[y];if(!xA(v)){this.updateId3CueEnds(h,d);const E=ef(a,h,m,v,d);E&&this.id3Track.addCue(E)}}}}updateId3CueEnds(e,t){var n;const r=(n=this.id3Track)==null?void 0:n.cues;if(r)for(let s=r.length;s--;){const a=r[s];a.type===t&&a.startTime<e&&a.endTime===Iu&&(a.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:n,type:r}){const{id3Track:s,hls:a}=this;if(!a)return;const{config:{enableEmsgMetadataCues:u,enableID3MetadataCues:d}}=a;if(s&&(u||d)){let c;r==="audio"?c=h=>h.type===Fn.audioId3&&d:r==="video"?c=h=>h.type===Fn.emsg&&u:c=h=>h.type===Fn.audioId3&&d||h.type===Fn.emsg&&u,Qf(s,t,n,c)}}onLevelUpdated(e,{details:t}){this.updateDateRangeCues(t,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.hls||!this.media)return;const{assetPlayerId:n,timelineOffset:r,enableDateRangeMetadataCues:s,interstitialsController:a}=this.hls.config;if(!s)return;const u=em();if(n&&r&&!a){const{fragmentStart:E,fragmentEnd:S}=e;let A=this.assetCue;A?(A.startTime=E,A.endTime=S):u&&(A=this.assetCue=ef(u,E,S,{assetPlayerId:this.hls.config.assetPlayerId},"hlsjs.interstitial.asset"),A&&(A.id=n,this.id3Track||(this.id3Track=this.createTrack(this.media)),this.id3Track.addCue(A),A.addEventListener("enter",this.onEventCueEnter)))}if(!e.hasProgramDateTime)return;const{id3Track:d}=this,{dateRanges:c}=e,h=Object.keys(c);let m=this.dateRangeCuesAppended;if(d&&t){var p;if((p=d.cues)!=null&&p.length){const E=Object.keys(m).filter(S=>!h.includes(S));for(let S=E.length;S--;){var y;const A=E[S],L=(y=m[A])==null?void 0:y.cues;delete m[A],L&&Object.keys(L).forEach(R=>{const D=L[R];if(D){D.removeEventListener("enter",this.onEventCueEnter);try{d.removeCue(D)}catch{}}})}}else m=this.dateRangeCuesAppended={}}const v=e.fragments[e.fragments.length-1];if(!(h.length===0||!ye(v==null?void 0:v.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(let E=0;E<h.length;E++){const S=h[E],A=c[S],L=A.startTime,R=m[S],D=(R==null?void 0:R.cues)||{};let k=(R==null?void 0:R.durationKnown)||!1,U=Iu;const{duration:C,endDate:_}=A;if(_&&C!==null)U=L+C,k=!0;else if(A.endOnNext&&!k){const O=h.reduce((W,z)=>{if(z!==A.id){const re=c[z];if(re.class===A.class&&re.startDate>A.startDate&&(!W||A.startDate<W.startDate))return re}return W},null);O&&(U=O.startTime,k=!0)}const F=Object.keys(A.attr);for(let O=0;O<F.length;O++){const W=F[O];if(!NM(W))continue;const z=D[W];if(z)k&&!(R!=null&&R.durationKnown)?z.endTime=U:Math.abs(z.startTime-L)>.01&&(z.startTime=L,z.endTime=U);else if(u){let re=A.attr[W];OM(W)&&(re=CT(re));const ce=ef(u,L,U,{key:W,data:re},Fn.dateRange);ce&&(ce.id=S,this.id3Track.addCue(ce),D[W]=ce,a&&(W==="X-ASSET-LIST"||W==="X-ASSET-URL")&&ce.addEventListener("enter",this.onEventCueEnter))}}m[S]={cues:D,dateRange:A,durationKnown:k}}}}}class p2{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:t}=this,n=this.levelDetails;if(!t||!n)return;this.currentTime=t.currentTime;const r=this.computeLatency();if(r===null)return;this._latency=r;const{lowLatencyMode:s,maxLiveSyncPlaybackRate:a}=this.config;if(!s||a===1||!n.live)return;const u=this.targetLatency;if(u===null)return;const d=r-u,c=Math.min(this.maxLatency,u+n.targetduration);if(d<c&&d>.05&&this.forwardBufferLength>1){const m=Math.min(2,Math.max(1,a)),p=Math.round(2/(1+Math.exp(-.75*d-this.edgeStalled))*20)/20,y=Math.min(m,Math.max(1,p));this.changeMediaPlaybackRate(t,y)}else t.playbackRate!==1&&t.playbackRate!==0&&this.changeMediaPlaybackRate(t,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return((e=this.hls)==null?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(e.liveMaxLatencyDuration!==void 0)return e.liveMaxLatencyDuration;const t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const e=this.levelDetails;if(e===null||this.hls===null)return null;const{holdBack:t,partHoldBack:n,targetduration:r}=e,{liveSyncDuration:s,liveSyncDurationCount:a,lowLatencyMode:u}=this.config,d=this.hls.userConfig;let c=u&&n||t;(this._targetLatencyUpdated||d.liveSyncDuration||d.liveSyncDurationCount||c===0)&&(c=s!==void 0?s:a*r);const h=r;return c+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,h)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency;if(e===null||t===null)return null;const n=this.levelDetails;if(n===null)return null;const r=n.edge,s=e-t-this.edgeStalled,a=r-n.totalduration,u=r-(this.config.lowLatencyMode&&n.partTarget||n.targetduration);return Math.min(Math.max(a,s),u)}get drift(){const e=this.levelDetails;return e===null?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(e===null)return 0;const t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;const n=e.buffered.length;return(n?e.buffered.end(n-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on(w.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(w.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(w.MANIFEST_LOADING,this.onManifestLoading,this),e.on(w.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(w.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(w.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(w.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(w.MANIFEST_LOADING,this.onManifestLoading,this),e.off(w.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(w.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){t.advanced&&this.onTimeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var n;t.details===Y.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(n=this.levelDetails)!=null&&n.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var n,r;e.playbackRate!==t&&((n=this.hls)==null||n.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${(r=this.targetLatency)==null?void 0:r.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${t}`),e.playbackRate=t)}estimateLiveEdge(){const e=this.levelDetails;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}class g2 extends hp{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(w.MANIFEST_LOADING,this.onManifestLoading,this),e.on(w.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(w.LEVEL_LOADED,this.onLevelLoaded,this),e.on(w.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(w.FRAG_BUFFERED,this.onFragBuffered,this),e.on(w.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(w.MANIFEST_LOADING,this.onManifestLoading,this),e.off(w.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(w.LEVEL_LOADED,this.onLevelLoaded,this),e.off(w.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(w.FRAG_BUFFERED,this.onFragBuffered,this),e.off(w.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const n=this.hls.config.preferManagedMediaSource,r=[],s={},a={};let u=!1,d=!1,c=!1;t.levels.forEach(h=>{const m=h.attrs;let{audioCodec:p,videoCodec:y}=h;p&&(h.audioCodec=p=rc(p,n)||void 0),y&&(y=h.videoCodec=Z_(y));const{width:v,height:E,unknownCodecs:S}=h,A=(S==null?void 0:S.length)||0;if(u||(u=!!(v&&E)),d||(d=!!y),c||(c=!!p),A||p&&!this.isAudioSupported(p)||y&&!this.isVideoSupported(y)){this.log(`Some or all CODECS not supported "${m.CODECS}"`);return}const{CODECS:L,"FRAME-RATE":R,"HDCP-LEVEL":D,"PATHWAY-ID":k,RESOLUTION:U,"VIDEO-RANGE":C}=m,F=`${`${k||"."}-`}${h.bitrate}-${U}-${R}-${L}-${C}-${D}`;if(s[F])if(s[F].uri!==h.url&&!h.attrs["PATHWAY-ID"]){const O=a[F]+=1;h.attrs["PATHWAY-ID"]=new Array(O+1).join(".");const W=this.createLevel(h);s[F]=W,r.push(W)}else s[F].addGroupId("audio",m.AUDIO),s[F].addGroupId("text",m.SUBTITLES);else{const O=this.createLevel(h);s[F]=O,a[F]=1,r.push(O)}}),this.filterAndSortMediaOptions(r,t,u,d,c)}createLevel(e){const t=new Uo(e),n=e.supplemental;if(n!=null&&n.videoCodec&&!this.isVideoSupported(n.videoCodec)){const r=new Error(`SUPPLEMENTAL-CODECS not supported "${n.videoCodec}"`);this.log(r.message),t.supportedResult=jT(r,[])}return t}isAudioSupported(e){return Fo(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return Fo(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,n,r,s){var a;let u=[],d=[],c=e;const h=((a=t.stats)==null?void 0:a.parsing)||{};if((n||r)&&s&&(c=c.filter(({videoCodec:L,videoRange:R,width:D,height:k})=>(!!L||!!(D&&k))&&lM(R))),c.length===0){Promise.resolve().then(()=>{if(this.hls){let L="no level with compatible codecs found in manifest",R=L;t.levels.length&&(R=`one or more CODECS in variant not supported: ${ot(t.levels.map(k=>k.attrs.CODECS).filter((k,U,C)=>C.indexOf(k)===U))}`,this.warn(R),L+=` (${R})`);const D=new Error(L);this.hls.trigger(w.ERROR,{type:Ie.MEDIA_ERROR,details:Y.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:D,reason:R})}}),h.end=performance.now();return}t.audioTracks&&(u=t.audioTracks.filter(L=>!L.audioCodec||this.isAudioSupported(L.audioCodec)),nE(u)),t.subtitles&&(d=t.subtitles,nE(d));const m=c.slice(0);c.sort((L,R)=>{if(L.attrs["HDCP-LEVEL"]!==R.attrs["HDCP-LEVEL"])return(L.attrs["HDCP-LEVEL"]||"")>(R.attrs["HDCP-LEVEL"]||"")?1:-1;if(n&&L.height!==R.height)return L.height-R.height;if(L.frameRate!==R.frameRate)return L.frameRate-R.frameRate;if(L.videoRange!==R.videoRange)return sc.indexOf(L.videoRange)-sc.indexOf(R.videoRange);if(L.videoCodec!==R.videoCodec){const D=Wv(L.videoCodec),k=Wv(R.videoCodec);if(D!==k)return k-D}if(L.uri===R.uri&&L.codecSet!==R.codecSet){const D=ic(L.codecSet),k=ic(R.codecSet);if(D!==k)return k-D}return L.averageBitrate!==R.averageBitrate?L.averageBitrate-R.averageBitrate:0});let p=m[0];if(this.steering&&(c=this.steering.filterParsedLevels(c),c.length!==m.length)){for(let L=0;L<m.length;L++)if(m[L].pathwayId===c[0].pathwayId){p=m[L];break}}this._levels=c;for(let L=0;L<c.length;L++)if(c[L]===p){var y;this._firstLevel=L;const R=p.bitrate,D=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${c.length} level(s) found, first bitrate: ${R}`),((y=this.hls.userConfig)==null?void 0:y.abrEwmaDefaultEstimate)===void 0){const k=Math.min(R,this.hls.config.abrEwmaDefaultEstimateMax);k>D&&D===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=k)}break}const v=s&&!r,E=this.hls.config,S=!!(E.audioStreamController&&E.audioTrackController),A={levels:c,audioTracks:u,subtitleTracks:d,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:s,video:r,altAudio:S&&!v&&u.some(L=>!!L.url)};h.end=performance.now(),this.hls.trigger(w.MANIFEST_PARSED,A)}get levels(){return this._levels.length===0?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){const h=new Error("invalid level idx"),m=e<0;if(this.hls.trigger(w.ERROR,{type:Ie.OTHER_ERROR,details:Y.LEVEL_SWITCH_ERROR,level:e,fatal:m,error:h,reason:h.message}),m)return;e=Math.min(e,t.length-1)}const n=this.currentLevelIndex,r=this.currentLevel,s=r?r.attrs["PATHWAY-ID"]:void 0,a=t[e],u=a.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=a,n===e&&r&&s===u)return;this.log(`Switching to level ${e} (${a.height?a.height+"p ":""}${a.videoRange?a.videoRange+" ":""}${a.codecSet?a.codecSet+" ":""}@${a.bitrate})${u?" with Pathway "+u:""} from level ${n}${s?" with Pathway "+s:""}`);const d={level:e,attrs:a.attrs,details:a.details,bitrate:a.bitrate,averageBitrate:a.averageBitrate,maxBitrate:a.maxBitrate,realBitrate:a.realBitrate,width:a.width,height:a.height,codecSet:a.codecSet,audioCodec:a.audioCodec,videoCodec:a.videoCodec,audioGroups:a.audioGroups,subtitleGroups:a.subtitleGroups,loaded:a.loaded,loadError:a.loadError,fragmentError:a.fragmentError,name:a.name,id:a.id,uri:a.uri,url:a.url,urlId:0,audioGroupIds:a.audioGroupIds,textGroupIds:a.textGroupIds};this.hls.trigger(w.LEVEL_SWITCHING,d);const c=a.details;if(!c||c.live){const h=this.switchParams(a.uri,r==null?void 0:r.details,c);this.loadPlaylist(h)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const t=this.steering.pathways(),n=e.filter(r=>t.indexOf(r)!==-1);if(e.length<1){this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${t}`);return}this.steering.pathwayPriority=n}}onError(e,t){t.fatal||!t.context||t.context.type===ze.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(t!==void 0&&t.type===xe.MAIN){const n=t.elementaryStreams;if(!Object.keys(n).some(s=>!!n[s]))return;const r=this._levels[t.level];r!=null&&r.loadError&&(this.log(`Resetting level error count of ${r.loadError} on frag buffered`),r.loadError=0)}}onLevelLoaded(e,t){var n;const{level:r,details:s}=t,a=t.levelInfo;if(!a){var u;this.warn(`Invalid level index ${r}`),(u=t.deliveryDirectives)!=null&&u.skip&&(s.deltaUpdateFailed=!0);return}if(a===this.currentLevel||t.withoutMultiVariant){a.fragmentError===0&&(a.loadError=0);let d=a.details;d===t.details&&d.advanced&&(d=void 0),this.playlistLoaded(r,t,d)}else(n=t.deliveryDirectives)!=null&&n.skip&&(s.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const n=this.getUrlWithDirectives(e.uri,t),r=this.currentLevelIndex,s=e.attrs["PATHWAY-ID"],a=e.details,u=a==null?void 0:a.age;this.log(`Loading level index ${r}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${s?" Pathway "+s:""}${u&&a.live?" age "+u.toFixed(1)+(a.type&&" "+a.type||""):""} ${n}`),this.hls.trigger(w.LEVEL_LOADING,{url:n,level:r,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(this._levels.length===1)return;const n=this._levels.filter((s,a)=>a!==e?!0:(this.steering&&this.steering.removeLevel(s),s===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,s.details&&s.details.fragments.forEach(u=>u.level=-1)),!1));lA(n),this._levels=n,this.currentLevelIndex>-1&&(t=this.currentLevel)!=null&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const r=n.length-1;this._firstLevel=Math.min(this._firstLevel,r),this._startLevel&&(this._startLevel=Math.min(this._startLevel,r)),this.hls.trigger(w.LEVELS_UPDATED,{levels:n})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:n}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(w.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:n}))}}function nE(i){const e={};i.forEach(t=>{const n=t.groupId||"";t.id=e[n]=e[n]||0,e[n]++})}function i1(){return self.SourceBuffer||self.WebKitSourceBuffer}function r1(){if(!Ur())return!1;const e=i1();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function y2(){if(!r1())return!1;const i=Ur();return typeof(i==null?void 0:i.isTypeSupported)=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>i.isTypeSupported(Bo(e,"video")))||["mp4a.40.2","fLaC"].some(e=>i.isTypeSupported(Bo(e,"audio"))))}function v2(){var i;const e=i1();return typeof(e==null||(i=e.prototype)==null?void 0:i.changeType)=="function"}const x2=100;class E2 extends rp{constructor(e,t,n){super(e,t,n,"stream-controller",xe.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const r=this.media,s=r?r.currentTime:null;if(s===null||!ye(s)||(this.log(`Media seeked to ${s.toFixed(3)}`),!this.getBufferedFrag(s)))return;const a=this.getFwdBufferInfoAtPos(r,s,xe.MAIN,0);if(a===null||a.len===0){this.warn(`Main forward buffer length at ${s} on "seeked" event ${a?a.len:"empty"})`);return}this.tick()},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(w.MANIFEST_PARSED,this.onManifestParsed,this),e.on(w.LEVEL_LOADING,this.onLevelLoading,this),e.on(w.LEVEL_LOADED,this.onLevelLoaded,this),e.on(w.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(w.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(w.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(w.BUFFER_CREATED,this.onBufferCreated,this),e.on(w.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(w.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(w.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(w.MANIFEST_PARSED,this.onManifestParsed,this),e.off(w.LEVEL_LOADED,this.onLevelLoaded,this),e.off(w.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(w.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(w.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(w.BUFFER_CREATED,this.onBufferCreated,this),e.off(w.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(w.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(w.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){const{lastCurrentTime:n,hls:r}=this;if(this.stopLoad(),this.setInterval(x2),this.level=-1,!this.startFragRequested){let s=r.startLevel;s===-1&&(r.config.testBandwidth&&this.levels.length>1?(s=0,this.bitrateTest=!0):s=r.firstAutoLevel),r.nextLoadLevel=s,this.level=r.loadLevel,this._hasEnoughToStart=!!t}n>0&&e===-1&&!t&&(this.log(`Override startPosition with lastCurrentTime @${n.toFixed(3)}`),e=n),this.state=se.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=se.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case se.WAITING_LEVEL:{const{levels:e,level:t}=this,n=e==null?void 0:e[t],r=n==null?void 0:n.details;if(r&&(!r.live||this.levelLastLoaded===n&&!this.waitForLive(n))){if(this.waitForCdnTuneIn(r))break;this.state=se.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=se.IDLE;break}break}case se.FRAG_LOADING_WAITING_RETRY:this.checkRetryDate();break}this.state===se.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),(e=this.media)!=null&&e.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:n,media:r}=this;if(t===null||!r&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const s=this.buffering?e.nextLoadLevel:e.loadLevel;if(!(n!=null&&n[s]))return;const a=n[s],u=this.getMainFwdBufferInfo();if(u===null)return;const d=this.getLevelDetails();if(d&&this._streamEnded(u,d)){const E={};this.altAudio===2&&(E.type="video"),this.hls.trigger(w.BUFFER_EOS,E),this.state=se.ENDED;return}if(!this.buffering)return;e.loadLevel!==s&&e.manualLevel===-1&&this.log(`Adapting to level ${s} from level ${this.level}`),this.level=e.nextLoadLevel=s;const c=a.details;if(!c||this.state===se.WAITING_LEVEL||this.waitForLive(a)){this.level=s,this.state=se.WAITING_LEVEL,this.startFragRequested=!1;return}const h=u.len,m=this.getMaxBufferLength(a.maxBitrate);if(h>=m)return;this.backtrackFragment&&this.backtrackFragment.start>u.end&&(this.backtrackFragment=null);const p=this.backtrackFragment?this.backtrackFragment.start:u.end;let y=this.getNextFragment(p,c);if(this.couldBacktrack&&!this.fragPrevious&&y&&Rt(y)&&this.fragmentTracker.getState(y)!==Bt.OK){var v;const S=((v=this.backtrackFragment)!=null?v:y).sn-c.startSN,A=c.fragments[S-1];A&&y.cc===A.cc&&(y=A,this.fragmentTracker.removeFragment(A))}else this.backtrackFragment&&u.len&&(this.backtrackFragment=null);if(y&&this.isLoopLoading(y,p)){if(!y.gap){const S=this.audioOnly&&!this.altAudio?at.AUDIO:at.VIDEO,A=(S===at.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;A&&this.afterBufferFlushed(A,S,xe.MAIN)}y=this.getNextFragmentLoopLoading(y,c,u,xe.MAIN,m)}y&&(y.initSegment&&!y.initSegment.data&&!this.bitrateTest&&(y=y.initSegment),this.loadFragment(y,a,p))}loadFragment(e,t,n){const r=this.fragmentTracker.getState(e);r===Bt.NOT_LOADED||r===Bt.PARTIAL?Rt(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,n):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,xe.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(t!=null&&t.readyState){let n;const r=this.getAppendedFrag(t.currentTime);r&&r.start>1&&this.flushMainBuffer(0,r.start-1);const s=this.getLevelDetails();if(s!=null&&s.live){const u=this.getMainFwdBufferInfo();if(!u||u.len<s.targetduration*2)return}if(!t.paused&&e){const u=this.hls.nextLoadLevel,d=e[u],c=this.fragLastKbps;c&&this.fragCurrent?n=this.fragCurrent.duration*d.maxBitrate/(1e3*c)+1:n=0}else n=0;const a=this.getBufferedFrag(t.currentTime+n);if(a){const u=this.followingBufferedFrag(a);if(u){this.abortCurrentFrag();const d=u.maxStartPTS?u.maxStartPTS:u.start,c=u.duration,h=Math.max(a.end,d+Math.min(Math.max(c-this.config.maxFragLookUpTolerance,c*(this.couldBacktrack?.5:.125)),c*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(h,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case se.KEY_LOADING:case se.FRAG_LOADING:case se.FRAG_LOADING_WAITING_RETRY:case se.PARSING:case se.PARSED:this.state=se.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio===2?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const n=t.media;mn(n,"playing",this.onMediaPlaying),mn(n,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){const{media:n}=this;n&&(Ln(n,"playing",this.onMediaPlaying),Ln(n,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t),!t.transferMedia&&(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(w.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let n=!1,r=!1;for(let s=0;s<t.levels.length;s++){const a=t.levels[s].audioCodec;a&&(n=n||a.indexOf("mp4a.40.2")!==-1,r=r||a.indexOf("mp4a.40.5")!==-1)}this.audioCodecSwitch=n&&r&&!v2(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:n}=this;if(!n||this.state!==se.IDLE)return;const r=t.levelInfo;(!r.details||r.details.live&&(this.levelLastLoaded!==r||r.details.expired)||this.waitForCdnTuneIn(r.details))&&(this.state=se.WAITING_LEVEL)}onLevelLoaded(e,t){var n;const{levels:r,startFragRequested:s}=this,a=t.level,u=t.details,d=u.totalduration;if(!r){this.warn(`Levels were reset while loading level ${a}`);return}this.log(`Level ${a} loaded [${u.startSN},${u.endSN}]${u.lastPartSn?`[part-${u.lastPartSn}-${u.lastPartIndex}]`:""}, cc [${u.startCC}, ${u.endCC}] duration:${d}`);const c=t.levelInfo,h=this.fragCurrent;h&&(this.state===se.FRAG_LOADING||this.state===se.FRAG_LOADING_WAITING_RETRY)&&h.level!==t.level&&h.loader&&this.abortCurrentFrag();let m=0;if(u.live||(n=c.details)!=null&&n.live){var p;if(this.checkLiveUpdate(u),u.deltaUpdateFailed)return;m=this.alignPlaylists(u,c.details,(p=this.levelLastLoaded)==null?void 0:p.details)}if(c.details=u,this.levelLastLoaded=c,s||this.setStartPosition(u,m),this.hls.trigger(w.LEVEL_UPDATED,{details:u,level:a}),this.state===se.WAITING_LEVEL){if(this.waitForCdnTuneIn(u))return;this.state=se.IDLE}s&&u.live&&this.synchronizeToLiveEdge(u),this.tick()}synchronizeToLiveEdge(e){const{config:t,media:n}=this;if(!n)return;const r=this.hls.liveSyncPosition,s=this.getLoadPosition(),a=e.fragmentStart,u=e.edge,d=s>=a-t.maxFragLookUpTolerance&&s<=u;if(r!==null&&n.duration>r&&(s<r||!d)){const h=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;if((!d&&n.readyState<4||s<u-h)&&(this._hasEnoughToStart||(this.nextLoadPosition=r),n.readyState))if(this.warn(`Playback: ${s.toFixed(3)} is located too far from the end of live sliding playlist: ${u}, reset currentTime to : ${r.toFixed(3)}`),this.config.liveSyncMode==="buffered"){var c;const m=Ue.bufferInfo(n,r,0);if(!((c=m.buffered)!=null&&c.length)){n.currentTime=r;return}if(m.start<=s){n.currentTime=r;return}const{nextStart:y}=Ue.bufferedInfo(m.buffered,s,0);y&&(n.currentTime=y)}else n.currentTime=r}}_handleFragmentLoadProgress(e){var t;const n=e.frag,{part:r,payload:s}=e,{levels:a}=this;if(!a){this.warn(`Levels were reset while fragment load was in progress. Fragment ${n.sn} of level ${n.level} will not be buffered`);return}const u=a[n.level];if(!u){this.warn(`Level ${n.level} not found on progress`);return}const d=u.details;if(!d){this.warn(`Dropping fragment ${n.sn} of level ${n.level} after level details were reset`),this.fragmentTracker.removeFragment(n);return}const c=u.videoCodec,h=d.PTSKnown||!d.live,m=(t=n.initSegment)==null?void 0:t.data,p=this._getAudioCodec(u),y=this.transmuxer=this.transmuxer||new DA(this.hls,xe.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),v=r?r.index:-1,E=v!==-1,S=new tp(n.level,n.sn,n.stats.chunkCount,s.byteLength,v,E),A=this.initPTS[n.cc];y.push(s,m,p,c,n,r,d.totalduration,h,S,A)}onAudioTrackSwitching(e,t){const n=this.hls,r=this.altAudio!==0;if(ac(t.url,n))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const a=this.fragCurrent;a&&(this.log("Switching to main audio track, cancel main fragment load"),a.abortRequests(),this.fragmentTracker.removeFragment(a)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(r){this.altAudio=0,this.fragmentTracker.removeAllFragments(),n.once(w.BUFFER_FLUSHED,()=>{this.hls&&this.hls.trigger(w.AUDIO_TRACK_SWITCHED,t)}),n.trigger(w.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}n.trigger(w.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const n=ac(t.url,this.hls);if(n){const r=this.videoBuffer;r&&this.mediaBuffer!==r&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=r)}this.altAudio=n?2:0,this.tick()}onBufferCreated(e,t){const n=t.tracks;let r,s,a=!1;for(const u in n){const d=n[u];if(d.id==="main"){if(s=u,r=d,u==="video"){const c=n[u];c&&(this.videoBuffer=c.buffer)}}else a=!0}a&&r?(this.log(`Alternate track found, use ${s}.buffered to schedule main fragment loading`),this.mediaBuffer=r.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:n,part:r}=t,s=n.type===xe.MAIN;if(s){if(this.fragContextChanged(n)){this.warn(`Fragment ${n.sn}${r?" p: "+r.index:""} of level ${n.level} finished buffering, but was aborted. state: ${this.state}`),this.state===se.PARSED&&(this.state=se.IDLE);return}const u=r?r.stats:n.stats;this.fragLastKbps=Math.round(8*u.total/(u.buffering.end-u.loading.first)),Rt(n)&&(this.fragPrevious=n),this.fragBufferedComplete(n,r)}const a=this.media;a&&(!this._hasEnoughToStart&&Ue.getBuffered(a).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),s&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var n;if(t.fatal){this.state=se.ERROR;return}switch(t.details){case Y.FRAG_GAP:case Y.FRAG_PARSING_ERROR:case Y.FRAG_DECRYPT_ERROR:case Y.FRAG_LOAD_ERROR:case Y.FRAG_LOAD_TIMEOUT:case Y.KEY_LOAD_ERROR:case Y.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(xe.MAIN,t);break;case Y.LEVEL_LOAD_ERROR:case Y.LEVEL_LOAD_TIMEOUT:case Y.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===se.WAITING_LEVEL&&((n=t.context)==null?void 0:n.type)===ze.LEVEL&&(this.state=se.IDLE);break;case Y.BUFFER_ADD_CODEC_ERROR:case Y.BUFFER_APPEND_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.resetLoadingState();break;case Y.BUFFER_FULL_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&(!this.config.interstitialsController&&this.config.assetPlayerId?this._hasEnoughToStart=!0:this.flushMainBuffer(0,Number.POSITIVE_INFINITY));break;case Y.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onFragLoadEmergencyAborted(){this.state=se.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==at.AUDIO||!this.altAudio){const n=(t===at.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;n&&(this.afterBufferFlushed(n,t,xe.MAIN),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let n=this.startPosition;if(n>=0&&t<n){if(e.seeking){this.log(`could not seek to ${n}, already seeking at ${t}`);return}const r=this.timelineOffset;r&&n&&(n+=r);const s=this.getLevelDetails(),a=Ue.getBuffered(e),u=a.length?a.start(0):0,d=u-n,c=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||d>0&&(d<c||this.loadingParts&&d<2*((s==null?void 0:s.partTarget)||0)))&&(this.log(`adjusting start position by ${d} to match buffer start`),n+=d,this.startPosition=n),t<n&&(this.log(`seek to target start position ${n} from current time ${t} buffer start ${u}`),e.currentTime=n)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(n=>{const{hls:r}=this,s=n==null?void 0:n.frag;if(!s||this.fragContextChanged(s))return;t.fragmentError=0,this.state=se.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const a=s.stats;a.parsing.start=a.parsing.end=a.buffering.start=a.buffering.end=self.performance.now(),r.trigger(w.FRAG_LOADED,n),s.bitrateTest=!1}).catch(n=>{this.state===se.STOPPED||this.state===se.ERROR||(this.warn(n),this.resetFragmentLoading(e))})}_handleTransmuxComplete(e){const t=this.playlistType,{hls:n}=this,{remuxResult:r,chunkMeta:s}=e,a=this.getCurrentContext(s);if(!a){this.resetWhenMissingContext(s);return}const{frag:u,part:d,level:c}=a,{video:h,text:m,id3:p,initSegment:y}=r,{details:v}=c,E=this.altAudio?void 0:r.audio;if(this.fragContextChanged(u)){this.fragmentTracker.removeFragment(u);return}if(this.state=se.PARSING,y){const S=y.tracks;if(S){const D=u.initSegment||u;if(this.unhandledEncryptionError(y,u))return;this._bufferInitSegment(c,S,D,s),n.trigger(w.FRAG_PARSING_INIT_SEGMENT,{frag:D,id:t,tracks:S})}const A=y.initPTS,L=y.timescale,R=this.initPTS[u.cc];if(ye(A)&&(!R||R.baseTime!==A||R.timescale!==L)){const D=y.trackId;this.initPTS[u.cc]={baseTime:A,timescale:L,trackId:D},n.trigger(w.INIT_PTS_FOUND,{frag:u,id:t,initPTS:A,timescale:L,trackId:D})}}if(h&&v){E&&h.type==="audiovideo"&&this.logMuxedErr(u);const S=v.fragments[u.sn-1-v.startSN],A=u.sn===v.startSN,L=!S||u.cc>S.cc;if(r.independent!==!1){const{startPTS:R,endPTS:D,startDTS:k,endDTS:U}=h;if(d)d.elementaryStreams[h.type]={startPTS:R,endPTS:D,startDTS:k,endDTS:U};else if(h.firstKeyFrame&&h.independent&&s.id===1&&!L&&(this.couldBacktrack=!0),h.dropped&&h.independent){const C=this.getMainFwdBufferInfo(),_=(C?C.end:this.getLoadPosition())+this.config.maxBufferHole,F=h.firstKeyFramePTS?h.firstKeyFramePTS:R;if(!A&&_<F-this.config.maxBufferHole&&!L){this.backtrack(u);return}else L&&(u.gap=!0);u.setElementaryStreamInfo(h.type,u.start,D,u.start,U,!0)}else A&&R-(v.appliedTimelineOffset||0)>Ku&&(u.gap=!0);u.setElementaryStreamInfo(h.type,R,D,k,U),this.backtrackFragment&&(this.backtrackFragment=u),this.bufferFragmentData(h,u,d,s,A||L)}else if(A||L)u.gap=!0;else{this.backtrack(u);return}}if(E){const{startPTS:S,endPTS:A,startDTS:L,endDTS:R}=E;d&&(d.elementaryStreams[at.AUDIO]={startPTS:S,endPTS:A,startDTS:L,endDTS:R}),u.setElementaryStreamInfo(at.AUDIO,S,A,L,R),this.bufferFragmentData(E,u,d,s)}if(v&&p!=null&&p.samples.length){const S={id:t,frag:u,details:v,samples:p.samples};n.trigger(w.FRAG_PARSING_METADATA,S)}if(v&&m){const S={id:t,frag:u,details:v,samples:m.samples};n.trigger(w.FRAG_PARSING_USERDATA,S)}}logMuxedErr(e){this.warn(`${Rt(e)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${e.url}`)}_bufferInitSegment(e,t,n,r){if(this.state!==se.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(n));const{audio:s,video:a,audiovideo:u}=t;if(s){const c=e.audioCodec;let h=Uu(s.codec,c);h==="mp4a"&&(h="mp4a.40.5");const m=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){h&&(h.indexOf("mp4a.40.5")!==-1?h="mp4a.40.2":h="mp4a.40.5");const p=s.metadata;p&&"channelCount"in p&&(p.channelCount||1)!==1&&m.indexOf("firefox")===-1&&(h="mp4a.40.5")}h&&h.indexOf("mp4a.40.5")!==-1&&m.indexOf("android")!==-1&&s.container!=="audio/mpeg"&&(h="mp4a.40.2",this.log(`Android: force audio codec to ${h}`)),c&&c!==h&&this.log(`Swapping manifest audio codec "${c}" for "${h}"`),s.levelCodec=h,s.id=xe.MAIN,this.log(`Init audio buffer, container:${s.container}, codecs[selected/level/parsed]=[${h||""}/${c||""}/${s.codec}]`),delete t.audiovideo}if(a){a.levelCodec=e.videoCodec,a.id=xe.MAIN;const c=a.codec;if((c==null?void 0:c.length)===4)switch(c){case"hvc1":case"hev1":a.codec="hvc1.1.6.L120.90";break;case"av01":a.codec="av01.0.04M.08";break;case"avc1":a.codec="avc1.42e01e";break}this.log(`Init video buffer, container:${a.container}, codecs[level/parsed]=[${e.videoCodec||""}/${c}]${a.codec!==c?" parsed-corrected="+a.codec:""}${a.supplemental?" supplemental="+a.supplemental:""}`),delete t.audiovideo}u&&(this.log(`Init audiovideo buffer, container:${u.container}, codecs[level/parsed]=[${e.codecs}/${u.codec}]`),delete t.video,delete t.audio);const d=Object.keys(t);if(d.length){if(this.hls.trigger(w.BUFFER_CODECS,t),!this.hls)return;d.forEach(c=>{const m=t[c].initSegment;m!=null&&m.byteLength&&this.hls.trigger(w.BUFFER_APPENDING,{type:c,data:m,frag:n,part:null,chunkMeta:r,parent:n.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,xe.MAIN)}get maxBufferLength(){const{levels:e,level:t}=this,n=e==null?void 0:e[t];return n?this.getMaxBufferLength(n.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=se.IDLE}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&e.seeking===!1){const n=e.currentTime;if(Ue.isBuffered(e,n)?t=this.getAppendedFrag(n):Ue.isBuffered(e,n+.1)&&(t=this.getAppendedFrag(n+.1)),t){this.backtrackFragment=null;const r=this.fragPlaying,s=t.level;(!r||t.sn!==r.sn||r.level!==s)&&(this.fragPlaying=t,this.hls.trigger(w.FRAG_CHANGED,{frag:t}),(!r||r.level!==s)&&this.hls.trigger(w.LEVEL_SWITCHED,{level:s}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;return ye(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;if(ye(t)){const n=this.getLevelDetails(),r=this.currentFrag||(n?Ss(null,n.fragments,t):null);if(r){const s=r.programDateTime;if(s!==null){const a=s+(t-r.start)*1e3;return new Date(a)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class S2 extends Jn{constructor(e,t){super("key-loader",t),this.config=void 0,this.keyIdToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const n in this.keyIdToKeyInfo){const r=this.keyIdToKeyInfo[n].loader;if(r){var t;if(e&&e!==((t=r.context)==null?void 0:t.frag.type))return;r.abort()}}}detach(){for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyIdToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e].loader;t&&t.destroy()}this.keyIdToKeyInfo={}}createKeyLoadError(e,t=Y.KEY_LOAD_ERROR,n,r,s){return new er({type:Ie.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:s,error:n,networkDetails:r})}loadClear(e,t,n){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(t.length)for(let r=0,s=t.length;r<s;r++){const a=t[r];if(e.cc<=a.cc&&(!Rt(e)||!Rt(a)||e.sn<a.sn)||!n&&r==s-1)return this.emeController.selectKeySystemFormat(a).then(u=>{if(!this.emeController)return;a.setKeyFormat(u);const d=ju(u);if(d)return this.emeController.getKeySystemAccess([d])})}if(this.config.requireKeySystemAccessOnStart){const r=vo(this.config);if(r.length)return this.emeController.getKeySystemAccess(r)}}return null}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var n,r;t&&e.setKeyFormat(t);const s=e.decryptdata;if(!s){const c=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:`Missing decryption data on fragment in onKeyLoading (emeEnabled with controller: ${this.emeController&&this.config.emeEnabled})`);return Promise.reject(this.createKeyLoadError(e,Y.KEY_LOAD_ERROR,c))}const a=s.uri;if(!a)return Promise.reject(this.createKeyLoadError(e,Y.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${a}"`)));const u=tf(s);let d=this.keyIdToKeyInfo[u];if((n=d)!=null&&n.decryptdata.key)return s.key=d.decryptdata.key,Promise.resolve({frag:e,keyInfo:d});if(this.emeController&&(r=d)!=null&&r.keyLoadPromise)switch(this.emeController.getKeyStatus(d.decryptdata)){case"usable":case"usable-in-future":return d.keyLoadPromise.then(h=>{const{keyInfo:m}=h;return s.key=m.decryptdata.key,{frag:e,keyInfo:m}})}switch(this.log(`${this.keyIdToKeyInfo[u]?"Rel":"L"}oading${s.keyId?" keyId: "+qt(s.keyId):""} URI: ${s.uri} from ${e.type} ${e.level}`),d=this.keyIdToKeyInfo[u]={decryptdata:s,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},s.method){case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return s.keyFormat==="identity"?this.loadKeyHTTP(d,e):this.loadKeyEME(d,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(d,e);default:return Promise.reject(this.createKeyLoadError(e,Y.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${s.method}"`)))}}loadKeyEME(e,t){const n={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){var r;if(!e.decryptdata.keyId&&(r=t.initSegment)!=null&&r.data){const a=$_(t.initSegment.data);if(a.length){let u=a[0];u.some(d=>d!==0)?(this.log(`Using keyId found in init segment ${qt(u)}`),Fr.setKeyIdForUri(e.decryptdata.uri,u)):(u=Fr.addKeyIdForUri(e.decryptdata.uri),this.log(`Generating keyId to patch media ${qt(u)}`)),e.decryptdata.keyId=u}}if(!e.decryptdata.keyId&&!Rt(t))return Promise.resolve(n);const s=this.emeController.loadKey(n);return(e.keyLoadPromise=s.then(a=>(e.mediaKeySessionContext=a,n))).catch(a=>{throw e.keyLoadPromise=null,"data"in a&&(a.data.frag=t),a})}return Promise.resolve(n)}loadKeyHTTP(e,t){const n=this.config,r=n.loader,s=new r(n);return t.keyLoader=e.loader=s,e.keyLoadPromise=new Promise((a,u)=>{const d={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},c=n.keyLoadPolicy.default,h={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},m={onSuccess:(p,y,v,E)=>{const{frag:S,keyInfo:A}=v,L=tf(A.decryptdata);if(!S.decryptdata||A!==this.keyIdToKeyInfo[L])return u(this.createKeyLoadError(S,Y.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),E));A.decryptdata.key=S.decryptdata.key=new Uint8Array(p.data),S.keyLoader=null,A.loader=null,a({frag:S,keyInfo:A})},onError:(p,y,v,E)=>{this.resetLoader(y),u(this.createKeyLoadError(t,Y.KEY_LOAD_ERROR,new Error(`HTTP Error ${p.code} loading key ${p.text}`),v,tt({url:d.url,data:void 0},p)))},onTimeout:(p,y,v)=>{this.resetLoader(y),u(this.createKeyLoadError(t,Y.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),v))},onAbort:(p,y,v)=>{this.resetLoader(y),u(this.createKeyLoadError(t,Y.INTERNAL_ABORTED,new Error("key loading aborted"),v))}};s.load(d,h,m)})}resetLoader(e){const{frag:t,keyInfo:n,url:r}=e,s=n.loader;t.keyLoader===s&&(t.keyLoader=null,n.loader=null);const a=tf(n.decryptdata)||r;delete this.keyIdToKeyInfo[a],s&&s.destroy()}}function tf(i){if(i.keyFormat!==Xt.FAIRPLAY){const e=i.keyId;if(e)return qt(e)}return i.uri}function iE(i){const{type:e}=i;switch(e){case ze.AUDIO_TRACK:return xe.AUDIO;case ze.SUBTITLE_TRACK:return xe.SUBTITLE;default:return xe.MAIN}}function nf(i,e){let t=i.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}class T2{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(w.MANIFEST_LOADING,this.onManifestLoading,this),e.on(w.LEVEL_LOADING,this.onLevelLoading,this),e.on(w.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(w.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(w.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(w.MANIFEST_LOADING,this.onManifestLoading,this),e.off(w.LEVEL_LOADING,this.onLevelLoading,this),e.off(w.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(w.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(w.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const t=this.hls.config,n=t.pLoader,r=t.loader,s=n||r,a=new s(t);return this.loaders[e.type]=a,a}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:n}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:ze.MANIFEST,url:n,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){const{id:n,level:r,pathwayId:s,url:a,deliveryDirectives:u,levelInfo:d}=t;this.load({id:n,level:r,pathwayId:s,responseType:"text",type:ze.LEVEL,url:a,deliveryDirectives:u,levelOrTrack:d})}onAudioTrackLoading(e,t){const{id:n,groupId:r,url:s,deliveryDirectives:a,track:u}=t;this.load({id:n,groupId:r,level:null,responseType:"text",type:ze.AUDIO_TRACK,url:s,deliveryDirectives:a,levelOrTrack:u})}onSubtitleTrackLoading(e,t){const{id:n,groupId:r,url:s,deliveryDirectives:a,track:u}=t;this.load({id:n,groupId:r,level:null,responseType:"text",type:ze.SUBTITLE_TRACK,url:s,deliveryDirectives:a,levelOrTrack:u})}onLevelsUpdated(e,t){const n=this.loaders[ze.LEVEL];if(n){const r=n.context;r&&!t.levels.some(s=>s===r.levelOrTrack)&&(n.abort(),delete this.loaders[ze.LEVEL])}}load(e){var t;const n=this.hls.config;let r=this.getInternalLoader(e);if(r){const c=this.hls.logger,h=r.context;if(h&&h.levelOrTrack===e.levelOrTrack&&(h.url===e.url||h.deliveryDirectives&&!e.deliveryDirectives)){h.url===e.url?c.log(`[playlist-loader]: ignore ${e.url} ongoing request`):c.log(`[playlist-loader]: ignore ${e.url} in favor of ${h.url}`);return}c.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),r.abort()}let s;if(e.type===ze.MANIFEST?s=n.manifestLoadPolicy.default:s=rt({},n.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),r=this.createInternalLoader(e),ye((t=e.deliveryDirectives)==null?void 0:t.part)){let c;if(e.type===ze.LEVEL&&e.level!==null?c=this.hls.levels[e.level].details:e.type===ze.AUDIO_TRACK&&e.id!==null?c=this.hls.audioTracks[e.id].details:e.type===ze.SUBTITLE_TRACK&&e.id!==null&&(c=this.hls.subtitleTracks[e.id].details),c){const h=c.partTarget,m=c.targetduration;if(h&&m){const p=Math.max(h*3,m*.8)*1e3;s=rt({},s,{maxTimeToFirstByteMs:Math.min(p,s.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(p,s.maxTimeToFirstByteMs)})}}}const a=s.errorRetry||s.timeoutRetry||{},u={loadPolicy:s,timeout:s.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},d={onSuccess:(c,h,m,p)=>{const y=this.getInternalLoader(m);this.resetInternalLoader(m.type);const v=c.data;h.parsing.start=performance.now(),Pi.isMediaPlaylist(v)||m.type!==ze.MANIFEST?this.handleTrackOrLevelPlaylist(c,h,m,p||null,y):this.handleMasterPlaylist(c,h,m,p)},onError:(c,h,m,p)=>{this.handleNetworkError(h,m,!1,c,p)},onTimeout:(c,h,m)=>{this.handleNetworkError(h,m,!0,void 0,c)}};r.load(e,u,d)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:t},forceStartLoad:n}=this.hls;(e||n)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${t}`),this.hls.startLoad(t))}handleMasterPlaylist(e,t,n,r){const s=this.hls,a=e.data,u=nf(e,n),d=Pi.parseMasterPlaylist(a,u);if(d.playlistParsingError){t.parsing.end=performance.now(),this.handleManifestParsingError(e,n,d.playlistParsingError,r,t);return}const{contentSteering:c,levels:h,sessionData:m,sessionKeys:p,startTimeOffset:y,variableList:v}=d;this.variableList=v,h.forEach(L=>{const{unknownCodecs:R}=L;if(R){const{preferManagedMediaSource:D}=this.hls.config;let{audioCodec:k,videoCodec:U}=L;for(let C=R.length;C--;){const _=R[C];Fo(_,"audio",D)?(L.audioCodec=k=k?`${k},${_}`:_,ya.audio[k.substring(0,4)]=2,R.splice(C,1)):Fo(_,"video",D)&&(L.videoCodec=U=U?`${U},${_}`:_,ya.video[U.substring(0,4)]=2,R.splice(C,1))}}});const{AUDIO:E=[],SUBTITLES:S,"CLOSED-CAPTIONS":A}=Pi.parseMasterPlaylistMedia(a,u,d);E.length&&!E.some(R=>!R.url)&&h[0].audioCodec&&!h[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),E.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new gt({}),bitrate:0,url:""})),s.trigger(w.MANIFEST_LOADED,{levels:h,audioTracks:E,subtitles:S,captions:A,contentSteering:c,url:u,stats:t,networkDetails:r,sessionData:m,sessionKeys:p,startTimeOffset:y,variableList:v})}handleTrackOrLevelPlaylist(e,t,n,r,s){const a=this.hls,{id:u,level:d,type:c}=n,h=nf(e,n),m=ye(d)?d:ye(u)?u:0,p=iE(n),y=Pi.parseLevelPlaylist(e.data,h,m,p,0,this.variableList);if(c===ze.MANIFEST){const v={attrs:new gt({}),bitrate:0,details:y,name:"",url:h};y.requestScheduled=t.loading.start+sA(y,0),a.trigger(w.MANIFEST_LOADED,{levels:[v],audioTracks:[],url:h,stats:t,networkDetails:r,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),n.levelDetails=y,this.handlePlaylistLoaded(y,e,t,n,r,s)}handleManifestParsingError(e,t,n,r,s){this.hls.trigger(w.ERROR,{type:Ie.NETWORK_ERROR,details:Y.MANIFEST_PARSING_ERROR,fatal:t.type===ze.MANIFEST,url:e.url,err:n,error:n,reason:n.message,response:e,context:t,networkDetails:r,stats:s})}handleNetworkError(e,t,n=!1,r,s){let a=`A network ${n?"timeout":"error"+(r?" (status "+r.code+")":"")} occurred while loading ${e.type}`;e.type===ze.LEVEL?a+=`: ${e.level} id: ${e.id}`:(e.type===ze.AUDIO_TRACK||e.type===ze.SUBTITLE_TRACK)&&(a+=` id: ${e.id} group-id: "${e.groupId}"`);const u=new Error(a);this.hls.logger.warn(`[playlist-loader]: ${a}`);let d=Y.UNKNOWN,c=!1;const h=this.getInternalLoader(e);switch(e.type){case ze.MANIFEST:d=n?Y.MANIFEST_LOAD_TIMEOUT:Y.MANIFEST_LOAD_ERROR,c=!0;break;case ze.LEVEL:d=n?Y.LEVEL_LOAD_TIMEOUT:Y.LEVEL_LOAD_ERROR,c=!1;break;case ze.AUDIO_TRACK:d=n?Y.AUDIO_TRACK_LOAD_TIMEOUT:Y.AUDIO_TRACK_LOAD_ERROR,c=!1;break;case ze.SUBTITLE_TRACK:d=n?Y.SUBTITLE_TRACK_LOAD_TIMEOUT:Y.SUBTITLE_LOAD_ERROR,c=!1;break}h&&this.resetInternalLoader(e.type);const m={type:Ie.NETWORK_ERROR,details:d,fatal:c,url:e.url,loader:h,context:e,error:u,networkDetails:t,stats:s};if(r){const p=(t==null?void 0:t.url)||e.url;m.response=tt({url:p,data:void 0},r)}this.hls.trigger(w.ERROR,m)}handlePlaylistLoaded(e,t,n,r,s,a){const u=this.hls,{type:d,level:c,levelOrTrack:h,id:m,groupId:p,deliveryDirectives:y}=r,v=nf(t,r),E=iE(r);let S=typeof r.level=="number"&&E===xe.MAIN?c:void 0;const A=e.playlistParsingError;if(A){if(this.hls.logger.warn(`${A} ${e.url}`),!u.config.ignorePlaylistParsingErrors){u.trigger(w.ERROR,{type:Ie.NETWORK_ERROR,details:Y.LEVEL_PARSING_ERROR,fatal:!1,url:v,error:A,reason:A.message,response:t,context:r,level:S,parent:E,networkDetails:s,stats:n});return}e.playlistParsingError=null}if(!e.fragments.length){const L=e.playlistParsingError=new Error("No Segments found in Playlist");u.trigger(w.ERROR,{type:Ie.NETWORK_ERROR,details:Y.LEVEL_EMPTY_ERROR,fatal:!1,url:v,error:L,reason:L.message,response:t,context:r,level:S,parent:E,networkDetails:s,stats:n});return}switch(e.live&&a&&(a.getCacheAge&&(e.ageHeader=a.getCacheAge()||0),(!a.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),d){case ze.MANIFEST:case ze.LEVEL:if(S){if(!h)S=0;else if(h!==u.levels[S]){const L=u.levels.indexOf(h);L>-1&&(S=L)}}u.trigger(w.LEVEL_LOADED,{details:e,levelInfo:h||u.levels[0],level:S||0,id:m||0,stats:n,networkDetails:s,deliveryDirectives:y,withoutMultiVariant:d===ze.MANIFEST});break;case ze.AUDIO_TRACK:u.trigger(w.AUDIO_TRACK_LOADED,{details:e,track:h,id:m||0,groupId:p||"",stats:n,networkDetails:s,deliveryDirectives:y});break;case ze.SUBTITLE_TRACK:u.trigger(w.SUBTITLE_TRACK_LOADED,{details:e,track:h,id:m||0,groupId:p||"",stats:n,networkDetails:s,deliveryDirectives:y});break}}}class fi{static get version(){return $o}static isMSESupported(){return r1()}static isSupported(){return y2()}static getMediaSource(){return Ur()}static get Events(){return w}static get MetadataSchema(){return Fn}static get ErrorTypes(){return Ie}static get ErrorDetails(){return Y}static get DefaultConfig(){return fi.defaultConfig?fi.defaultConfig:s2}static set DefaultConfig(e){fi.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new sp,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const t=this.logger=I_(e.debug||!1,"Hls instance",e.assetPlayerId),n=this.config=o2(fi.DefaultConfig,e,t);this.userConfig=e,n.progressive&&l2(n,t);const{abrController:r,bufferController:s,capLevelController:a,errorController:u,fpsController:d}=n,c=new u(this),h=this.abrController=new r(this),m=new AM(this),p=n.interstitialsController,y=p?this.interstitialsController=new p(this,fi):null,v=this.bufferController=new s(this,m),E=this.capLevelController=new a(this),S=new d(this),A=new T2(this),L=n.contentSteeringController,R=L?new L(this):null,D=this.levelController=new g2(this,R),k=new m2(this),U=new S2(this.config,this.logger),C=this.streamController=new E2(this,m,U),_=this.gapController=new h2(this,m);E.setStreamController(C),S.setStreamController(C);const F=[A,D,C];y&&F.splice(1,0,y),R&&F.splice(1,0,R),this.networkControllers=F;const O=[h,v,_,E,S,k,m];this.audioTrackController=this.createController(n.audioTrackController,F);const W=n.audioStreamController;W&&F.push(this.audioStreamController=new W(this,m,U)),this.subtitleTrackController=this.createController(n.subtitleTrackController,F);const z=n.subtitleStreamController;z&&F.push(this.subtititleStreamController=new z(this,m,U)),this.createController(n.timelineController,O),U.emeController=this.emeController=this.createController(n.emeController,O),this.cmcdController=this.createController(n.cmcdController,O),this.latencyController=this.createController(p2,O),this.coreComponents=O,F.push(c);const re=c.onErrorOut;typeof re=="function"&&this.on(w.ERROR,re,c),this.on(w.MANIFEST_LOADED,A.onManifestLoaded,A)}createController(e,t){if(e){const n=new e(this);return t&&t.push(n),n}return null}on(e,t,n=this){this._emitter.on(e,t,n)}once(e,t,n=this){this._emitter.once(e,t,n)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,n=this,r){this._emitter.off(e,t,n,r)}listeners(e){return this._emitter.listeners(e)}emit(e,t,n){return this._emitter.emit(e,t,n)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(n){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+n.message+'". Here is a stacktrace:',n),!this.triggeringException){this.triggeringException=!0;const r=e===w.ERROR;this.trigger(w.ERROR,{type:Ie.OTHER_ERROR,details:Y.INTERNAL_EXCEPTION,fatal:r,event:e,error:n}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(w.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const s=new Error(`attachMedia failed: invalid argument (${e})`);this.trigger(w.ERROR,{type:Ie.OTHER_ERROR,details:Y.ATTACH_MEDIA_ERROR,fatal:!0,error:s});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const t="media"in e,n=t?e.media:e,r=t?e:{media:n};this._media=n,this.trigger(w.MEDIA_ATTACHING,r)}detachMedia(){this.logger.log("detachMedia"),this.trigger(w.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(w.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const t=this.media,n=this._url,r=this._url=Ym.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${r}`),t&&n&&(n!==r||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(w.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(e=-1,t){this.logger.log(`startLoad(${e+(t?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let n=0;n<this.networkControllers.length&&(this.networkControllers[n].startLoad(e,t),!(!this.started||!this.networkControllers));n++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!(this.started||!this.networkControllers));e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){const e={[xe.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[xe.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[xe.SUBTITLE]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,t=e==null?void 0:e.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=hF()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){oM(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const n=e.length;for(let r=0;r<n;r++)if(e[r].maxBitrate>=t)return r;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:n}=this;let r;if(t===-1&&e!=null&&e.length?r=e.length-1:r=t,n)for(let s=r;s--;){const a=e[s].attrs["HDCP-LEVEL"];if(a&&a<=n)return s}return r}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return((t=this.audioTrackController)==null?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return((t=this.subtitleTrackController)==null?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!!((e=this.bufferController)!=null&&e.bufferedToEnd)}get interstitialsManager(){var e;return((e=this.interstitialsController)==null?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e,t=this.allAudioTracks){const n=HT(t);return VT(e,n,navigator.mediaCapabilities)}}fi.defaultConfig=void 0;function A2({videoUrl:i,movieId:e,movieTitle:t,onNext:n,episodeNumber:r}){const s=M.useRef(null),a=M.useRef(null),u=M.useRef(null),d=M.useRef(null),[c,h]=M.useState(!1),[m,p]=M.useState(0),[y,v]=M.useState(0),[E,S]=M.useState(1),[A,L]=M.useState(!1),[R,D]=M.useState(!0),[k,U]=M.useState(!1),[C,_]=M.useState(!1),[F,O]=M.useState(!1),[W,z]=M.useState("Auto"),[re,ae]=M.useState("Tt"),ce=M.useRef();M.useEffect(()=>{if(s.current){if(fi.isSupported()){const te=new fi({enableWorker:!0,lowLatencyMode:!0});d.current=te,te.loadSource(i),te.attachMedia(s.current),te.on(fi.Events.MANIFEST_PARSED,()=>{console.log("HLS manifest parsed")}),te.on(fi.Events.ERROR,(fe,Pe)=>{console.error("HLS error:",Pe)})}else s.current.canPlayType("application/vnd.apple.mpegurl")&&(s.current.src=i);return()=>{d.current&&d.current.destroy()}}},[i]),M.useEffect(()=>{const te=setInterval(()=>{if(s.current&&y>0){const fe=m/y*100;Pu.addToHistory(e,fe,r)}},1e4);return()=>clearInterval(te)},[m,y,e,r]),M.useEffect(()=>{const te=s.current;if(!te)return;const fe=()=>p(te.currentTime),Pe=()=>v(te.duration),be=()=>h(!0),Ve=()=>h(!1),Ze=()=>{h(!1),n&&setTimeout(()=>n(),2e3)};return te.addEventListener("timeupdate",fe),te.addEventListener("durationchange",Pe),te.addEventListener("play",be),te.addEventListener("pause",Ve),te.addEventListener("ended",Ze),()=>{te.removeEventListener("timeupdate",fe),te.removeEventListener("durationchange",Pe),te.removeEventListener("play",be),te.removeEventListener("pause",Ve),te.removeEventListener("ended",Ze)}},[n]);const ne=()=>{D(!0),ce.current&&clearTimeout(ce.current),ce.current=setTimeout(()=>{c&&D(!1)},3e3)},ie=()=>{s.current&&(c?s.current.pause():s.current.play())},G=te=>{if(!s.current||!u.current)return;const fe=u.current.getBoundingClientRect(),Pe=(te.clientX-fe.left)/fe.width;s.current.currentTime=Pe*y},ee=te=>{s.current&&(S(te),s.current.volume=te,L(te===0))},J=()=>{s.current&&(A?(s.current.volume=E,L(!1)):(s.current.volume=0,L(!0)))},P=()=>{a.current&&(k?document.exitFullscreen&&document.exitFullscreen():a.current.requestFullscreen&&a.current.requestFullscreen(),U(!k))},j=te=>{s.current&&(s.current.currentTime+=te)},he=te=>{const fe=Math.floor(te/3600),Pe=Math.floor(te%3600/60),be=Math.floor(te%60);return fe>0?`${fe}:${Pe.toString().padStart(2,"0")}:${be.toString().padStart(2,"0")}`:`${Pe}:${be.toString().padStart(2,"0")}`},ge=y>0?m/y*100:0;return b.jsxs("div",{ref:a,className:"relative w-full aspect-video bg-black group",onMouseMove:ne,onMouseLeave:()=>c&&D(!1),children:[b.jsx("video",{ref:s,className:"w-full h-full",onClick:ie}),b.jsx(aP,{children:R&&b.jsxs(Pt.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-black/40 flex flex-col justify-between pointer-events-none",children:[b.jsxs("div",{className:"p-4 pointer-events-auto",children:[b.jsx("h3",{className:"text-lg font-semibold",children:t}),r&&b.jsxs("p",{className:"text-sm text-gray-300",children:["Tp ",r]})]}),!c&&b.jsx(Pt.button,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.8,opacity:0},onClick:ie,className:"self-center p-6 bg-red-600 rounded-full hover:bg-red-700 transition-colors pointer-events-auto",children:b.jsx(Es,{className:"w-12 h-12 fill-current"})}),b.jsxs("div",{className:"p-4 space-y-3 pointer-events-auto",children:[b.jsx("div",{ref:u,className:"h-1 bg-white/20 rounded-full cursor-pointer hover:h-1.5 transition-all",onClick:G,children:b.jsx("div",{className:"h-full bg-red-600 rounded-full relative",style:{width:`${ge}%`},children:b.jsx("div",{className:"absolute right-0 top-1/2 -translate-y-1/2 w-3 h-3 bg-red-600 rounded-full opacity-0 hover:opacity-100"})})}),b.jsxs("div",{className:"flex items-center justify-between",children:[b.jsxs("div",{className:"flex items-center gap-3",children:[b.jsx("button",{onClick:ie,className:"p-2 hover:bg-white/20 rounded-lg transition-colors",children:c?b.jsx(Jb,{className:"w-6 h-6"}):b.jsx(Es,{className:"w-6 h-6 fill-current"})}),b.jsx("button",{onClick:()=>j(10),className:"p-2 hover:bg-white/20 rounded-lg transition-colors",children:b.jsx(aI,{className:"w-5 h-5"})}),b.jsxs("div",{className:"flex items-center gap-2 group/volume",children:[b.jsx("button",{onClick:J,className:"p-2 hover:bg-white/20 rounded-lg transition-colors",children:A?b.jsx(pI,{className:"w-5 h-5"}):b.jsx(fI,{className:"w-5 h-5"})}),b.jsx("input",{type:"range",min:"0",max:"1",step:"0.1",value:A?0:E,onChange:te=>ee(parseFloat(te.target.value)),className:"w-0 group-hover/volume:w-20 transition-all"})]}),b.jsxs("span",{className:"text-sm",children:[he(m)," / ",he(y)]})]}),b.jsxs("div",{className:"flex items-center gap-2",children:[b.jsxs("div",{className:"relative",children:[b.jsx("button",{onClick:()=>O(!F),className:"p-2 hover:bg-white/20 rounded-lg transition-colors",children:b.jsx(_b,{className:"w-5 h-5"})}),F&&b.jsxs("div",{className:"absolute bottom-full right-0 mb-2 p-2 bg-black/90 rounded-lg min-w-[150px]",children:[b.jsx("button",{onClick:()=>{ae("Tt"),O(!1)},className:"w-full text-left px-3 py-2 hover:bg-white/20 rounded",children:"Tt"}),b.jsx("button",{onClick:()=>{ae("Ting Vit"),O(!1)},className:"w-full text-left px-3 py-2 hover:bg-white/20 rounded",children:"Ting Vit"}),b.jsx("button",{onClick:()=>{ae("English"),O(!1)},className:"w-full text-left px-3 py-2 hover:bg-white/20 rounded",children:"English"})]})]}),b.jsxs("div",{className:"relative",children:[b.jsx("button",{onClick:()=>_(!C),className:"p-2 hover:bg-white/20 rounded-lg transition-colors",children:b.jsx(rI,{className:"w-5 h-5"})}),C&&b.jsxs("div",{className:"absolute bottom-full right-0 mb-2 p-2 bg-black/90 rounded-lg min-w-[150px]",children:[b.jsx("div",{className:"px-3 py-1 text-xs text-gray-400",children:"Cht lng"}),["Auto","1080p","720p","480p","360p"].map(te=>b.jsx("button",{onClick:()=>{z(te),_(!1)},className:`w-full text-left px-3 py-2 hover:bg-white/20 rounded ${W===te?"text-red-500":""}`,children:te},te))]})]}),b.jsx("button",{onClick:P,className:"p-2 hover:bg-white/20 rounded-lg transition-colors",children:b.jsx(Qb,{className:"w-5 h-5"})}),n&&b.jsx("button",{onClick:n,className:"px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg text-sm font-medium transition-colors",children:"Tp tip"})]})]})]})]})})]})}function w2(){const{id:i}=IE(),[e]=NE(),t=As(),n=e.get("ep")?parseInt(e.get("ep")):void 0,r=i?nc(i):null;if(!r)return b.jsx("div",{className:"min-h-screen flex items-center justify-center",children:b.jsxs("div",{className:"text-center",children:[b.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Khng tm thy phim"}),b.jsx(kt,{to:"/",className:"text-red-500 hover:underline",children:"V trang ch"})]})});const s=r.type==="series"&&n&&r.seasons?r.seasons[0].episodes.find(h=>h.episodeNumber===n):null,a=(s==null?void 0:s.videoUrl)||r.videoUrl,u=s?`${r.title} - Tp ${n}`:r.title,d=()=>{if(r.type==="series"&&n&&r.seasons){const h=n+1;r.seasons[0].episodes.find(p=>p.episodeNumber===h)&&t(`/watch/${r.id}?ep=${h}`)}},c=r.type==="series"&&n&&r.seasons&&n<r.seasons[0].episodes.length;return b.jsxs("div",{className:"min-h-screen bg-black",children:[b.jsx("div",{className:"absolute top-20 left-4 sm:left-8 z-50",children:b.jsxs("button",{onClick:()=>t(-1),className:"flex items-center gap-2 px-4 py-2 bg-black/80 hover:bg-black backdrop-blur-sm rounded-lg transition-colors",children:[b.jsx(FE,{className:"w-5 h-5"}),b.jsx("span",{className:"hidden sm:inline",children:"Quay li"})]})}),b.jsx("div",{className:"w-full",children:b.jsx(A2,{videoUrl:a,movieId:r.id,movieTitle:u,onNext:c?d:void 0,episodeNumber:n})}),b.jsx("div",{className:"max-w-[1920px] mx-auto px-4 sm:px-6 lg:px-8 py-8",children:b.jsxs(Pt.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:[b.jsxs("div",{className:"flex items-start gap-6 mb-8",children:[b.jsx("img",{src:r.poster,alt:r.title,className:"w-32 sm:w-40 rounded-lg shadow-lg"}),b.jsxs("div",{className:"flex-1",children:[b.jsx("h1",{className:"text-3xl font-bold mb-2",children:r.title}),b.jsx("p",{className:"text-gray-400 mb-4",children:r.originalTitle}),b.jsx("p",{className:"text-gray-300 mb-4",children:r.description}),b.jsxs(kt,{to:`/movie/${r.id}`,className:"inline-flex items-center gap-2 px-4 py-2 bg-white/10 hover:bg-white/20 border border-white/20 rounded-lg transition-colors",children:[b.jsx(UE,{className:"w-4 h-4"}),"Xem chi tit"]})]})]}),r.type==="series"&&r.seasons&&b.jsxs("div",{children:[b.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"Cc tp phim"}),b.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-3",children:r.seasons[0].episodes.map(h=>b.jsx(kt,{to:`/watch/${r.id}?ep=${h.episodeNumber}`,className:`aspect-video rounded-lg overflow-hidden bg-white/10 hover:bg-white/20 border transition-all ${n===h.episodeNumber?"border-red-500 ring-2 ring-red-500":"border-white/20 hover:border-red-500"}`,children:b.jsxs("div",{className:"relative w-full h-full flex items-center justify-center",children:[b.jsx("img",{src:h.thumbnail,alt:h.title,className:"absolute inset-0 w-full h-full object-cover opacity-40"}),b.jsxs("div",{className:"relative z-10 text-center",children:[b.jsxs("p",{className:"font-semibold",children:["Tp ",h.episodeNumber]}),n===h.episodeNumber&&b.jsx("p",{className:"text-xs text-red-500 mt-1",children:"ang xem"})]})]})},h.episodeNumber))})]})]})})]})}function L2(){const[i,e]=NE(),t=i.get("q")||"",[n,r]=M.useState(t),[s,a]=M.useState(ir),[u,d]=M.useState(!1),[c,h]=M.useState([]),[m,p]=M.useState([]),[y,v]=M.useState([]),[E,S]=M.useState("all"),[A,L]=M.useState(0),R=p_(),D=g_(),k=y_();M.useEffect(()=>{let z=ir;if(n.trim()){const re=n.toLowerCase();z=z.filter(ae=>ae.title.toLowerCase().includes(re)||ae.originalTitle.toLowerCase().includes(re)||ae.description.toLowerCase().includes(re)||ae.director.toLowerCase().includes(re))}c.length>0&&(z=z.filter(re=>c.some(ae=>re.genres.includes(ae)))),m.length>0&&(z=z.filter(re=>m.includes(re.country))),y.length>0&&(z=z.filter(re=>y.includes(re.releaseYear))),E!=="all"&&(z=z.filter(re=>re.type===E)),A>0&&(z=z.filter(re=>re.rating>=A)),a(z)},[n,c,m,y,E,A]);const U=z=>{z.preventDefault(),n.trim()&&e({q:n.trim()})},C=z=>{h(re=>re.includes(z)?re.filter(ae=>ae!==z):[...re,z])},_=z=>{p(re=>re.includes(z)?re.filter(ae=>ae!==z):[...re,z])},F=z=>{v(re=>re.includes(z)?re.filter(ae=>ae!==z):[...re,z])},O=()=>{h([]),p([]),v([]),S("all"),L(0)},W=c.length>0||m.length>0||y.length>0||E!=="all"||A>0;return b.jsx("div",{className:"min-h-screen py-8",children:b.jsxs("div",{className:"max-w-[1920px] mx-auto px-4 sm:px-6 lg:px-8",children:[b.jsxs("div",{className:"mb-8",children:[b.jsx("h1",{className:"text-3xl font-bold mb-6",children:"Tm kim phim"}),b.jsxs("form",{onSubmit:U,className:"flex gap-3 mb-4",children:[b.jsxs("div",{className:"relative flex-1",children:[b.jsx("input",{type:"text",value:n,onChange:z=>r(z.target.value),placeholder:"Tm kim theo tn phim, o din...",className:"w-full bg-white/10 border border-white/20 rounded-lg px-4 py-3 pl-12 text-white placeholder-gray-400 focus:outline-none focus:border-red-500 focus:bg-white/15 transition-all"}),b.jsx(Do,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"})]}),b.jsxs("button",{type:"button",onClick:()=>d(!u),className:`flex items-center gap-2 px-6 py-3 rounded-lg font-medium transition-colors ${u||W?"bg-red-600 hover:bg-red-700":"bg-white/10 hover:bg-white/20 border border-white/20"}`,children:[b.jsx(lI,{className:"w-5 h-5"}),b.jsx("span",{className:"hidden sm:inline",children:"B lc"}),W&&b.jsx("span",{className:"w-2 h-2 bg-white rounded-full"})]})]}),u&&b.jsxs(Pt.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"p-6 bg-white/5 border border-white/10 rounded-lg space-y-6",children:[b.jsxs("div",{children:[b.jsx("div",{className:"flex items-center justify-between mb-3",children:b.jsx("h3",{className:"font-semibold",children:"Loi phim"})}),b.jsx("div",{className:"flex gap-2",children:[{value:"all",label:"Tt c"},{value:"movie",label:"Phim l"},{value:"series",label:"Phim b"}].map(z=>b.jsx("button",{onClick:()=>S(z.value),className:`px-4 py-2 rounded-lg font-medium transition-colors ${E===z.value?"bg-red-600":"bg-white/10 hover:bg-white/20"}`,children:z.label},z.value))})]}),b.jsxs("div",{children:[b.jsxs("div",{className:"flex items-center justify-between mb-3",children:[b.jsx("h3",{className:"font-semibold",children:"nh gi ti thiu"}),b.jsx("span",{className:"text-sm text-gray-400",children:A.toFixed(1)})]}),b.jsx("input",{type:"range",min:"0",max:"10",step:"0.5",value:A,onChange:z=>L(parseFloat(z.target.value)),className:"w-full"})]}),b.jsxs("div",{children:[b.jsxs("div",{className:"flex items-center justify-between mb-3",children:[b.jsx("h3",{className:"font-semibold",children:"Th loi"}),c.length>0&&b.jsxs("span",{className:"text-sm text-gray-400",children:[c.length,"  chn"]})]}),b.jsx("div",{className:"flex flex-wrap gap-2",children:R.map(z=>b.jsx("button",{onClick:()=>C(z),className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-colors ${c.includes(z)?"bg-red-600":"bg-white/10 hover:bg-white/20"}`,children:z},z))})]}),b.jsxs("div",{children:[b.jsxs("div",{className:"flex items-center justify-between mb-3",children:[b.jsx("h3",{className:"font-semibold",children:"Quc gia"}),m.length>0&&b.jsxs("span",{className:"text-sm text-gray-400",children:[m.length,"  chn"]})]}),b.jsx("div",{className:"flex flex-wrap gap-2",children:D.map(z=>b.jsx("button",{onClick:()=>_(z),className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-colors ${m.includes(z)?"bg-red-600":"bg-white/10 hover:bg-white/20"}`,children:z},z))})]}),b.jsxs("div",{children:[b.jsxs("div",{className:"flex items-center justify-between mb-3",children:[b.jsx("h3",{className:"font-semibold",children:"Nm pht hnh"}),y.length>0&&b.jsxs("span",{className:"text-sm text-gray-400",children:[y.length,"  chn"]})]}),b.jsx("div",{className:"flex flex-wrap gap-2",children:k.map(z=>b.jsx("button",{onClick:()=>F(z),className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-colors ${y.includes(z)?"bg-red-600":"bg-white/10 hover:bg-white/20"}`,children:z},z))})]}),W&&b.jsxs("button",{onClick:O,className:"flex items-center gap-2 px-4 py-2 bg-white/10 hover:bg-white/20 rounded-lg transition-colors",children:[b.jsx(yI,{className:"w-4 h-4"}),"Xa b lc"]})]})]}),b.jsx("div",{className:"mb-6",children:b.jsxs("h2",{className:"text-xl font-semibold",children:[s.length," kt qu",n&&` cho "${n}"`]})}),s.length>0?b.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4",children:s.map((z,re)=>b.jsx(Pt.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:re*.03,duration:.4},children:b.jsx(Wm,{movie:z})},z.id))}):b.jsxs("div",{className:"text-center py-20",children:[b.jsx(Do,{className:"w-16 h-16 text-gray-600 mx-auto mb-4"}),b.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Khng tm thy kt qu"}),b.jsx("p",{className:"text-gray-400",children:"Th thay i t kha hoc b lc"})]})]})})}function R2(){const i=As(),e=ko.getCurrentUser(),[t,n]=M.useState("watchlist"),[r,s]=M.useState([]),[a,u]=M.useState([]);if(M.useEffect(()=>{if(!e){i("/login");return}const p=mi.getWatchlist().map(E=>nc(E.movieId)).filter(E=>E!==void 0);s(p);const v=Pu.getHistory().map(E=>{const S=nc(E.movieId);return S?{movie:S,progress:E.progress,watchedAt:E.watchedAt}:null}).filter(E=>E!==null);u(v)},[e,i]),!e)return null;const d=m=>{mi.removeFromWatchlist(m),s(p=>p.filter(y=>y.id!==m))},c=m=>{Pu.removeFromHistory(m),u(p=>p.filter(y=>y.movie.id!==m))},h=()=>{confirm("Bn c chc mun xa ton b lch s xem?")&&(Pu.clearHistory(),u([]))};return b.jsx("div",{className:"min-h-screen py-8",children:b.jsxs("div",{className:"max-w-[1920px] mx-auto px-4 sm:px-6 lg:px-8",children:[b.jsxs(Pt.div,{className:"flex items-center gap-6 mb-8 p-6 bg-gradient-to-r from-red-900/20 to-transparent border border-white/10 rounded-lg",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[b.jsx("img",{src:e.avatar,alt:e.name,className:"w-20 h-20 rounded-full border-2 border-red-500"}),b.jsxs("div",{children:[b.jsx("h1",{className:"text-3xl font-bold mb-1",children:e.name}),b.jsx("p",{className:"text-gray-400",children:e.email}),b.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Thnh vin t ",new Date(e.createdAt).toLocaleDateString("vi-VN")]})]})]}),b.jsxs("div",{className:"flex gap-4 mb-8 border-b border-white/10",children:[b.jsxs("button",{onClick:()=>n("watchlist"),className:`flex items-center gap-2 px-6 py-3 font-semibold transition-colors relative ${t==="watchlist"?"text-red-500":"text-gray-400 hover:text-white"}`,children:[b.jsx(df,{className:"w-5 h-5"}),"Danh sch ca ti",t==="watchlist"&&b.jsx(Pt.div,{layoutId:"activeTab",className:"absolute bottom-0 left-0 right-0 h-0.5 bg-red-500"})]}),b.jsxs("button",{onClick:()=>n("history"),className:`flex items-center gap-2 px-6 py-3 font-semibold transition-colors relative ${t==="history"?"text-red-500":"text-gray-400 hover:text-white"}`,children:[b.jsx(uf,{className:"w-5 h-5"}),"Lch s xem",t==="history"&&b.jsx(Pt.div,{layoutId:"activeTab",className:"absolute bottom-0 left-0 right-0 h-0.5 bg-red-500"})]})]}),t==="watchlist"&&b.jsxs(Pt.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},children:[b.jsx("div",{className:"flex items-center justify-between mb-6",children:b.jsxs("h2",{className:"text-2xl font-semibold",children:[r.length," phim trong danh sch"]})}),r.length>0?b.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4",children:r.map(m=>b.jsxs("div",{className:"relative group",children:[b.jsx(Wm,{movie:m}),b.jsx("button",{onClick:()=>d(m.id),className:"absolute top-2 right-2 p-2 bg-black/80 hover:bg-red-600 rounded-lg opacity-0 group-hover:opacity-100 transition-all z-10",title:"Xa khi danh sch",children:b.jsx(fh,{className:"w-4 h-4"})})]},m.id))}):b.jsxs("div",{className:"text-center py-20",children:[b.jsx(df,{className:"w-16 h-16 text-gray-600 mx-auto mb-4"}),b.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Danh sch trng"}),b.jsx("p",{className:"text-gray-400 mb-6",children:"Thm phim vo danh sch  xem sau"}),b.jsx("button",{onClick:()=>i("/"),className:"px-6 py-3 bg-red-600 hover:bg-red-700 rounded-lg font-medium transition-colors",children:"Khm ph phim"})]})]},"watchlist"),t==="history"&&b.jsxs(Pt.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},children:[b.jsxs("div",{className:"flex items-center justify-between mb-6",children:[b.jsxs("h2",{className:"text-2xl font-semibold",children:[a.length," phim  xem"]}),a.length>0&&b.jsxs("button",{onClick:h,className:"flex items-center gap-2 px-4 py-2 bg-white/10 hover:bg-red-600 rounded-lg transition-colors",children:[b.jsx(fh,{className:"w-4 h-4"}),"Xa tt c"]})]}),a.length>0?b.jsx("div",{className:"space-y-4",children:a.map(m=>b.jsxs(Pt.div,{className:"flex gap-4 p-4 bg-white/5 hover:bg-white/10 border border-white/10 rounded-lg transition-colors group",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},children:[b.jsx("div",{className:"flex-none w-32 sm:w-40 aspect-video rounded-lg overflow-hidden bg-gray-900",children:b.jsx("img",{src:m.movie.backdrop,alt:m.movie.title,className:"w-full h-full object-cover"})}),b.jsxs("div",{className:"flex-1 min-w-0",children:[b.jsx("h3",{className:"text-lg font-semibold mb-1 truncate",children:m.movie.title}),b.jsxs("p",{className:"text-sm text-gray-400 mb-2",children:["Xem ln cui: ",new Date(m.watchedAt).toLocaleString("vi-VN")]}),b.jsxs("div",{className:"mb-3",children:[b.jsxs("div",{className:"flex items-center justify-between text-sm mb-1",children:[b.jsx("span",{className:"text-gray-400",children:"Tin "}),b.jsxs("span",{children:[Math.round(m.progress),"%"]})]}),b.jsx("div",{className:"h-1.5 bg-white/10 rounded-full overflow-hidden",children:b.jsx("div",{className:"h-full bg-red-600 rounded-full",style:{width:`${m.progress}%`}})})]}),b.jsxs("div",{className:"flex gap-2",children:[b.jsxs("button",{onClick:()=>i(`/watch/${m.movie.id}`),className:"flex items-center gap-2 px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg text-sm font-medium transition-colors",children:[b.jsx(Es,{className:"w-4 h-4"}),m.progress<90?"Xem tip":"Xem li"]}),b.jsx("button",{onClick:()=>c(m.movie.id),className:"p-2 hover:bg-red-600 rounded-lg transition-colors",title:"Xa khi lch s",children:b.jsx(fh,{className:"w-4 h-4"})})]})]})]},m.movie.id))}):b.jsxs("div",{className:"text-center py-20",children:[b.jsx(uf,{className:"w-16 h-16 text-gray-600 mx-auto mb-4"}),b.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Cha c lch s xem"}),b.jsx("p",{className:"text-gray-400 mb-6",children:"Bt u xem phim  lu li lch s"}),b.jsx("button",{onClick:()=>i("/"),className:"px-6 py-3 bg-red-600 hover:bg-red-700 rounded-lg font-medium transition-colors",children:"Khm ph phim"})]})]},"history")]})})}function b2(){const i=As(),[e,t]=M.useState("login"),[n,r]=M.useState(""),[s,a]=M.useState(""),[u,d]=M.useState(""),[c,h]=M.useState(""),m=p=>{if(p.preventDefault(),h(""),e==="login"){const y=ko.login(n,s);y.success?i("/"):h(y.error||"ng nhp tht bi")}else{const y=ko.register(n,s,u);y.success?i("/"):h(y.error||"ng k tht bi")}};return b.jsxs("div",{className:"min-h-screen bg-[#0a0a0a] flex items-center justify-center p-4",children:[b.jsxs("div",{className:"fixed inset-0 overflow-hidden",children:[b.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-red-900/20 via-transparent to-purple-900/20"}),b.jsx("div",{className:"absolute top-20 left-10 w-72 h-72 bg-red-600/10 rounded-full blur-3xl"}),b.jsx("div",{className:"absolute bottom-20 right-10 w-96 h-96 bg-purple-600/10 rounded-full blur-3xl"})]}),b.jsxs(Pt.div,{className:"relative w-full max-w-md",initial:{opacity:0,y:40},animate:{opacity:1,y:0},transition:{duration:.6},children:[b.jsxs("div",{className:"flex items-center justify-center gap-2 mb-8",children:[b.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-red-600 to-red-800 rounded-xl flex items-center justify-center",children:b.jsx(cf,{className:"w-7 h-7 text-white"})}),b.jsx("span",{className:"text-3xl font-bold bg-gradient-to-r from-white to-gray-300 bg-clip-text text-transparent",children:"VieStream"})]}),b.jsxs("div",{className:"bg-black/40 backdrop-blur-xl border border-white/10 rounded-2xl p-8 shadow-2xl",children:[b.jsxs("div",{className:"flex gap-2 mb-8 p-1 bg-white/5 rounded-lg",children:[b.jsx("button",{onClick:()=>{t("login"),h("")},className:`flex-1 py-2.5 rounded-lg font-medium transition-colors ${e==="login"?"bg-red-600 text-white":"text-gray-400 hover:text-white"}`,children:"ng nhp"}),b.jsx("button",{onClick:()=>{t("register"),h("")},className:`flex-1 py-2.5 rounded-lg font-medium transition-colors ${e==="register"?"bg-red-600 text-white":"text-gray-400 hover:text-white"}`,children:"ng k"})]}),b.jsxs("form",{onSubmit:m,className:"space-y-5",children:[e==="register"&&b.jsxs("div",{children:[b.jsx("label",{htmlFor:"name",className:"block text-sm font-medium mb-2",children:"H v tn"}),b.jsxs("div",{className:"relative",children:[b.jsx("input",{id:"name",type:"text",value:u,onChange:p=>d(p.target.value),placeholder:"Nhp h v tn",required:!0,className:"w-full bg-white/10 border border-white/20 rounded-lg px-4 py-3 pl-11 text-white placeholder-gray-400 focus:outline-none focus:border-red-500 focus:bg-white/15 transition-all"}),b.jsx(jE,{className:"absolute left-3.5 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"})]})]}),b.jsxs("div",{children:[b.jsx("label",{htmlFor:"email",className:"block text-sm font-medium mb-2",children:"Email"}),b.jsxs("div",{className:"relative",children:[b.jsx("input",{id:"email",type:"email",value:n,onChange:p=>r(p.target.value),placeholder:"your@email.com",required:!0,className:"w-full bg-white/10 border border-white/20 rounded-lg px-4 py-3 pl-11 text-white placeholder-gray-400 focus:outline-none focus:border-red-500 focus:bg-white/15 transition-all"}),b.jsx(qb,{className:"absolute left-3.5 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"})]})]}),b.jsxs("div",{children:[b.jsx("label",{htmlFor:"password",className:"block text-sm font-medium mb-2",children:"Mt khu"}),b.jsxs("div",{className:"relative",children:[b.jsx("input",{id:"password",type:"password",value:s,onChange:p=>a(p.target.value),placeholder:"",required:!0,className:"w-full bg-white/10 border border-white/20 rounded-lg px-4 py-3 pl-11 text-white placeholder-gray-400 focus:outline-none focus:border-red-500 focus:bg-white/15 transition-all"}),b.jsx(zb,{className:"absolute left-3.5 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"})]})]}),c&&b.jsx(Pt.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"p-3 bg-red-500/10 border border-red-500/20 rounded-lg text-red-400 text-sm",children:c}),b.jsx("button",{type:"submit",className:"w-full py-3 bg-red-600 hover:bg-red-700 rounded-lg font-semibold transition-colors shadow-lg shadow-red-600/20",children:e==="login"?"ng nhp":"ng k"})]}),b.jsx("div",{className:"mt-6 p-4 bg-blue-500/10 border border-blue-500/20 rounded-lg",children:b.jsx("p",{className:"text-sm text-blue-300 text-center",children:" Demo mode: Nhp bt k email v mt khu  tri nghim"})}),b.jsx("button",{onClick:()=>i("/"),className:"w-full mt-4 text-sm text-gray-400 hover:text-white transition-colors",children:"Quay v trang ch"})]}),b.jsx("p",{className:"text-center text-sm text-gray-500 mt-6",children:"y l demo app streaming phim OTT/Streaming"})]})]})}function I2(){return b.jsx("div",{className:"min-h-screen flex items-center justify-center px-4",children:b.jsxs(Pt.div,{className:"text-center",initial:{opacity:0,y:40},animate:{opacity:1,y:0},transition:{duration:.6},children:[b.jsx("h1",{className:"text-9xl font-bold bg-gradient-to-r from-red-600 to-purple-600 bg-clip-text text-transparent mb-4",children:"404"}),b.jsx("h2",{className:"text-3xl font-bold mb-4",children:"Khng tm thy trang"}),b.jsx("p",{className:"text-gray-400 mb-8 max-w-md",children:"Trang bn ang tm kim khng tn ti hoc  b di chuyn."}),b.jsxs("div",{className:"flex flex-wrap gap-3 justify-center",children:[b.jsxs(kt,{to:"/",className:"flex items-center gap-2 px-6 py-3 bg-red-600 hover:bg-red-700 rounded-lg font-semibold transition-colors",children:[b.jsx(BE,{className:"w-5 h-5"}),"V trang ch"]}),b.jsxs(kt,{to:"/search",className:"flex items-center gap-2 px-6 py-3 bg-white/10 hover:bg-white/20 border border-white/20 rounded-lg font-semibold transition-colors",children:[b.jsx(Do,{className:"w-5 h-5"}),"Tm kim phim"]})]})]})})}const C2=fb([{path:"/",Component:xI,children:[{index:!0,Component:v_},{path:"movie/:id",Component:x_},{path:"watch/:id",Component:w2},{path:"search",Component:L2},{path:"profile",Component:R2},{path:"*",Component:I2}]},{path:"/login",Component:b2}]);function D2(){return b.jsx(BR,{router:C2})}Xw.createRoot(document.getElementById("root")).render(b.jsx(D2,{}));
